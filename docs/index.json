[
  {
    "__docId__": 1,
    "kind": "external",
    "name": "Infinity",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Infinity",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Infinity",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 2,
    "kind": "external",
    "name": "NaN",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NaN",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~NaN",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 3,
    "kind": "external",
    "name": "undefined",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~undefined",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 4,
    "kind": "external",
    "name": "null",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/null",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~null",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 5,
    "kind": "external",
    "name": "Object",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Object",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 6,
    "kind": "external",
    "name": "object",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~object",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 7,
    "kind": "external",
    "name": "Function",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Function",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 8,
    "kind": "external",
    "name": "function",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~function",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 9,
    "kind": "external",
    "name": "Boolean",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Boolean",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 10,
    "kind": "external",
    "name": "boolean",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~boolean",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 11,
    "kind": "external",
    "name": "Symbol",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Symbol",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 12,
    "kind": "external",
    "name": "Error",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Error",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 13,
    "kind": "external",
    "name": "EvalError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/EvalError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~EvalError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 14,
    "kind": "external",
    "name": "InternalError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/InternalError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~InternalError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 15,
    "kind": "external",
    "name": "RangeError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RangeError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~RangeError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 16,
    "kind": "external",
    "name": "ReferenceError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ReferenceError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~ReferenceError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 17,
    "kind": "external",
    "name": "SyntaxError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SyntaxError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~SyntaxError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 18,
    "kind": "external",
    "name": "TypeError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypeError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~TypeError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 19,
    "kind": "external",
    "name": "URIError",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/URIError",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~URIError",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 20,
    "kind": "external",
    "name": "Number",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Number",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 21,
    "kind": "external",
    "name": "number",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~number",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 22,
    "kind": "external",
    "name": "Date",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Date",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 23,
    "kind": "external",
    "name": "String",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~String",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 24,
    "kind": "external",
    "name": "string",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~string",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 25,
    "kind": "external",
    "name": "RegExp",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~RegExp",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 26,
    "kind": "external",
    "name": "Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 27,
    "kind": "external",
    "name": "Int8Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int8Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Int8Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 28,
    "kind": "external",
    "name": "Uint8Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Uint8Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 29,
    "kind": "external",
    "name": "Uint8ClampedArray",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Uint8ClampedArray",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 30,
    "kind": "external",
    "name": "Int16Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int16Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Int16Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 31,
    "kind": "external",
    "name": "Uint16Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Uint16Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 32,
    "kind": "external",
    "name": "Int32Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int32Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Int32Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 33,
    "kind": "external",
    "name": "Uint32Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Uint32Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 34,
    "kind": "external",
    "name": "Float32Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Float32Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 35,
    "kind": "external",
    "name": "Float64Array",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float64Array",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Float64Array",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 36,
    "kind": "external",
    "name": "Map",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Map",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 37,
    "kind": "external",
    "name": "Set",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Set",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 38,
    "kind": "external",
    "name": "WeakMap",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~WeakMap",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 39,
    "kind": "external",
    "name": "WeakSet",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~WeakSet",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 40,
    "kind": "external",
    "name": "ArrayBuffer",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~ArrayBuffer",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 41,
    "kind": "external",
    "name": "DataView",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~DataView",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 42,
    "kind": "external",
    "name": "JSON",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~JSON",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 43,
    "kind": "external",
    "name": "Promise",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Promise",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 44,
    "kind": "external",
    "name": "Generator",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Generator",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 45,
    "kind": "external",
    "name": "GeneratorFunction",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/GeneratorFunction",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~GeneratorFunction",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 46,
    "kind": "external",
    "name": "Reflect",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Reflect",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 47,
    "kind": "external",
    "name": "Proxy",
    "externalLink": "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",
    "memberof": "src/.external-ecmascript.js",
    "static": true,
    "longname": "src/.external-ecmascript.js~Proxy",
    "access": "public",
    "description": "",
    "builtinExternal": true
  },
  {
    "__docId__": 48,
    "kind": "file",
    "name": "src/client/index.js",
    "content": "// Load in HTML templates\r\nvar viewportPath = \"../public/templates/viewport.html\";\r\nvar studyViewerPath = \"../public/templates/studyViewer.html\";\r\n\r\n/* ========================= MESSAGES ========================= */\r\n\r\nwindow.addEventListener('fileToDirectory', function(e) {\r\n  SaveData('data.txt', e.detail.rawData)\r\n});\r\n\r\nvar SaveData = function(fileName, data) {\r\n  alert(fileName);\r\n  var fs = require('fs');\r\n  fs.writeFile(fileName, data, 'utf8', function(err) {\r\n    if (err) {\r\n      return console.log(err);\r\n    }\r\n    console.log(\"The file was saved!\");\r\n  });\r\n};\r\n\r\n/* ============================================================ */\r\n\r\n// The file with the list of all studies.\r\nvar fileName = '../common/studyList';\r\nvar fileFormat = '.json';\r\nvar studyListFile = fileName + fileFormat;\r\n\r\nconsole.log('Read Study List File From: \\n', studyListFile);\r\n\r\nvar viewportTemplate; // the viewport template\r\nloadTemplate(viewportPath, function(element) {\r\n  viewportTemplate = element;\r\n});\r\n\r\nvar studyViewerTemplate; // the study viewer template\r\nloadTemplate(studyViewerPath, function(element) {\r\n  studyViewerTemplate = element;\r\n});\r\n\r\n// Get study list from JSON manifest\r\n$.getJSON(studyListFile, function(data) {\r\n  data.studyList.forEach(function(study) {\r\n\r\n    // Create one table row for each study in the manifest\r\n    var studyRow = '<tr><td>' +\r\n      study.patientName + '</td><td>' +\r\n      study.patientId + '</td><td>' +\r\n      study.studyDate + '</td><td>' +\r\n      study.modality + '</td><td>' +\r\n      study.studyDescription + '</td><td>' +\r\n      study.numImages + '</td><td>' +\r\n      '</tr>';\r\n\r\n    // Append the row to the study list\r\n    var studyRowElement = $(studyRow).appendTo('#studyListData');\r\n\r\n    // On study list row click\r\n    $(studyRowElement).click(function() {\r\n\r\n      // Add new tab for this study and switch to it\r\n      var studyTab = '<li><a href=\"#x' + study.patientId + '\" data-toggle=\"tab\">' + study.patientName + '</a></li>';\r\n      $('#tabs').append(studyTab);\r\n\r\n      // Add tab content by making a copy of the studyViewerTemplate element\r\n      var studyViewerCopy = studyViewerTemplate.clone();\r\n\r\n      var viewportCopy = viewportTemplate.clone();\r\n      studyViewerCopy.find('.imageViewer').append(viewportCopy);\r\n\r\n\r\n      studyViewerCopy.attr(\"id\", 'x' + study.patientId);\r\n      // Make the viewer visible\r\n      studyViewerCopy.removeClass('hidden');\r\n      // Add section to the tab content\r\n      studyViewerCopy.appendTo('#tabContent');\r\n\r\n      // Show the new tab (which will be the last one since it was just added\r\n      $('#tabs a:last').tab('show');\r\n\r\n      // Toggle window resize (?)\r\n      $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function(e) {\r\n        $(window).trigger('resize');\r\n      });\r\n\r\n      studyViewerCopy.roiData = {\r\n        studyId: study.studyId,\r\n        modality: study.modality,\r\n        stacks: [],\r\n      };\r\n\r\n      // Now load the study.json\r\n      loadStudy(studyViewerCopy, viewportTemplate, study.studyId + fileFormat);\r\n    });\r\n  });\r\n});\r\n\r\n// Show tabs on click\r\n$('#tabs a').click(function(e) {\r\n  e.preventDefault();\r\n  $(this).tab('show');\r\n});\r\n\r\n// Resize main\r\nfunction resizeMain() {\r\n  var height = $(window).height();\r\n  $('#main').height(height - 50);\r\n  $('#tabContent').height(height - 50 - 42);\r\n}\r\n\r\n// Call resize main on window resize\r\n$(window).resize(function() {\r\n  resizeMain();\r\n});\r\nresizeMain();\r\n\r\n// Prevent scrolling on iOS\r\ndocument.body.addEventListener('touchmove', function(e) {\r\n  e.preventDefault();\r\n});\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/index.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 49,
    "kind": "variable",
    "name": "viewportPath",
    "memberof": "src/client/index.js",
    "static": true,
    "longname": "src/client/index.js~viewportPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 50,
    "kind": "variable",
    "name": "studyViewerPath",
    "memberof": "src/client/index.js",
    "static": true,
    "longname": "src/client/index.js~studyViewerPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 51,
    "kind": "function",
    "name": "SaveData",
    "memberof": "src/client/index.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/index.js~SaveData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 11,
    "undocument": true,
    "params": [
      {
        "name": "fileName",
        "types": [
          "*"
        ]
      },
      {
        "name": "data",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 52,
    "kind": "variable",
    "name": "fileName",
    "memberof": "src/client/index.js",
    "static": true,
    "longname": "src/client/index.js~fileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 25,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 53,
    "kind": "variable",
    "name": "fileFormat",
    "memberof": "src/client/index.js",
    "static": true,
    "longname": "src/client/index.js~fileFormat",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 26,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 54,
    "kind": "variable",
    "name": "studyListFile",
    "memberof": "src/client/index.js",
    "static": true,
    "longname": "src/client/index.js~studyListFile",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 27,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 55,
    "kind": "function",
    "name": "resizeMain",
    "memberof": "src/client/index.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/index.js~resizeMain",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 105,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 56,
    "kind": "file",
    "name": "src/client/lib/bootstrap.min.js",
    "content": "/*!\r\n * Bootstrap v3.3.5 (http://getbootstrap.com)\r\n * Copyright 2011-2015 Twitter, Inc.\r\n * Licensed under the MIT license\r\n */\r\nif(\"undefined\"==typeof jQuery)throw new Error(\"Bootstrap's JavaScript requires jQuery\");+function(a){\"use strict\";var b=a.fn.jquery.split(\" \")[0].split(\".\");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1)throw new Error(\"Bootstrap's JavaScript requires jQuery version 1.9.1 or higher\")}(jQuery),+function(a){\"use strict\";function b(){var a=document.createElement(\"bootstrap\"),b={WebkitTransition:\"webkitTransitionEnd\",MozTransition:\"transitionend\",OTransition:\"oTransitionEnd otransitionend\",transition:\"transitionend\"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(\"bsTransitionEnd\",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var c=a(this),e=c.data(\"bs.alert\");e||c.data(\"bs.alert\",e=new d(this)),\"string\"==typeof b&&e[b].call(c)})}var c='[data-dismiss=\"alert\"]',d=function(b){a(b).on(\"click\",c,this.close)};d.VERSION=\"3.3.5\",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger(\"closed.bs.alert\").remove()}var e=a(this),f=e.attr(\"data-target\");f||(f=e.attr(\"href\"),f=f&&f.replace(/.*(?=#[^\\s]*$)/,\"\"));var g=a(f);b&&b.preventDefault(),g.length||(g=e.closest(\".alert\")),g.trigger(b=a.Event(\"close.bs.alert\")),b.isDefaultPrevented()||(g.removeClass(\"in\"),a.support.transition&&g.hasClass(\"fade\")?g.one(\"bsTransitionEnd\",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on(\"click.bs.alert.data-api\",c,d.prototype.close)}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var d=a(this),e=d.data(\"bs.button\"),f=\"object\"==typeof b&&b;e||d.data(\"bs.button\",e=new c(this,f)),\"toggle\"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION=\"3.3.5\",c.DEFAULTS={loadingText:\"loading...\"},c.prototype.setState=function(b){var c=\"disabled\",d=this.$element,e=d.is(\"input\")?\"val\":\"html\",f=d.data();b+=\"Text\",null==f.resetText&&d.data(\"resetText\",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),\"loadingText\"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle=\"buttons\"]');if(b.length){var c=this.$element.find(\"input\");\"radio\"==c.prop(\"type\")?(c.prop(\"checked\")&&(a=!1),b.find(\".active\").removeClass(\"active\"),this.$element.addClass(\"active\")):\"checkbox\"==c.prop(\"type\")&&(c.prop(\"checked\")!==this.$element.hasClass(\"active\")&&(a=!1),this.$element.toggleClass(\"active\")),c.prop(\"checked\",this.$element.hasClass(\"active\")),a&&c.trigger(\"change\")}else this.$element.attr(\"aria-pressed\",!this.$element.hasClass(\"active\")),this.$element.toggleClass(\"active\")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on(\"click.bs.button.data-api\",'[data-toggle^=\"button\"]',function(c){var d=a(c.target);d.hasClass(\"btn\")||(d=d.closest(\".btn\")),b.call(d,\"toggle\"),a(c.target).is('input[type=\"radio\"]')||a(c.target).is('input[type=\"checkbox\"]')||c.preventDefault()}).on(\"focus.bs.button.data-api blur.bs.button.data-api\",'[data-toggle^=\"button\"]',function(b){a(b.target).closest(\".btn\").toggleClass(\"focus\",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var d=a(this),e=d.data(\"bs.carousel\"),f=a.extend({},c.DEFAULTS,d.data(),\"object\"==typeof b&&b),g=\"string\"==typeof b?b:f.slide;e||d.data(\"bs.carousel\",e=new c(this,f)),\"number\"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(\".carousel-indicators\"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on(\"keydown.bs.carousel\",a.proxy(this.keydown,this)),\"hover\"==this.options.pause&&!(\"ontouchstart\"in document.documentElement)&&this.$element.on(\"mouseenter.bs.carousel\",a.proxy(this.pause,this)).on(\"mouseleave.bs.carousel\",a.proxy(this.cycle,this))};c.VERSION=\"3.3.5\",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:\"hover\",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(\".item\"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d=\"prev\"==a&&0===c||\"next\"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e=\"prev\"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(\".item.active\"));return a>this.$items.length-1||0>a?void 0:this.sliding?this.$element.one(\"slid.bs.carousel\",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?\"next\":\"prev\",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(\".next, .prev\").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide(\"next\")},c.prototype.prev=function(){return this.sliding?void 0:this.slide(\"prev\")},c.prototype.slide=function(b,d){var e=this.$element.find(\".item.active\"),f=d||this.getItemForDirection(b,e),g=this.interval,h=\"next\"==b?\"left\":\"right\",i=this;if(f.hasClass(\"active\"))return this.sliding=!1;var j=f[0],k=a.Event(\"slide.bs.carousel\",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(\".active\").removeClass(\"active\");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass(\"active\")}var m=a.Event(\"slid.bs.carousel\",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass(\"slide\")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one(\"bsTransitionEnd\",function(){f.removeClass([b,h].join(\" \")).addClass(\"active\"),e.removeClass([\"active\",h].join(\" \")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass(\"active\"),f.addClass(\"active\"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr(\"data-target\")||(d=e.attr(\"href\"))&&d.replace(/.*(?=#[^\\s]+$)/,\"\"));if(f.hasClass(\"carousel\")){var g=a.extend({},f.data(),e.data()),h=e.attr(\"data-slide-to\");h&&(g.interval=!1),b.call(f,g),h&&f.data(\"bs.carousel\").to(h),c.preventDefault()}};a(document).on(\"click.bs.carousel.data-api\",\"[data-slide]\",e).on(\"click.bs.carousel.data-api\",\"[data-slide-to]\",e),a(window).on(\"load\",function(){a('[data-ride=\"carousel\"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){\"use strict\";function b(b){var c,d=b.attr(\"data-target\")||(c=b.attr(\"href\"))&&c.replace(/.*(?=#[^\\s]+$)/,\"\");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data(\"bs.collapse\"),f=a.extend({},d.DEFAULTS,c.data(),\"object\"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data(\"bs.collapse\",e=new d(this,f)),\"string\"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle=\"collapse\"][href=\"#'+b.id+'\"],[data-toggle=\"collapse\"][data-target=\"#'+b.id+'\"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION=\"3.3.5\",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass(\"width\");return a?\"width\":\"height\"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass(\"in\")){var b,e=this.$parent&&this.$parent.children(\".panel\").children(\".in, .collapsing\");if(!(e&&e.length&&(b=e.data(\"bs.collapse\"),b&&b.transitioning))){var f=a.Event(\"show.bs.collapse\");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,\"hide\"),b||e.data(\"bs.collapse\",null));var g=this.dimension();this.$element.removeClass(\"collapse\").addClass(\"collapsing\")[g](0).attr(\"aria-expanded\",!0),this.$trigger.removeClass(\"collapsed\").attr(\"aria-expanded\",!0),this.transitioning=1;var h=function(){this.$element.removeClass(\"collapsing\").addClass(\"collapse in\")[g](\"\"),this.transitioning=0,this.$element.trigger(\"shown.bs.collapse\")};if(!a.support.transition)return h.call(this);var i=a.camelCase([\"scroll\",g].join(\"-\"));this.$element.one(\"bsTransitionEnd\",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass(\"in\")){var b=a.Event(\"hide.bs.collapse\");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass(\"collapsing\").removeClass(\"collapse in\").attr(\"aria-expanded\",!1),this.$trigger.addClass(\"collapsed\").attr(\"aria-expanded\",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass(\"collapsing\").addClass(\"collapse\").trigger(\"hidden.bs.collapse\")};return a.support.transition?void this.$element[c](0).one(\"bsTransitionEnd\",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass(\"in\")?\"hide\":\"show\"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle=\"collapse\"][data-parent=\"'+this.options.parent+'\"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass(\"in\");a.attr(\"aria-expanded\",c),b.toggleClass(\"collapsed\",!c).attr(\"aria-expanded\",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on(\"click.bs.collapse.data-api\",'[data-toggle=\"collapse\"]',function(d){var e=a(this);e.attr(\"data-target\")||d.preventDefault();var f=b(e),g=f.data(\"bs.collapse\"),h=g?\"toggle\":e.data();c.call(f,h)})}(jQuery),+function(a){\"use strict\";function b(b){var c=b.attr(\"data-target\");c||(c=b.attr(\"href\"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\\s]*$)/,\"\"));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass(\"open\")&&(c&&\"click\"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event(\"hide.bs.dropdown\",f)),c.isDefaultPrevented()||(d.attr(\"aria-expanded\",\"false\"),e.removeClass(\"open\").trigger(\"hidden.bs.dropdown\",f))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data(\"bs.dropdown\");d||c.data(\"bs.dropdown\",d=new g(this)),\"string\"==typeof b&&d[b].call(c)})}var e=\".dropdown-backdrop\",f='[data-toggle=\"dropdown\"]',g=function(b){a(b).on(\"click.bs.dropdown\",this.toggle)};g.VERSION=\"3.3.5\",g.prototype.toggle=function(d){var e=a(this);if(!e.is(\".disabled, :disabled\")){var f=b(e),g=f.hasClass(\"open\");if(c(),!g){\"ontouchstart\"in document.documentElement&&!f.closest(\".navbar-nav\").length&&a(document.createElement(\"div\")).addClass(\"dropdown-backdrop\").insertAfter(a(this)).on(\"click\",c);var h={relatedTarget:this};if(f.trigger(d=a.Event(\"show.bs.dropdown\",h)),d.isDefaultPrevented())return;e.trigger(\"focus\").attr(\"aria-expanded\",\"true\"),f.toggleClass(\"open\").trigger(\"shown.bs.dropdown\",h)}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(\".disabled, :disabled\")){var e=b(d),g=e.hasClass(\"open\");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger(\"focus\"),d.trigger(\"click\");var h=\" li:not(.disabled):visible a\",i=e.find(\".dropdown-menu\"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger(\"focus\")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on(\"click.bs.dropdown.data-api\",c).on(\"click.bs.dropdown.data-api\",\".dropdown form\",function(a){a.stopPropagation()}).on(\"click.bs.dropdown.data-api\",f,g.prototype.toggle).on(\"keydown.bs.dropdown.data-api\",f,g.prototype.keydown).on(\"keydown.bs.dropdown.data-api\",\".dropdown-menu\",g.prototype.keydown)}(jQuery),+function(a){\"use strict\";function b(b,d){return this.each(function(){var e=a(this),f=e.data(\"bs.modal\"),g=a.extend({},c.DEFAULTS,e.data(),\"object\"==typeof b&&b);f||e.data(\"bs.modal\",f=new c(this,g)),\"string\"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(\".modal-dialog\"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(\".modal-content\").load(this.options.remote,a.proxy(function(){this.$element.trigger(\"loaded.bs.modal\")},this))};c.VERSION=\"3.3.5\",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event(\"show.bs.modal\",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass(\"modal-open\"),this.escape(),this.resize(),this.$element.on(\"click.dismiss.bs.modal\",'[data-dismiss=\"modal\"]',a.proxy(this.hide,this)),this.$dialog.on(\"mousedown.dismiss.bs.modal\",function(){d.$element.one(\"mouseup.dismiss.bs.modal\",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass(\"fade\");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass(\"in\"),d.enforceFocus();var f=a.Event(\"shown.bs.modal\",{relatedTarget:b});e?d.$dialog.one(\"bsTransitionEnd\",function(){d.$element.trigger(\"focus\").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger(\"focus\").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event(\"hide.bs.modal\"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off(\"focusin.bs.modal\"),this.$element.removeClass(\"in\").off(\"click.dismiss.bs.modal\").off(\"mouseup.dismiss.bs.modal\"),this.$dialog.off(\"mousedown.dismiss.bs.modal\"),a.support.transition&&this.$element.hasClass(\"fade\")?this.$element.one(\"bsTransitionEnd\",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off(\"focusin.bs.modal\").on(\"focusin.bs.modal\",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger(\"focus\")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on(\"keydown.dismiss.bs.modal\",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off(\"keydown.dismiss.bs.modal\")},c.prototype.resize=function(){this.isShown?a(window).on(\"resize.bs.modal\",a.proxy(this.handleUpdate,this)):a(window).off(\"resize.bs.modal\")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass(\"modal-open\"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger(\"hidden.bs.modal\")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass(\"fade\")?\"fade\":\"\";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement(\"div\")).addClass(\"modal-backdrop \"+e).appendTo(this.$body),this.$element.on(\"click.dismiss.bs.modal\",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&(\"static\"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass(\"in\"),!b)return;f?this.$backdrop.one(\"bsTransitionEnd\",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass(\"in\");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass(\"fade\")?this.$backdrop.one(\"bsTransitionEnd\",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:\"\",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:\"\"})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:\"\",paddingRight:\"\"})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css(\"padding-right\")||0,10);this.originalBodyPad=document.body.style.paddingRight||\"\",this.bodyIsOverflowing&&this.$body.css(\"padding-right\",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css(\"padding-right\",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement(\"div\");a.className=\"modal-scrollbar-measure\",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on(\"click.bs.modal.data-api\",'[data-toggle=\"modal\"]',function(c){var d=a(this),e=d.attr(\"href\"),f=a(d.attr(\"data-target\")||e&&e.replace(/.*(?=#[^\\s]+$)/,\"\")),g=f.data(\"bs.modal\")?\"toggle\":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is(\"a\")&&c.preventDefault(),f.one(\"show.bs.modal\",function(a){a.isDefaultPrevented()||f.one(\"hidden.bs.modal\",function(){d.is(\":visible\")&&d.trigger(\"focus\")})}),b.call(f,g,this)})}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var d=a(this),e=d.data(\"bs.tooltip\"),f=\"object\"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data(\"bs.tooltip\",e=new c(this,f)),\"string\"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init(\"tooltip\",a,b)};c.VERSION=\"3.3.5\",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:\"top\",selector:!1,template:'<div class=\"tooltip\" role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>',trigger:\"hover focus\",title:\"\",delay:0,html:!1,container:!1,viewport:{selector:\"body\",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error(\"`selector` option must be specified when initializing \"+this.type+\" on the window.document object!\");for(var e=this.options.trigger.split(\" \"),f=e.length;f--;){var g=e[f];if(\"click\"==g)this.$element.on(\"click.\"+this.type,this.options.selector,a.proxy(this.toggle,this));else if(\"manual\"!=g){var h=\"hover\"==g?\"mouseenter\":\"focusin\",i=\"hover\"==g?\"mouseleave\":\"focusout\";this.$element.on(h+\".\"+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+\".\"+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:\"manual\",selector:\"\"}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&\"number\"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data(\"bs.\"+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data(\"bs.\"+this.type,c)),b instanceof a.Event&&(c.inState[\"focusin\"==b.type?\"focus\":\"hover\"]=!0),c.tip().hasClass(\"in\")||\"in\"==c.hoverState?void(c.hoverState=\"in\"):(clearTimeout(c.timeout),c.hoverState=\"in\",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){\"in\"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data(\"bs.\"+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data(\"bs.\"+this.type,c)),b instanceof a.Event&&(c.inState[\"focusout\"==b.type?\"focus\":\"hover\"]=!1),c.isInStateTrue()?void 0:(clearTimeout(c.timeout),c.hoverState=\"out\",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){\"out\"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide())},c.prototype.show=function(){var b=a.Event(\"show.bs.\"+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr(\"id\",g),this.$element.attr(\"aria-describedby\",g),this.options.animation&&f.addClass(\"fade\");var h=\"function\"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\\s?auto?\\s?/i,j=i.test(h);j&&(h=h.replace(i,\"\")||\"top\"),f.detach().css({top:0,left:0,display:\"block\"}).addClass(h).data(\"bs.\"+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger(\"inserted.bs.\"+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h=\"bottom\"==h&&k.bottom+m>o.bottom?\"top\":\"top\"==h&&k.top-m<o.top?\"bottom\":\"right\"==h&&k.right+l>o.width?\"left\":\"left\"==h&&k.left-l<o.left?\"right\":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger(\"shown.bs.\"+e.type),e.hoverState=null,\"out\"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass(\"fade\")?f.one(\"bsTransitionEnd\",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css(\"margin-top\"),10),h=parseInt(d.css(\"margin-left\"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass(\"in\");var i=d[0].offsetWidth,j=d[0].offsetHeight;\"top\"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?\"offsetWidth\":\"offsetHeight\";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?\"left\":\"top\",50*(1-a/b)+\"%\").css(c?\"top\":\"left\",\"\")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(\".tooltip-inner\")[this.options.html?\"html\":\"text\"](b),a.removeClass(\"fade in top bottom left right\")},c.prototype.hide=function(b){function d(){\"in\"!=e.hoverState&&f.detach(),e.$element.removeAttr(\"aria-describedby\").trigger(\"hidden.bs.\"+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event(\"hide.bs.\"+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass(\"in\"),a.support.transition&&f.hasClass(\"fade\")?f.one(\"bsTransitionEnd\",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr(\"title\")||\"string\"!=typeof a.attr(\"data-original-title\"))&&a.attr(\"data-original-title\",a.attr(\"title\")||\"\").attr(\"title\",\"\")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d=\"BODY\"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return\"bottom\"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:\"top\"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:\"left\"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr(\"data-original-title\")||(\"function\"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+\" `template` option must consist of exactly 1 top-level element!\");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(\".tooltip-arrow\")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data(\"bs.\"+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data(\"bs.\"+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass(\"in\")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off(\".\"+a.type).removeData(\"bs.\"+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var d=a(this),e=d.data(\"bs.popover\"),f=\"object\"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data(\"bs.popover\",e=new c(this,f)),\"string\"==typeof b&&e[b]())})}var c=function(a,b){this.init(\"popover\",a,b)};if(!a.fn.tooltip)throw new Error(\"Popover requires tooltip.js\");c.VERSION=\"3.3.5\",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:\"right\",trigger:\"click\",content:\"\",template:'<div class=\"popover\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(\".popover-title\")[this.options.html?\"html\":\"text\"](b),a.find(\".popover-content\").children().detach().end()[this.options.html?\"string\"==typeof c?\"html\":\"append\":\"text\"](c),a.removeClass(\"fade top bottom left right in\"),a.find(\".popover-title\").html()||a.find(\".popover-title\").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr(\"data-content\")||(\"function\"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(\".arrow\")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){\"use strict\";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||\"\")+\" .nav li > a\",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on(\"scroll.bs.scrollspy\",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data(\"bs.scrollspy\"),f=\"object\"==typeof c&&c;e||d.data(\"bs.scrollspy\",e=new b(this,f)),\"string\"==typeof c&&e[c]()})}b.VERSION=\"3.3.5\",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c=\"offset\",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c=\"position\",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data(\"target\")||b.attr(\"href\"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(\":visible\")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target=\"'+b+'\"],'+this.selector+'[href=\"'+b+'\"]',d=a(c).parents(\"li\").addClass(\"active\");d.parent(\".dropdown-menu\").length&&(d=d.closest(\"li.dropdown\").addClass(\"active\")),\r\nd.trigger(\"activate.bs.scrollspy\")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,\".active\").removeClass(\"active\")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on(\"load.bs.scrollspy.data-api\",function(){a('[data-spy=\"scroll\"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var d=a(this),e=d.data(\"bs.tab\");e||d.data(\"bs.tab\",e=new c(this)),\"string\"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION=\"3.3.5\",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest(\"ul:not(.dropdown-menu)\"),d=b.data(\"target\");if(d||(d=b.attr(\"href\"),d=d&&d.replace(/.*(?=#[^\\s]*$)/,\"\")),!b.parent(\"li\").hasClass(\"active\")){var e=c.find(\".active:last a\"),f=a.Event(\"hide.bs.tab\",{relatedTarget:b[0]}),g=a.Event(\"show.bs.tab\",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest(\"li\"),c),this.activate(h,h.parent(),function(){e.trigger({type:\"hidden.bs.tab\",relatedTarget:b[0]}),b.trigger({type:\"shown.bs.tab\",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass(\"active\").find(\"> .dropdown-menu > .active\").removeClass(\"active\").end().find('[data-toggle=\"tab\"]').attr(\"aria-expanded\",!1),b.addClass(\"active\").find('[data-toggle=\"tab\"]').attr(\"aria-expanded\",!0),h?(b[0].offsetWidth,b.addClass(\"in\")):b.removeClass(\"fade\"),b.parent(\".dropdown-menu\").length&&b.closest(\"li.dropdown\").addClass(\"active\").end().find('[data-toggle=\"tab\"]').attr(\"aria-expanded\",!0),e&&e()}var g=d.find(\"> .active\"),h=e&&a.support.transition&&(g.length&&g.hasClass(\"fade\")||!!d.find(\"> .fade\").length);g.length&&h?g.one(\"bsTransitionEnd\",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass(\"in\")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),\"show\")};a(document).on(\"click.bs.tab.data-api\",'[data-toggle=\"tab\"]',e).on(\"click.bs.tab.data-api\",'[data-toggle=\"pill\"]',e)}(jQuery),+function(a){\"use strict\";function b(b){return this.each(function(){var d=a(this),e=d.data(\"bs.affix\"),f=\"object\"==typeof b&&b;e||d.data(\"bs.affix\",e=new c(this,f)),\"string\"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on(\"scroll.bs.affix.data-api\",a.proxy(this.checkPosition,this)).on(\"click.bs.affix.data-api\",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION=\"3.3.5\",c.RESET=\"affix affix-top affix-bottom\",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&\"top\"==this.affixed)return c>e?\"top\":!1;if(\"bottom\"==this.affixed)return null!=c?e+this.unpin<=f.top?!1:\"bottom\":a-d>=e+g?!1:\"bottom\";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&c>=e?\"top\":null!=d&&i+j>=a-d?\"bottom\":!1},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass(\"affix\");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(\":visible\")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());\"object\"!=typeof d&&(f=e=d),\"function\"==typeof e&&(e=d.top(this.$element)),\"function\"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css(\"top\",\"\");var i=\"affix\"+(h?\"-\"+h:\"\"),j=a.Event(i+\".bs.affix\");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin=\"bottom\"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace(\"affix\",\"affixed\")+\".bs.affix\")}\"bottom\"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on(\"load\",function(){a('[data-spy=\"affix\"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/bootstrap.min.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 57,
    "kind": "file",
    "name": "src/client/lib/cornerstone.js",
    "content": "/*! cornerstone - v0.8.1 - 2015-06-16 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */\r\nif(typeof cornerstone === 'undefined'){\r\n    cornerstone = {\r\n        internal : {},\r\n        rendering: {}\r\n    };\r\n}\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function disable(element) {\r\n        if(element === undefined) {\r\n            throw \"disable: element element must not be undefined\";\r\n        }\r\n\r\n        // Search for this element in this list of enabled elements\r\n        var enabledElements = cornerstone.getEnabledElements();\r\n        for(var i=0; i < enabledElements.length; i++) {\r\n            if(enabledElements[i].element === element) {\r\n                // We found it!\r\n\r\n                // Fire an event so dependencies can cleanup\r\n                var eventData = {\r\n                    element : element\r\n                };\r\n                $(element).trigger(\"CornerstoneElementDisabled\", eventData);\r\n\r\n                // remove the child dom elements that we created (e.g.canvas)\r\n                enabledElements[i].element.removeChild(enabledElements[i].canvas);\r\n\r\n                // remove this element from the list of enabled elements\r\n                enabledElements.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.disable = disable;\r\n\r\n}(cornerstone));\r\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n */\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * sets a new image object for a given element\r\n     * @param element\r\n     * @param image\r\n     */\r\n    function displayImage(element, image, viewport) {\r\n        if(element === undefined) {\r\n            throw \"displayImage: parameter element cannot be undefined\";\r\n        }\r\n        if(image === undefined) {\r\n            throw \"displayImage: parameter image cannot be undefined\";\r\n        }\r\n\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        enabledElement.image = image;\r\n\r\n        if(enabledElement.viewport === undefined) {\r\n            enabledElement.viewport = cornerstone.internal.getDefaultViewport(enabledElement.canvas, image);\r\n        }\r\n\r\n        // merge viewport\r\n        if(viewport) {\r\n            for(var attrname in viewport)\r\n            {\r\n                if(viewport[attrname] !== null) {\r\n                    enabledElement.viewport[attrname] = viewport[attrname];\r\n                }\r\n            }\r\n        }\r\n\r\n        var now = new Date();\r\n        var frameRate;\r\n        if(enabledElement.lastImageTimeStamp !== undefined) {\r\n            var timeSinceLastImage = now.getTime() - enabledElement.lastImageTimeStamp;\r\n            frameRate = (1000 / timeSinceLastImage).toFixed();\r\n        } else {\r\n        }\r\n        enabledElement.lastImageTimeStamp = now.getTime();\r\n\r\n        var newImageEventData = {\r\n            viewport : enabledElement.viewport,\r\n            element : enabledElement.element,\r\n            image : enabledElement.image,\r\n            enabledElement : enabledElement,\r\n            frameRate : frameRate\r\n        };\r\n\r\n        $(enabledElement.element).trigger(\"CornerstoneNewImage\", newImageEventData);\r\n\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.displayImage = displayImage;\r\n}($, cornerstone));\r\n/**\r\n * This module is responsible for immediately drawing an enabled element\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Immediately draws the enabled element\r\n     *\r\n     * @param element\r\n     */\r\n    function draw(element) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        if(enabledElement.image === undefined) {\r\n            throw \"draw: image has not been loaded yet\";\r\n        }\r\n\r\n        cornerstone.drawImage(enabledElement);\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.draw = draw;\r\n\r\n}($, cornerstone));\r\n/**\r\n * This module is responsible for drawing invalidated enabled elements\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Draws all invalidated enabled elements and clears the invalid flag after drawing it\r\n     */\r\n    function drawInvalidated()\r\n    {\r\n        var enabledElements = cornerstone.getEnabledElements();\r\n        for(var i=0;i < enabledElements.length; i++) {\r\n            var ee = enabledElements[i];\r\n            if(ee.invalid === true) {\r\n                cornerstone.drawImage(ee);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.drawInvalidated = drawInvalidated;\r\n}($, cornerstone));\r\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function enable(element) {\r\n        if(element === undefined) {\r\n            throw \"enable: parameter element cannot be undefined\";\r\n        }\r\n\r\n        var canvas = document.createElement('canvas');\r\n        element.appendChild(canvas);\r\n\r\n        var el = {\r\n            element: element,\r\n            canvas: canvas,\r\n            image : undefined, // will be set once image is loaded\r\n            invalid: false, // true if image needs to be drawn, false if not\r\n            data : {}\r\n        };\r\n        cornerstone.addEnabledElement(el);\r\n\r\n        cornerstone.resize(element, true);\r\n\r\n        return element;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.enable = enable;\r\n}(cornerstone));\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function getElementData(el, dataType) {\r\n        var ee = cornerstone.getEnabledElement(el);\r\n        if(ee.data.hasOwnProperty(dataType) === false)\r\n        {\r\n            ee.data[dataType] = {};\r\n        }\r\n        return ee.data[dataType];\r\n    }\r\n\r\n    function removeElementData(el, dataType) {\r\n        var ee = cornerstone.getEnabledElement(el);\r\n        delete ee.data[dataType];\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.getElementData = getElementData;\r\n    cornerstone.removeElementData = removeElementData;\r\n\r\n}(cornerstone));\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    var enabledElements = [];\r\n\r\n    function getEnabledElement(element) {\r\n        if(element === undefined) {\r\n            throw \"getEnabledElement: parameter element must not be undefined\";\r\n        }\r\n        for(var i=0; i < enabledElements.length; i++) {\r\n            if(enabledElements[i].element == element) {\r\n                return enabledElements[i];\r\n            }\r\n        }\r\n\r\n        throw \"element not enabled\";\r\n    }\r\n\r\n    function addEnabledElement(enabledElement) {\r\n        if(enabledElement === undefined) {\r\n            throw \"getEnabledElement: enabledElement element must not be undefined\";\r\n        }\r\n\r\n        enabledElements.push(enabledElement);\r\n    }\r\n\r\n    function getEnabledElementsByImageId(imageId) {\r\n        var ees = [];\r\n        enabledElements.forEach(function(enabledElement) {\r\n            if(enabledElement.image && enabledElement.image.imageId === imageId) {\r\n                ees.push(enabledElement);\r\n            }\r\n        });\r\n        return ees;\r\n    }\r\n\r\n    function getEnabledElements() {\r\n        return enabledElements;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.getEnabledElement = getEnabledElement;\r\n    cornerstone.addEnabledElement = addEnabledElement;\r\n    cornerstone.getEnabledElementsByImageId = getEnabledElementsByImageId;\r\n    cornerstone.getEnabledElements = getEnabledElements;\r\n}(cornerstone));\r\n/**\r\n * This module will fit an image to fit inside the canvas displaying it such that all pixels\r\n * in the image are viewable\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Adjusts an images scale and center so the image is centered and completely visible\r\n     * @param element\r\n     */\r\n    function fitToWindow(element)\r\n    {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        var defaultViewport = cornerstone.internal.getDefaultViewport(enabledElement.canvas, enabledElement.image);\r\n        enabledElement.viewport.scale = defaultViewport.scale;\r\n        enabledElement.viewport.translation.x = defaultViewport.translation.x;\r\n        enabledElement.viewport.translation.y = defaultViewport.translation.y;\r\n        enabledElement.viewport.rotation = defaultViewport.rotation;\r\n        enabledElement.viewport.hflip = defaultViewport.hflip;\r\n        enabledElement.viewport.vflip = defaultViewport.vflip;\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    cornerstone.fitToWindow = fitToWindow;\r\n}(cornerstone));\r\n\r\n/**\r\n * This file is responsible for returning the default viewport for an image\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * returns a default viewport for display the specified image on the specified\r\n     * enabled element.  The default viewport is fit to window\r\n     *\r\n     * @param element\r\n     * @param image\r\n     */\r\n    function getDefaultViewportForImage(element, image) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        var viewport = cornerstone.internal.getDefaultViewport(enabledElement.canvas, image);\r\n        return viewport;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.getDefaultViewportForImage = getDefaultViewportForImage;\r\n}($, cornerstone));\r\n/**\r\n * This module is responsible for returning the currently displayed image for an element\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * returns the currently displayed image for an element or undefined if no image has\r\n     * been displayed yet\r\n     *\r\n     * @param element\r\n     */\r\n    function getImage(element) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        return enabledElement.image;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.getImage = getImage;\r\n}($, cornerstone));\r\n/**\r\n * This module returns a subset of the stored pixels of an image\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n\r\n    /**\r\n     * Returns array of pixels with modality LUT transformation applied\r\n     */\r\n    function getPixels(element, x, y, width, height) {\r\n\r\n        var storedPixels = cornerstone.getStoredPixels(element, x, y, width, height);\r\n        var ee = cornerstone.getEnabledElement(element);\r\n        var slope = ee.image.slope;\r\n        var intercept = ee.image.intercept;\r\n\r\n        var modalityPixels = storedPixels.map(function(pixel){\r\n            return pixel * slope + intercept;\r\n        });\r\n\r\n        return modalityPixels;\r\n    }\r\n\r\n    // module exports\r\n    cornerstone.getPixels = getPixels;\r\n}(cornerstone));\r\n/**\r\n * This module returns a subset of the stored pixels of an image\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Returns an array of stored pixels given a rectangle in the image\r\n     * @param element\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     * @returns {Array}\r\n     */\r\n    function getStoredPixels(element, x, y, width, height) {\r\n        if(element === undefined) {\r\n            throw \"getStoredPixels: parameter element must not be undefined\";\r\n        }\r\n\r\n        x = Math.round(x);\r\n        y = Math.round(y);\r\n        var ee = cornerstone.getEnabledElement(element);\r\n        var storedPixels = [];\r\n        var index = 0;\r\n        var pixelData = ee.image.getPixelData();\r\n        for(var row=0; row < height; row++) {\r\n            for(var column=0; column < width; column++) {\r\n                var spIndex = ((row + y) * ee.image.columns) + (column + x);\r\n                storedPixels[index++] = pixelData[spIndex];\r\n            }\r\n        }\r\n        return storedPixels;\r\n    }\r\n\r\n    // module exports\r\n    cornerstone.getStoredPixels = getStoredPixels;\r\n}(cornerstone));\r\n/**\r\n * This module contains functions to deal with getting and setting the viewport for an enabled element\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Returns the viewport for the specified enabled element\r\n     * @param element\r\n     * @returns {*}\r\n     */\r\n    function getViewport(element) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        var viewport = enabledElement.viewport;\r\n        if(viewport === undefined) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            scale : viewport.scale,\r\n            translation : {\r\n                x : viewport.translation.x,\r\n                y : viewport.translation.y\r\n            },\r\n            voi : {\r\n                windowWidth: viewport.voi.windowWidth,\r\n                windowCenter : viewport.voi.windowCenter\r\n            },\r\n            invert : viewport.invert,\r\n            pixelReplication: viewport.pixelReplication,\r\n            rotation: viewport.rotation, \r\n            hflip: viewport.hflip,\r\n            vflip: viewport.vflip\r\n        };\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.getViewport = getViewport;\r\n\r\n}(cornerstone));\r\n\r\n/**\r\n * This module deals with caching images\r\n */\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    var imageCache = {\r\n    };\r\n\r\n    var cachedImages = [];\r\n\r\n    var maximumSizeInBytes = 1024 * 1024 * 1024; // 1 GB\r\n    var cacheSizeInBytes = 0;\r\n\r\n    function setMaximumSizeBytes(numBytes)\r\n    {\r\n        if(numBytes === undefined) {\r\n            throw \"setMaximumSizeBytes: parameter numBytes must not be undefined\";\r\n        }\r\n        if(numBytes.toFixed === undefined) {\r\n            throw \"setMaximumSizeBytes: parameter numBytes must be a number\";\r\n        }\r\n\r\n        maximumSizeInBytes = numBytes;\r\n        purgeCacheIfNecessary();\r\n    }\r\n\r\n    function purgeCacheIfNecessary()\r\n    {\r\n        // if max cache size has not been exceeded, do nothing\r\n        if(cacheSizeInBytes <= maximumSizeInBytes)\r\n        {\r\n            return;\r\n        }\r\n\r\n        // cache size has been exceeded, create list of images sorted by timeStamp\r\n        // so we can purge the least recently used image\r\n        function compare(a,b) {\r\n            if(a.timeStamp > b.timeStamp) {\r\n                return -1;\r\n            }\r\n            if(a.timeStamp < b.timeStamp) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        }\r\n        cachedImages.sort(compare);\r\n\r\n        // remove images as necessary\r\n        while(cacheSizeInBytes > maximumSizeInBytes)\r\n        {\r\n            var lastCachedImage = cachedImages[cachedImages.length - 1];\r\n            cacheSizeInBytes -= lastCachedImage.sizeInBytes;\r\n            delete imageCache[lastCachedImage.imageId];\r\n            lastCachedImage.imagePromise.reject();\r\n            cachedImages.pop();\r\n        }\r\n    }\r\n\r\n    function putImagePromise(imageId, imagePromise) {\r\n        if(imageId === undefined)\r\n        {\r\n            throw \"getImagePromise: imageId must not be undefined\";\r\n        }\r\n        if(imagePromise === undefined)\r\n        {\r\n            throw \"getImagePromise: imagePromise must not be undefined\";\r\n        }\r\n\r\n        if(imageCache.hasOwnProperty(imageId) === true) {\r\n            throw \"putImagePromise: imageId already in cache\";\r\n        }\r\n\r\n        var cachedImage = {\r\n            loaded : false,\r\n            imageId : imageId,\r\n            imagePromise : imagePromise,\r\n            timeStamp : new Date(),\r\n            sizeInBytes: 0\r\n        };\r\n\r\n        imageCache[imageId] = cachedImage;\r\n        cachedImages.push(cachedImage);\r\n\r\n        imagePromise.then(function(image) {\r\n            cachedImage.loaded = true;\r\n\r\n            if(image.sizeInBytes === undefined)\r\n            {\r\n                throw \"putImagePromise: image does not have sizeInBytes property or\";\r\n            }\r\n            if(image.sizeInBytes.toFixed === undefined) {\r\n                throw \"putImagePromise: image.sizeInBytes is not a number\";\r\n            }\r\n            cachedImage.sizeInBytes = image.sizeInBytes;\r\n            cacheSizeInBytes += cachedImage.sizeInBytes;\r\n            purgeCacheIfNecessary();\r\n        });\r\n    }\r\n\r\n    function getImagePromise(imageId) {\r\n        if(imageId === undefined)\r\n        {\r\n            throw \"getImagePromise: imageId must not be undefined\";\r\n        }\r\n        var cachedImage = imageCache[imageId];\r\n        if(cachedImage === undefined) {\r\n            return undefined;\r\n        }\r\n\r\n        // bump time stamp for cached image\r\n        cachedImage.timeStamp = new Date();\r\n        return cachedImage.imagePromise;\r\n    }\r\n\r\n    function removeImagePromise(imageId) {\r\n        if(imageId === undefined) {\r\n            throw \"removeImagePromise: imageId must not be undefined\";\r\n        }\r\n        var cachedImage = imageCache[imageId];\r\n        if(cachedImage === undefined) {\r\n            throw \"removeImagePromise: imageId must not be undefined\";\r\n        }\r\n        cachedImages.splice( cachedImages.indexOf(cachedImage), 1);\r\n        cacheSizeInBytes -= cachedImage.sizeInBytes;\r\n        delete imageCache[imageId];\r\n\r\n        return cachedImage.imagePromise;\r\n    }\r\n\r\n    function getCacheInfo() {\r\n        return {\r\n            maximumSizeInBytes : maximumSizeInBytes,\r\n            cacheSizeInBytes : cacheSizeInBytes,\r\n            numberOfImagesCached: cachedImages.length\r\n        };\r\n    }\r\n\r\n    function purgeCache() {\r\n        while (cachedImages.length > 0) {\r\n            var removedCachedImage = cachedImages.pop();\r\n            delete imageCache[removedCachedImage.imageId];\r\n            removedCachedImage.imagePromise.reject();\r\n        }\r\n        cacheSizeInBytes = 0;\r\n    }\r\n\r\n    // module exports\r\n\r\n    cornerstone.imageCache = {\r\n        putImagePromise : putImagePromise,\r\n        getImagePromise: getImagePromise,\r\n        removeImagePromise: removeImagePromise,\r\n        setMaximumSizeBytes: setMaximumSizeBytes,\r\n        getCacheInfo : getCacheInfo,\r\n        purgeCache: purgeCache\r\n    };\r\n}(cornerstone));\r\n\r\n/**\r\n * This module deals with ImageLoaders, loading images and caching images\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    var imageLoaders = {};\r\n\r\n    var unknownImageLoader;\r\n\r\n    function loadImageFromImageLoader(imageId) {\r\n        var colonIndex = imageId.indexOf(\":\");\r\n        var scheme = imageId.substring(0, colonIndex);\r\n        var loader = imageLoaders[scheme];\r\n        var imagePromise;\r\n        if(loader === undefined || loader === null) {\r\n            if(unknownImageLoader !== undefined) {\r\n                imagePromise = unknownImageLoader(imageId);\r\n                return imagePromise;\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n        imagePromise = loader(imageId);\r\n\r\n        // broadcast an image loaded event once the image is loaded\r\n        // This is based on the idea here: http://stackoverflow.com/questions/3279809/global-custom-events-in-jquery\r\n        imagePromise.then(function(image) {\r\n            $(cornerstone).trigger('CornerstoneImageLoaded', {image: image});\r\n        });\r\n\r\n        return imagePromise;\r\n    }\r\n\r\n    // Loads an image given an imageId and returns a promise which will resolve\r\n    // to the loaded image object or fail if an error occurred.  The loaded image\r\n    // is not stored in the cache\r\n    function loadImage(imageId) {\r\n        if(imageId === undefined) {\r\n            throw \"loadImage: parameter imageId must not be undefined\";\r\n        }\r\n\r\n        var imagePromise = cornerstone.imageCache.getImagePromise(imageId);\r\n        if(imagePromise !== undefined) {\r\n            return imagePromise;\r\n        }\r\n\r\n        imagePromise = loadImageFromImageLoader(imageId);\r\n        if(imagePromise === undefined) {\r\n            throw \"loadImage: no image loader for imageId\";\r\n        }\r\n\r\n        return imagePromise;\r\n    }\r\n\r\n    // Loads an image given an imageId and returns a promise which will resolve\r\n    // to the loaded image object or fail if an error occurred.  The image is\r\n    // stored in the cache\r\n    function loadAndCacheImage(imageId) {\r\n        if(imageId === undefined) {\r\n            throw \"loadAndCacheImage: parameter imageId must not be undefined\";\r\n        }\r\n\r\n        var imagePromise = cornerstone.imageCache.getImagePromise(imageId);\r\n        if(imagePromise !== undefined) {\r\n            return imagePromise;\r\n        }\r\n\r\n        imagePromise = loadImageFromImageLoader(imageId);\r\n        if(imagePromise === undefined) {\r\n            throw \"loadAndCacheImage: no image loader for imageId\";\r\n        }\r\n\r\n        cornerstone.imageCache.putImagePromise(imageId, imagePromise);\r\n\r\n        return imagePromise;\r\n    }\r\n\r\n\r\n    // registers an imageLoader plugin with cornerstone for the specified scheme\r\n    function registerImageLoader(scheme, imageLoader) {\r\n        imageLoaders[scheme] = imageLoader;\r\n    }\r\n\r\n    // Registers a new unknownImageLoader and returns the previous one (if it exists)\r\n    function registerUnknownImageLoader(imageLoader) {\r\n        var oldImageLoader = unknownImageLoader;\r\n        unknownImageLoader = imageLoader;\r\n        return oldImageLoader;\r\n    }\r\n\r\n    // module exports\r\n\r\n    cornerstone.loadImage = loadImage;\r\n    cornerstone.loadAndCacheImage = loadAndCacheImage;\r\n    cornerstone.registerImageLoader = registerImageLoader;\r\n    cornerstone.registerUnknownImageLoader = registerUnknownImageLoader;\r\n\r\n}($, cornerstone));\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function calculateTransform(enabledElement, scale) {\r\n\r\n        var transform = new cornerstone.internal.Transform();\r\n        transform.translate(enabledElement.canvas.width/2, enabledElement.canvas.height / 2);\r\n\r\n        //Apply the rotation before scaling for non square pixels\r\n        var angle = enabledElement.viewport.rotation;\r\n        if(angle!==0) {\r\n            transform.rotate(angle*Math.PI/180);\r\n        }\r\n\r\n        // apply the scale\r\n        var widthScale = enabledElement.viewport.scale;\r\n        var heightScale = enabledElement.viewport.scale;\r\n        if(enabledElement.image.rowPixelSpacing < enabledElement.image.columnPixelSpacing) {\r\n            widthScale = widthScale * (enabledElement.image.columnPixelSpacing / enabledElement.image.rowPixelSpacing);\r\n        }\r\n        else if(enabledElement.image.columnPixelSpacing < enabledElement.image.rowPixelSpacing) {\r\n            heightScale = heightScale * (enabledElement.image.rowPixelSpacing / enabledElement.image.columnPixelSpacing);\r\n        }\r\n        transform.scale(widthScale, heightScale);\r\n\r\n        // unrotate to so we can translate unrotated\r\n        if(angle!==0) {\r\n            transform.rotate(-angle*Math.PI/180);\r\n        }\r\n\r\n        // apply the pan offset\r\n        transform.translate(enabledElement.viewport.translation.x, enabledElement.viewport.translation.y);\r\n\r\n        // rotate again so we can apply general scale\r\n        if(angle!==0) {\r\n            transform.rotate(angle*Math.PI/180);\r\n        }\r\n\r\n        if(scale !== undefined) {\r\n            // apply the font scale\r\n            transform.scale(scale, scale);\r\n        }\r\n\r\n        //Apply Flip if required\r\n        if(enabledElement.viewport.hflip) {\r\n            transform.scale(-1,1);\r\n        }\r\n\r\n        if(enabledElement.viewport.vflip) {\r\n            transform.scale(1,-1);\r\n        }\r\n\r\n        // translate the origin back to the corner of the image so the event handlers can draw in image coordinate system\r\n        transform.translate(-enabledElement.image.width / 2 , -enabledElement.image.height/ 2);\r\n        return transform;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.internal.calculateTransform = calculateTransform;\r\n}(cornerstone));\r\n/**\r\n * This module is responsible for drawing an image to an enabled elements canvas element\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Internal API function to draw an image to a given enabled element\r\n     * @param enabledElement\r\n     * @param invalidated - true if pixel data has been invalidated and cached rendering should not be used\r\n     */\r\n    function drawImage(enabledElement, invalidated) {\r\n\r\n        var start = new Date();\r\n\r\n        enabledElement.image.render(enabledElement, invalidated);\r\n\r\n        var context = enabledElement.canvas.getContext('2d');\r\n\r\n        var end = new Date();\r\n        var diff = end - start;\r\n        //console.log(diff + ' ms');\r\n\r\n        var eventData = {\r\n            viewport : enabledElement.viewport,\r\n            element : enabledElement.element,\r\n            image : enabledElement.image,\r\n            enabledElement : enabledElement,\r\n            canvasContext: context,\r\n            renderTimeInMs : diff\r\n        };\r\n\r\n        $(enabledElement.element).trigger(\"CornerstoneImageRendered\", eventData);\r\n        enabledElement.invalid = false;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.internal.drawImage = drawImage;\r\n    cornerstone.drawImage = drawImage;\r\n\r\n}($, cornerstone));\r\n/**\r\n * This module generates a lut for an image\r\n */\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Creates a LUT used while rendering to convert stored pixel values to\r\n     * display pixels\r\n     *\r\n     * @param image\r\n     * @returns {Array}\r\n     */\r\n    function generateLut(image, windowWidth, windowCenter, invert)\r\n    {\r\n        if(image.lut === undefined) {\r\n            image.lut =  new Int16Array(image.maxPixelValue - Math.min(image.minPixelValue,0)+1);\r\n        }\r\n        var lut = image.lut;\r\n\r\n        var maxPixelValue = image.maxPixelValue;\r\n        var minPixelValue = image.minPixelValue;\r\n        var slope = image.slope;\r\n        var intercept = image.intercept;\r\n        var localWindowWidth = windowWidth;\r\n        var localWindowCenter = windowCenter;\r\n\r\n        var modalityLutValue;\r\n        var voiLutValue;\r\n        var clampedValue;\r\n        var storedValue;\r\n\r\n        // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\r\n        // We improve performance by offsetting the pixel values for signed data to avoid negative indexes\r\n        // when generating the lut and then undo it in storedPixelDataToCanvasImagedata.  Thanks to @jpambrun\r\n        // for this contribution!\r\n\r\n        var offset = 0;\r\n        if(minPixelValue < 0) {\r\n            offset = minPixelValue;\r\n        }\r\n\r\n        if(invert === true) {\r\n            for(storedValue = image.minPixelValue; storedValue <= maxPixelValue; storedValue++)\r\n            {\r\n                modalityLutValue = storedValue * slope + intercept;\r\n                voiLutValue = (((modalityLutValue - (localWindowCenter)) / (localWindowWidth) + 0.5) * 255.0);\r\n                clampedValue = Math.min(Math.max(voiLutValue, 0), 255);\r\n                lut[storedValue + (-offset)] = Math.round(255 - clampedValue);\r\n            }\r\n        }\r\n        else {\r\n            for(storedValue = image.minPixelValue; storedValue <= maxPixelValue; storedValue++)\r\n            {\r\n                modalityLutValue = storedValue * slope + intercept;\r\n                voiLutValue = (((modalityLutValue - (localWindowCenter)) / (localWindowWidth) + 0.5) * 255.0);\r\n                clampedValue = Math.min(Math.max(voiLutValue, 0), 255);\r\n                lut[storedValue+ (-offset)] = Math.round(clampedValue);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // Module exports\r\n    cornerstone.internal.generateLut = generateLut;\r\n    cornerstone.generateLut = generateLut;\r\n}(cornerstone));\r\n\r\n/**\r\n * This module contains a function to get a default viewport for an image given\r\n * a canvas element to display it in\r\n *\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Creates a new viewport object containing default values for the image and canvas\r\n     * @param canvas\r\n     * @param image\r\n     * @returns viewport object\r\n     */\r\n    function getDefaultViewport(canvas, image) {\r\n        if(canvas === undefined) {\r\n            throw \"getDefaultViewport: parameter canvas must not be undefined\";\r\n        }\r\n        if(image === undefined) {\r\n            throw \"getDefaultViewport: parameter image must not be undefined\";\r\n        }\r\n        var viewport = {\r\n            scale : 1.0,\r\n            translation : {\r\n                x : 0,\r\n                y : 0\r\n            },\r\n            voi : {\r\n                windowWidth: image.windowWidth,\r\n                windowCenter: image.windowCenter,\r\n            },\r\n            invert: image.invert,\r\n            pixelReplication: false,\r\n            rotation: 0,\r\n            hflip: false,\r\n            vflip: false\r\n        };\r\n\r\n        // fit image to window\r\n        var verticalScale = canvas.height / image.rows;\r\n        var horizontalScale= canvas.width / image.columns;\r\n        if(horizontalScale < verticalScale) {\r\n            viewport.scale = horizontalScale;\r\n        }\r\n        else {\r\n            viewport.scale = verticalScale;\r\n        }\r\n        return viewport;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.internal.getDefaultViewport = getDefaultViewport;\r\n    cornerstone.getDefaultViewport = getDefaultViewport;\r\n}(cornerstone));\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function getTransform(enabledElement)\r\n    {\r\n        // For now we will calculate it every time it is requested.  In the future, we may want to cache\r\n        // it in the enabled element to speed things up\r\n        var transform = cornerstone.internal.calculateTransform(enabledElement);\r\n        return transform;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.internal.getTransform = getTransform;\r\n\r\n}(cornerstone));\r\n/**\r\n * This module is responsible for drawing an image to an enabled elements canvas element\r\n */\r\n\r\n(function ($, cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    cornerstone.drawImage = cornerstone.internal.drawImage;\r\n    cornerstone.generateLut = cornerstone.internal.generateLut;\r\n    cornerstone.storedPixelDataToCanvasImageData = cornerstone.internal.storedPixelDataToCanvasImageData;\r\n    cornerstone.storedColorPixelDataToCanvasImageData = cornerstone.internal.storedColorPixelDataToCanvasImageData;\r\n\r\n}($, cornerstone));\r\n/**\r\n * This module contains a function to convert stored pixel values to display pixel values using a LUT\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function storedColorPixelDataToCanvasImageData(image, lut, canvasImageDataData)\r\n    {\r\n        var minPixelValue = image.minPixelValue;\r\n        var canvasImageDataIndex = 0;\r\n        var storedPixelDataIndex = 0;\r\n        var numPixels = image.width * image.height * 4;\r\n        var storedPixelData = image.getPixelData();\r\n        var localLut = lut;\r\n        var localCanvasImageDataData = canvasImageDataData;\r\n        // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\r\n        // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\r\n        if(minPixelValue < 0){\r\n            while(storedPixelDataIndex < numPixels) {\r\n                localCanvasImageDataData[canvasImageDataIndex++] = localLut[storedPixelData[storedPixelDataIndex++] + (-minPixelValue)]; // red\r\n                localCanvasImageDataData[canvasImageDataIndex++] = localLut[storedPixelData[storedPixelDataIndex++] + (-minPixelValue)]; // green\r\n                localCanvasImageDataData[canvasImageDataIndex] = localLut[storedPixelData[storedPixelDataIndex] + (-minPixelValue)]; // blue\r\n                storedPixelDataIndex+=2;\r\n                canvasImageDataIndex+=2;\r\n            }\r\n        }else{\r\n            while(storedPixelDataIndex < numPixels) {\r\n                localCanvasImageDataData[canvasImageDataIndex++] = localLut[storedPixelData[storedPixelDataIndex++]]; // red\r\n                localCanvasImageDataData[canvasImageDataIndex++] = localLut[storedPixelData[storedPixelDataIndex++]]; // green\r\n                localCanvasImageDataData[canvasImageDataIndex] = localLut[storedPixelData[storedPixelDataIndex]]; // blue\r\n                storedPixelDataIndex+=2;\r\n                canvasImageDataIndex+=2;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.internal.storedColorPixelDataToCanvasImageData = storedColorPixelDataToCanvasImageData;\r\n    cornerstone.storedColorPixelDataToCanvasImageData = storedColorPixelDataToCanvasImageData;\r\n\r\n}(cornerstone));\r\n\r\n/**\r\n * This module contains a function to convert stored pixel values to display pixel values using a LUT\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * This function transforms stored pixel values into a canvas image data buffer\r\n     * by using a LUT.  This is the most performance sensitive code in cornerstone and\r\n     * we use a special trick to make this go as fast as possible.  Specifically we\r\n     * use the alpha channel only to control the luminance rather than the red, green and\r\n     * blue channels which makes it over 3x faster.  The canvasImageDataData buffer needs\r\n     * to be previously filled with white pixels.\r\n     *\r\n     * NOTE: Attribution would be appreciated if you use this technique!\r\n     *\r\n     * @param pixelData the pixel data\r\n     * @param lut the lut\r\n     * @param canvasImageDataData a canvasImgageData.data buffer filled with white pixels\r\n     */\r\n    function storedPixelDataToCanvasImageData(image, lut, canvasImageDataData)\r\n    {\r\n        var pixelData = image.getPixelData();\r\n        var minPixelValue = image.minPixelValue;\r\n        var canvasImageDataIndex = 3;\r\n        var storedPixelDataIndex = 0;\r\n        var localNumPixels = pixelData.length;\r\n        var localPixelData = pixelData;\r\n        var localLut = lut;\r\n        var localCanvasImageDataData = canvasImageDataData;\r\n        // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.\r\n        // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement\r\n        if(minPixelValue < 0){\r\n            while(storedPixelDataIndex < localNumPixels) {\r\n                localCanvasImageDataData[canvasImageDataIndex] = localLut[localPixelData[storedPixelDataIndex++] + (-minPixelValue)]; // alpha\r\n                canvasImageDataIndex += 4;\r\n            }\r\n        }else{\r\n            while(storedPixelDataIndex < localNumPixels) {\r\n                localCanvasImageDataData[canvasImageDataIndex] = localLut[localPixelData[storedPixelDataIndex++]]; // alpha\r\n                canvasImageDataIndex += 4;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.internal.storedPixelDataToCanvasImageData = storedPixelDataToCanvasImageData;\r\n    cornerstone.storedPixelDataToCanvasImageData = storedPixelDataToCanvasImageData;\r\n\r\n}(cornerstone));\r\n\r\n// Last updated November 2011\r\n// By Simon Sarris\r\n// www.simonsarris.com\r\n// sarris@acm.org\r\n//\r\n// Free to use and distribute at will\r\n// So long as you are nice to people, etc\r\n\r\n// Simple class for keeping track of the current transformation matrix\r\n\r\n// For instance:\r\n//    var t = new Transform();\r\n//    t.rotate(5);\r\n//    var m = t.m;\r\n//    ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);\r\n\r\n// Is equivalent to:\r\n//    ctx.rotate(5);\r\n\r\n// But now you can retrieve it :)\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n\r\n    // Remember that this does not account for any CSS transforms applied to the canvas\r\n    function Transform() {\r\n        this.reset();\r\n    }\r\n\r\n    Transform.prototype.reset = function() {\r\n        this.m = [1,0,0,1,0,0];\r\n    };\r\n\r\n    Transform.prototype.clone = function() {\r\n        var transform = new Transform();\r\n        transform.m[0] = this.m[0];\r\n        transform.m[1] = this.m[1];\r\n        transform.m[2] = this.m[2];\r\n        transform.m[3] = this.m[3];\r\n        transform.m[4] = this.m[4];\r\n        transform.m[5] = this.m[5];\r\n        return transform;\r\n    };\r\n\r\n\r\n    Transform.prototype.multiply = function(matrix) {\r\n        var m11 = this.m[0] * matrix.m[0] + this.m[2] * matrix.m[1];\r\n        var m12 = this.m[1] * matrix.m[0] + this.m[3] * matrix.m[1];\r\n\r\n        var m21 = this.m[0] * matrix.m[2] + this.m[2] * matrix.m[3];\r\n        var m22 = this.m[1] * matrix.m[2] + this.m[3] * matrix.m[3];\r\n\r\n        var dx = this.m[0] * matrix.m[4] + this.m[2] * matrix.m[5] + this.m[4];\r\n        var dy = this.m[1] * matrix.m[4] + this.m[3] * matrix.m[5] + this.m[5];\r\n\r\n        this.m[0] = m11;\r\n        this.m[1] = m12;\r\n        this.m[2] = m21;\r\n        this.m[3] = m22;\r\n        this.m[4] = dx;\r\n        this.m[5] = dy;\r\n    };\r\n\r\n    Transform.prototype.invert = function() {\r\n        var d = 1 / (this.m[0] * this.m[3] - this.m[1] * this.m[2]);\r\n        var m0 = this.m[3] * d;\r\n        var m1 = -this.m[1] * d;\r\n        var m2 = -this.m[2] * d;\r\n        var m3 = this.m[0] * d;\r\n        var m4 = d * (this.m[2] * this.m[5] - this.m[3] * this.m[4]);\r\n        var m5 = d * (this.m[1] * this.m[4] - this.m[0] * this.m[5]);\r\n        this.m[0] = m0;\r\n        this.m[1] = m1;\r\n        this.m[2] = m2;\r\n        this.m[3] = m3;\r\n        this.m[4] = m4;\r\n        this.m[5] = m5;\r\n    };\r\n\r\n    Transform.prototype.rotate = function(rad) {\r\n        var c = Math.cos(rad);\r\n        var s = Math.sin(rad);\r\n        var m11 = this.m[0] * c + this.m[2] * s;\r\n        var m12 = this.m[1] * c + this.m[3] * s;\r\n        var m21 = this.m[0] * -s + this.m[2] * c;\r\n        var m22 = this.m[1] * -s + this.m[3] * c;\r\n        this.m[0] = m11;\r\n        this.m[1] = m12;\r\n        this.m[2] = m21;\r\n        this.m[3] = m22;\r\n    };\r\n\r\n    Transform.prototype.translate = function(x, y) {\r\n        this.m[4] += this.m[0] * x + this.m[2] * y;\r\n        this.m[5] += this.m[1] * x + this.m[3] * y;\r\n    };\r\n\r\n    Transform.prototype.scale = function(sx, sy) {\r\n        this.m[0] *= sx;\r\n        this.m[1] *= sx;\r\n        this.m[2] *= sy;\r\n        this.m[3] *= sy;\r\n    };\r\n\r\n    Transform.prototype.transformPoint = function(px, py) {\r\n        var x = px;\r\n        var y = py;\r\n        px = x * this.m[0] + y * this.m[2] + this.m[4];\r\n        py = x * this.m[1] + y * this.m[3] + this.m[5];\r\n        return {x: px, y: py};\r\n    };\r\n\r\n    cornerstone.internal.Transform = Transform;\r\n}(cornerstone));\r\n/**\r\n * This module contains a function to make an image is invalid\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Sets the invalid flag on the enabled element and fire an event\r\n     * @param element\r\n     */\r\n    function invalidate(element) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        enabledElement.invalid = true;\r\n        var eventData = {\r\n            element: element\r\n        };\r\n        $(enabledElement.element).trigger(\"CornerstoneInvalidated\", eventData);\r\n    }\r\n\r\n    // module exports\r\n    cornerstone.invalidate = invalidate;\r\n}(cornerstone));\r\n/**\r\n * This module contains a function to immediately invalidate an image\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Forces the image to be updated/redrawn for the specified enabled element\r\n     * @param element\r\n     */\r\n    function invalidateImageId(imageId) {\r\n\r\n        var enabledElements = cornerstone.getEnabledElementsByImageId(imageId);\r\n        enabledElements.forEach(function(enabledElement) {\r\n            cornerstone.drawImage(enabledElement, true);\r\n        });\r\n    }\r\n\r\n    // module exports\r\n    cornerstone.invalidateImageId = invalidateImageId;\r\n}(cornerstone));\r\n/**\r\n * This module contains a helper function to covert page coordinates to pixel coordinates\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Converts a point in the page coordinate system to the pixel coordinate\r\n     * system\r\n     * @param element\r\n     * @param pageX\r\n     * @param pageY\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    function pageToPixel(element, pageX, pageY) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        if(enabledElement.image === undefined) {\r\n            throw \"image has not been loaded yet\";\r\n        }\r\n\r\n        var image = enabledElement.image;\r\n\r\n        // convert the pageX and pageY to the canvas client coordinates\r\n        var rect = element.getBoundingClientRect();\r\n        var clientX = pageX - rect.left - window.pageXOffset;\r\n        var clientY = pageY - rect.top - window.pageYOffset;\r\n\r\n        var pt = {x: clientX, y: clientY};\r\n        var transform = cornerstone.internal.getTransform(enabledElement);\r\n        transform.invert();\r\n        return transform.transformPoint(pt.x, pt.y);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.pageToPixel = pageToPixel;\r\n\r\n}(cornerstone));\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Converts a point in the pixel coordinate system to the canvas coordinate system\r\n     * system.  This can be used to render using canvas context without having the weird\r\n     * side effects that come from scaling and non square pixels\r\n     * @param element\r\n     * @param pt\r\n     * @returns {x: number, y: number}\r\n     */\r\n    function pixelToCanvas(element, pt) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        var transform = cornerstone.internal.getTransform(enabledElement);\r\n        return transform.transformPoint(pt.x, pt.y);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.pixelToCanvas = pixelToCanvas;\r\n\r\n}(cornerstone));\r\n\r\n/**\r\n * This module is responsible for drawing an image to an enabled elements canvas element\r\n */\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    var colorRenderCanvas = document.createElement('canvas');\r\n    var colorRenderCanvasContext;\r\n    var colorRenderCanvasData;\r\n\r\n    var lastRenderedImageId;\r\n    var lastRenderedViewport = {};\r\n\r\n    function initializeColorRenderCanvas(image)\r\n    {\r\n        // Resize the canvas\r\n        colorRenderCanvas.width = image.width;\r\n        colorRenderCanvas.height = image.height;\r\n\r\n        // get the canvas data so we can write to it directly\r\n        colorRenderCanvasContext = colorRenderCanvas.getContext('2d');\r\n        colorRenderCanvasContext.fillStyle = 'white';\r\n        colorRenderCanvasContext.fillRect(0,0, colorRenderCanvas.width, colorRenderCanvas.height);\r\n        colorRenderCanvasData = colorRenderCanvasContext.getImageData(0,0,image.width, image.height);\r\n    }\r\n\r\n\r\n    function getLut(image, viewport)\r\n    {\r\n        // if we have a cached lut and it has the right values, return it immediately\r\n        if(image.lut !== undefined &&\r\n            image.lut.windowCenter === viewport.voi.windowCenter &&\r\n            image.lut.windowWidth === viewport.voi.windowWidth &&\r\n            image.lut.invert === viewport.invert) {\r\n            return image.lut;\r\n        }\r\n\r\n        // lut is invalid or not present, regenerate it and cache it\r\n        cornerstone.generateLut(image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert);\r\n        image.lut.windowWidth = viewport.voi.windowWidth;\r\n        image.lut.windowCenter = viewport.voi.windowCenter;\r\n        image.lut.invert = viewport.invert;\r\n        return image.lut;\r\n    }\r\n\r\n    function doesImageNeedToBeRendered(enabledElement, image)\r\n    {\r\n        if(image.imageId !== lastRenderedImageId ||\r\n            lastRenderedViewport.windowCenter !== enabledElement.viewport.voi.windowCenter ||\r\n            lastRenderedViewport.windowWidth !== enabledElement.viewport.voi.windowWidth ||\r\n            lastRenderedViewport.invert !== enabledElement.viewport.invert ||\r\n            lastRenderedViewport.rotation !== enabledElement.viewport.rotation ||  \r\n            lastRenderedViewport.hflip !== enabledElement.viewport.hflip ||\r\n            lastRenderedViewport.vflip !== enabledElement.viewport.vflip\r\n            )\r\n        {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    function getRenderCanvas(enabledElement, image, invalidated)\r\n    {\r\n        // apply the lut to the stored pixel data onto the render canvas\r\n\r\n        if(enabledElement.viewport.voi.windowWidth === enabledElement.image.windowWidth &&\r\n            enabledElement.viewport.voi.windowCenter === enabledElement.image.windowCenter &&\r\n            enabledElement.viewport.invert === false)\r\n        {\r\n            // the color image voi/invert has not been modified, request the canvas that contains\r\n            // it so we can draw it directly to the display canvas\r\n            return image.getCanvas();\r\n        }\r\n        else\r\n        {\r\n            if(doesImageNeedToBeRendered(enabledElement, image) === false && invalidated !== true) {\r\n                return colorRenderCanvas;\r\n            }\r\n\r\n            // If our render canvas does not match the size of this image reset it\r\n            // NOTE: This might be inefficient if we are updating multiple images of different\r\n            // sizes frequently.\r\n            if(colorRenderCanvas.width !== image.width || colorRenderCanvas.height != image.height) {\r\n                initializeColorRenderCanvas(image);\r\n            }\r\n\r\n            // get the lut to use\r\n            var colorLut = getLut(image, enabledElement.viewport);\r\n\r\n            // the color image voi/invert has been modified - apply the lut to the underlying\r\n            // pixel data and put it into the renderCanvas\r\n            cornerstone.storedColorPixelDataToCanvasImageData(image, colorLut, colorRenderCanvasData.data);\r\n            colorRenderCanvasContext.putImageData(colorRenderCanvasData, 0, 0);\r\n            return colorRenderCanvas;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * API function to render a color image to an enabled element\r\n     * @param enabledElement\r\n     * @param invalidated - true if pixel data has been invaldiated and cached rendering should not be used\r\n     */\r\n    function renderColorImage(enabledElement, invalidated) {\r\n\r\n        if(enabledElement === undefined) {\r\n            throw \"drawImage: enabledElement parameter must not be undefined\";\r\n        }\r\n        var image = enabledElement.image;\r\n        if(image === undefined) {\r\n            throw \"drawImage: image must be loaded before it can be drawn\";\r\n        }\r\n\r\n        // get the canvas context and reset the transform\r\n        var context = enabledElement.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        // clear the canvas\r\n        context.fillStyle = 'black';\r\n        context.fillRect(0,0, enabledElement.canvas.width, enabledElement.canvas.height);\r\n\r\n        // turn off image smooth/interpolation if pixelReplication is set in the viewport\r\n        if(enabledElement.viewport.pixelReplication === true) {\r\n            context.imageSmoothingEnabled = false;\r\n            context.mozImageSmoothingEnabled = false; // firefox doesn't support imageSmoothingEnabled yet\r\n        }\r\n        else {\r\n            context.imageSmoothingEnabled = true;\r\n            context.mozImageSmoothingEnabled = true;\r\n        }\r\n\r\n        // save the canvas context state and apply the viewport properties\r\n        context.save();\r\n        cornerstone.setToPixelCoordinateSystem(enabledElement, context);\r\n\r\n        var renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\r\n\r\n        context.drawImage(renderCanvas, 0,0, image.width, image.height, 0, 0, image.width, image.height);\r\n\r\n        context.restore();\r\n\r\n        lastRenderedImageId = image.imageId;\r\n        lastRenderedViewport.windowCenter = enabledElement.viewport.voi.windowCenter;\r\n        lastRenderedViewport.windowWidth = enabledElement.viewport.voi.windowWidth;\r\n        lastRenderedViewport.invert = enabledElement.viewport.invert;\r\n        lastRenderedViewport.rotation = enabledElement.viewport.rotation;\r\n        lastRenderedViewport.hflip = enabledElement.viewport.hflip;\r\n        lastRenderedViewport.vflip = enabledElement.viewport.vflip;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.rendering.colorImage = renderColorImage;\r\n    cornerstone.renderColorImage = renderColorImage;\r\n}(cornerstone));\r\n\r\n/**\r\n * This module is responsible for drawing a grayscale image\r\n */\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    var grayscaleRenderCanvas = document.createElement('canvas');\r\n    var grayscaleRenderCanvasContext;\r\n    var grayscaleRenderCanvasData;\r\n\r\n    var lastRenderedImageId;\r\n    var lastRenderedViewport = {};\r\n\r\n    function initializeGrayscaleRenderCanvas(image)\r\n    {\r\n        // Resize the canvas\r\n        grayscaleRenderCanvas.width = image.width;\r\n        grayscaleRenderCanvas.height = image.height;\r\n\r\n        // NOTE - we need to fill the render canvas with white pixels since we control the luminance\r\n        // using the alpha channel to improve rendering performance.\r\n        grayscaleRenderCanvasContext = grayscaleRenderCanvas.getContext('2d');\r\n        grayscaleRenderCanvasContext.fillStyle = 'white';\r\n        grayscaleRenderCanvasContext.fillRect(0,0, grayscaleRenderCanvas.width, grayscaleRenderCanvas.height);\r\n        grayscaleRenderCanvasData = grayscaleRenderCanvasContext.getImageData(0,0,image.width, image.height);\r\n    }\r\n\r\n    function getLut(image, viewport, invalidated)\r\n    {\r\n        // if we have a cached lut and it has the right values, return it immediately\r\n        if(image.lut !== undefined &&\r\n            image.lut.windowCenter === viewport.voi.windowCenter &&\r\n            image.lut.windowWidth === viewport.voi.windowWidth &&\r\n            image.lut.invert === viewport.invert &&\r\n            invalidated !== true) {\r\n            return image.lut;\r\n        }\r\n\r\n        // lut is invalid or not present, regenerate it and cache it\r\n        cornerstone.generateLut(image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert);\r\n        image.lut.windowWidth = viewport.voi.windowWidth;\r\n        image.lut.windowCenter = viewport.voi.windowCenter;\r\n        image.lut.invert = viewport.invert;\r\n        return image.lut;\r\n    }\r\n\r\n    function doesImageNeedToBeRendered(enabledElement, image)\r\n    {\r\n        if(image.imageId !== lastRenderedImageId ||\r\n            lastRenderedViewport.windowCenter !== enabledElement.viewport.voi.windowCenter ||\r\n            lastRenderedViewport.windowWidth !== enabledElement.viewport.voi.windowWidth ||\r\n            lastRenderedViewport.invert !== enabledElement.viewport.invert ||\r\n            lastRenderedViewport.rotation !== enabledElement.viewport.rotation ||\r\n            lastRenderedViewport.hflip !== enabledElement.viewport.hflip ||\r\n            lastRenderedViewport.vflip !== enabledElement.viewport.vflip\r\n            )\r\n        {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    function getRenderCanvas(enabledElement, image, invalidated)\r\n    {\r\n        // apply the lut to the stored pixel data onto the render canvas\r\n\r\n        if(doesImageNeedToBeRendered(enabledElement, image) === false && invalidated !== true) {\r\n            return grayscaleRenderCanvas;\r\n        }\r\n\r\n        // If our render canvas does not match the size of this image reset it\r\n        // NOTE: This might be inefficient if we are updating multiple images of different\r\n        // sizes frequently.\r\n        if(grayscaleRenderCanvas.width !== image.width || grayscaleRenderCanvas.height != image.height) {\r\n            initializeGrayscaleRenderCanvas(image);\r\n        }\r\n\r\n        // get the lut to use\r\n        var lut = getLut(image, enabledElement.viewport, invalidated);\r\n        // gray scale image - apply the lut and put the resulting image onto the render canvas\r\n        cornerstone.storedPixelDataToCanvasImageData(image, lut, grayscaleRenderCanvasData.data);\r\n        grayscaleRenderCanvasContext.putImageData(grayscaleRenderCanvasData, 0, 0);\r\n        return grayscaleRenderCanvas;\r\n    }\r\n\r\n    /**\r\n     * API function to draw a grayscale image to a given enabledElement\r\n     * @param enabledElement\r\n     * @param invalidated - true if pixel data has been invaldiated and cached rendering should not be used\r\n     */\r\n    function renderGrayscaleImage(enabledElement, invalidated) {\r\n\r\n        if(enabledElement === undefined) {\r\n            throw \"drawImage: enabledElement parameter must not be undefined\";\r\n        }\r\n        var image = enabledElement.image;\r\n        if(image === undefined) {\r\n            throw \"drawImage: image must be loaded before it can be drawn\";\r\n        }\r\n\r\n        // get the canvas context and reset the transform\r\n        var context = enabledElement.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        // clear the canvas\r\n        context.fillStyle = 'black';\r\n        context.fillRect(0,0, enabledElement.canvas.width, enabledElement.canvas.height);\r\n\r\n        // turn off image smooth/interpolation if pixelReplication is set in the viewport\r\n        if(enabledElement.viewport.pixelReplication === true) {\r\n            context.imageSmoothingEnabled = false;\r\n            context.mozImageSmoothingEnabled = false; // firefox doesn't support imageSmoothingEnabled yet\r\n        }\r\n        else {\r\n            context.imageSmoothingEnabled = true;\r\n            context.mozImageSmoothingEnabled = true;\r\n        }\r\n\r\n        // save the canvas context state and apply the viewport properties\r\n        cornerstone.setToPixelCoordinateSystem(enabledElement, context);\r\n\r\n        var renderCanvas = getRenderCanvas(enabledElement, image, invalidated);\r\n\r\n        // Draw the render canvas half the image size (because we set origin to the middle of the canvas above)\r\n        context.drawImage(renderCanvas, 0,0, image.width, image.height, 0, 0, image.width, image.height);\r\n\r\n        lastRenderedImageId = image.imageId;\r\n        lastRenderedViewport.windowCenter = enabledElement.viewport.voi.windowCenter;\r\n        lastRenderedViewport.windowWidth = enabledElement.viewport.voi.windowWidth;\r\n        lastRenderedViewport.invert = enabledElement.viewport.invert;\r\n        lastRenderedViewport.rotation = enabledElement.viewport.rotation;\r\n        lastRenderedViewport.hflip = enabledElement.viewport.hflip;\r\n        lastRenderedViewport.vflip = enabledElement.viewport.vflip;\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.rendering.grayscaleImage = renderGrayscaleImage;\r\n    cornerstone.renderGrayscaleImage = renderGrayscaleImage;\r\n\r\n}(cornerstone));\r\n\r\n/**\r\n * This module is responsible for drawing an image to an enabled elements canvas element\r\n */\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * API function to draw a standard web image (PNG, JPG) to an enabledImage\r\n     *\r\n     * @param enabledElement\r\n     * @param invalidated - true if pixel data has been invaldiated and cached rendering should not be used\r\n     */\r\n    function renderWebImage(enabledElement, invalidated) {\r\n\r\n        if(enabledElement === undefined) {\r\n            throw \"drawImage: enabledElement parameter must not be undefined\";\r\n        }\r\n        var image = enabledElement.image;\r\n        if(image === undefined) {\r\n            throw \"drawImage: image must be loaded before it can be drawn\";\r\n        }\r\n\r\n        // get the canvas context and reset the transform\r\n        var context = enabledElement.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        // clear the canvas\r\n        context.fillStyle = 'black';\r\n        context.fillRect(0,0, enabledElement.canvas.width, enabledElement.canvas.height);\r\n\r\n        // turn off image smooth/interpolation if pixelReplication is set in the viewport\r\n        if(enabledElement.viewport.pixelReplication === true) {\r\n            context.imageSmoothingEnabled = false;\r\n            context.mozImageSmoothingEnabled = false; // firefox doesn't support imageSmoothingEnabled yet\r\n        }\r\n        else {\r\n            context.imageSmoothingEnabled = true;\r\n            context.mozImageSmoothingEnabled = true;\r\n        }\r\n\r\n        // save the canvas context state and apply the viewport properties\r\n        cornerstone.setToPixelCoordinateSystem(enabledElement, context);\r\n\r\n        // if the viewport ww/wc and invert all match the initial state of the image, we can draw the image\r\n        // directly.  If any of those are changed, we call renderColorImage() to apply the lut\r\n        if(enabledElement.viewport.voi.windowWidth === enabledElement.image.windowWidth &&\r\n            enabledElement.viewport.voi.windowCenter === enabledElement.image.windowCenter &&\r\n            enabledElement.viewport.invert === false)\r\n        {\r\n            context.drawImage(image.getImage(), 0, 0, image.width, image.height, 0, 0, image.width, image.height);\r\n        } else {\r\n            cornerstone.renderColorImage(enabledElement, invalidated);\r\n        }\r\n\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.rendering.webImage = renderWebImage;\r\n    cornerstone.renderWebImage = renderWebImage;\r\n\r\n}(cornerstone));\r\n/**\r\n * This module is responsible for enabling an element to display images with cornerstone\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function setCanvasSize(element, canvas)\r\n    {\r\n        // the device pixel ratio is 1.0 for normal displays and > 1.0\r\n        // for high DPI displays like Retina\r\n        /*\r\n\r\n        This functionality is disabled due to buggy behavior on systems with mixed DPI's.  If the canvas\r\n        is created on a display with high DPI (e.g. 2.0) and then the browser window is dragged to\r\n        a different display with a different DPI (e.g. 1.0), the canvas is not recreated so the pageToPixel\r\n        produces incorrect results.  I couldn't find any way to determine when the DPI changed other than\r\n        by polling which is not very clean.  If anyone has any ideas here, please let me know, but for now\r\n        we will disable this functionality.  We may want\r\n        to add a mechanism to optionally enable this functionality if we can determine it is safe to do\r\n        so (e.g. iPad or iPhone or perhaps enumerate the displays on the system.  I am choosing\r\n        to be cautious here since I would rather not have bug reports or safety issues related to this\r\n        scenario.\r\n\r\n        var devicePixelRatio = window.devicePixelRatio;\r\n        if(devicePixelRatio === undefined) {\r\n            devicePixelRatio = 1.0;\r\n        }\r\n        */\r\n\r\n        canvas.width = element.clientWidth;\r\n        canvas.height = element.clientHeight;\r\n        canvas.style.width = element.clientWidth + \"px\";\r\n        canvas.style.height = element.clientHeight + \"px\";\r\n    }\r\n\r\n    /**\r\n     * resizes an enabled element and optionally fits the image to window\r\n     * @param element\r\n     * @param fitToWindow true to refit, false to leave viewport parameters as they are\r\n     */\r\n    function resize(element, fitToWindow) {\r\n\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        setCanvasSize(element, enabledElement.canvas);\r\n\r\n        if(enabledElement.image === undefined ) {\r\n            return;\r\n        }\r\n\r\n        if(fitToWindow === true) {\r\n            cornerstone.fitToWindow(element);\r\n        }\r\n        else {\r\n            cornerstone.updateImage(element);\r\n        }\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstone.resize = resize;\r\n\r\n}(cornerstone));\r\n/**\r\n * This module contains a function that will set the canvas context to the pixel coordinates system\r\n * making it easy to draw geometry on the image\r\n */\r\n\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Sets the canvas context transformation matrix to the pixel coordinate system.  This allows\r\n     * geometry to be driven using the canvas context using coordinates in the pixel coordinate system\r\n     * @param ee\r\n     * @param context\r\n     * @param scale optional scaler to apply\r\n     */\r\n    function setToPixelCoordinateSystem(enabledElement, context, scale)\r\n    {\r\n        if(enabledElement === undefined) {\r\n            throw \"setToPixelCoordinateSystem: parameter enabledElement must not be undefined\";\r\n        }\r\n        if(context === undefined) {\r\n            throw \"setToPixelCoordinateSystem: parameter context must not be undefined\";\r\n        }\r\n\r\n        var transform = cornerstone.internal.calculateTransform(enabledElement, scale);\r\n        context.setTransform(transform.m[0],transform.m[1],transform.m[2],transform.m[3],transform.m[4],transform.m[5],transform.m[6]);\r\n    }\r\n\r\n    // Module exports\r\n    cornerstone.setToPixelCoordinateSystem = setToPixelCoordinateSystem;\r\n}(cornerstone));\r\n/**\r\n * This module contains functions to deal with getting and setting the viewport for an enabled element\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    function setViewport(element, viewport) {\r\n\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        enabledElement.viewport.scale = viewport.scale;\r\n        enabledElement.viewport.translation.x = viewport.translation.x;\r\n        enabledElement.viewport.translation.y = viewport.translation.y;\r\n        enabledElement.viewport.voi.windowWidth = viewport.voi.windowWidth;\r\n        enabledElement.viewport.voi.windowCenter = viewport.voi.windowCenter;\r\n        enabledElement.viewport.invert = viewport.invert;\r\n        enabledElement.viewport.pixelReplication = viewport.pixelReplication;\r\n        enabledElement.viewport.rotation = viewport.rotation;\r\n        enabledElement.viewport.hflip = viewport.hflip;\r\n        enabledElement.viewport.vflip = viewport.vflip;\r\n\r\n        // prevent window width from being < 1\r\n        if(enabledElement.viewport.voi.windowWidth < 1) {\r\n            enabledElement.viewport.voi.windowWidth = 1;\r\n        }\r\n        // prevent scale from getting too small\r\n        if(enabledElement.viewport.scale < 0.0001) {\r\n            enabledElement.viewport.scale = 0.25;\r\n        }\r\n\r\n        if(enabledElement.viewport.rotation===360 || enabledElement.viewport.rotation===-360) {\r\n            enabledElement.viewport.rotation = 0;\r\n        }\r\n\r\n        // Force the image to be updated since the viewport has been modified\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n\r\n    // module/private exports\r\n    cornerstone.setViewport = setViewport;\r\n\r\n}(cornerstone));\r\n\r\n/**\r\n * This module contains a function to immediately redraw an image\r\n */\r\n(function (cornerstone) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Forces the image to be updated/redrawn for the specified enabled element\r\n     * @param element\r\n     */\r\n    function updateImage(element, invalidated) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n\r\n        if(enabledElement.image === undefined) {\r\n            throw \"updateImage: image has not been loaded yet\";\r\n        }\r\n\r\n        cornerstone.drawImage(enabledElement, invalidated);\r\n    }\r\n\r\n    // module exports\r\n    cornerstone.updateImage = updateImage;\r\n\r\n}(cornerstone));",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/cornerstone.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 58,
    "kind": "file",
    "name": "src/client/lib/cornerstoneFileImageLoader.js",
    "content": "/*! cornerstone-file-image-loader - v0.5.1 - 2015-04-04 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneFileImageLoader */\r\n//\r\n// This is a cornerstone image loader for DICOM P10 files.  It currently does not support compressed\r\n// transfer syntaxes or big endian transfer syntaxes.  It will support implicit little endian transfer\r\n// syntaxes but explicit little endian is strongly preferred to avoid any parsing issues related\r\n// to SQ elements.\r\n//\r\n\r\nvar cornerstoneFileImageLoader = (function ($, cornerstone, cornerstoneFileImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneFileImageLoader === undefined) {\r\n        cornerstoneFileImageLoader = {};\r\n    }\r\n\r\n\r\n\r\n    function isColorImage(photoMetricInterpretation)\r\n    {\r\n        if(photoMetricInterpretation === \"RGB\" ||\r\n            photoMetricInterpretation === \"PALETTE COLOR\" ||\r\n            photoMetricInterpretation === \"YBR_FULL\" ||\r\n            photoMetricInterpretation === \"YBR_FULL_422\" ||\r\n            photoMetricInterpretation === \"YBR_PARTIAL_422\" ||\r\n            photoMetricInterpretation === \"YBR_PARTIAL_420\" ||\r\n            photoMetricInterpretation === \"YBR_RCT\")\r\n        {\r\n            return true;\r\n        }\r\n        else\r\n        {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function createImageObject(dataSet, imageId, frame)\r\n    {\r\n        if(frame === undefined) {\r\n            frame = 0;\r\n        }\r\n\r\n        // make the image based on whether it is color or not\r\n        var photometricInterpretation = dataSet.string('x00280004');\r\n        var isColor = isColorImage(photometricInterpretation);\r\n        if(isColor === false) {\r\n            return cornerstoneWADOImageLoader.makeGrayscaleImage(imageId, dataSet, dataSet.byteArray, photometricInterpretation, frame);\r\n        } else {\r\n            return cornerstoneWADOImageLoader.makeColorImage(imageId, dataSet, dataSet.byteArray, photometricInterpretation, frame);\r\n        }\r\n    }\r\n\r\n    var multiFrameCacheHack = {};\r\n\r\n    // Loads an image given an imageId\r\n    // wado url example:\r\n    // http://localhost:3333/wado?requestType=WADO&studyUID=1.3.6.1.4.1.25403.166563008443.5076.20120418075541.1&seriesUID=1.3.6.1.4.1.25403.166563008443.5076.20120418075541.2&objectUID=1.3.6.1.4.1.25403.166563008443.5076.20120418075557.1&contentType=application%2Fdicom&transferSyntax=1.2.840.10008.1.2.1\r\n    // NOTE: supposedly the instance will be returned in Explicit Little Endian transfer syntax if you don't\r\n    // specify a transferSyntax but Osirix doesn't do this and seems to return it with the transfer syntax it is\r\n    // stored as.\r\n    function loadImage(imageId) {\r\n        // create a deferred object\r\n        // TODO: Consider not using jquery for deferred - maybe cujo's when library\r\n        var deferred = $.Deferred();\r\n\r\n        // build a url by parsing out the url scheme and frame index from the imageId\r\n        var url = imageId;\r\n        url = url.substring(12);\r\n        var frameIndex = url.indexOf('frame=');\r\n        var frame;\r\n        if(frameIndex !== -1) {\r\n            var frameStr = url.substr(frameIndex + 6);\r\n            frame = parseInt(frameStr);\r\n            url = url.substr(0, frameIndex-1);\r\n        }\r\n\r\n        // if multiframe and cached, use the cached data set to extract the frame\r\n        if(frame !== undefined &&\r\n            multiFrameCacheHack.hasOwnProperty(url))\r\n        {\r\n            var dataSet = multiFrameCacheHack[url];\r\n            var imagePromise = createImageObject(dataSet, imageId, frame);\r\n            imagePromise.then(function(image) {\r\n                deferred.resolve(image);\r\n            }, function() {\r\n                deferred.reject();\r\n            });\r\n            return deferred;\r\n        }\r\n\r\n        var fileIndex = parseInt(url);\r\n        var file = cornerstoneFileImageLoader.getFile(fileIndex);\r\n        if(file === undefined) {\r\n            deferred.reject('unknown file index ' + url);\r\n            return deferred;\r\n        }\r\n\r\n        // Read the DICOM Data\r\n        var fileReader = new FileReader();\r\n        fileReader.onload = function(e) {\r\n            // Parse the DICOM File\r\n            var dicomPart10AsArrayBuffer = e.target.result;\r\n            var byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\r\n            var dataSet = dicomParser.parseDicom(byteArray);\r\n\r\n            // if multiframe, cache the parsed data set to speed up subsequent\r\n            // requests for the other frames\r\n            if(frame !== undefined) {\r\n                multiFrameCacheHack[url] = dataSet;\r\n            }\r\n\r\n            var imagePromise = createImageObject(dataSet, imageId, frame);\r\n            imagePromise.then(function(image) {\r\n                deferred.resolve(image);\r\n            }, function() {\r\n                deferred.reject();\r\n            });\r\n        };\r\n        fileReader.readAsArrayBuffer(file);\r\n\r\n        return deferred;\r\n    }\r\n\r\n    // steam the http and https prefixes so we can use wado URL's directly\r\n    cornerstone.registerImageLoader('dicomfile', loadImage);\r\n\r\n    return cornerstoneFileImageLoader;\r\n}($, cornerstone, cornerstoneFileImageLoader));\r\n/**\r\n */\r\nvar cornerstoneFileImageLoader = (function (cornerstoneFileImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneFileImageLoader === undefined) {\r\n        cornerstoneFileImageLoader = {};\r\n    }\r\n\r\n    var files = [];\r\n\r\n    function addFile(file) {\r\n        var fileIndex =  files.push(file);\r\n        return fileIndex - 1;\r\n    }\r\n\r\n    function getFile(index) {\r\n        return files[index];\r\n    }\r\n\r\n    function purge() {\r\n        files = [];\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneFileImageLoader.addFile = addFile;\r\n    cornerstoneFileImageLoader.getFile = getFile;\r\n    cornerstoneFileImageLoader.purge = purge;\r\n\r\n    return cornerstoneFileImageLoader;\r\n}(cornerstoneFileImageLoader));",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/cornerstoneFileImageLoader.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 59,
    "kind": "variable",
    "name": "cornerstoneFileImageLoader",
    "memberof": "src/client/lib/cornerstoneFileImageLoader.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneFileImageLoader.js~cornerstoneFileImageLoader",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneFileImageLoader.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 9,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 60,
    "kind": "variable",
    "name": "cornerstoneFileImageLoader",
    "memberof": "src/client/lib/cornerstoneFileImageLoader.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneFileImageLoader.js~cornerstoneFileImageLoader",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneFileImageLoader.js",
    "importStyle": null,
    "description": "",
    "lineNumber": 131,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 61,
    "kind": "file",
    "name": "src/client/lib/cornerstoneMath.js",
    "content": "/*! cornerstoneMath - v0.1.2 - 2015-08-31 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneMath */\r\n// Begin Source: src/vector3.js\r\n// Based on THREE.JS\r\n\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    cornerstoneMath.Vector3 = function ( x, y, z ) {\r\n\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n        this.z = z || 0;\r\n\r\n    };\r\n\r\n    cornerstoneMath.Vector3.prototype = {\r\n\r\n        constructor: cornerstoneMath.Vector3,\r\n\r\n        set: function ( x, y, z ) {\r\n\r\n            this.x = x;\r\n            this.y = y;\r\n            this.z = z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setX: function ( x ) {\r\n\r\n            this.x = x;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setY: function ( y ) {\r\n\r\n            this.y = y;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setZ: function ( z ) {\r\n\r\n            this.z = z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setComponent: function ( index, value ) {\r\n\r\n            switch ( index ) {\r\n\r\n                case 0: this.x = value; break;\r\n                case 1: this.y = value; break;\r\n                case 2: this.z = value; break;\r\n                default: throw new Error( \"index is out of range: \" + index );\r\n\r\n            }\r\n\r\n        },\r\n\r\n        getComponent: function ( index ) {\r\n\r\n            switch ( index ) {\r\n\r\n                case 0: return this.x;\r\n                case 1: return this.y;\r\n                case 2: return this.z;\r\n                default: throw new Error( \"index is out of range: \" + index );\r\n\r\n            }\r\n\r\n        },\r\n\r\n        copy: function ( v ) {\r\n\r\n            this.x = v.x;\r\n            this.y = v.y;\r\n            this.z = v.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        add: function ( v, w ) {\r\n\r\n            if ( w !== undefined ) {\r\n\r\n                console.warn( 'DEPRECATED: Vector3\\'s .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n                return this.addVectors( v, w );\r\n\r\n            }\r\n\r\n            this.x += v.x;\r\n            this.y += v.y;\r\n            this.z += v.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        addScalar: function ( s ) {\r\n\r\n            this.x += s;\r\n            this.y += s;\r\n            this.z += s;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        addVectors: function ( a, b ) {\r\n\r\n            this.x = a.x + b.x;\r\n            this.y = a.y + b.y;\r\n            this.z = a.z + b.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        sub: function ( v, w ) {\r\n\r\n            if ( w !== undefined ) {\r\n\r\n                console.warn( 'DEPRECATED: Vector3\\'s .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n                return this.subVectors( v, w );\r\n\r\n            }\r\n\r\n            this.x -= v.x;\r\n            this.y -= v.y;\r\n            this.z -= v.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        subVectors: function ( a, b ) {\r\n\r\n            this.x = a.x - b.x;\r\n            this.y = a.y - b.y;\r\n            this.z = a.z - b.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        multiply: function ( v, w ) {\r\n\r\n            if ( w !== undefined ) {\r\n\r\n                console.warn( 'DEPRECATED: Vector3\\'s .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.' );\r\n                return this.multiplyVectors( v, w );\r\n\r\n            }\r\n\r\n            this.x *= v.x;\r\n            this.y *= v.y;\r\n            this.z *= v.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        multiplyScalar: function ( scalar ) {\r\n\r\n            this.x *= scalar;\r\n            this.y *= scalar;\r\n            this.z *= scalar;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        multiplyVectors: function ( a, b ) {\r\n\r\n            this.x = a.x * b.x;\r\n            this.y = a.y * b.y;\r\n            this.z = a.z * b.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n\r\n        applyAxisAngle: function () {\r\n\r\n            var quaternion;\r\n\r\n            return function ( axis, angle ) {\r\n\r\n                if ( quaternion === undefined ) quaternion = new cornerstoneMath.Quaternion();\r\n\r\n                this.applyQuaternion( quaternion.setFromAxisAngle( axis, angle ) );\r\n\r\n                return this;\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n        applyMatrix3: function ( m ) {\r\n\r\n            var x = this.x;\r\n            var y = this.y;\r\n            var z = this.z;\r\n\r\n            var e = m.elements;\r\n\r\n            this.x = e[0] * x + e[3] * y + e[6] * z;\r\n            this.y = e[1] * x + e[4] * y + e[7] * z;\r\n            this.z = e[2] * x + e[5] * y + e[8] * z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        applyMatrix4: function ( m ) {\r\n\r\n            // input: THREE.Matrix4 affine matrix\r\n\r\n            var x = this.x, y = this.y, z = this.z;\r\n\r\n            var e = m.elements;\r\n\r\n            this.x = e[0] * x + e[4] * y + e[8]  * z + e[12];\r\n            this.y = e[1] * x + e[5] * y + e[9]  * z + e[13];\r\n            this.z = e[2] * x + e[6] * y + e[10] * z + e[14];\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        applyProjection: function ( m ) {\r\n\r\n            // input: THREE.Matrix4 projection matrix\r\n\r\n            var x = this.x, y = this.y, z = this.z;\r\n\r\n            var e = m.elements;\r\n            var d = 1 / ( e[3] * x + e[7] * y + e[11] * z + e[15] ); // perspective divide\r\n\r\n            this.x = ( e[0] * x + e[4] * y + e[8]  * z + e[12] ) * d;\r\n            this.y = ( e[1] * x + e[5] * y + e[9]  * z + e[13] ) * d;\r\n            this.z = ( e[2] * x + e[6] * y + e[10] * z + e[14] ) * d;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        applyQuaternion: function ( q ) {\r\n\r\n            var x = this.x;\r\n            var y = this.y;\r\n            var z = this.z;\r\n\r\n            var qx = q.x;\r\n            var qy = q.y;\r\n            var qz = q.z;\r\n            var qw = q.w;\r\n\r\n            // calculate quat * vector\r\n\r\n            var ix =  qw * x + qy * z - qz * y;\r\n            var iy =  qw * y + qz * x - qx * z;\r\n            var iz =  qw * z + qx * y - qy * x;\r\n            var iw = -qx * x - qy * y - qz * z;\r\n\r\n            // calculate result * inverse quat\r\n\r\n            this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n            this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n            this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        transformDirection: function ( m ) {\r\n\r\n            // input: THREE.Matrix4 affine matrix\r\n            // vector interpreted as a direction\r\n\r\n            var x = this.x, y = this.y, z = this.z;\r\n\r\n            var e = m.elements;\r\n\r\n            this.x = e[0] * x + e[4] * y + e[8]  * z;\r\n            this.y = e[1] * x + e[5] * y + e[9]  * z;\r\n            this.z = e[2] * x + e[6] * y + e[10] * z;\r\n\r\n            this.normalize();\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        divide: function ( v ) {\r\n\r\n            this.x /= v.x;\r\n            this.y /= v.y;\r\n            this.z /= v.z;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        divideScalar: function ( scalar ) {\r\n\r\n            if ( scalar !== 0 ) {\r\n\r\n                var invScalar = 1 / scalar;\r\n\r\n                this.x *= invScalar;\r\n                this.y *= invScalar;\r\n                this.z *= invScalar;\r\n\r\n            } else {\r\n\r\n                this.x = 0;\r\n                this.y = 0;\r\n                this.z = 0;\r\n\r\n            }\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        min: function ( v ) {\r\n\r\n            if ( this.x > v.x ) {\r\n\r\n                this.x = v.x;\r\n\r\n            }\r\n\r\n            if ( this.y > v.y ) {\r\n\r\n                this.y = v.y;\r\n\r\n            }\r\n\r\n            if ( this.z > v.z ) {\r\n\r\n                this.z = v.z;\r\n\r\n            }\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        max: function ( v ) {\r\n\r\n            if ( this.x < v.x ) {\r\n\r\n                this.x = v.x;\r\n\r\n            }\r\n\r\n            if ( this.y < v.y ) {\r\n\r\n                this.y = v.y;\r\n\r\n            }\r\n\r\n            if ( this.z < v.z ) {\r\n\r\n                this.z = v.z;\r\n\r\n            }\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        clamp: function ( min, max ) {\r\n\r\n            // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n            if ( this.x < min.x ) {\r\n\r\n                this.x = min.x;\r\n\r\n            } else if ( this.x > max.x ) {\r\n\r\n                this.x = max.x;\r\n\r\n            }\r\n\r\n            if ( this.y < min.y ) {\r\n\r\n                this.y = min.y;\r\n\r\n            } else if ( this.y > max.y ) {\r\n\r\n                this.y = max.y;\r\n\r\n            }\r\n\r\n            if ( this.z < min.z ) {\r\n\r\n                this.z = min.z;\r\n\r\n            } else if ( this.z > max.z ) {\r\n\r\n                this.z = max.z;\r\n\r\n            }\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        clampScalar: ( function () {\r\n\r\n            var min, max;\r\n\r\n            return function ( minVal, maxVal ) {\r\n\r\n                if ( min === undefined ) {\r\n\r\n                    min = new cornerstoneMath.Vector3();\r\n                    max = new cornerstoneMath.Vector3();\r\n\r\n                }\r\n\r\n                min.set( minVal, minVal, minVal );\r\n                max.set( maxVal, maxVal, maxVal );\r\n\r\n                return this.clamp( min, max );\r\n\r\n            };\r\n\r\n        } )(),\r\n\r\n        floor: function () {\r\n\r\n            this.x = Math.floor( this.x );\r\n            this.y = Math.floor( this.y );\r\n            this.z = Math.floor( this.z );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        ceil: function () {\r\n\r\n            this.x = Math.ceil( this.x );\r\n            this.y = Math.ceil( this.y );\r\n            this.z = Math.ceil( this.z );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        round: function () {\r\n\r\n            this.x = Math.round( this.x );\r\n            this.y = Math.round( this.y );\r\n            this.z = Math.round( this.z );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        roundToZero: function () {\r\n\r\n            this.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n            this.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n            this.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        negate: function () {\r\n\r\n            return this.multiplyScalar( - 1 );\r\n\r\n        },\r\n\r\n        dot: function ( v ) {\r\n\r\n            return this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n        },\r\n\r\n        lengthSq: function () {\r\n\r\n            return this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n        },\r\n\r\n        length: function () {\r\n\r\n            return Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\r\n\r\n        },\r\n\r\n        lengthManhattan: function () {\r\n\r\n            return Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z );\r\n\r\n        },\r\n\r\n        normalize: function () {\r\n\r\n            return this.divideScalar( this.length() );\r\n\r\n        },\r\n\r\n        setLength: function ( l ) {\r\n\r\n            var oldLength = this.length();\r\n\r\n            if ( oldLength !== 0 && l !== oldLength  ) {\r\n\r\n                this.multiplyScalar( l / oldLength );\r\n            }\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        lerp: function ( v, alpha ) {\r\n\r\n            this.x += ( v.x - this.x ) * alpha;\r\n            this.y += ( v.y - this.y ) * alpha;\r\n            this.z += ( v.z - this.z ) * alpha;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        cross: function ( v, w ) {\r\n\r\n            if ( w !== undefined ) {\r\n\r\n                console.warn( 'DEPRECATED: Vector3\\'s .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.' );\r\n                return this.crossVectors( v, w );\r\n\r\n            }\r\n\r\n            var x = this.x, y = this.y, z = this.z;\r\n\r\n            this.x = y * v.z - z * v.y;\r\n            this.y = z * v.x - x * v.z;\r\n            this.z = x * v.y - y * v.x;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        crossVectors: function ( a, b ) {\r\n\r\n            var ax = a.x, ay = a.y, az = a.z;\r\n            var bx = b.x, by = b.y, bz = b.z;\r\n\r\n            this.x = ay * bz - az * by;\r\n            this.y = az * bx - ax * bz;\r\n            this.z = ax * by - ay * bx;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        projectOnVector: function () {\r\n\r\n            var v1, dot;\r\n\r\n            return function ( vector ) {\r\n\r\n                if ( v1 === undefined ) v1 = new cornerstoneMath.Vector3();\r\n\r\n                v1.copy( vector ).normalize();\r\n\r\n                dot = this.dot( v1 );\r\n\r\n                return this.copy( v1 ).multiplyScalar( dot );\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n        projectOnPlane: function () {\r\n\r\n            var v1;\r\n\r\n            return function ( planeNormal ) {\r\n\r\n                if ( v1 === undefined ) v1 = new cornerstoneMath.Vector3();\r\n\r\n                v1.copy( this ).projectOnVector( planeNormal );\r\n\r\n                return this.sub( v1 );\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n        reflect: function () {\r\n\r\n            // reflect incident vector off plane orthogonal to normal\r\n            // normal is assumed to have unit length\r\n\r\n            var v1;\r\n\r\n            return function ( normal ) {\r\n\r\n                if ( v1 === undefined ) v1 = new cornerstoneMath.Vector3();\r\n\r\n                return this.sub( v1.copy( normal ).multiplyScalar( 2 * this.dot( normal ) ) );\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n        angleTo: function ( v ) {\r\n\r\n            var theta = this.dot( v ) / ( this.length() * v.length() );\r\n\r\n            // clamp, to handle numerical problems\r\n\r\n            return Math.acos( cornerstoneMath.clamp( theta, -1, 1 ) );\r\n\r\n        },\r\n\r\n        distanceTo: function ( v ) {\r\n\r\n            return Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n        },\r\n\r\n        distanceToSquared: function ( v ) {\r\n\r\n            var dx = this.x - v.x;\r\n            var dy = this.y - v.y;\r\n            var dz = this.z - v.z;\r\n\r\n            return dx * dx + dy * dy + dz * dz;\r\n\r\n        },\r\n\r\n        setEulerFromRotationMatrix: function ( m, order ) {\r\n\r\n            console.error( \"REMOVED: Vector3\\'s setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.\");\r\n\r\n        },\r\n\r\n        setEulerFromQuaternion: function ( q, order ) {\r\n\r\n            console.error( \"REMOVED: Vector3\\'s setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.\");\r\n\r\n        },\r\n\r\n        getPositionFromMatrix: function ( m ) {\r\n\r\n            console.warn( \"DEPRECATED: Vector3\\'s .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code.\" );\r\n\r\n            return this.setFromMatrixPosition( m );\r\n\r\n        },\r\n\r\n        getScaleFromMatrix: function ( m ) {\r\n\r\n            console.warn( \"DEPRECATED: Vector3\\'s .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code.\" );\r\n\r\n            return this.setFromMatrixScale( m );\r\n        },\r\n\r\n        getColumnFromMatrix: function ( index, matrix ) {\r\n\r\n            console.warn( \"DEPRECATED: Vector3\\'s .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code.\" );\r\n\r\n            return this.setFromMatrixColumn( index, matrix );\r\n\r\n        },\r\n\r\n        setFromMatrixPosition: function ( m ) {\r\n\r\n            this.x = m.elements[ 12 ];\r\n            this.y = m.elements[ 13 ];\r\n            this.z = m.elements[ 14 ];\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setFromMatrixScale: function ( m ) {\r\n\r\n            var sx = this.set( m.elements[ 0 ], m.elements[ 1 ], m.elements[  2 ] ).length();\r\n            var sy = this.set( m.elements[ 4 ], m.elements[ 5 ], m.elements[  6 ] ).length();\r\n            var sz = this.set( m.elements[ 8 ], m.elements[ 9 ], m.elements[ 10 ] ).length();\r\n\r\n            this.x = sx;\r\n            this.y = sy;\r\n            this.z = sz;\r\n\r\n            return this;\r\n        },\r\n\r\n        setFromMatrixColumn: function ( index, matrix ) {\r\n\r\n            var offset = index * 4;\r\n\r\n            var me = matrix.elements;\r\n\r\n            this.x = me[ offset ];\r\n            this.y = me[ offset + 1 ];\r\n            this.z = me[ offset + 2 ];\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        equals: function ( v ) {\r\n\r\n            return ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\r\n\r\n        },\r\n\r\n        fromArray: function ( array ) {\r\n\r\n            this.x = array[ 0 ];\r\n            this.y = array[ 1 ];\r\n            this.z = array[ 2 ];\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        toArray: function () {\r\n\r\n            return [ this.x, this.y, this.z ];\r\n\r\n        },\r\n\r\n        clone: function () {\r\n\r\n            return new cornerstoneMath.Vector3( this.x, this.y, this.z );\r\n\r\n        }\r\n\r\n    };\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/vector3.js\r\n\r\n// Begin Source: src/Line3.js\r\n// Copied from THREE.JS\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if (cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    cornerstoneMath.Line3 = function ( start, end ) {\r\n\r\n        this.start = ( start !== undefined ) ? start : new cornerstoneMath.Vector3();\r\n        this.end = ( end !== undefined ) ? end : new cornerstoneMath.Vector3();\r\n\r\n    };\r\n\r\n    cornerstoneMath.Line3.prototype = {\r\n\r\n        constructor: cornerstoneMath.Line3,\r\n\r\n        set: function ( start, end ) {\r\n\r\n            this.start.copy( start );\r\n            this.end.copy( end );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        copy: function ( line ) {\r\n\r\n            this.start.copy( line.start );\r\n            this.end.copy( line.end );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        center: function ( optionalTarget ) {\r\n\r\n            var result = optionalTarget || new cornerstoneMath.Vector3();\r\n            return result.addVectors( this.start, this.end ).multiplyScalar( 0.5 );\r\n\r\n        },\r\n\r\n        delta: function ( optionalTarget ) {\r\n\r\n            var result = optionalTarget || new cornerstoneMath.Vector3();\r\n            return result.subVectors( this.end, this.start );\r\n\r\n        },\r\n\r\n        distanceSq: function () {\r\n\r\n            return this.start.distanceToSquared( this.end );\r\n\r\n        },\r\n\r\n        distance: function () {\r\n\r\n            return this.start.distanceTo( this.end );\r\n\r\n        },\r\n\r\n        at: function ( t, optionalTarget ) {\r\n\r\n            var result = optionalTarget || new cornerstoneMath.Vector3();\r\n\r\n            return this.delta( result ).multiplyScalar( t ).add( this.start );\r\n\r\n        },\r\n\r\n        closestPointToPointParameter: function () {\r\n\r\n            var startP = new cornerstoneMath.Vector3();\r\n            var startEnd = new cornerstoneMath.Vector3();\r\n\r\n            return function ( point, clampToLine ) {\r\n\r\n                startP.subVectors( point, this.start );\r\n                startEnd.subVectors( this.end, this.start );\r\n\r\n                var startEnd2 = startEnd.dot( startEnd );\r\n                var startEnd_startP = startEnd.dot( startP );\r\n\r\n                var t = startEnd_startP / startEnd2;\r\n\r\n                if ( clampToLine ) {\r\n\r\n                    t = cornerstoneMath.Math.clamp( t, 0, 1 );\r\n\r\n                }\r\n\r\n                return t;\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n        closestPointToPoint: function ( point, clampToLine, optionalTarget ) {\r\n\r\n            var t = this.closestPointToPointParameter( point, clampToLine );\r\n\r\n            var result = optionalTarget || new cornerstoneMath.Vector3();\r\n\r\n            return this.delta( result ).multiplyScalar( t ).add( this.start );\r\n\r\n        },\r\n\r\n        applyMatrix4: function ( matrix ) {\r\n\r\n            this.start.applyMatrix4( matrix );\r\n            this.end.applyMatrix4( matrix );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        equals: function ( line ) {\r\n\r\n            return line.start.equals( this.start ) && line.end.equals( this.end );\r\n\r\n        },\r\n\r\n        clone: function () {\r\n\r\n            return new cornerstoneMath.Line3().copy( this );\r\n\r\n        },\r\n\r\n        intersectLine: function ( line ) {\r\n            // http://stackoverflow.com/questions/2316490/the-algorithm-to-find-the-point-of-intersection-of-two-3d-line-segment/10288710#10288710\r\n            var da = this.end.clone().sub(this.start);\r\n            var db = line.end.clone().sub(line.start);\r\n            var dc = line.start.clone().sub(this.start);\r\n\r\n            var daCrossDb = da.clone().cross(db);\r\n            var dcCrossDb = dc.clone().cross(db);\r\n\r\n            if (dc.dot(da) === 0){\r\n                // Lines are not coplanar, stop here\r\n                return;\r\n            }\r\n\r\n            var s = dcCrossDb.dot(daCrossDb) / daCrossDb.lengthSq();\r\n\r\n            // Make sure we have an intersection\r\n            if (s > 1.0 || isNaN(s)) {\r\n                return;\r\n            }\r\n\r\n            var intersection = this.start.clone().add(da.clone().multiplyScalar(s));\r\n            var distanceTest = intersection.clone().sub(line.start).lengthSq() + intersection.clone().sub(line.end).lengthSq();\r\n            if (distanceTest <= line.distanceSq()) {\r\n                return intersection;\r\n            }\r\n            return;\r\n        }\r\n    };\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/Line3.js\r\n\r\n// Begin Source: src/lineSegment.js\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    // based on  http://stackoverflow.com/questions/849211/shortest-distance-between-a-point-and-a-line-segment\r\n    function sqr(x)\r\n    {\r\n        return x * x;\r\n    }\r\n\r\n    function dist2(v, w) {\r\n        return sqr(v.x - w.x) + sqr(v.y - w.y);\r\n    }\r\n\r\n    function distanceToPointSquared(lineSegment, point)\r\n    {\r\n        var l2 = dist2(lineSegment.start, lineSegment.end);\r\n        if(l2 === 0) {\r\n            return dist2(point, lineSegment.start);\r\n        }\r\n        var t = ((point.x - lineSegment.start.x) * (lineSegment.end.x - lineSegment.start.x) +\r\n            (point.y - lineSegment.start.y) * (lineSegment.end.y - lineSegment.start.y)) / l2;\r\n        if(t < 0) {\r\n            return dist2(point, lineSegment.start);\r\n        }\r\n        if(t > 1) {\r\n            return dist2(point, lineSegment.end);\r\n        }\r\n\r\n        var pt = {\r\n            x : lineSegment.start.x + t * (lineSegment.end.x - lineSegment.start.x),\r\n            y : lineSegment.start.y + t * (lineSegment.end.y - lineSegment.start.y)\r\n        };\r\n        return dist2(point, pt);\r\n    }\r\n\r\n    function distanceToPoint(lineSegment, point)\r\n    {\r\n        return Math.sqrt(distanceToPointSquared(lineSegment, point));\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneMath.lineSegment =\r\n    {\r\n        distanceToPoint : distanceToPoint\r\n    };\r\n\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/lineSegment.js\r\n\r\n// Begin Source: src/math.js\r\n// Based on THREE.JS\r\n\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if (cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    function clamp(x,a,b) {\r\n        return ( x < a ) ? a : ( ( x > b ) ? b : x );\r\n    }\r\n\r\n    function degToRad(degrees) {\r\n        var degreeToRadiansFactor = Math.PI / 180;\r\n        return degrees * degreeToRadiansFactor;\r\n    }\r\n\r\n    function radToDeg(radians) {\r\n        var radianToDegreesFactor = 180 / Math.PI;\r\n        return radians * radianToDegreesFactor;\r\n    }\r\n\r\n    cornerstoneMath.clamp = clamp;\r\n    cornerstoneMath.degToRad = degToRad;\r\n    cornerstoneMath.radToDeg = radToDeg;\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/math.js\r\n\r\n// Begin Source: src/matrix4.js\r\n// Based on THREE.JS\r\n\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    cornerstoneMath.Matrix4 = function Matrix4(n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 )\r\n    {\r\n        this.elements = new Float32Array( 16 );\r\n\r\n        // TODO: if n11 is undefined, then just set to identity, otherwise copy all other values into matrix\r\n        //   we should not support semi specification of Matrix4, it is just weird.\r\n\r\n        var te = this.elements;\r\n\r\n        te[0] = ( n11 !== undefined ) ? n11 : 1; te[4] = n12 || 0; te[8] = n13 || 0; te[12] = n14 || 0;\r\n        te[1] = n21 || 0; te[5] = ( n22 !== undefined ) ? n22 : 1; te[9] = n23 || 0; te[13] = n24 || 0;\r\n        te[2] = n31 || 0; te[6] = n32 || 0; te[10] = ( n33 !== undefined ) ? n33 : 1; te[14] = n34 || 0;\r\n        te[3] = n41 || 0; te[7] = n42 || 0; te[11] = n43 || 0; te[15] = ( n44 !== undefined ) ? n44 : 1;\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.makeRotationFromQuaternion = function(q) {\r\n        var te = this.elements;\r\n\r\n        var x = q.x, y = q.y, z = q.z, w = q.w;\r\n        var x2 = x + x, y2 = y + y, z2 = z + z;\r\n        var xx = x * x2, xy = x * y2, xz = x * z2;\r\n        var yy = y * y2, yz = y * z2, zz = z * z2;\r\n        var wx = w * x2, wy = w * y2, wz = w * z2;\r\n\r\n        te[0] = 1 - ( yy + zz );\r\n        te[4] = xy - wz;\r\n        te[8] = xz + wy;\r\n\r\n        te[1] = xy + wz;\r\n        te[5] = 1 - ( xx + zz );\r\n        te[9] = yz - wx;\r\n\r\n        te[2] = xz - wy;\r\n        te[6] = yz + wx;\r\n        te[10] = 1 - ( xx + yy );\r\n\r\n        // last column\r\n        te[3] = 0;\r\n        te[7] = 0;\r\n        te[11] = 0;\r\n\r\n        // bottom row\r\n        te[12] = 0;\r\n        te[13] = 0;\r\n        te[14] = 0;\r\n        te[15] = 1;\r\n\r\n        return this;\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.multiplyMatrices = function(a, b)\r\n    {\r\n        var ae = a.elements;\r\n        var be = b.elements;\r\n        var te = this.elements;\r\n\r\n        var a11 = ae[0], a12 = ae[4], a13 = ae[8], a14 = ae[12];\r\n        var a21 = ae[1], a22 = ae[5], a23 = ae[9], a24 = ae[13];\r\n        var a31 = ae[2], a32 = ae[6], a33 = ae[10], a34 = ae[14];\r\n        var a41 = ae[3], a42 = ae[7], a43 = ae[11], a44 = ae[15];\r\n\r\n        var b11 = be[0], b12 = be[4], b13 = be[8], b14 = be[12];\r\n        var b21 = be[1], b22 = be[5], b23 = be[9], b24 = be[13];\r\n        var b31 = be[2], b32 = be[6], b33 = be[10], b34 = be[14];\r\n        var b41 = be[3], b42 = be[7], b43 = be[11], b44 = be[15];\r\n\r\n        te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n        te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n        te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n        te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n        te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n        te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n        te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n        te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n        te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n        te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n        te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n        te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n        te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n        te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n        te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n        te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n        return this;\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.multiply = function(m, n )\r\n    {\r\n\r\n        if (n !== undefined) {\r\n\r\n            console.warn('DEPRECATED: Matrix4\\'s .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\r\n            return this.multiplyMatrices(m, n);\r\n        }\r\n\r\n        return this.multiplyMatrices(this, m);\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.getInverse = function ( m, throwOnInvertible ) {\r\n\r\n        // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n        var te = this.elements;\r\n        var me = m.elements;\r\n\r\n        var n11 = me[0], n12 = me[4], n13 = me[8], n14 = me[12];\r\n        var n21 = me[1], n22 = me[5], n23 = me[9], n24 = me[13];\r\n        var n31 = me[2], n32 = me[6], n33 = me[10], n34 = me[14];\r\n        var n41 = me[3], n42 = me[7], n43 = me[11], n44 = me[15];\r\n\r\n        te[0] = n23*n34*n42 - n24*n33*n42 + n24*n32*n43 - n22*n34*n43 - n23*n32*n44 + n22*n33*n44;\r\n        te[4] = n14*n33*n42 - n13*n34*n42 - n14*n32*n43 + n12*n34*n43 + n13*n32*n44 - n12*n33*n44;\r\n        te[8] = n13*n24*n42 - n14*n23*n42 + n14*n22*n43 - n12*n24*n43 - n13*n22*n44 + n12*n23*n44;\r\n        te[12] = n14*n23*n32 - n13*n24*n32 - n14*n22*n33 + n12*n24*n33 + n13*n22*n34 - n12*n23*n34;\r\n        te[1] = n24*n33*n41 - n23*n34*n41 - n24*n31*n43 + n21*n34*n43 + n23*n31*n44 - n21*n33*n44;\r\n        te[5] = n13*n34*n41 - n14*n33*n41 + n14*n31*n43 - n11*n34*n43 - n13*n31*n44 + n11*n33*n44;\r\n        te[9] = n14*n23*n41 - n13*n24*n41 - n14*n21*n43 + n11*n24*n43 + n13*n21*n44 - n11*n23*n44;\r\n        te[13] = n13*n24*n31 - n14*n23*n31 + n14*n21*n33 - n11*n24*n33 - n13*n21*n34 + n11*n23*n34;\r\n        te[2] = n22*n34*n41 - n24*n32*n41 + n24*n31*n42 - n21*n34*n42 - n22*n31*n44 + n21*n32*n44;\r\n        te[6] = n14*n32*n41 - n12*n34*n41 - n14*n31*n42 + n11*n34*n42 + n12*n31*n44 - n11*n32*n44;\r\n        te[10] = n12*n24*n41 - n14*n22*n41 + n14*n21*n42 - n11*n24*n42 - n12*n21*n44 + n11*n22*n44;\r\n        te[14] = n14*n22*n31 - n12*n24*n31 - n14*n21*n32 + n11*n24*n32 + n12*n21*n34 - n11*n22*n34;\r\n        te[3] = n23*n32*n41 - n22*n33*n41 - n23*n31*n42 + n21*n33*n42 + n22*n31*n43 - n21*n32*n43;\r\n        te[7] = n12*n33*n41 - n13*n32*n41 + n13*n31*n42 - n11*n33*n42 - n12*n31*n43 + n11*n32*n43;\r\n        te[11] = n13*n22*n41 - n12*n23*n41 - n13*n21*n42 + n11*n23*n42 + n12*n21*n43 - n11*n22*n43;\r\n        te[15] = n12*n23*n31 - n13*n22*n31 + n13*n21*n32 - n11*n23*n32 - n12*n21*n33 + n11*n22*n33;\r\n\r\n        var det = n11 * te[ 0 ] + n21 * te[ 4 ] + n31 * te[ 8 ] + n41 * te[ 12 ];\r\n\r\n        if ( det === 0 ) {\r\n\r\n            var msg = \"Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n            if ( throwOnInvertible || false ) {\r\n\r\n                throw new Error( msg );\r\n\r\n            } else {\r\n\r\n                console.warn( msg );\r\n\r\n            }\r\n\r\n            this.identity();\r\n\r\n            return this;\r\n        }\r\n\r\n        this.multiplyScalar( 1 / det );\r\n\r\n        return this;\r\n\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.applyToVector3Array = function() {\r\n\r\n        var v1 = new cornerstoneMath.Vector3();\r\n\r\n        return function ( array, offset, length ) {\r\n\r\n            if ( offset === undefined ) offset = 0;\r\n            if ( length === undefined ) length = array.length;\r\n\r\n            for ( var i = 0, j = offset, il; i < length; i += 3, j += 3 ) {\r\n\r\n                v1.x = array[ j ];\r\n                v1.y = array[ j + 1 ];\r\n                v1.z = array[ j + 2 ];\r\n\r\n                v1.applyMatrix4( this );\r\n\r\n                array[ j ]     = v1.x;\r\n                array[ j + 1 ] = v1.y;\r\n                array[ j + 2 ] = v1.z;\r\n\r\n            }\r\n\r\n            return array;\r\n\r\n        };\r\n\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.makeTranslation = function ( x, y, z ) {\r\n\r\n        this.set(\r\n\r\n            1, 0, 0, x,\r\n            0, 1, 0, y,\r\n            0, 0, 1, z,\r\n            0, 0, 0, 1\r\n\r\n        );\r\n\r\n        return this;\r\n\r\n    };\r\n    cornerstoneMath.Matrix4.prototype.multiplyScalar = function ( s ) {\r\n\r\n        var te = this.elements;\r\n\r\n        te[0] *= s; te[4] *= s; te[8] *= s; te[12] *= s;\r\n        te[1] *= s; te[5] *= s; te[9] *= s; te[13] *= s;\r\n        te[2] *= s; te[6] *= s; te[10] *= s; te[14] *= s;\r\n        te[3] *= s; te[7] *= s; te[11] *= s; te[15] *= s;\r\n\r\n        return this;\r\n\r\n    };\r\n    cornerstoneMath.Matrix4.prototype.set = function ( n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 ) {\r\n\r\n        var te = this.elements;\r\n\r\n        te[0] = n11; te[4] = n12; te[8] = n13; te[12] = n14;\r\n        te[1] = n21; te[5] = n22; te[9] = n23; te[13] = n24;\r\n        te[2] = n31; te[6] = n32; te[10] = n33; te[14] = n34;\r\n        te[3] = n41; te[7] = n42; te[11] = n43; te[15] = n44;\r\n\r\n        return this;\r\n\r\n    };\r\n\r\n    cornerstoneMath.Matrix4.prototype.makeScale = function ( x, y, z ) {\r\n\r\n        this.set(\r\n\r\n            x, 0, 0, 0,\r\n            0, y, 0, 0,\r\n            0, 0, z, 0,\r\n            0, 0, 0, 1\r\n\r\n        );\r\n\r\n        return this;\r\n\r\n    };\r\n\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/matrix4.js\r\n\r\n// Begin Source: src/plane.js\r\n// Copied from Three.JS\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if (cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    cornerstoneMath.Plane = function ( normal, constant ) {\r\n\r\n        this.normal = ( normal !== undefined ) ? normal : new cornerstoneMath.Vector3( 1, 0, 0 );\r\n        this.constant = ( constant !== undefined ) ? constant : 0;\r\n\r\n    };\r\n\r\n    cornerstoneMath.Plane.prototype = {\r\n\r\n        constructor: cornerstoneMath.Plane,\r\n\r\n        set: function ( normal, constant ) {\r\n\r\n            this.normal.copy( normal );\r\n            this.constant = constant;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setComponents: function ( x, y, z, w ) {\r\n\r\n            this.normal.set( x, y, z );\r\n            this.constant = w;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setFromNormalAndCoplanarPoint: function ( normal, point ) {\r\n\r\n            this.normal.copy( normal );\r\n            this.constant = - point.dot( this.normal ); // must be this.normal, not normal, as this.normal is normalized\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        setFromCoplanarPoints: function () {\r\n\r\n            var v1 = new cornerstoneMath.Vector3();\r\n            var v2 = new cornerstoneMath.Vector3();\r\n\r\n            return function ( a, b, c ) {\r\n\r\n                var normal = v1.subVectors( c, b ).cross( v2.subVectors( a, b ) ).normalize();\r\n\r\n                // Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n                this.setFromNormalAndCoplanarPoint( normal, a );\r\n\r\n                return this;\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n\r\n        copy: function ( plane ) {\r\n\r\n            this.normal.copy( plane.normal );\r\n            this.constant = plane.constant;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        normalize: function () {\r\n\r\n            // Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n            var inverseNormalLength = 1.0 / this.normal.length();\r\n            this.normal.multiplyScalar( inverseNormalLength );\r\n            this.constant *= inverseNormalLength;\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        negate: function () {\r\n\r\n            this.constant *= - 1;\r\n            this.normal.negate();\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        distanceToPoint: function ( point ) {\r\n\r\n            return this.normal.dot( point ) + this.constant;\r\n\r\n        },\r\n\r\n        distanceToSphere: function ( sphere ) {\r\n\r\n            return this.distanceToPoint( sphere.center ) - sphere.radius;\r\n\r\n        },\r\n\r\n        projectPoint: function ( point, optionalTarget ) {\r\n\r\n            return this.orthoPoint( point, optionalTarget ).sub( point ).negate();\r\n\r\n        },\r\n\r\n        orthoPoint: function ( point, optionalTarget ) {\r\n\r\n            var perpendicularMagnitude = this.distanceToPoint( point );\r\n\r\n            var result = optionalTarget || new cornerstoneMath.Vector3();\r\n            return result.copy( this.normal ).multiplyScalar( perpendicularMagnitude );\r\n\r\n        },\r\n\r\n        isIntersectionLine: function ( line ) {\r\n\r\n            // Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n            var startSign = this.distanceToPoint( line.start );\r\n            var endSign = this.distanceToPoint( line.end );\r\n\r\n            return ( startSign < 0 && endSign > 0 ) || ( endSign < 0 && startSign > 0 );\r\n\r\n        },\r\n\r\n        intersectLine: function () {\r\n\r\n            var v1 = new cornerstoneMath.Vector3();\r\n\r\n            return function ( line, optionalTarget ) {\r\n\r\n                var result = optionalTarget || new cornerstoneMath.Vector3();\r\n\r\n                var direction = line.delta( v1 );\r\n\r\n                var denominator = this.normal.dot( direction );\r\n\r\n                if ( denominator === 0 ) {\r\n\r\n                    // line is coplanar, return origin\r\n                    if ( this.distanceToPoint( line.start ) === 0 ) {\r\n\r\n                        return result.copy( line.start );\r\n\r\n                    }\r\n\r\n                    // Unsure if this is the correct method to handle this case.\r\n                    return undefined;\r\n\r\n                }\r\n\r\n                var t = - ( line.start.dot( this.normal ) + this.constant ) / denominator;\r\n\r\n                if ( t < 0 || t > 1 ) {\r\n\r\n                    return undefined;\r\n\r\n                }\r\n\r\n                return result.copy( direction ).multiplyScalar( t ).add( line.start );\r\n\r\n            };\r\n\r\n        }(),\r\n\r\n        intersectPlane: function (targetPlane) {\r\n            // Returns the intersection line between two planes\r\n            var direction = this.normal.clone().cross(targetPlane.normal);\r\n            var origin = new cornerstoneMath.Vector3();\r\n            var intersectionData = {\r\n                origin: origin,\r\n                direction: direction\r\n            };\r\n\r\n            // If the planes are parallel, return an empty vector for the\r\n            // intersection line\r\n            if (this.normal.clone().cross(targetPlane.normal).length < 1e-10) {\r\n                intersectionData.direction = new cornerstoneMath.Vector3();\r\n                return intersectionData;\r\n            }\r\n\r\n            var h1 = this.constant;\r\n            var h2 = targetPlane.constant;\r\n            var n1dotn2 = this.normal.clone().dot(targetPlane.normal);\r\n\r\n            var c1 = -(h1 - h2 * n1dotn2) / (1 - n1dotn2 * n1dotn2);\r\n            var c2 = -(h2 - h1 * n1dotn2) / (1 - n1dotn2 * n1dotn2);\r\n            intersectionData.origin = this.normal.clone().multiplyScalar(c1).add(targetPlane.normal.clone().multiplyScalar(c2));\r\n            return intersectionData;\r\n        },\r\n\r\n        coplanarPoint: function ( optionalTarget ) {\r\n\r\n            var result = optionalTarget || new cornerstoneMath.Vector3();\r\n            return result.copy( this.normal ).multiplyScalar( - this.constant );\r\n\r\n        },\r\n\r\n        translate: function ( offset ) {\r\n\r\n            this.constant = this.constant - offset.dot( this.normal );\r\n\r\n            return this;\r\n\r\n        },\r\n\r\n        equals: function ( plane ) {\r\n\r\n            return plane.normal.equals( this.normal ) && ( plane.constant == this.constant );\r\n\r\n        },\r\n\r\n        clone: function () {\r\n\r\n            return new cornerstoneMath.Plane().copy( this );\r\n\r\n        }\r\n    };\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/plane.js\r\n\r\n// Begin Source: src/point.js\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    function pageToPoint(e)\r\n    {\r\n        return {\r\n            x : e.pageX,\r\n            y : e.pageY\r\n        };\r\n    }\r\n\r\n    function subtract(lhs, rhs)\r\n    {\r\n        return {\r\n            x : lhs.x - rhs.x,\r\n            y : lhs.y - rhs.y\r\n        };\r\n    }\r\n\r\n    function copy(point)\r\n    {\r\n        return {\r\n            x : point.x,\r\n            y : point.y\r\n        };\r\n    }\r\n\r\n    function distance(from, to)\r\n    {\r\n        return Math.sqrt(distanceSquared(from, to));\r\n    }\r\n\r\n    function distanceSquared(from, to)\r\n    {\r\n        var delta = subtract(from, to);\r\n        return delta.x * delta.x + delta.y * delta.y;\r\n    }\r\n\r\n    function insideRect(point, rect)\r\n    {\r\n        if( point.x < rect.left ||\r\n            point.x > rect.left + rect.width ||\r\n            point.y < rect.top ||\r\n            point.y > rect.top + rect.height)\r\n        {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    // module exports\r\n    cornerstoneMath.point =\r\n    {\r\n        subtract : subtract,\r\n        copy: copy,\r\n        pageToPoint: pageToPoint,\r\n        distance: distance,\r\n        distanceSquared: distanceSquared,\r\n        insideRect: insideRect\r\n    };\r\n\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/point.js\r\n\r\n// Begin Source: src/quaternion.js\r\n// Based on THREE.JS\r\n\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    cornerstoneMath.Quaternion = function Quaternion(x, y, z, w)\r\n    {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n        this.z = z || 0;\r\n        this.w = ( w !== undefined ) ? w : 1;\r\n    };\r\n\r\n    cornerstoneMath.Quaternion.prototype.setFromAxisAngle = function(axis, angle)\r\n    {\r\n        var halfAngle = angle / 2, s = Math.sin( halfAngle );\r\n\r\n        this.x = axis.x * s;\r\n        this.y = axis.y * s;\r\n        this.z = axis.z * s;\r\n        this.w = Math.cos( halfAngle );\r\n\r\n        return this;\r\n    };\r\n\r\n    cornerstoneMath.Quaternion.prototype.multiplyQuaternions = function( a, b)\r\n    {\r\n        var qax = a.x, qay = a.y, qaz = a.z, qaw = a.w;\r\n        var qbx = b.x, qby = b.y, qbz = b.z, qbw = b.w;\r\n\r\n        this.x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n        this.y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n        this.z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n        this.w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n        return this;\r\n    };\r\n\r\n    cornerstoneMath.Quaternion.prototype.setFromRotationMatrix = function(m)\r\n    {\r\n        var te = m.elements,\r\n\r\n            m11 = te[0], m12 = te[4], m13 = te[8],\r\n            m21 = te[1], m22 = te[5], m23 = te[9],\r\n            m31 = te[2], m32 = te[6], m33 = te[10],\r\n\r\n            trace = m11 + m22 + m33,\r\n            s;\r\n\r\n        if ( trace > 0 ) {\r\n\r\n            s = 0.5 / Math.sqrt( trace + 1.0 );\r\n\r\n            this.w = 0.25 / s;\r\n            this.x = ( m32 - m23 ) * s;\r\n            this.y = ( m13 - m31 ) * s;\r\n            this.z = ( m21 - m12 ) * s;\r\n\r\n        } else if ( m11 > m22 && m11 > m33 ) {\r\n\r\n            s = 2.0 * Math.sqrt( 1.0 + m11 - m22 - m33 );\r\n\r\n            this.w = (m32 - m23 ) / s;\r\n            this.x = 0.25 * s;\r\n            this.y = (m12 + m21 ) / s;\r\n            this.z = (m13 + m31 ) / s;\r\n\r\n        } else if ( m22 > m33 ) {\r\n\r\n            s = 2.0 * Math.sqrt( 1.0 + m22 - m11 - m33 );\r\n\r\n            this.w = (m13 - m31 ) / s;\r\n            this.x = (m12 + m21 ) / s;\r\n            this.y = 0.25 * s;\r\n            this.z = (m23 + m32 ) / s;\r\n\r\n        } else {\r\n\r\n            s = 2.0 * Math.sqrt( 1.0 + m33 - m11 - m22 );\r\n\r\n            this.w = ( m21 - m12 ) / s;\r\n            this.x = ( m13 + m31 ) / s;\r\n            this.y = ( m23 + m32 ) / s;\r\n            this.z = 0.25 * s;\r\n\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/quaternion.js\r\n\r\n// Begin Source: src/rect.js\r\nvar cornerstoneMath = (function (cornerstoneMath) {\r\n\r\n    \"use strict\";\r\n\r\n    if(cornerstoneMath === undefined) {\r\n        cornerstoneMath = {};\r\n    }\r\n\r\n    function rectToLineSegments(rect)\r\n    {\r\n        var top = {\r\n            start : {\r\n                x :rect.left,\r\n                y :rect.top\r\n            },\r\n            end : {\r\n                x :rect.left + rect.width,\r\n                y :rect.top\r\n\r\n            }\r\n        };\r\n        var right = {\r\n            start : {\r\n                x :rect.left + rect.width,\r\n                y :rect.top\r\n            },\r\n            end : {\r\n                x :rect.left + rect.width,\r\n                y :rect.top + rect.height\r\n\r\n            }\r\n        };\r\n        var bottom = {\r\n            start : {\r\n                x :rect.left + rect.width,\r\n                y :rect.top + rect.height\r\n            },\r\n            end : {\r\n                x :rect.left,\r\n                y :rect.top + rect.height\r\n\r\n            }\r\n        };\r\n        var left = {\r\n            start : {\r\n                x :rect.left,\r\n                y :rect.top + rect.height\r\n            },\r\n            end : {\r\n                x :rect.left,\r\n                y :rect.top\r\n\r\n            }\r\n        };\r\n        var lineSegments = [top, right, bottom, left];\r\n        return lineSegments;\r\n    }\r\n\r\n    function pointNearLineSegment(point, lineSegment, maxDistance)\r\n    {\r\n        if(maxDistance === undefined) {\r\n            maxDistance = 5;\r\n        }\r\n        var distance = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, point);\r\n\r\n        return (distance < maxDistance);\r\n    }\r\n    function distanceToPoint(rect, point)\r\n    {\r\n        var minDistance = 655535;\r\n        var lineSegments = rectToLineSegments(rect);\r\n        lineSegments.forEach(function(lineSegment) {\r\n            var distance = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, point);\r\n            if(distance < minDistance) {\r\n                minDistance = distance;\r\n            }\r\n        });\r\n        return minDistance;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneMath.rect =\r\n    {\r\n        distanceToPoint : distanceToPoint\r\n    };\r\n\r\n\r\n    return cornerstoneMath;\r\n}(cornerstoneMath)); \r\n// End Source; src/rect.js\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 62,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 5,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 63,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": "",
    "lineNumber": 770,
    "unknown": [
      {
        "tagName": "@author",
        "tagValue": "bhouston / http://exocortex.com"
      }
    ],
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 64,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 934,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 65,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 993,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 66,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1026,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 67,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": "",
    "lineNumber": 1284,
    "unknown": [
      {
        "tagName": "@author",
        "tagValue": "bhouston / http://exocortex.com"
      }
    ],
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 68,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1517,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 69,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1592,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 70,
    "kind": "variable",
    "name": "cornerstoneMath",
    "memberof": "src/client/lib/cornerstoneMath.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneMath.js~cornerstoneMath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneMath.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1690,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 71,
    "kind": "file",
    "name": "src/client/lib/cornerstoneTools.js",
    "content": "/*! cornerstoneTools - v0.7.2 - 2015-09-07 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */\r\n// Begin Source: src/header.js\r\nif (typeof cornerstone === 'undefined') {\r\n    cornerstone = {};\r\n}\r\n\r\nif (typeof cornerstoneTools === 'undefined') {\r\n    cornerstoneTools = {\r\n        referenceLines: {}, orientation: {}\r\n    };\r\n}\r\n \r\n// End Source; src/header.js\r\n\r\n// Begin Source: src/inputSources/mouseWheelInput.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseWheel(e) {\r\n        // !!!HACK/NOTE/WARNING!!!\r\n        // for some reason I am getting mousewheel and DOMMouseScroll events on my\r\n        // mac os x mavericks system when middle mouse button dragging.\r\n        // I couldn't find any info about this so this might break other systems\r\n        // webkit hack\r\n        if (e.originalEvent.type === 'mousewheel' && e.originalEvent.wheelDeltaY === 0) {\r\n            return;\r\n        }\r\n        // firefox hack\r\n        if (e.originalEvent.type === 'DOMMouseScroll' && e.originalEvent.axis === 1) {\r\n            return;\r\n        }\r\n\r\n        var element = e.currentTarget;\r\n        var startingCoords = cornerstone.pageToPixel(element, e.pageX || e.originalEvent.pageX, e.pageY || e.originalEvent.pageY);\r\n\r\n        e = window.event || e; // old IE support\r\n        var wheelDelta = e.wheelDelta || -e.detail || -e.originalEvent.detail;\r\n        var direction = Math.max(-1, Math.min(1, (wheelDelta)));\r\n\r\n        var mouseWheelData = {\r\n            element: element, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, direction: direction, pageX: e.pageX || e.originalEvent.pageX, pageY: e.pageY || e.originalEvent.pageY, imageX: startingCoords.x, imageY: startingCoords.y\r\n        };\r\n\r\n        $(element).trigger('CornerstoneToolsMouseWheel', mouseWheelData);\r\n    }\r\n\r\n    var mouseWheelEvents = 'mousewheel DOMMouseScroll';\r\n\r\n    function enable(element) {\r\n        $(element).on(mouseWheelEvents, mouseWheel);\r\n    }\r\n\r\n    function disable(element) {\r\n        $(element).unbind(mouseWheelEvents, mouseWheel);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.mouseWheelInput = {\r\n        enable: enable, disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/inputSources/mouseWheelInput.js\r\n\r\n// Begin Source: src/inputSources/mouseInput.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var isClickEvent;\r\n    var preventClickTimeout;\r\n    var clickDelay = 200;\r\n\r\n    function preventClickHandler() {\r\n        isClickEvent = false;\r\n    }\r\n\r\n    function activateMouseDown(mouseEventDetail) {\r\n        $(mouseEventDetail.element).trigger('CornerstoneToolsMouseDownActivate', mouseEventDetail);\r\n    }\r\n\r\n    function mouseDoubleClick(e) {\r\n        var element = e.currentTarget;\r\n\r\n        var startPoints = {\r\n            page: cornerstoneMath.point.pageToPoint(e), image: cornerstone.pageToPixel(element, e.pageX, e.pageY), client: {\r\n                x: e.clientX, y: e.clientY\r\n            }\r\n        };\r\n        startPoints.canvas = cornerstone.pixelToCanvas(element, startPoints.image);\r\n\r\n        var lastPoints = cornerstoneTools.copyPoints(startPoints);\r\n        var mouseEventDetail = {\r\n            event: e, which: e.which, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, element: element, startPoints: startPoints, lastPoints: lastPoints, currentPoints: startPoints, deltaPoints: {\r\n                x: 0, y: 0\r\n            }\r\n        };\r\n\r\n        var event = $.Event('CornerstoneToolsMouseDoubleClick', mouseEventDetail);\r\n        $(mouseEventDetail.element).trigger(event, mouseEventDetail);\r\n    }\r\n\r\n    function mouseDown(e) {\r\n        preventClickTimeout = setTimeout(preventClickHandler, clickDelay);\r\n\r\n        var element = e.currentTarget;\r\n\r\n        // Prevent CornerstoneToolsMouseMove while mouse is down\r\n        $(element).off('mousemove', mouseMove);\r\n\r\n        var startPoints = {\r\n            page: cornerstoneMath.point.pageToPoint(e), image: cornerstone.pageToPixel(element, e.pageX, e.pageY), client: {\r\n                x: e.clientX, y: e.clientY\r\n            }\r\n        };\r\n        startPoints.canvas = cornerstone.pixelToCanvas(element, startPoints.image);\r\n\r\n        var lastPoints = cornerstoneTools.copyPoints(startPoints);\r\n        var mouseEventDetail = {\r\n                event: e, which: e.which, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, element: element, startPoints: startPoints, lastPoints: lastPoints, currentPoints: startPoints, deltaPoints: {\r\n                    x: 0, y: 0\r\n                }\r\n            };\r\n\r\n        var event = $.Event('CornerstoneToolsMouseDown', mouseEventDetail);\r\n        $(mouseEventDetail.element).trigger(event, mouseEventDetail);\r\n\r\n        if (event.isImmediatePropagationStopped() === false) {\r\n            // no tools responded to this event, give the active tool a chance\r\n            if (activateMouseDown(mouseEventDetail) === true) {\r\n                return cornerstoneTools.pauseEvent(e);\r\n            }\r\n        }\r\n\r\n        var whichMouseButton = e.which;\r\n\r\n        function onMouseMove(e) {\r\n            // calculate our current points in page and image coordinates\r\n            var currentPoints = {\r\n                page: cornerstoneMath.point.pageToPoint(e), image: cornerstone.pageToPixel(element, e.pageX, e.pageY), client: {\r\n                    x: e.clientX, y: e.clientY\r\n                }\r\n            };\r\n            currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n            // Calculate delta values in page and image coordinates\r\n            var deltaPoints = {\r\n                page: cornerstoneMath.point.subtract(currentPoints.page, lastPoints.page), image: cornerstoneMath.point.subtract(currentPoints.image, lastPoints.image), client: cornerstoneMath.point.subtract(currentPoints.client, lastPoints.client), canvas: cornerstoneMath.point.subtract(currentPoints.canvas, lastPoints.canvas)\r\n            };\r\n\r\n            var eventData = {\r\n                which: whichMouseButton, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, element: element, startPoints: startPoints, lastPoints: lastPoints, currentPoints: currentPoints, deltaPoints: deltaPoints\r\n            };\r\n\r\n            //element.dispatchEvent(event);\r\n\r\n            $(mouseEventDetail.element).trigger('CornerstoneToolsMouseDrag', eventData);\r\n\r\n            // update the last points\r\n            lastPoints = cornerstoneTools.copyPoints(currentPoints);\r\n\r\n            // prevent left click selection of DOM elements\r\n            return cornerstoneTools.pauseEvent(e);\r\n        }\r\n\r\n        // hook mouseup so we can unbind our event listeners\r\n        // when they stop dragging\r\n        function onMouseUp(e) {\r\n            // Cancel the timeout preventing the click event from triggering\r\n            clearTimeout(preventClickTimeout);\r\n\r\n            var eventType = 'CornerstoneToolsMouseUp';\r\n            if (isClickEvent) {\r\n                eventType = 'CornerstoneToolsMouseClick';\r\n            }\r\n\r\n            // calculate our current points in page and image coordinates\r\n            var currentPoints = {\r\n                page: cornerstoneMath.point.pageToPoint(e),\r\n                image: cornerstone.pageToPixel(element, e.pageX, e.pageY),\r\n                client: {\r\n                    x: e.clientX,\r\n                    y: e.clientY\r\n                }\r\n            };\r\n            currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n            // Calculate delta values in page and image coordinates\r\n            var deltaPoints = {\r\n                page: cornerstoneMath.point.subtract(currentPoints.page, lastPoints.page),\r\n                image: cornerstoneMath.point.subtract(currentPoints.image, lastPoints.image),\r\n                client: cornerstoneMath.point.subtract(currentPoints.client, lastPoints.client),\r\n                canvas: cornerstoneMath.point.subtract(currentPoints.canvas, lastPoints.canvas)\r\n            };\r\n\r\n            var eventData = {\r\n                event: e,\r\n                which: whichMouseButton,\r\n                viewport: cornerstone.getViewport(element),\r\n                image: cornerstone.getEnabledElement(element).image,\r\n                element: element, startPoints: startPoints,\r\n                lastPoints: lastPoints,\r\n                currentPoints: currentPoints,\r\n                deltaPoints: deltaPoints\r\n            };\r\n\r\n            var event = $.Event(eventType, eventData);\r\n            $(mouseEventDetail.element).trigger(event, eventData);\r\n\r\n            $(document).off('mousemove', onMouseMove);\r\n            $(document).off('mouseup', onMouseUp);\r\n\r\n            $(mouseEventDetail.element).on('mousemove', mouseMove);\r\n\r\n            isClickEvent = true;\r\n        }\r\n\r\n        $(document).on('mousemove', onMouseMove);\r\n        $(document).on('mouseup', onMouseUp);\r\n\r\n        return cornerstoneTools.pauseEvent(e);\r\n    }\r\n\r\n    function mouseMove(e) {\r\n        var element = e.currentTarget;\r\n\r\n        var startPoints = {\r\n            page: cornerstoneMath.point.pageToPoint(e), image: cornerstone.pageToPixel(element, e.pageX, e.pageY), client: {\r\n                x: e.clientX, y: e.clientY\r\n            }\r\n        };\r\n        startPoints.canvas = cornerstone.pixelToCanvas(element, startPoints.image);\r\n\r\n        var lastPoints = cornerstoneTools.copyPoints(startPoints);\r\n\r\n        var whichMouseButton = e.which;\r\n\r\n        // calculate our current points in page and image coordinates\r\n        var currentPoints = {\r\n            page: cornerstoneMath.point.pageToPoint(e), image: cornerstone.pageToPixel(element, e.pageX, e.pageY), client: {\r\n                x: e.clientX, y: e.clientY\r\n            }\r\n        };\r\n        currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n        // Calculate delta values in page and image coordinates\r\n        var deltaPoints = {\r\n            page: cornerstoneMath.point.subtract(currentPoints.page, lastPoints.page), image: cornerstoneMath.point.subtract(currentPoints.image, lastPoints.image), client: cornerstoneMath.point.subtract(currentPoints.client, lastPoints.client), canvas: cornerstoneMath.point.subtract(currentPoints.canvas, lastPoints.canvas)\r\n        };\r\n\r\n        var mouseMoveEventData = {\r\n            which: whichMouseButton, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, element: element, startPoints: startPoints, lastPoints: lastPoints, currentPoints: currentPoints, deltaPoints: deltaPoints\r\n        };\r\n        $(element).trigger('CornerstoneToolsMouseMove', mouseMoveEventData);\r\n\r\n        // update the last points\r\n        lastPoints = cornerstoneTools.copyPoints(currentPoints);\r\n    }\r\n\r\n    function disable(element) {\r\n        $(element).off('mousedown', mouseDown);\r\n        $(element).off('mousemove', mouseMove);\r\n        $(element).off('dblclick', mouseDoubleClick);\r\n    }\r\n\r\n    function enable(element) {\r\n        // Prevent handlers from being attached multiple times\r\n        disable(element);\r\n        \r\n        $(element).on('mousedown', mouseDown);\r\n        $(element).on('mousemove', mouseMove);\r\n        $(element).on('dblclick', mouseDoubleClick);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.mouseInput = {\r\n        enable: enable,\r\n        disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/inputSources/mouseInput.js\r\n\r\n// Begin Source: src/inputSources/touchInput.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    /*jshint newcap: false */\r\n\r\n    var lastScale = 1.0,\r\n        lastRotation = 0.0,\r\n        startPoints,\r\n        currentPoints,\r\n        lastPoints,\r\n        deltaPoints,\r\n        eventData;\r\n    \r\n    function activateMouseDown(eventData) {\r\n        $(eventData.element).trigger('CornerstoneToolsDragStartActive', eventData);\r\n    }\r\n\r\n    function onTouch(e) {\r\n        var element = e.target.parentNode,\r\n            event,\r\n            eventType;\r\n\r\n        // Prevent mouse events from occurring alongside touch events\r\n        e.preventDefault();\r\n\r\n        switch (e.type) {\r\n            case 'tap':\r\n                // calculate our current points in page and image coordinates\r\n                currentPoints = {\r\n                    page: cornerstoneMath.point.pageToPoint(e.pointers[0]),\r\n                    image: cornerstone.pageToPixel(element, e.pointers[0].pageX, e.pointers[0].pageY),\r\n                    client: {\r\n                        x: e.pointers[0].clientX,\r\n                        y: e.pointers[0].clientY\r\n                    }\r\n                };\r\n                currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n                eventType = 'CornerstoneToolsTap';\r\n                eventData = {\r\n                    event: e,\r\n                    viewport: cornerstone.getViewport(element),\r\n                    image: cornerstone.getEnabledElement(element).image,\r\n                    element: element,\r\n                    currentPoints: currentPoints,\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n                break;\r\n\r\n            case 'doubletap':\r\n                // calculate our current points in page and image coordinates\r\n                currentPoints = {\r\n                    page: cornerstoneMath.point.pageToPoint(e.pointers[0]),\r\n                    image: cornerstone.pageToPixel(element, e.pointers[0].pageX, e.pointers[0].pageY),\r\n                    client: {\r\n                        x: e.pointers[0].clientX,\r\n                        y: e.pointers[0].clientY\r\n                    }\r\n                };\r\n                currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n                eventType = 'CornerstoneToolsDoubleTap';\r\n                eventData = {\r\n                    event: e,\r\n                    viewport: cornerstone.getViewport(element),\r\n                    image: cornerstone.getEnabledElement(element).image,\r\n                    element: element,\r\n                    currentPoints: currentPoints,\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n                break;\r\n\r\n            case 'press':\r\n                // calculate our current points in page and image coordinates\r\n                currentPoints = {\r\n                    page: cornerstoneMath.point.pageToPoint(e.pointers[0]),\r\n                    image: cornerstone.pageToPixel(element, e.pointers[0].pageX, e.pointers[0].pageY),\r\n                    client: {\r\n                        x: e.pointers[0].clientX,\r\n                        y: e.pointers[0].clientY\r\n                    }\r\n                };\r\n                currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n                eventType = 'CornerstoneToolsTouchPress';\r\n                eventData = {\r\n                    event: e,\r\n                    viewport: cornerstone.getViewport(element),\r\n                    image: cornerstone.getEnabledElement(element).image,\r\n                    element: element,\r\n                    currentPoints: currentPoints,\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n                break;\r\n\r\n            case 'pinch':\r\n                var scale = lastScale - e.scale;\r\n                lastScale = e.scale;\r\n                \r\n                eventType = 'CornerstoneToolsTouchPinch';\r\n                eventData = {\r\n                    event: e,\r\n                    viewport: cornerstone.getViewport(element),\r\n                    image: cornerstone.getEnabledElement(element).image,\r\n                    element: element,\r\n                    direction: scale < 0 ? 1 : -1,\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n                break;\r\n\r\n            case 'panstart':\r\n                startPoints = {\r\n                    page: cornerstoneMath.point.pageToPoint(e.pointers[0]), image: cornerstone.pageToPixel(element, e.pointers[0].pageX, e.pointers[0].pageY), client: {\r\n                        x: e.pointers[0].clientX,\r\n                        y: e.pointers[0].clientY\r\n                    }\r\n                };\r\n                startPoints.canvas = cornerstone.pixelToCanvas(element, startPoints.image);\r\n\r\n                if (e.pointers.length === 1) {\r\n                    eventType = 'CornerstoneToolsDragStart';\r\n                } else {\r\n                    eventType = 'CornerstoneToolsMultiTouchDragStart';\r\n                }\r\n\r\n                eventData = {\r\n                    event: e.srcEvent, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, element: element, startPoints: startPoints, lastPoints: lastPoints, currentPoints: startPoints, deltaPoints: {\r\n                        x: 0, y: 0\r\n                    },\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(eventData.element).trigger(event, eventData);\r\n                lastPoints = cornerstoneTools.copyPoints(startPoints);\r\n\r\n                if (event.isImmediatePropagationStopped() === false) {\r\n                    // No current tools responded to the drag action.\r\n                    // Create new tool measurement\r\n                    activateMouseDown(eventData);\r\n                }\r\n\r\n                break;\r\n\r\n            case 'panmove':\r\n                // calculate our current points in page and image coordinates\r\n                currentPoints = {\r\n                    page: cornerstoneMath.point.pageToPoint(e.pointers[0]),\r\n                    image: cornerstone.pageToPixel(element, e.pointers[0].pageX, e.pointers[0].pageY),\r\n                    client: {\r\n                        x: e.pointers[0].clientX,\r\n                        y: e.pointers[0].clientY\r\n                    }\r\n                };\r\n                currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n                // Calculate delta values in page and image coordinates\r\n                deltaPoints = {\r\n                    page: cornerstoneMath.point.subtract(currentPoints.page, lastPoints.page), image: cornerstoneMath.point.subtract(currentPoints.image, lastPoints.image), client: cornerstoneMath.point.subtract(currentPoints.client, lastPoints.client), canvas: cornerstoneMath.point.subtract(currentPoints.canvas, lastPoints.canvas)\r\n                };\r\n              \r\n                eventType = 'CornerstoneToolsTouchDrag';\r\n                if (e.pointers.length > 1) {\r\n                    eventType = 'CornerstoneToolsMultiTouchDrag';\r\n                }\r\n\r\n                eventData = {\r\n                    viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, element: element, startPoints: startPoints, lastPoints: lastPoints, currentPoints: currentPoints, deltaPoints: deltaPoints,\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n\r\n                lastPoints = cornerstoneTools.copyPoints(currentPoints);\r\n                break;\r\n\r\n            case 'panend':\r\n                // If lastPoints is not yet set, it means panend fired without panstart or pan,\r\n                // so we can ignore this event\r\n                if (!lastPoints) {\r\n                    return false;\r\n                }\r\n\r\n                currentPoints = {\r\n                    page: cornerstoneMath.point.pageToPoint(e.pointers[0]),\r\n                    image: cornerstone.pageToPixel(element, e.pointers[0].pageX, e.pointers[0].pageY),\r\n                    client: {\r\n                        x: e.pointers[0].clientX,\r\n                        y: e.pointers[0].clientY\r\n                    }\r\n                };\r\n                currentPoints.canvas = cornerstone.pixelToCanvas(element, currentPoints.image);\r\n\r\n                // Calculate delta values in page and image coordinates\r\n                deltaPoints = {\r\n                    page: cornerstoneMath.point.subtract(currentPoints.page, lastPoints.page), image: cornerstoneMath.point.subtract(currentPoints.image, lastPoints.image), client: cornerstoneMath.point.subtract(currentPoints.client, lastPoints.client), canvas: cornerstoneMath.point.subtract(currentPoints.canvas, lastPoints.canvas)\r\n                };\r\n\r\n                eventType = 'CornerstoneToolsDragEnd';\r\n                if (e.pointers.length > 1) {\r\n                    eventType = 'CornerstoneToolsMultiTouchDragEnd';\r\n                }\r\n\r\n                eventData = {\r\n                    event: e.srcEvent,\r\n                    viewport: cornerstone.getViewport(element),\r\n                    image: cornerstone.getEnabledElement(element).image,\r\n                    element: element,\r\n                    startPoints: startPoints,\r\n                    lastPoints: lastPoints,\r\n                    currentPoints: currentPoints,\r\n                    deltaPoints: deltaPoints,\r\n                    type: eventType\r\n                };\r\n\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n                return cornerstoneTools.pauseEvent(e);\r\n\r\n            case 'rotate':\r\n                var rotation = e.rotation - lastRotation;\r\n                lastRotation = e.rotation;\r\n\r\n                eventType = 'CornerstoneToolsTouchRotate';\r\n                eventData = {\r\n                    event: e.srcEvent,\r\n                    viewport: cornerstone.getViewport(element),\r\n                    image: cornerstone.getEnabledElement(element).image,\r\n                    element: element,\r\n                    rotation: rotation,\r\n                    type: eventType\r\n                };\r\n                event = $.Event(eventType, eventData);\r\n                $(element).trigger(event, eventData);\r\n                break;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function enable(element) {\r\n        disable(element);\r\n        var hammerOptions = {\r\n            transform_always_block: true,\r\n            transform_min_scale: 0.01,\r\n            drag_block_horizontal: true,\r\n            drag_block_vertical: true,\r\n            drag_min_distance: 0\r\n        };\r\n\r\n        var mc = new Hammer(element, {\r\n            inputClass: Hammer.SUPPORT_POINTER_EVENTS ? Hammer.PointerEventInput : Hammer.TouchInput\r\n        });\r\n        mc.set(hammerOptions);\r\n\r\n        var panOptions = {\r\n            pointers: 0,\r\n            direction: Hammer.DIRECTION_ALL\r\n        };\r\n\r\n        var pan = new Hammer.Pan(panOptions);\r\n        var pinch = new Hammer.Pinch({\r\n            threshold: 0.25\r\n        });\r\n        var rotate = new Hammer.Rotate({\r\n            threshold: 0.05\r\n        });\r\n        var press = new Hammer.Press({\r\n            threshold: 10\r\n        });\r\n        \r\n        // we want to detect both the same time\r\n        pinch.recognizeWith(pan);\r\n        pinch.recognizeWith(rotate);\r\n\r\n        // add to the Manager\r\n        mc.add([ press, pan, pinch, rotate ]);\r\n\r\n        mc.on('press tap doubletap panstart panmove panend pinch rotate', onTouch);\r\n\r\n        $(element).data('hammer', mc);\r\n        cornerstoneTools.preventGhostClick(element);\r\n    }\r\n\r\n    function disable(element) {\r\n        var mc = $(element).data('hammer');\r\n        if (mc) {\r\n            mc.off('press tap doubletap panstart panmove panend pinch rotate', onTouch);\r\n        }\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.touchInput = {\r\n        enable: enable, disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/inputSources/touchInput.js\r\n\r\n// Begin Source: src/imageTools/simpleMouseButtonTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function simpleMouseButtonTool(mouseDownCallback) {\r\n        var configuration = {};\r\n\r\n        var toolInterface = {\r\n            activate: function(element, mouseButtonMask, options) {\r\n                $(element).off('CornerstoneToolsMouseDownActivate', mouseDownCallback);\r\n                var eventData = {\r\n                    mouseButtonMask: mouseButtonMask, options: options\r\n                };\r\n                $(element).on('CornerstoneToolsMouseDownActivate', eventData, mouseDownCallback);\r\n            },\r\n            disable: function(element) {$(element).off('CornerstoneToolsMouseDownActivate', mouseDownCallback);},\r\n            enable: function(element) {$(element).off('CornerstoneToolsMouseDownActivate', mouseDownCallback);},\r\n            deactivate: function(element) {$(element).off('CornerstoneToolsMouseDownActivate', mouseDownCallback);},\r\n            getConfiguration: function() { return configuration;},\r\n            setConfiguration: function(config) {configuration = config;}\r\n        };\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.simpleMouseButtonTool = simpleMouseButtonTool;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/simpleMouseButtonTool.js\r\n\r\n// Begin Source: src/imageTools/mouseButtonTool.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseButtonTool(mouseToolInterface) {\r\n        var configuration = {};\r\n\r\n        ///////// BEGIN ACTIVE TOOL ///////\r\n        function addNewMeasurement(mouseEventData) {\r\n            var element = mouseEventData.element;\r\n\r\n            var measurementData = mouseToolInterface.createNewMeasurement(mouseEventData);\r\n            if (!measurementData) {\r\n                return;\r\n            }\r\n\r\n            var eventData = {\r\n                mouseButtonMask: mouseEventData.which,\r\n            };\r\n\r\n            // associate this data with this imageId so we can render it and manipulate it\r\n            cornerstoneTools.addToolState(mouseEventData.element, mouseToolInterface.toolType, measurementData);\r\n\r\n            // since we are dragging to another place to drop the end point, we can just activate\r\n            // the end point and let the moveHandle move it for us.\r\n            $(element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n            if (mouseToolInterface.mouseDoubleClickCallback) {\r\n                $(element).off('CornerstoneToolsMouseDoubleClick', mouseToolInterface.mouseDoubleClickCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n            cornerstoneTools.moveNewHandle(mouseEventData, measurementData.handles.end, function() {\r\n                measurementData.active = false;\r\n                measurementData.invalidated = true;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(element, mouseToolInterface.toolType, measurementData);\r\n                }\r\n\r\n                $(element).on('CornerstoneToolsMouseMove', eventData, mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n                $(element).on('CornerstoneToolsMouseDown', eventData, mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n                $(element).on('CornerstoneToolsMouseDownActivate', eventData, mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n                if (mouseToolInterface.mouseDoubleClickCallback) {\r\n                    $(element).on('CornerstoneToolsMouseDoubleClick', eventData, mouseToolInterface.mouseDoubleClickCallback);\r\n                }\r\n\r\n                cornerstone.updateImage(element);\r\n            });\r\n        }\r\n\r\n        function mouseDownActivateCallback(e, eventData) {\r\n            if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n                if (mouseToolInterface.addNewMeasurement) {\r\n                    mouseToolInterface.addNewMeasurement(eventData);\r\n                } else {\r\n                    addNewMeasurement(eventData);\r\n                }\r\n\r\n                return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n            }\r\n        }\r\n\r\n        ///////// END ACTIVE TOOL ///////\r\n\r\n        ///////// BEGIN DEACTIVE TOOL ///////\r\n\r\n        function mouseMoveCallback(e, eventData) {\r\n            cornerstoneTools.toolCoordinates.setCoords(eventData);\r\n            // if a mouse button is down, do nothing\r\n            if (eventData.which !== 0) {\r\n                return;\r\n            }\r\n          \r\n            // if we have no tool data for this element, do nothing\r\n            var toolData = cornerstoneTools.getToolState(eventData.element, mouseToolInterface.toolType);\r\n            if (toolData === undefined) {\r\n                return;\r\n            }\r\n            \r\n            // We have tool data, search through all data\r\n            // and see if we can activate a handle\r\n            var imageNeedsUpdate = false;\r\n            for (var i = 0; i < toolData.data.length; i++) {\r\n                // get the cursor position in canvas coordinates\r\n                var coords = eventData.currentPoints.canvas;\r\n\r\n                var data = toolData.data[i];\r\n                if (cornerstoneTools.handleActivator(eventData.element, data.handles, coords) === true) {\r\n                    imageNeedsUpdate = true;\r\n                }\r\n\r\n                if ((mouseToolInterface.pointNearTool(eventData.element, data, coords) && !data.active) || (!mouseToolInterface.pointNearTool(eventData.element, data, coords) && data.active)) {\r\n                    data.active = !data.active;\r\n                    imageNeedsUpdate = true;\r\n                }\r\n            }\r\n\r\n            // Handle activation status changed, redraw the image\r\n            if (imageNeedsUpdate === true) {\r\n                cornerstone.updateImage(eventData.element);\r\n            }\r\n        }\r\n\r\n        function mouseDownCallback(e, eventData) {\r\n            var data;\r\n\r\n            function handleDoneMove() {\r\n                data.active = false;\r\n                data.invalidated = true;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(eventData, data.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(eventData.element, mouseToolInterface.toolType, data);\r\n                }\r\n\r\n                cornerstone.updateImage(eventData.element);\r\n                $(eventData.element).on('CornerstoneToolsMouseMove', eventData, mouseMoveCallback);\r\n            }\r\n\r\n            if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n                var coords = eventData.startPoints.canvas;\r\n                var toolData = cornerstoneTools.getToolState(e.currentTarget, mouseToolInterface.toolType);\r\n\r\n                var i;\r\n\r\n                // now check to see if there is a handle we can move\r\n                if (toolData !== undefined) {\r\n                    for (i = 0; i < toolData.data.length; i++) {\r\n                        data = toolData.data[i];\r\n                        var distanceSq = 25;\r\n                        var handle = cornerstoneTools.getHandleNearImagePoint(eventData.element, data, coords, distanceSq);\r\n                        if (handle !== undefined) {\r\n                            $(eventData.element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n                            data.active = true;\r\n                            cornerstoneTools.moveHandle(eventData, handle, handleDoneMove);\r\n                            e.stopImmediatePropagation();\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Now check to see if there is a line we can move\r\n                // now check to see if we have a tool that we can move\r\n                if (toolData !== undefined && mouseToolInterface.pointNearTool !== undefined) {\r\n                    for (i = 0; i < toolData.data.length; i++) {\r\n                        data = toolData.data[i];\r\n                        if (mouseToolInterface.pointNearTool(eventData.element, data, coords)) {\r\n                            $(eventData.element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n                            cornerstoneTools.moveAllHandles(e, data, toolData, true);\r\n                            $(eventData.element).on('CornerstoneToolsMouseMove', eventData, mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n                            e.stopImmediatePropagation();\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        ///////// END DEACTIVE TOOL ///////\r\n\r\n        // not visible, not interactive\r\n        function disable(element) {\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n            if (mouseToolInterface.mouseDoubleClickCallback) {\r\n                $(element).off('CornerstoneToolsMouseDoubleClick', mouseToolInterface.mouseDoubleClickCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible but not interactive\r\n        function enable(element) {\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n            if (mouseToolInterface.mouseDoubleClickCallback) {\r\n                $(element).off('CornerstoneToolsMouseDoubleClick', mouseToolInterface.mouseDoubleClickCallback);\r\n            }\r\n\r\n            $(element).on('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible, interactive and can create\r\n        function activate(element, mouseButtonMask) {\r\n            var eventData = {\r\n                mouseButtonMask: mouseButtonMask,\r\n            };\r\n\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).on('CornerstoneToolsMouseMove', eventData, mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).on('CornerstoneToolsMouseDown', eventData, mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n            $(element).on('CornerstoneToolsMouseDownActivate', eventData, mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n            if (mouseToolInterface.mouseDoubleClickCallback) {\r\n                $(element).off('CornerstoneToolsMouseDoubleClick', mouseToolInterface.mouseDoubleClickCallback);\r\n                $(element).on('CornerstoneToolsMouseDoubleClick', eventData, mouseToolInterface.mouseDoubleClickCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible, interactive\r\n        function deactivate(element, mouseButtonMask) {\r\n            var eventData = {\r\n                mouseButtonMask: mouseButtonMask,\r\n            };\r\n\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).on('CornerstoneToolsMouseMove', eventData, mouseToolInterface.mouseMoveCallback || mouseMoveCallback);\r\n            $(element).on('CornerstoneToolsMouseDown', eventData, mouseToolInterface.mouseDownCallback || mouseDownCallback);\r\n\r\n            if (mouseToolInterface.mouseDoubleClickCallback) {\r\n                $(element).off('CornerstoneToolsMouseDoubleClick', mouseToolInterface.mouseDoubleClickCallback);\r\n                $(element).on('CornerstoneToolsMouseDoubleClick', eventData, mouseToolInterface.mouseDoubleClickCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        function getConfiguration() {\r\n            return configuration;\r\n        }\r\n\r\n        function setConfiguration(config) {\r\n            configuration = config;\r\n        }\r\n\r\n        var toolInterface = {\r\n            enable: enable,\r\n            disable: disable,\r\n            activate: activate,\r\n            deactivate: deactivate,\r\n            getConfiguration: getConfiguration,\r\n            setConfiguration: setConfiguration,\r\n            mouseDownCallback: mouseDownCallback,\r\n            mouseMoveCallback: mouseMoveCallback,\r\n            mouseDownActivateCallback: mouseDownActivateCallback\r\n        };\r\n\r\n        // Expose pointNearTool if available\r\n        if (mouseToolInterface.pointNearTool) {\r\n            toolInterface.pointNearTool = mouseToolInterface.pointNearTool;\r\n        }\r\n\r\n        if (mouseToolInterface.mouseDoubleClickCallback) {\r\n            toolInterface.mouseDoubleClickCallback = mouseToolInterface.mouseDoubleClickCallback;\r\n        }\r\n\r\n        if (mouseToolInterface.addNewMeasurement) {\r\n            toolInterface.addNewMeasurement = mouseToolInterface.addNewMeasurement;\r\n        }\r\n\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.mouseButtonTool = mouseButtonTool;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/mouseButtonTool.js\r\n\r\n// Begin Source: src/imageTools/mouseButtonRectangleTool.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n    \r\n    function mouseButtonRectangleTool(mouseToolInterface, preventHandleOutsideImage) {\r\n        ///////// BEGIN ACTIVE TOOL ///////\r\n        function addNewMeasurement(mouseEventData) {\r\n            var measurementData = mouseToolInterface.createNewMeasurement(mouseEventData);\r\n            \r\n            //prevent adding new measurement if tool returns nill\r\n            if (!measurementData) {\r\n                return;\r\n            }\r\n\r\n            // associate this data with this imageId so we can render it and manipulate it\r\n            cornerstoneTools.addToolState(mouseEventData.element, mouseToolInterface.toolType, measurementData);\r\n           \r\n            // since we are dragging to another place to drop the end point, we can just activate\r\n            // the end point and let the moveHandle move it for us.\r\n            $(mouseEventData.element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            cornerstoneTools.moveHandle(mouseEventData, measurementData.handles.end, function() {\r\n                measurementData.active = false;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(mouseEventData.element, mouseToolInterface.toolType, measurementData);\r\n                }\r\n\r\n                $(mouseEventData.element).on('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            }, preventHandleOutsideImage);\r\n        }\r\n\r\n        function mouseDownActivateCallback(e, eventData) {\r\n            if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n                addNewMeasurement(eventData);\r\n                return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n            }\r\n        }\r\n        ///////// END ACTIVE TOOL ///////\r\n\r\n        ///////// BEGIN DEACTIVE TOOL ///////\r\n\r\n        function mouseMoveCallback(e, eventData) {\r\n            cornerstoneTools.toolCoordinates.setCoords(eventData);\r\n            // if a mouse button is down, do nothing\r\n            if (eventData.which !== 0) {\r\n                return;\r\n            }\r\n          \r\n            // if we have no tool data for this element, do nothing\r\n            var toolData = cornerstoneTools.getToolState(eventData.element, mouseToolInterface.toolType);\r\n            if (toolData === undefined) {\r\n                return;\r\n            }\r\n            \r\n            // We have tool data, search through all data\r\n            // and see if we can activate a handle\r\n            var imageNeedsUpdate = false;\r\n            var coords = eventData.currentPoints.canvas;\r\n\r\n            for (var i = 0; i < toolData.data.length; i++) {\r\n                // get the cursor position in image coordinates\r\n                var data = toolData.data[i];\r\n                if (cornerstoneTools.handleActivator(eventData.element, data.handles, coords) === true) {\r\n                    imageNeedsUpdate = true;\r\n                }\r\n\r\n                if ((mouseToolInterface.pointInsideRect(eventData.element, data, coords) && !data.active) || (!mouseToolInterface.pointInsideRect(eventData.element, data, coords) && data.active)) {\r\n                    data.active = !data.active;\r\n                    imageNeedsUpdate = true;\r\n                }\r\n            }\r\n\r\n            // Handle activation status changed, redraw the image\r\n            if (imageNeedsUpdate === true) {\r\n                cornerstone.updateImage(eventData.element);\r\n            }\r\n        }\r\n\r\n        function mouseDownCallback(e, eventData) {\r\n            var data;\r\n\r\n            function handleDoneMove() {\r\n                data.active = false;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(eventData, data.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(eventData.element, mouseToolInterface.toolType, data);\r\n                }\r\n\r\n                cornerstone.updateImage(eventData.element);\r\n                $(eventData.element).on('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            }\r\n\r\n            if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n                var coords = eventData.startPoints.canvas;\r\n                var toolData = cornerstoneTools.getToolState(e.currentTarget, mouseToolInterface.toolType);\r\n\r\n                var i;\r\n\r\n                // now check to see if there is a handle we can move\r\n                if (toolData !== undefined) {\r\n                    for (i = 0; i < toolData.data.length; i++) {\r\n                        data = toolData.data[i];\r\n                        var handle = cornerstoneTools.getHandleNearImagePoint(eventData.element, data, coords);\r\n                        if (handle !== undefined) {\r\n                            $(eventData.element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n                            data.active = true;\r\n                            cornerstoneTools.moveHandle(eventData, handle, handleDoneMove, preventHandleOutsideImage);\r\n                            e.stopImmediatePropagation();\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Now check to see if there is a line we can move\r\n                // now check to see if we have a tool that we can move\r\n                if (toolData !== undefined && mouseToolInterface.pointInsideRect !== undefined) {\r\n                    for (i = 0; i < toolData.data.length; i++) {\r\n                        data = toolData.data[i];\r\n                        if (mouseToolInterface.pointInsideRect(eventData.element, data, coords)) {\r\n                            $(eventData.element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n                            cornerstoneTools.moveAllHandles(e, data, toolData, false, preventHandleOutsideImage);\r\n                            $(eventData.element).on('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n                            e.stopImmediatePropagation();\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        ///////// END DEACTIVE TOOL ///////\r\n\r\n        // not visible, not interactive\r\n        function disable(element) {\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseDownActivateCallback);\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible but not interactive\r\n        function enable(element) {\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseDownActivateCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible, interactive and can create\r\n        function activate(element, mouseButtonMask) {\r\n            var eventData = {\r\n                mouseButtonMask: mouseButtonMask,\r\n            };\r\n\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseDownActivateCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).on('CornerstoneToolsMouseMove', eventData, mouseMoveCallback);\r\n            $(element).on('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n            $(element).on('CornerstoneToolsMouseDownActivate', eventData, mouseDownActivateCallback);\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible, interactive\r\n        function deactivate(element, mouseButtonMask) {\r\n            var eventData = {\r\n                mouseButtonMask: mouseButtonMask,\r\n            };\r\n\r\n            $(element).off('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n            $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n            $(element).off('CornerstoneToolsMouseDownActivate', mouseDownActivateCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', mouseToolInterface.onImageRendered);\r\n            $(element).on('CornerstoneToolsMouseMove', eventData, mouseMoveCallback);\r\n            $(element).on('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        var toolInterface = {\r\n            enable: enable, disable: disable, activate: activate, deactivate: deactivate\r\n        };\r\n\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.mouseButtonRectangleTool = mouseButtonRectangleTool;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/mouseButtonRectangleTool.js\r\n\r\n// Begin Source: src/imageTools/mouseWheelTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseWheelTool(mouseWheelCallback) {\r\n        var toolInterface = {\r\n            activate: function(element) {\r\n                $(element).off('CornerstoneToolsMouseWheel', mouseWheelCallback);\r\n                var eventData = {\r\n                };\r\n                $(element).on('CornerstoneToolsMouseWheel', eventData, mouseWheelCallback);\r\n            }, disable: function(element) {$(element).off('CornerstoneToolsMouseWheel', mouseWheelCallback);}, enable: function(element) {$(element).off('CornerstoneToolsMouseWheel', mouseWheelCallback);}, deactivate: function(element) {$(element).off('CornerstoneToolsMouseWheel', mouseWheelCallback);}\r\n        };\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.mouseWheelTool = mouseWheelTool;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/mouseWheelTool.js\r\n\r\n// Begin Source: src/imageTools/touchDragTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function touchDragTool(touchDragCallback) {\r\n        var toolInterface = {\r\n            activate: function(element) {\r\n                $(element).off('CornerstoneToolsTouchDrag', touchDragCallback);\r\n                $(element).on('CornerstoneToolsTouchDrag', touchDragCallback);\r\n            }, disable: function(element) {$(element).off('CornerstoneToolsTouchDrag', touchDragCallback);}, enable: function(element) {$(element).off('CornerstoneToolsTouchDrag', touchDragCallback);}, deactivate: function(element) {$(element).off('CornerstoneToolsTouchDrag', touchDragCallback);}\r\n        };\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.touchDragTool = touchDragTool;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/touchDragTool.js\r\n\r\n// Begin Source: src/imageTools/touchPinchTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    /*jshint newcap: false */\r\n\r\n    function touchPinchTool(touchPinchCallback) {\r\n        var toolInterface = {\r\n            activate: function(element) {\r\n                $(element).off('CornerstoneToolsTouchPinch', touchPinchCallback);\r\n                var eventData = {\r\n                };\r\n                $(element).on('CornerstoneToolsTouchPinch', eventData, touchPinchCallback);\r\n            }, disable: function(element) {$(element).off('CornerstoneToolsTouchPinch', touchPinchCallback);}, enable: function(element) {$(element).off('CornerstoneToolsTouchPinch', touchPinchCallback);}, deactivate: function(element) {$(element).off('CornerstoneToolsTouchPinch', touchPinchCallback);}\r\n        };\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.touchPinchTool = touchPinchTool;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/touchPinchTool.js\r\n\r\n// Begin Source: src/imageTools/touchTool.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function deactivateAllHandles(handles) {\r\n        Object.keys(handles).forEach(function(name) {\r\n            var handle = handles[name];\r\n            handle.active = false;\r\n        });\r\n    }\r\n\r\n    function deactivateAllToolInstances(toolData) {\r\n        if (!toolData) {\r\n            return;\r\n        }\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            var data = toolData.data[i];\r\n            data.active = false;\r\n            if (!data.handles) {\r\n                continue;\r\n            }\r\n\r\n            deactivateAllHandles(data.handles);\r\n        }\r\n    }\r\n\r\n    function touchTool(touchToolInterface) {\r\n        ///////// BEGIN ACTIVE TOOL ///////\r\n\r\n        function addNewMeasurement(touchEventData) {\r\n            var element = touchEventData.element;\r\n\r\n            var measurementData = touchToolInterface.createNewMeasurement(touchEventData);\r\n            if (!measurementData) {\r\n                return;\r\n            }\r\n\r\n            cornerstoneTools.addToolState(element, touchToolInterface.toolType, measurementData);\r\n\r\n            if (Object.keys(measurementData.handles).length === 1 && touchEventData.type === 'CornerstoneToolsTap') {\r\n                measurementData.active = false;\r\n                measurementData.handles.end.active = false;\r\n                measurementData.handles.end.highlight = false;\r\n                measurementData.invalidated = true;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(element, touchToolInterface.toolType, measurementData);\r\n                }\r\n\r\n                cornerstone.updateImage(element);\r\n                return;\r\n            }\r\n\r\n            $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n            $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            cornerstone.updateImage(element);\r\n            cornerstoneTools.moveNewHandleTouch(touchEventData, measurementData.handles.end, function() {\r\n                measurementData.active = false;\r\n                measurementData.invalidated = true;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(element, touchToolInterface.toolType, measurementData);\r\n                }\r\n\r\n                $(element).on('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n                $(element).on('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n                $(element).on('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n                cornerstone.updateImage(element);\r\n            });\r\n        }\r\n\r\n        function touchDownActivateCallback(e, eventData) {\r\n            if (touchToolInterface.addNewMeasurement) {\r\n                touchToolInterface.addNewMeasurement(eventData);\r\n            } else {\r\n                addNewMeasurement(eventData);\r\n            }\r\n\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n        ///////// END ACTIVE TOOL ///////\r\n\r\n        ///////// BEGIN INACTIVE TOOL ///////\r\n        function touchMoveCallback(e, eventData) {\r\n            cornerstoneTools.toolCoordinates.setCoords(eventData);\r\n      \r\n            // if we have no tool data for this element, do nothing\r\n            var toolData = cornerstoneTools.getToolState(eventData.element, touchToolInterface.toolType);\r\n            if (toolData === undefined) {\r\n                return;\r\n            }\r\n\r\n            // We have tool data, search through all data\r\n            // and see if we can activate a handle\r\n            var imageNeedsUpdate = false;\r\n            for (var i = 0; i < toolData.data.length; i++) {\r\n                // get the touch position in canvas coordinates\r\n                var coords = eventData.currentPoints.canvas;\r\n\r\n                var data = toolData.data[i];\r\n                if (cornerstoneTools.handleActivator(eventData.element, data.handles, coords) === true) {\r\n                    imageNeedsUpdate = true;\r\n                }\r\n            }\r\n\r\n            // Handle activation status changed, redraw the image\r\n            if (imageNeedsUpdate === true) {\r\n                cornerstone.updateImage(eventData.element);\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function tapCallback(e, eventData) {\r\n            var element = eventData.element;\r\n            var coords = eventData.currentPoints.canvas;\r\n            var toolData = cornerstoneTools.getToolState(e.currentTarget, touchToolInterface.toolType);\r\n            var data;\r\n            var i;\r\n\r\n            // Deactivate everything\r\n            deactivateAllToolInstances(toolData);\r\n\r\n            function doneMovingCallback() {\r\n                deactivateAllToolInstances(toolData);\r\n                if (cornerstoneTools.anyHandlesOutsideImage(eventData, data.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(element, touchToolInterface.toolType, data);\r\n                }\r\n\r\n                cornerstone.updateImage(element);\r\n                $(element).on('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n                $(element).on('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n                $(element).on('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n            }\r\n\r\n            // now check to see if there is a handle we can move\r\n            if (toolData) {\r\n                for (i = 0; i < toolData.data.length; i++) {\r\n                    data = toolData.data[i];\r\n                    var distanceSq = 75; // Should probably make this a settable property later\r\n                    var handle = cornerstoneTools.getHandleNearImagePoint(element, data, coords, distanceSq);\r\n                    if (handle) {\r\n                        $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n                        $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n                        $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n                        data.active = true;\r\n                        handle.active = true;\r\n                        cornerstone.updateImage(element);\r\n                        cornerstoneTools.touchMoveHandle(e, handle, doneMovingCallback);\r\n                        e.stopImmediatePropagation();\r\n                        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Now check to see if we have a tool that we can move\r\n            if (toolData && touchToolInterface.pointNearTool) {\r\n                for (i = 0; i < toolData.data.length; i++) {\r\n                    data = toolData.data[i];\r\n                    if (touchToolInterface.pointNearTool(element, data, coords)) {\r\n                        $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n                        $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n                        $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n                        data.active = true;\r\n                        cornerstone.updateImage(element);\r\n                        cornerstoneTools.touchMoveAllHandles(e, data, toolData, true, doneMovingCallback);\r\n                        e.stopImmediatePropagation();\r\n                        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n                    }\r\n                }\r\n            }\r\n            // If there is nothing to move, add a new instance of the tool\r\n            \r\n            // Need to check here to see if activation is allowed!\r\n\r\n            if (touchToolInterface.touchDownActivateCallback) {\r\n                touchToolInterface.touchDownActivateCallback(e, eventData);\r\n            } else {\r\n                touchDownActivateCallback(e, eventData);\r\n            }\r\n\r\n            return false;\r\n        }\r\n        ///////// END INACTIVE TOOL ///////\r\n\r\n        // not visible, not interactive\r\n        function disable(element) {\r\n            $(element).off('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n            $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            if (touchToolInterface.doubleTapCallback) {\r\n                $(element).off('CornerstoneToolsDoubleTap', touchToolInterface.doubleTapCallback);\r\n            }\r\n            \r\n            if (touchToolInterface.pressCallback) {\r\n                $(element).off('CornerstoneToolsTouchPress', touchToolInterface.pressCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible but not interactive\r\n        function enable(element) {\r\n            $(element).off('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n            $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n\r\n            if (touchToolInterface.doubleTapCallback) {\r\n                $(element).off('CornerstoneToolsDoubleTap', touchToolInterface.doubleTapCallback);\r\n            }\r\n\r\n            if (touchToolInterface.pressCallback) {\r\n                $(element).off('CornerstoneToolsTouchPress', touchToolInterface.pressCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible, interactive and can create\r\n        function activate(element) {\r\n            $(element).off('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n            $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n            $(element).on('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            $(element).on('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n            $(element).on('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            if (touchToolInterface.doubleTapCallback) {\r\n                $(element).off('CornerstoneToolsDoubleTap', touchToolInterface.doubleTapCallback);\r\n                $(element).on('CornerstoneToolsDoubleTap', touchToolInterface.doubleTapCallback);\r\n            }\r\n\r\n            if (touchToolInterface.pressCallback) {\r\n                $(element).off('CornerstoneToolsTouchPress', touchToolInterface.pressCallback);\r\n                $(element).on('CornerstoneToolsTouchPress', touchToolInterface.pressCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        // visible, interactive\r\n        function deactivate(element) {\r\n            $(element).off('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n            $(element).off('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            $(element).off('CornerstoneToolsDragStartActive', touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\r\n            $(element).off('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            $(element).on('CornerstoneImageRendered', touchToolInterface.onImageRendered);\r\n            $(element).on('CornerstoneToolsTouchDrag', touchToolInterface.touchMoveCallback || touchMoveCallback);\r\n            //$(element).on('CornerstoneToolsTap', touchToolInterface.tapCallback || tapCallback);\r\n\r\n            if (touchToolInterface.doubleTapCallback) {\r\n                $(element).off('CornerstoneToolsDoubleTap', touchToolInterface.doubleTapCallback);\r\n                $(element).on('CornerstoneToolsDoubleTap', touchToolInterface.doubleTapCallback);\r\n            }\r\n\r\n            if (touchToolInterface.pressCallback) {\r\n                $(element).off('CornerstoneToolsTouchPress', touchToolInterface.pressCallback);\r\n                $(element).on('CornerstoneToolsTouchPress', touchToolInterface.pressCallback);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        var toolInterface = {\r\n            enable: enable,\r\n            disable: disable,\r\n            activate: activate,\r\n            deactivate: deactivate,\r\n            touchMoveCallback: touchMoveCallback,\r\n            touchDownActivateCallback: touchDownActivateCallback,\r\n            tapCallback: tapCallback\r\n        };\r\n\r\n        if (touchToolInterface.doubleTapCallback) {\r\n            toolInterface.doubleTapCallback = touchToolInterface.doubleTapCallback;\r\n        }\r\n\r\n        if (touchToolInterface.pressCallback) {\r\n            toolInterface.pressCallback = touchToolInterface.pressCallback;\r\n        }\r\n\r\n        if (touchToolInterface.addNewMeasurement) {\r\n            toolInterface.addNewMeasurement = touchToolInterface.addNewMeasurement;\r\n        }\r\n\r\n        if (touchToolInterface.touchStartCallback) {\r\n            toolInterface.touchStartCallback = touchToolInterface.touchStartCallback;\r\n        }\r\n\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.touchTool = touchTool;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/touchTool.js\r\n\r\n// Begin Source: src/imageTools/AngleTool.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'angle';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var angleData = {\r\n            visible: true, active: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x - 20, y: mouseEventData.currentPoints.image.y + 10, highlight: true, active: false\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }, start2: {\r\n                    x: mouseEventData.currentPoints.image.x - 20, y: mouseEventData.currentPoints.image.y + 10, highlight: true, active: false\r\n                }, end2: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y + 20, highlight: true, active: false\r\n                }\r\n            }\r\n        };\r\n\r\n        return angleData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        var lineSegment = {\r\n            start: cornerstone.pixelToCanvas(element, data.handles.start), end: cornerstone.pixelToCanvas(element, data.handles.end)\r\n        };\r\n        \r\n        var distanceToPoint = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\r\n        if (distanceToPoint < 5) {\r\n            return true;\r\n        }\r\n\r\n        lineSegment.start = cornerstone.pixelToCanvas(element, data.handles.start2);\r\n        lineSegment.end = cornerstone.pixelToCanvas(element, data.handles.end2);\r\n\r\n        distanceToPoint = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\r\n        return (distanceToPoint < 5);\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n        \r\n        //activation color \r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var config = cornerstoneTools.angle.getConfiguration();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n\r\n            // configurable shadow\r\n            if (config && config.shadow) {\r\n                context.shadowColor = '#000000';\r\n                context.shadowOffsetX = +1;\r\n                context.shadowOffsetY = +1;\r\n            }\r\n\r\n            var data = toolData.data[i];\r\n\r\n            //differentiate the color of activation tool\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            // draw the line\r\n            context.beginPath();\r\n            context.strokeStyle = color;\r\n            context.lineWidth = lineWidth;\r\n\r\n            var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n            var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n            context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\r\n            context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\r\n\r\n            handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start2);\r\n            handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end2);\r\n\r\n            context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\r\n            context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\r\n            context.stroke();\r\n\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles);\r\n\r\n            // Draw the text\r\n            context.fillStyle = color;\r\n\r\n            // Need to work on correct angle to measure.  This is a cobb angle and we need to determine\r\n            // where lines cross to measure angle. For now it will show smallest angle. \r\n            var dx1 = (Math.ceil(data.handles.start.x) - Math.ceil(data.handles.end.x)) * eventData.image.columnPixelSpacing;\r\n            var dy1 = (Math.ceil(data.handles.start.y) - Math.ceil(data.handles.end.y)) * eventData.image.rowPixelSpacing;\r\n            var dx2 = (Math.ceil(data.handles.start2.x) - Math.ceil(data.handles.end2.x)) * eventData.image.columnPixelSpacing;\r\n            var dy2 = (Math.ceil(data.handles.start2.y) - Math.ceil(data.handles.end2.y)) * eventData.image.rowPixelSpacing;\r\n\r\n            var angle = Math.acos(Math.abs(((dx1 * dx2) + (dy1 * dy2)) / (Math.sqrt((dx1 * dx1) + (dy1 * dy1)) * Math.sqrt((dx2 * dx2) + (dy2 * dy2)))));\r\n            angle = angle * (180 / Math.PI);\r\n\r\n            var rAngle = cornerstoneTools.roundToDecimal(angle, 2);\r\n            var str = '00B0'; // degrees symbol\r\n            var text = rAngle.toString() + String.fromCharCode(parseInt(str, 16));\r\n\r\n            var textX = (handleStartCanvas.x + handleEndCanvas.x) / 2;\r\n            var textY = (handleStartCanvas.y + handleEndCanvas.y) / 2;\r\n\r\n            context.font = font;\r\n            cornerstoneTools.drawTextBox(context, text, textX, textY, color);\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.angle = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n    \r\n    cornerstoneTools.angleTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/AngleTool.js\r\n\r\n// Begin Source: src/imageTools/annotation.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'arrowAnnotate';\r\n\r\n    // Define a callback to get your text annotation\r\n    // This could be used, e.g. to open a modal\r\n    function getTextCallback(doneChangingTextCallback) {\r\n        doneChangingTextCallback(prompt('Enter your annotation:'));\r\n    }\r\n\r\n    var configuration = {\r\n        getTextCallback: getTextCallback,\r\n        drawHandles: false,\r\n        drawHandlesOnHover: true,\r\n        arrowFirst: true\r\n    };\r\n\r\n    /// --- Mouse Tool --- ///\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function addNewMeasurement(mouseEventData) {\r\n\r\n        function doneChangingTextCallback(annotationText) {\r\n            if (annotationText !== null) {\r\n                measurementData.annotationText = annotationText;\r\n            } else {\r\n                cornerstoneTools.removeToolState(mouseEventData.element, toolType, measurementData);\r\n            }\r\n\r\n            measurementData.active = false;\r\n            cornerstone.updateImage(mouseEventData.element);\r\n        }\r\n\r\n        var measurementData = createNewMeasurement(mouseEventData);\r\n\r\n        var eventData = {\r\n            mouseButtonMask: mouseEventData.which,\r\n        };\r\n        \r\n        // associate this data with this imageId so we can render it and manipulate it\r\n        cornerstoneTools.addToolState(mouseEventData.element, toolType, measurementData);\r\n       \r\n        // since we are dragging to another place to drop the end point, we can just activate\r\n        // the end point and let the moveHandle move it for us.\r\n        $(mouseEventData.element).off('CornerstoneToolsMouseMove', cornerstoneTools.arrowAnnotate.mouseMoveCallback);\r\n        $(mouseEventData.element).off('CornerstoneToolsMouseDown', cornerstoneTools.arrowAnnotate.mouseDownCallback);\r\n        $(mouseEventData.element).off('CornerstoneToolsMouseDownActivate', cornerstoneTools.arrowAnnotate.mouseDownActivateCallback);\r\n\r\n        cornerstone.updateImage(mouseEventData.element);\r\n        cornerstoneTools.moveNewHandle(mouseEventData, measurementData.handles.end, function() {\r\n            if (cornerstoneTools.anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\r\n                // delete the measurement\r\n                cornerstoneTools.removeToolState(mouseEventData.element, toolType, measurementData);\r\n            }\r\n\r\n            var config = cornerstoneTools.arrowAnnotate.getConfiguration();\r\n            if (measurementData.annotationText === undefined) {\r\n                config.getTextCallback(doneChangingTextCallback);\r\n            }\r\n\r\n            $(mouseEventData.element).on('CornerstoneToolsMouseMove', eventData, cornerstoneTools.arrowAnnotate.mouseMoveCallback);\r\n            $(mouseEventData.element).on('CornerstoneToolsMouseDown', eventData, cornerstoneTools.arrowAnnotate.mouseDownCallback);\r\n            $(mouseEventData.element).on('CornerstoneToolsMouseDownActivate', eventData, cornerstoneTools.arrowAnnotate.mouseDownActivateCallback);\r\n            cornerstone.updateImage(mouseEventData.element);\r\n        });\r\n    }\r\n\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }\r\n            }\r\n        };\r\n\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        var lineSegment = {\r\n            start: cornerstone.pixelToCanvas(element, data.handles.start), end: cornerstone.pixelToCanvas(element, data.handles.end)\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\r\n        return (distanceToPoint < 25);\r\n    }\r\n\r\n    function drawArrow(context, start, end, color, lineWidth) {\r\n        //variables to be used when creating the arrow\r\n        var headLength = 10;\r\n\r\n        var angle = Math.atan2(end.y - start.y, end.x - start.x);\r\n\r\n        //starting path of the arrow from the start square to the end square and drawing the stroke\r\n        context.beginPath();\r\n        context.moveTo(start.x, start.y);\r\n        context.lineTo(end.x, end.y);\r\n        context.strokeStyle = color;\r\n        context.lineWidth = lineWidth;\r\n        context.stroke();\r\n\r\n        //starting a new path from the head of the arrow to one of the sides of the point\r\n        context.beginPath();\r\n        context.moveTo(end.x, end.y);\r\n        context.lineTo(end.x - headLength * Math.cos(angle - Math.PI / 7), end.y - headLength * Math.sin(angle - Math.PI / 7));\r\n\r\n        //path from the side point of the arrow, to the other side point\r\n        context.lineTo(end.x - headLength * Math.cos(angle + Math.PI / 7), end.y - headLength * Math.sin(angle + Math.PI / 7));\r\n\r\n        //path from the side point back to the tip of the arrow, and then again to the opposite side point\r\n        context.lineTo(end.x, end.y);\r\n        context.lineTo(end.x - headLength * Math.cos(angle - Math.PI / 7), end.y - headLength * Math.sin(angle - Math.PI / 7));\r\n\r\n        //draws the paths created above\r\n        context.strokeStyle = color;\r\n        context.lineWidth = lineWidth;\r\n        context.stroke();\r\n        context.fillStyle = color;\r\n        context.fill();\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function onImageRendered(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var config = cornerstoneTools.arrowAnnotate.getConfiguration();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n\r\n            var data = toolData.data[i];\r\n\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n            \r\n            // Draw the arrow\r\n            var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n            var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n            if (config.arrowFirst) {\r\n                drawArrow(context, handleEndCanvas, handleStartCanvas, color, lineWidth);\r\n            } else {\r\n                drawArrow(context, handleStartCanvas, handleEndCanvas, color, lineWidth);\r\n            }\r\n\r\n            if (config.drawHandles) {\r\n                cornerstoneTools.drawHandles(context, eventData, data.handles, color);\r\n            } else if (config.drawHandlesOnHover && data.handles.start.active) {\r\n                cornerstoneTools.drawHandles(context, eventData, [ data.handles.start ], color);\r\n            } else if (config.drawHandlesOnHover && data.handles.end.active) {\r\n                cornerstoneTools.drawHandles(context, eventData, [ data.handles.end ], color);\r\n            }\r\n\r\n            // Draw the text\r\n            if (data.annotationText && data.annotationText !== '') {\r\n                context.font = font;\r\n                \r\n                var distance = 13;\r\n\r\n                // TODO: add 2 dimensional vector operations to cornerstoneMath\r\n                var vector;\r\n                \r\n                var displacement = {\r\n                    x: distance, y: distance / 2\r\n                };\r\n\r\n                vector = {\r\n                    x: handleEndCanvas.x - handleStartCanvas.x, y: handleEndCanvas.y - handleStartCanvas.y\r\n                };\r\n\r\n                var textCoords;\r\n                if (config.arrowFirst) {\r\n                    // Fix text placement if arrow faces right\r\n                    if (vector.x < 0) {\r\n                        displacement.x = -displacement.x - context.measureText(data.annotationText).width;\r\n                    }\r\n\r\n                    textCoords = {\r\n                        x: vector.x + handleStartCanvas.x + displacement.x, y: vector.y + handleStartCanvas.y + displacement.y\r\n                    };\r\n                } else {\r\n                    // Fix text placement if arrow faces right\r\n                    if (vector.x > 0) {\r\n                        displacement.x = -displacement.x - context.measureText(data.annotationText).width;\r\n                    }\r\n\r\n                    textCoords = {\r\n                        x: -vector.x + handleEndCanvas.x + displacement.x, y: -vector.y + handleEndCanvas.y + displacement.y\r\n                    };\r\n                }\r\n\r\n                cornerstoneTools.drawTextBox(context, data.annotationText, textCoords.x, textCoords.y, color);\r\n            }\r\n\r\n            context.restore();\r\n        }\r\n    }\r\n    // ---- Touch tool ----\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function addNewMeasurementTouch(touchEventData) {\r\n        var element = touchEventData.element;\r\n\r\n        function doneChangingTextCallback(annotationText) {\r\n            if (annotationText !== null) {\r\n                measurementData.annotationText = annotationText;\r\n            } else {\r\n                cornerstoneTools.removeToolState(element, toolType, measurementData);\r\n            }\r\n\r\n            measurementData.active = false;\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        var measurementData = createNewMeasurement(touchEventData);\r\n        cornerstoneTools.addToolState(element, toolType, measurementData);\r\n        $(element).off('CornerstoneToolsTouchDrag', cornerstoneTools.arrowAnnotateTouch.touchMoveCallback);\r\n        $(element).off('CornerstoneToolsDragStartActive', cornerstoneTools.arrowAnnotateTouch.touchDownActivateCallback);\r\n        $(element).off('CornerstoneToolsTap', cornerstoneTools.arrowAnnotateTouch.tapCallback);\r\n        cornerstone.updateImage(element);\r\n\r\n        cornerstoneTools.moveNewHandleTouch(touchEventData, measurementData.handles.end, function() {\r\n            cornerstone.updateImage(element);\r\n\r\n            if (cornerstoneTools.anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\r\n                // delete the measurement\r\n                cornerstoneTools.removeToolState(element, toolType, measurementData);\r\n            }\r\n\r\n            var config = cornerstoneTools.arrowAnnotate.getConfiguration();\r\n            if (measurementData.annotationText === undefined) {\r\n                config.getTextCallback(doneChangingTextCallback);\r\n            }\r\n\r\n            $(element).on('CornerstoneToolsTouchDrag', cornerstoneTools.arrowAnnotateTouch.touchMoveCallback);\r\n            $(element).on('CornerstoneToolsDragStartActive', cornerstoneTools.arrowAnnotateTouch.touchDownActivateCallback);\r\n            $(element).on('CornerstoneToolsTap', cornerstoneTools.arrowAnnotateTouch.tapCallback);\r\n        });\r\n    }\r\n\r\n    cornerstoneTools.arrowAnnotate = cornerstoneTools.mouseButtonTool({\r\n        addNewMeasurement: addNewMeasurement,\r\n        createNewMeasurement: createNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType\r\n    });\r\n\r\n    cornerstoneTools.arrowAnnotate.setConfiguration(configuration);\r\n\r\n    cornerstoneTools.arrowAnnotateTouch = cornerstoneTools.touchTool({\r\n        addNewMeasurement: addNewMeasurementTouch,\r\n        createNewMeasurement: createNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/annotation.js\r\n\r\n// Begin Source: src/imageTools/crosshairs.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'crosshairs';\r\n\r\n    function chooseLocation(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (!toolData) {\r\n            return;\r\n        }\r\n\r\n        // Get current element target information\r\n        var sourceElement = e.currentTarget;\r\n        var sourceEnabledElement = cornerstone.getEnabledElement(sourceElement);\r\n        var sourceImageId = sourceEnabledElement.image.imageId;\r\n        var sourceImagePlane = cornerstoneTools.metaData.get('imagePlane', sourceImageId);\r\n\r\n        // Get currentPoints from mouse cursor on selected element\r\n        var sourceImagePoint = eventData.currentPoints.image;\r\n\r\n        // Transfer this to a patientPoint given imagePlane metadata\r\n        var patientPoint = cornerstoneTools.imagePointToPatientPoint(sourceImagePoint, sourceImagePlane);\r\n\r\n        // Get the enabled elements associated with this synchronization context\r\n        var syncContext = toolData.data[0].synchronizationContext;\r\n        var enabledElements = syncContext.getSourceElements();\r\n\r\n        // Iterate over each synchronized element\r\n        $.each(enabledElements, function(index, targetElement) {\r\n            // don't do anything if the target is the same as the source\r\n            if (targetElement === sourceElement) {\r\n                return; // Same as 'continue' in a normal for loop\r\n            }\r\n\r\n            var minDistance = Number.MAX_VALUE;\r\n            var newImageIdIndex = -1;\r\n\r\n            var stackToolDataSource = cornerstoneTools.getToolState(targetElement, 'stack');\r\n            if (stackToolDataSource === undefined) {\r\n                return; // Same as 'continue' in a normal for loop\r\n            }\r\n\r\n            var stackData = stackToolDataSource.data[0];\r\n\r\n            // Find within the element's stack the closest image plane to selected location\r\n            $.each(stackData.imageIds, function(index, imageId) {\r\n                var imagePlane = cornerstoneTools.metaData.get('imagePlane', imageId);\r\n                var imagePosition = imagePlane.imagePositionPatient;\r\n                var row = imagePlane.rowCosines.clone();\r\n                var column = imagePlane.columnCosines.clone();\r\n                var normal = column.clone().cross(row.clone());\r\n                var distance = Math.abs(normal.clone().dot(imagePosition) - normal.clone().dot(patientPoint));\r\n                //console.log(index + '=' + distance);\r\n                if (distance < minDistance) {\r\n                    minDistance = distance;\r\n                    newImageIdIndex = index;\r\n                }\r\n            });\r\n\r\n            if (newImageIdIndex === stackData.currentImageIdIndex) {\r\n                return;\r\n            }\r\n\r\n            // Switch the loaded image to the required image\r\n            if (newImageIdIndex !== -1 && stackData.imageIds[newImageIdIndex] !== undefined) {\r\n                var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n                var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n                var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n                if (startLoadingHandler) {\r\n                    startLoadingHandler(targetElement);\r\n                }\r\n\r\n                cornerstone.loadAndCacheImage(stackData.imageIds[newImageIdIndex]).then(function(image) {\r\n                    var viewport = cornerstone.getViewport(targetElement);\r\n                    stackData.currentImageIdIndex = newImageIdIndex;\r\n                    cornerstone.displayImage(targetElement, image, viewport);\r\n                    if (endLoadingHandler) {\r\n                        endLoadingHandler(targetElement);\r\n                    }\r\n                }, function(error) {\r\n                    var imageId = stackData.imageIds[newImageIdIndex];\r\n                    if (errorLoadingHandler) {\r\n                        errorLoadingHandler(targetElement, imageId, error);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            chooseLocation(e, eventData);\r\n            return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    function mouseDragCallback(e, eventData) {\r\n        chooseLocation(e, eventData);\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function enable(element, mouseButtonMask, synchronizationContext) {\r\n        var eventData = {\r\n            mouseButtonMask: mouseButtonMask,\r\n        };\r\n\r\n        cornerstoneTools.addToolState(element, toolType, {\r\n            synchronizationContext: synchronizationContext,\r\n        });\r\n\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n\r\n        $(element).on('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n    }\r\n\r\n    // disables the reference line tool for the given element\r\n    function disable(element) {\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.crosshairs = {\r\n        enable: enable,\r\n        disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/crosshairs.js\r\n\r\n// Begin Source: src/imageTools/displayTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function displayTool(onImageRendered) {\r\n        var configuration = {};\r\n\r\n        var toolInterface = {\r\n            disable: function(element) {$(element).off('CornerstoneImageRendered', onImageRendered);}, enable: function(element) {\r\n                $(element).off('CornerstoneImageRendered', onImageRendered);\r\n                $(element).on('CornerstoneImageRendered', onImageRendered);\r\n                cornerstone.updateImage(element);\r\n            }, getConfiguration: function() { return configuration; }, setConfiguration: function(config) {configuration = config;}\r\n        };\r\n\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.displayTool = displayTool;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/displayTool.js\r\n\r\n// Begin Source: src/imageTools/dragProbe.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function defaultStrategy(eventData) {\r\n        var enabledElement = cornerstone.getEnabledElement(eventData.element);\r\n\r\n        cornerstone.updateImage(eventData.element);\r\n\r\n        var context = enabledElement.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color = cornerstoneTools.toolColors.getActiveColor();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var fontHeight = cornerstoneTools.textStyle.getFontSize();\r\n\r\n        context.save();\r\n\r\n        var x = Math.round(eventData.currentPoints.image.x);\r\n        var y = Math.round(eventData.currentPoints.image.y);\r\n\r\n        var storedPixels = cornerstone.getStoredPixels(eventData.element, x, y, 1, 1);\r\n        var sp = storedPixels[0];\r\n        var mo = sp * eventData.image.slope + eventData.image.intercept;\r\n        var suv = cornerstoneTools.calculateSUV(eventData.image, sp);\r\n\r\n        // Draw text\r\n        var coords = {\r\n            // translate the x/y away from the cursor\r\n            x: eventData.currentPoints.image.x + 3, y: eventData.currentPoints.image.y - 3\r\n        };\r\n        var textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\r\n        \r\n        context.font = font;\r\n        context.fillStyle = color;\r\n        var text = '' + x + ',' + y;\r\n        var str = 'SP: ' + sp + ' MO: ' + parseFloat(mo.toFixed(3));\r\n        if (suv) {\r\n            str += ' SUV: ' + parseFloat(suv.toFixed(3));\r\n        }\r\n\r\n        cornerstoneTools.drawTextBox(context, str, textCoords.x, textCoords.y + fontHeight + 5, color);\r\n        cornerstoneTools.drawTextBox(context, text, textCoords.x, textCoords.y, color);\r\n        context.restore();\r\n    }\r\n\r\n    function minimalStrategy(eventData) {\r\n        var enabledElement = cornerstone.getEnabledElement(eventData.element);\r\n\r\n        cornerstone.updateImage(eventData.element);\r\n\r\n        var context = enabledElement.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color = cornerstoneTools.toolColors.getActiveColor();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n\r\n        context.save();\r\n\r\n        var x = Math.round(eventData.currentPoints.image.x);\r\n        var y = Math.round(eventData.currentPoints.image.y);\r\n\r\n        var storedPixels = cornerstone.getStoredPixels(eventData.element, x, y, 1, 1);\r\n        var huValue = storedPixels[0] * eventData.image.slope + eventData.image.intercept;\r\n        huValue = parseFloat(huValue.toFixed(3));\r\n\r\n        // Draw text\r\n        var coords = {\r\n            // translate the x/y away from the cursor\r\n            x: eventData.currentPoints.image.x + 4, y: eventData.currentPoints.image.y - 4\r\n        };\r\n        var textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\r\n        \r\n        context.font = font;\r\n        context.fillStyle = color;\r\n        cornerstoneTools.drawTextBox(context, huValue, textCoords.x, textCoords.y, color);\r\n        context.restore();\r\n    }\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', onDrag);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', onDrag);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            cornerstoneTools.dragProbe.strategy(eventData);\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    function onDrag(e, eventData) {\r\n        cornerstoneTools.dragProbe.strategy(eventData);\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    cornerstoneTools.dragProbe = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    \r\n    cornerstoneTools.dragProbe.strategies = {\r\n        default: defaultStrategy, minimal: minimalStrategy\r\n    };\r\n    cornerstoneTools.dragProbe.strategy = defaultStrategy;\r\n\r\n    cornerstoneTools.dragProbeTouch = cornerstoneTools.touchDragTool(onDrag);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/dragProbe.js\r\n\r\n// Begin Source: src/imageTools/ellipticalRoi.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'ellipticalRoi';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, invalidated: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }\r\n            }\r\n        };\r\n\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        // TODO: Find a formula for shortest distance between point and ellipse.  Rectangle is close enough\r\n        var startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: Math.min(startCanvas.x, endCanvas.x),\r\n            top: Math.min(startCanvas.y, endCanvas.y),\r\n            width: Math.abs(startCanvas.x - endCanvas.x),\r\n            height: Math.abs(startCanvas.y - endCanvas.y)\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.rect.distanceToPoint(rect, coords);\r\n        return (distanceToPoint < 5);\r\n    }\r\n\r\n    function pointNearToolTouch(element, data, coords) {\r\n        // TODO: Find a formula for shortest distance between point and ellipse.  Rectangle is close enough\r\n        var startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: Math.min(startCanvas.x, endCanvas.x),\r\n            top: Math.min(startCanvas.y, endCanvas.y),\r\n            width: Math.abs(startCanvas.x - endCanvas.x),\r\n            height: Math.abs(startCanvas.y - endCanvas.y)\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.rect.distanceToPoint(rect, coords);\r\n        return (distanceToPoint < 15);\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function pointInEllipse(ellipse, location) {\r\n        var xRadius = ellipse.width / 2;\r\n        var yRadius = ellipse.height / 2;\r\n\r\n        if (xRadius <= 0.0 || yRadius <= 0.0) {\r\n            return false;\r\n        }\r\n\r\n        var center = {\r\n            x: ellipse.left + xRadius, y: ellipse.top + yRadius\r\n        };\r\n\r\n        /* This is a more general form of the circle equation\r\n         *\r\n         * X^2/a^2 + Y^2/b^2 <= 1\r\n         */\r\n\r\n        var normalized = {\r\n            x: location.x - center.x, y: location.y - center.y\r\n        };\r\n\r\n        var inEllipse = ((normalized.x * normalized.y) / (xRadius * xRadius)) + ((normalized.y * normalized.y) / (yRadius * yRadius)) <= 1.0;\r\n        return inEllipse;\r\n    }\r\n\r\n    function calculateMeanStdDev(sp, ellipse) {\r\n        // TODO: Get a real statistics library here that supports large counts\r\n\r\n        var sum = 0;\r\n        var sumSquared = 0;\r\n        var count = 0;\r\n        var index = 0;\r\n\r\n        for (var y = ellipse.top; y < ellipse.top + ellipse.height; y++) {\r\n            for (var x = ellipse.left; x < ellipse.left + ellipse.width; x++) {\r\n                if (pointInEllipse(ellipse, {\r\n                    x: x, y: y\r\n                }) === true) {\r\n                    sum += sp[index];\r\n                    sumSquared += sp[index] * sp[index];\r\n                    count++;\r\n                }\r\n\r\n                index++;\r\n            }\r\n        }\r\n\r\n        if (count === 0) {\r\n            return {\r\n                count: count, mean: 0.0, variance: 0.0, stdDev: 0.0\r\n            };\r\n        }\r\n\r\n        var mean = sum / count;\r\n        var variance = sumSquared / count - mean * mean;\r\n\r\n        return {\r\n            count: count, mean: mean, variance: variance, stdDev: Math.sqrt(variance)\r\n        };\r\n    }\r\n\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        //activation color \r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var fontHeight = cornerstoneTools.textStyle.getFontSize();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n\r\n            var data = toolData.data[i];\r\n\r\n            //differentiate the color of activation tool\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            // draw the ellipse\r\n            var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n            var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n            var widthCanvas = Math.abs(handleStartCanvas.x - handleEndCanvas.x);\r\n            var heightCanvas = Math.abs(handleStartCanvas.y - handleEndCanvas.y);\r\n            var leftCanvas = Math.min(handleStartCanvas.x, handleEndCanvas.x);\r\n            var topCanvas = Math.min(handleStartCanvas.y, handleEndCanvas.y);\r\n            var centerX = (handleStartCanvas.x + handleEndCanvas.x) / 2;\r\n            var centerY = (handleStartCanvas.y + handleEndCanvas.y) / 2;\r\n\r\n            context.beginPath();\r\n            context.strokeStyle = color;\r\n            context.lineWidth = lineWidth;\r\n            cornerstoneTools.drawEllipse(context, leftCanvas, topCanvas, widthCanvas, heightCanvas);\r\n            context.closePath();\r\n\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles);\r\n            \r\n            context.font = font;\r\n\r\n            var textX, textY, meanStdDev, area, areaText, textSize;\r\n\r\n            if (!data.invalidated) {\r\n                textX = data.textX;\r\n                textY = data.textY;\r\n                meanStdDev = data.meanStdDev;\r\n                area = data.area;\r\n            } else {\r\n                // TODO: calculate this in web worker for large pixel counts...\r\n                var width = Math.abs(data.handles.start.x - data.handles.end.x);\r\n                var height = Math.abs(data.handles.start.y - data.handles.end.y);\r\n                var left = Math.min(data.handles.start.x, data.handles.end.x);\r\n                var top = Math.min(data.handles.start.y, data.handles.end.y);\r\n\r\n                var pixels = cornerstone.getPixels(eventData.element, left, top, width, height);\r\n\r\n                var ellipse = {\r\n                    left: left, top: top, width: width, height: height\r\n                };\r\n\r\n                // Calculate the mean, stddev, and area\r\n                meanStdDev = calculateMeanStdDev(pixels, ellipse);\r\n                area = Math.PI * (width * eventData.image.columnPixelSpacing / 2) * (height * eventData.image.rowPixelSpacing / 2);\r\n\r\n                data.invalidated = false;\r\n                if (!isNaN(area)) {\r\n                    data.area = area;\r\n                }\r\n\r\n                if (!isNaN(meanStdDev.mean) && !isNaN(meanStdDev.stdDev)) {\r\n                    data.meanStdDev = meanStdDev;\r\n                }\r\n            }\r\n            // Draw text\r\n            if (area !== undefined) {\r\n                areaText = 'Area: ' + area.toFixed(2) + ' mm' + String.fromCharCode(178);\r\n                textSize = context.measureText(areaText);\r\n            } else {\r\n                var stdDevText = 'StdDev: ' + meanStdDev.stdDev.toFixed(2);\r\n                textSize = context.measureText(stdDevText);\r\n            }\r\n\r\n            textX = centerX < (eventData.image.columns / 2) ? centerX + (widthCanvas / 2): centerX - (widthCanvas / 2) - textSize.width;\r\n            textY = centerY < (eventData.image.rows / 2) ? centerY + (heightCanvas / 2): centerY - (heightCanvas / 2);\r\n\r\n            context.fillStyle = color;\r\n            if (meanStdDev) {\r\n                cornerstoneTools.drawTextBox(context, 'Mean: ' + meanStdDev.mean.toFixed(2), textX, textY - fontHeight - 5, color);\r\n                cornerstoneTools.drawTextBox(context, 'StdDev: ' + meanStdDev.stdDev.toFixed(2), textX, textY, color);\r\n            }\r\n            \r\n            // Char code 178 is a superscript 2 for mm^2\r\n            if (area !== undefined && !isNaN(area)) {\r\n                cornerstoneTools.drawTextBox(context, areaText, textX, textY + fontHeight + 5, color);\r\n            }\r\n\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.ellipticalRoi = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType\r\n    });\r\n    cornerstoneTools.ellipticalRoiTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearToolTouch,\r\n        toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/ellipticalRoi.js\r\n\r\n// Begin Source: src/imageTools/freehand.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'freehand';\r\n    var configuration = {\r\n        mouseLocation: {\r\n            handles: {\r\n                start: {\r\n                    highlight: true, active: true,\r\n                }\r\n            }\r\n        }, freehand: false, modifying: false, currentHandle: 0, currentTool: -1\r\n    };\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function addPoint(eventData) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var config = cornerstoneTools.freehand.getConfiguration();\r\n\r\n        // Get the toolData from the last-drawn drawing\r\n        // (this should change when modification is added)\r\n        var data = toolData.data[config.currentTool];\r\n\r\n        var handleData = {\r\n            x: eventData.currentPoints.image.x, y: eventData.currentPoints.image.y, highlight: true, active: true, lines: []\r\n        };\r\n\r\n        // If this is not the first handle\r\n        if (data.handles.length){\r\n            // Add the line from the current handle to the new handle\r\n            data.handles[config.currentHandle - 1].lines.push(eventData.currentPoints.image);\r\n        }\r\n\r\n        // Add the new handle\r\n        data.handles.push(handleData);\r\n\r\n        // Increment the current handle value\r\n        config.currentHandle += 1;\r\n\r\n        // Reset freehand value\r\n        config.freehand = false;\r\n\r\n        // Force onImageRendered to fire\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function pointNearHandle(eventData, toolIndex) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var data = toolData.data[toolIndex];\r\n        if (data.handles === undefined) {\r\n            return;\r\n        }\r\n\r\n        var mousePoint = eventData.currentPoints.canvas;\r\n        for (var i = 0; i < data.handles.length; i++) {\r\n            var handleCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles[i]);\r\n            if (cornerstoneMath.point.distance(handleCanvas, mousePoint) < 5) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return;\r\n    }\r\n\r\n    function pointNearHandleAllTools(eventData) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var handleNearby;\r\n        for (var toolIndex = 0; toolIndex < toolData.data.length; toolIndex++) {\r\n            handleNearby = pointNearHandle(eventData, toolIndex);\r\n            if (handleNearby !== undefined) {\r\n                return {\r\n                    handleNearby: handleNearby, toolIndex: toolIndex\r\n                };\r\n            }\r\n        }\r\n\r\n        return; // Maybe this should return false?\r\n    }\r\n\r\n    // --- Drawing loop ---\r\n    // On first click, add point\r\n    // After first click, on mouse move, record location\r\n    // If mouse comes close to previous point, snap to it\r\n    // On next click, add another point -- continuously\r\n    // On each click, if it intersects with a current point, end drawing loop\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n\r\n        // Check if drawing is finished\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var config = cornerstoneTools.freehand.getConfiguration();\r\n\r\n        if (!eventData.event.shiftKey) {\r\n            config.freehand = false;\r\n        }\r\n\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function mouseMoveCallback(e, eventData) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var config = cornerstoneTools.freehand.getConfiguration();\r\n\r\n        var data = toolData.data[config.currentTool];\r\n\r\n        // Set the mouseLocation handle\r\n        config.mouseLocation.handles.start.x = eventData.currentPoints.image.x;\r\n        config.mouseLocation.handles.start.y = eventData.currentPoints.image.y;\r\n\r\n        var currentHandle = config.currentHandle;\r\n\r\n        if (config.modifying) {\r\n            // Move the handle\r\n            data.active = true;\r\n            data.highlight = true;\r\n            data.handles[currentHandle].x = config.mouseLocation.handles.start.x;\r\n            data.handles[currentHandle].y = config.mouseLocation.handles.start.y;\r\n            if (currentHandle) {\r\n                var lastLineIndex = data.handles[currentHandle - 1].lines.length - 1;\r\n                var lastLine = data.handles[currentHandle - 1].lines[lastLineIndex];\r\n                lastLine.x = config.mouseLocation.handles.start.x;\r\n                lastLine.y = config.mouseLocation.handles.start.y;\r\n            }\r\n        }\r\n\r\n        if (config.freehand) {\r\n            data.handles[currentHandle - 1].lines.push(eventData.currentPoints.image);\r\n        } else {\r\n            // No snapping in freehand mode\r\n            var handleNearby = pointNearHandle(eventData, config.currentTool);\r\n\r\n            // If there is a handle nearby to snap to\r\n            // (and it's not the actual mouse handle)\r\n            if (handleNearby !== undefined && handleNearby < (data.handles.length - 1)) {\r\n                config.mouseLocation.handles.start.x = data.handles[handleNearby].x;\r\n                config.mouseLocation.handles.start.y = data.handles[handleNearby].y;\r\n            }\r\n        }\r\n\r\n        // Force onImageRendered\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function startDrawing(eventData) {\r\n        $(eventData.element).on('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n        $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n\r\n        var measurementData = {\r\n            visible: true, active: true, handles: [],\r\n        };\r\n\r\n        var config = cornerstoneTools.freehand.getConfiguration();\r\n        config.mouseLocation.handles.start.x = eventData.currentPoints.image.x;\r\n        config.mouseLocation.handles.start.y = eventData.currentPoints.image.y;\r\n\r\n        cornerstoneTools.addToolState(eventData.element, toolType, measurementData);\r\n\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        config.currentTool = toolData.data.length - 1;\r\n    }\r\n\r\n    function endDrawing(eventData, handleNearby) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var config = cornerstoneTools.freehand.getConfiguration();\r\n\r\n        var data = toolData.data[config.currentTool];\r\n\r\n        data.active = false;\r\n        data.highlight = false;\r\n\r\n        // Connect the end of the drawing to the handle nearest to the click\r\n        if (handleNearby !== undefined){\r\n            data.handles[config.currentHandle - 1].lines.push(data.handles[handleNearby]);\r\n        }\r\n\r\n        if (config.modifying) {\r\n            config.modifying = false;\r\n        }\r\n\r\n        // Reset the current handle\r\n        config.currentHandle = 0;\r\n        config.currentTool = -1;\r\n\r\n        $(eventData.element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n\r\n            var handleNearby, toolIndex;\r\n\r\n            var config = cornerstoneTools.freehand.getConfiguration();\r\n            var currentTool = config.currentTool;\r\n\r\n            if (config.modifying) {\r\n                endDrawing(eventData);\r\n                return;\r\n            }\r\n\r\n            if (currentTool < 0) {\r\n                var nearby = pointNearHandleAllTools(eventData);\r\n                if (nearby) {\r\n                    handleNearby = nearby.handleNearby;\r\n                    toolIndex = nearby.toolIndex;\r\n                    // This means the user is trying to modify a point\r\n                    if (handleNearby !== undefined) {\r\n                        $(eventData.element).on('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n                        $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n                        config.modifying = true;\r\n                        config.currentHandle = handleNearby;\r\n                        config.currentTool = toolIndex;\r\n                    }\r\n                } else {\r\n                    startDrawing(eventData);\r\n                    addPoint(eventData);\r\n                }\r\n            } else if (currentTool >= 0 && toolData.data[currentTool].active) {\r\n                handleNearby = pointNearHandle(eventData, currentTool);\r\n                if (handleNearby !== undefined) {\r\n                    endDrawing(eventData, handleNearby);\r\n                } else if (eventData.event.shiftKey) {\r\n                    config.freehand = true;\r\n                } else {\r\n                    addPoint(eventData);\r\n                }\r\n            }\r\n\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function onImageRendered(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        var config = cornerstoneTools.freehand.getConfiguration();\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var fillColor = cornerstoneTools.toolColors.getFillColor();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n\r\n            var data = toolData.data[i];\r\n\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n                fillColor = cornerstoneTools.toolColors.getFillColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n                fillColor = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            var handleStart;\r\n\r\n            if (data.handles.length) {\r\n                for (var j = 0; j < data.handles.length; j++) {\r\n                    // Draw a line between handle j and j+1\r\n                    handleStart = data.handles[j];\r\n                    var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, handleStart);\r\n\r\n                    context.beginPath();\r\n                    context.strokeStyle = color;\r\n                    context.lineWidth = lineWidth;\r\n                    context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\r\n\r\n                    for (var k = 0; k < data.handles[j].lines.length; k++) {\r\n                        var lineCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles[j].lines[k]);\r\n                        context.lineTo(lineCanvas.x, lineCanvas.y);\r\n                        context.stroke();\r\n                    }\r\n\r\n                    var mouseLocationCanvas = cornerstone.pixelToCanvas(eventData.element, config.mouseLocation.handles.start);\r\n                    if (j === (data.handles.length - 1)) {\r\n                        if (data.active && !config.freehand && !config.modifying) {\r\n                            // If it's still being actively drawn, keep the last line to \r\n                            // the mouse location\r\n                            context.lineTo(mouseLocationCanvas.x, mouseLocationCanvas.y);\r\n                            context.stroke();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // If the tool is active, draw a handle at the cursor location\r\n            if (data.active){\r\n                cornerstoneTools.drawHandles(context, eventData, config.mouseLocation.handles, color, fillColor);\r\n            }\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles, color, fillColor);\r\n\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n    function enable(element) {\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n        $(element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n\r\n        $(element).on('CornerstoneImageRendered', onImageRendered);\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // disables the reference line tool for the given element\r\n    function disable(element) {\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n        $(element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // visible and interactive\r\n    function activate(element, mouseButtonMask) {\r\n        var eventData = {\r\n            mouseButtonMask: mouseButtonMask,\r\n        };\r\n\r\n        $(element).off('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n        $(element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n\r\n        $(element).on('CornerstoneImageRendered', onImageRendered);\r\n        $(element).on('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // visible, but not interactive\r\n    function deactivate(element) {\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n        $(element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        $(element).off('CornerstoneToolsMouseMove', mouseMoveCallback);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n\r\n        $(element).on('CornerstoneImageRendered', onImageRendered);\r\n\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    function getConfiguration() {\r\n        return configuration;\r\n    }\r\n\r\n    function setConfiguration(config) {\r\n        configuration = config;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.freehand = {\r\n        enable: enable, disable: disable, activate: activate, deactivate: deactivate, getConfiguration: getConfiguration, setConfiguration: setConfiguration\r\n    };\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/freehand.js\r\n\r\n// Begin Source: src/imageTools/highlight.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'highlight';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        //if already a highlight measurement, creating a new one will be useless\r\n        var existingToolData = cornerstoneTools.getToolState(mouseEventData.event.currentTarget, toolType);\r\n        if (existingToolData && existingToolData.data && existingToolData.data.length > 0) {\r\n            return;\r\n        }\r\n    \r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }\r\n            }\r\n        };\r\n\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointInsideRect(element, data, coords) {\r\n        var startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: Math.min(startCanvas.x, endCanvas.x), top: Math.min(startCanvas.y, endCanvas.y), width: Math.abs(startCanvas.x - endCanvas.x), height: Math.abs(startCanvas.y - endCanvas.y)\r\n        };\r\n\r\n        var insideBox = false;\r\n        if ((coords.x >= rect.left && coords.x <= (rect.left + rect.width)) && coords.y >= rect.top && coords.y <= (rect.top + rect.height)) {\r\n            insideBox = true;\r\n        }\r\n\r\n        return insideBox;\r\n    }\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        var startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: Math.min(startCanvas.x, endCanvas.x), top: Math.min(startCanvas.y, endCanvas.y), width: Math.abs(startCanvas.x - endCanvas.x), height: Math.abs(startCanvas.y - endCanvas.y)\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.rect.distanceToPoint(rect, coords);\r\n        return (distanceToPoint < 5);\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this elemen\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n\r\n        context.save();\r\n\r\n        var data = toolData.data[0];\r\n\r\n        if (!data) {\r\n            return;\r\n        }\r\n\r\n        if (data.active) {\r\n            color = cornerstoneTools.toolColors.getActiveColor();\r\n        } else {\r\n            color = cornerstoneTools.toolColors.getToolColor();\r\n        }\r\n\r\n        var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n        var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: Math.min(handleStartCanvas.x, handleEndCanvas.x), top: Math.min(handleStartCanvas.y, handleEndCanvas.y), width: Math.abs(handleStartCanvas.x - handleEndCanvas.x), height: Math.abs(handleStartCanvas.y - handleEndCanvas.y)\r\n        };\r\n\r\n        // draw dark fill outside the rectangle\r\n        context.beginPath();\r\n        context.strokeStyle = 'transparent';\r\n\r\n        context.rect(0, 0, context.canvas.clientWidth, context.canvas.clientHeight);\r\n\r\n        context.rect(rect.width + rect.left, rect.top, -rect.width, rect.height);\r\n        context.stroke();\r\n        context.fillStyle = 'rgba(0,0,0,0.7)';\r\n        context.fill();\r\n        context.closePath();\r\n\r\n        // draw dashed stroke rectangle\r\n        context.beginPath();\r\n        context.strokeStyle = color;\r\n        context.lineWidth = lineWidth;\r\n        context.setLineDash([ 4 ]);\r\n        context.strokeRect(rect.left, rect.top, rect.width, rect.height);\r\n\r\n        // Strange fix, but restore doesn't seem to reset the line dashes?\r\n        context.setLineDash([]);\r\n        \r\n        // draw the handles last, so they will be on top of the overlay\r\n        cornerstoneTools.drawHandles(context, eventData, data.handles, color);\r\n        context.restore();\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    var preventHandleOutsideImage = true;\r\n\r\n    cornerstoneTools.highlight = cornerstoneTools.mouseButtonRectangleTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, pointInsideRect: pointInsideRect, toolType: toolType\r\n    }, preventHandleOutsideImage);\r\n    \r\n    cornerstoneTools.highlightTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, pointInsideRect: pointInsideRect, toolType: toolType\r\n    }, preventHandleOutsideImage);\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/highlight.js\r\n\r\n// Begin Source: src/imageTools/keyboardTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function keyboardTool(keyDownCallback) {\r\n        var configuration = {};\r\n\r\n        var toolInterface = {\r\n            activate: function(element) {\r\n                $(element).off('CornerstoneToolsKeyDown', keyDownCallback);\r\n                $(element).on('CornerstoneToolsKeyDown', keyDownCallback);\r\n            }, disable: function(element) {$(element).off('CornerstoneToolsKeyDown', keyDownCallback);}, enable: function(element) {$(element).off('CornerstoneToolsKeyDown', keyDownCallback);}, deactivate: function(element) {$(element).off('CornerstoneToolsKeyDown', keyDownCallback);}, getConfiguration: function() { return configuration; }, setConfiguration: function(config) {configuration = config;}\r\n        };\r\n        return toolInterface;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.keyboardTool = keyboardTool;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/keyboardTool.js\r\n\r\n// Begin Source: src/imageTools/lengthTool.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'length';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }\r\n            }\r\n        };\r\n\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        var lineSegment = {\r\n            start: cornerstone.pixelToCanvas(element, data.handles.start), end: cornerstone.pixelToCanvas(element, data.handles.end)\r\n        };\r\n        var distanceToPoint = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\r\n        return (distanceToPoint < 25);\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var config = cornerstoneTools.length.getConfiguration();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n            // configurable shadow\r\n            if (config && config.shadow) {\r\n                context.shadowColor = '#000000';\r\n                context.shadowOffsetX = +1;\r\n                context.shadowOffsetY = +1;\r\n            }\r\n            \r\n            var data = toolData.data[i];\r\n\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            // draw the line\r\n            var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n            var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n            context.beginPath();\r\n            context.strokeStyle = color;\r\n            context.lineWidth = lineWidth;\r\n            context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\r\n            context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\r\n            context.stroke();\r\n\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles, color);\r\n\r\n            // Draw the text\r\n            context.fillStyle = color;\r\n            context.font = font;\r\n\r\n            var suffix = ' mm';\r\n            if (!eventData.image.rowPixelSpacing || !eventData.image.columnPixelSpacing) {\r\n                suffix = ' pixels';\r\n            }\r\n\r\n            // Set rowPixelSpacing and columnPixelSpacing to 1 if they are undefined (or zero)\r\n            var dx = (data.handles.start.x - data.handles.end.x) * (eventData.image.columnPixelSpacing || 1);\r\n            var dy = (data.handles.start.y - data.handles.end.y) * (eventData.image.rowPixelSpacing || 1);\r\n            \r\n            var length = Math.sqrt(dx * dx + dy * dy);\r\n            var text = '' + length.toFixed(2) + suffix;\r\n\r\n            var textCoords = {\r\n                x: (handleStartCanvas.x + handleEndCanvas.x) / 2 + 5, y: (handleStartCanvas.y + handleEndCanvas.y) / 2\r\n            };\r\n\r\n            cornerstoneTools.drawTextBox(context, text, textCoords.x, textCoords.y, color);\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.length = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n    cornerstoneTools.lengthTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/lengthTool.js\r\n\r\n// Begin Source: src/imageTools/magnify.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var configuration = {\r\n        magnifySize: 100, magnificationLevel: 2,\r\n    };\r\n\r\n    /** Remove the magnifying glass when the mouse event ends */\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', dragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        hideTool(eventData);\r\n    }\r\n\r\n    function hideTool(eventData) {\r\n        $(eventData.element).find('.magnifyTool').hide();\r\n        // Re-enable the mouse cursor\r\n        document.body.style.cursor = 'default';\r\n    }\r\n\r\n    /** Draw the magnifying glass on mouseDown, and begin tracking mouse movements */\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', eventData, dragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', eventData, mouseUpCallback);\r\n            drawMagnificationTool(eventData);\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    /** Drag callback is triggers by both the touch and mouse magnify tools */\r\n    function dragCallback(e, eventData) {\r\n        drawMagnificationTool(eventData);\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    /** Draws the magnifying glass */\r\n    function drawMagnificationTool(eventData) {\r\n        var magnify = $(eventData.element).find('.magnifyTool').get(0);\r\n\r\n        if (magnify === undefined) {\r\n            createMagnificationCanvas(eventData.element);\r\n        }\r\n\r\n        var config = cornerstoneTools.magnify.getConfiguration();\r\n\r\n        var magnifySize = config.magnifySize;\r\n        var magnificationLevel = config.magnificationLevel;\r\n\r\n        // The 'not' magnifyTool class here is necessary because cornerstone places\r\n        // no classes of it's own on the canvas we want to select\r\n        var canvas = $(eventData.element).find('canvas').not('.magnifyTool').get(0);\r\n        var context = canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var zoomCtx = magnify.getContext('2d');\r\n        zoomCtx.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        // Calculate the on-canvas location of the mouse pointer / touch\r\n        var canvasLocation = cornerstone.pixelToCanvas(eventData.element, eventData.currentPoints.image);\r\n\r\n        canvasLocation.x = Math.max(canvasLocation.x, 0);\r\n        canvasLocation.x = Math.min(canvasLocation.x, canvas.width);\r\n\r\n        canvasLocation.y = Math.max(canvasLocation.y, 0);\r\n        canvasLocation.y = Math.min(canvasLocation.y, canvas.height);\r\n\r\n        // Clear the rectangle\r\n        zoomCtx.clearRect(0, 0, magnifySize, magnifySize);\r\n        zoomCtx.fillStyle = 'transparent';\r\n\r\n        // Fill it with the pixels that the mouse is clicking on\r\n        zoomCtx.fillRect(0, 0, magnifySize, magnifySize);\r\n        \r\n        var scaledMagnifySize = magnifySize * magnificationLevel;\r\n        var getSize = magnifySize / magnificationLevel;\r\n        var copyFrom = {\r\n            x: canvasLocation.x - 0.5 * getSize, y: canvasLocation.y - 0.5 * getSize\r\n        };\r\n\r\n        zoomCtx.drawImage(canvas, copyFrom.x, copyFrom.y, magnifySize, magnifySize, 0, 0, scaledMagnifySize, scaledMagnifySize);\r\n\r\n        // Place the magnification tool at the same location as the pointer\r\n        magnify.style.top = canvasLocation.y - 0.5 * magnifySize + 'px';\r\n        magnify.style.left = canvasLocation.x - 0.5 * magnifySize + 'px';\r\n        magnify.style.display = 'block';\r\n\r\n        // Hide the mouse cursor, so the user can see better\r\n        document.body.style.cursor = 'none';\r\n    }\r\n\r\n    /** Creates the magnifying glass canvas */\r\n    function createMagnificationCanvas(element) {\r\n        // If the magnifying glass canvas doesn't already exist\r\n        if ($(element).find('.magnifyTool').length === 0) {\r\n            // Create a canvas and append it as a child to the element\r\n            var magnify = document.createElement('canvas');\r\n            // The magnifyTool class is used to find the canvas later on\r\n            magnify.classList.add('magnifyTool');\r\n\r\n            var config = cornerstoneTools.magnify.getConfiguration();\r\n            magnify.width = config.magnifySize;\r\n            magnify.height = config.magnifySize;\r\n\r\n            // Make sure position is absolute so the canvas can follow the mouse / touch\r\n            magnify.style.position = 'absolute';\r\n            element.appendChild(magnify);\r\n        }\r\n    }\r\n\r\n    /** Find the magnifying glass canvas and remove it */\r\n    function removeMagnificationCanvas(element) {\r\n        $(element).find('.magnifyTool').remove();\r\n    }\r\n\r\n    // --- Mouse tool activate / disable --- //\r\n    function disable(element) {\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n        removeMagnificationCanvas(element);\r\n    }\r\n\r\n    function enable(element) {\r\n        var config = cornerstoneTools.magnify.getConfiguration(config);\r\n        createMagnificationCanvas(element);\r\n    }\r\n\r\n    function activate(element, mouseButtonMask) {\r\n        var eventData = {\r\n            mouseButtonMask: mouseButtonMask,\r\n        };\r\n\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n\r\n        $(element).on('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n        createMagnificationCanvas(element);\r\n    }\r\n\r\n    // --- Touch tool activate / disable --- //\r\n    function disableTouchDrag(element) {\r\n        $(element).off('CornerstoneToolsTouchDrag', dragCallback);\r\n        $(element).off('CornerstoneToolsDragStart', dragCallback);\r\n        removeMagnificationCanvas(element);\r\n    }\r\n\r\n    function activateTouchDrag(element) {\r\n        $(element).off('CornerstoneToolsTouchDrag', dragCallback);\r\n        $(element).off('CornerstoneToolsDragStart', dragCallback);\r\n\r\n        $(element).on('CornerstoneToolsTouchDrag', dragCallback);\r\n        $(element).on('CornerstoneToolsDragStart', dragCallback);\r\n        createMagnificationCanvas(element);\r\n    }\r\n\r\n    function getConfiguration() {\r\n        return configuration;\r\n    }\r\n\r\n    function setConfiguration(config) {\r\n        configuration = config;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.magnify = {\r\n        enable: enable, activate: activate, deactivate: disable, disable: disable, getConfiguration: getConfiguration, setConfiguration: setConfiguration\r\n    };\r\n\r\n    cornerstoneTools.magnifyTouchDrag = {\r\n        enable: enable, activate: activateTouchDrag, deactivate: disableTouchDrag, disable: disableTouchDrag\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/magnify.js\r\n\r\n// Begin Source: src/imageTools/orientationMarkers.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function getOrientationMarkers(element) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        var imagePlaneMetaData = cornerstoneTools.metaData.get('imagePlane', enabledElement.image.imageId);\r\n\r\n        if (!imagePlaneMetaData || !imagePlaneMetaData.rowCosines || !imagePlaneMetaData.columnCosines) {\r\n            return;\r\n        }\r\n\r\n        var rowString = cornerstoneTools.orientation.getOrientationString(imagePlaneMetaData.rowCosines);\r\n        var columnString = cornerstoneTools.orientation.getOrientationString(imagePlaneMetaData.columnCosines);\r\n\r\n        var oppositeRowString = cornerstoneTools.orientation.invertOrientationString(rowString);\r\n        var oppositeColumnString = cornerstoneTools.orientation.invertOrientationString(columnString);\r\n\r\n        return {\r\n            top: oppositeColumnString, bottom: columnString, left: oppositeRowString, right: rowString\r\n        };\r\n    }\r\n\r\n    function getOrientationMarkerPositions(element) {\r\n        var enabledElement = cornerstone.getEnabledElement(element);\r\n        var coords;\r\n\r\n        coords = {\r\n            x: enabledElement.image.width / 2, y: 5\r\n        };\r\n        var topCoords = cornerstone.pixelToCanvas(element, coords);\r\n\r\n        coords = {\r\n            x: enabledElement.image.width / 2, y: enabledElement.image.height - 5\r\n        };\r\n        var bottomCoords = cornerstone.pixelToCanvas(element, coords);\r\n\r\n        coords = {\r\n            x: 5, y: enabledElement.image.height / 2\r\n        };\r\n        var leftCoords = cornerstone.pixelToCanvas(element, coords);\r\n\r\n        coords = {\r\n            x: enabledElement.image.width - 10, y: enabledElement.image.height / 2\r\n        };\r\n        var rightCoords = cornerstone.pixelToCanvas(element, coords);\r\n\r\n        return {\r\n            top: topCoords, bottom: bottomCoords, left: leftCoords, right: rightCoords\r\n        };\r\n    }\r\n\r\n    function onImageRendered(e, eventData) {\r\n        var element = eventData.element;\r\n\r\n        var markers = getOrientationMarkers(element);\r\n\r\n        if (!markers) {\r\n            return;\r\n        }\r\n\r\n        var coords = getOrientationMarkerPositions(element, markers);\r\n\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color = cornerstoneTools.toolColors.getToolColor();\r\n\r\n        var textWidths = {\r\n            top: context.measureText(markers.top).width, left: context.measureText(markers.left).width, right: context.measureText(markers.right).width, bottom: context.measureText(markers.bottom).width\r\n        };\r\n\r\n        cornerstoneTools.drawTextBox(context, markers.top, coords.top.x - textWidths.top / 2, coords.top.y, color);\r\n        cornerstoneTools.drawTextBox(context, markers.left, coords.left.x - textWidths.left / 2, coords.left.y, color);\r\n\r\n        var config = cornerstoneTools.orientationMarkers.getConfiguration();\r\n        if (config && config.drawAllMarkers) {\r\n            cornerstoneTools.drawTextBox(context, markers.right, coords.right.x - textWidths.right / 2, coords.right.y, color);\r\n            cornerstoneTools.drawTextBox(context, markers.bottom, coords.bottom.x - textWidths.bottom / 2, coords.bottom.y, color);\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.orientationMarkers = cornerstoneTools.displayTool(onImageRendered);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/orientationMarkers.js\r\n\r\n// Begin Source: src/imageTools/pan.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    function mouseDragCallback(e, eventData) {\r\n        eventData.viewport.translation.x += (eventData.deltaPoints.page.x / eventData.viewport.scale);\r\n        eventData.viewport.translation.y += (eventData.deltaPoints.page.y / eventData.viewport.scale);\r\n        cornerstone.setViewport(eventData.element, eventData.viewport);\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function onDrag(e, eventData) {\r\n        var dragData = eventData;\r\n        dragData.viewport.translation.x += (dragData.deltaPoints.page.x / dragData.viewport.scale);\r\n        dragData.viewport.translation.y += (dragData.deltaPoints.page.y / dragData.viewport.scale);\r\n        cornerstone.setViewport(dragData.element, dragData.viewport);\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    cornerstoneTools.pan = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    cornerstoneTools.panTouchDrag = cornerstoneTools.touchDragTool(onDrag);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/pan.js\r\n\r\n// Begin Source: src/imageTools/panMultiTouch.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function touchPanCallback(e, eventData) {\r\n        eventData.viewport.translation.x += (eventData.deltaPoints.page.x / eventData.viewport.scale);\r\n        eventData.viewport.translation.y += (eventData.deltaPoints.page.y / eventData.viewport.scale);\r\n        cornerstone.setViewport(eventData.element, eventData.viewport);\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function disable(element) {\r\n        $(element).off('CornerstoneToolsMultiTouchDrag', touchPanCallback);\r\n    }\r\n\r\n    function activate(element) {\r\n        $(element).off('CornerstoneToolsMultiTouchDrag', touchPanCallback);\r\n        $(element).on('CornerstoneToolsMultiTouchDrag', touchPanCallback);\r\n    }\r\n\r\n    cornerstoneTools.panMultiTouch = {\r\n        activate: activate, disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/panMultiTouch.js\r\n\r\n// Begin Source: src/imageTools/probe.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'probe';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, handles: {\r\n                end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }\r\n            }\r\n        };\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function pointNearTool(element, data, coords) {\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n        return cornerstoneMath.point.distance(endCanvas, coords) < 5;\r\n    }\r\n\r\n    function onImageRendered(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (!toolData) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var color;\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var fontHeight = cornerstoneTools.textStyle.getFontSize();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n\r\n            context.save();\r\n            var data = toolData.data[i];\r\n            \r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles, color);\r\n\r\n            var x = Math.round(data.handles.end.x);\r\n            var y = Math.round(data.handles.end.y);\r\n\r\n            var storedPixels = cornerstone.getStoredPixels(eventData.element, x, y, 1, 1);\r\n            var sp = storedPixels[0];\r\n            var mo = sp * eventData.image.slope + eventData.image.intercept;\r\n            var suv = cornerstoneTools.calculateSUV(eventData.image, sp);\r\n\r\n            // Draw text\r\n\r\n            var coords = {\r\n                // translate the x/y away from the cursor\r\n                x: data.handles.end.x + 3, y: data.handles.end.y - 3\r\n            };\r\n            var textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\r\n            \r\n            context.font = font;\r\n            context.fillStyle = color;\r\n            var text = '' + x + ', ' + y;\r\n            var str = 'SP: ' + sp + ' MO: ' + parseFloat(mo.toFixed(3));\r\n            if (suv) {\r\n                str += ' SUV: ' + parseFloat(suv.toFixed(3));\r\n            }\r\n\r\n            cornerstoneTools.drawTextBox(context, str, textCoords.x, textCoords.y + fontHeight + 5, color);\r\n            cornerstoneTools.drawTextBox(context, text, textCoords.x, textCoords.y, color);\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.probe = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n    cornerstoneTools.probeTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/probe.js\r\n\r\n// Begin Source: src/imageTools/rectangleRoi.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'rectangleRoi';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }\r\n            }\r\n        };\r\n\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        var startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: Math.min(startCanvas.x, endCanvas.x), top: Math.min(startCanvas.y, endCanvas.y), width: Math.abs(startCanvas.x - endCanvas.x), height: Math.abs(startCanvas.y - endCanvas.y)\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.rect.distanceToPoint(rect, coords);\r\n        return (distanceToPoint < 5);\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n\r\n    function calculateMeanStdDev(sp, ellipse) {\r\n        // TODO: Get a real statistics library here that supports large counts\r\n\r\n        var sum = 0;\r\n        var sumSquared = 0;\r\n        var count = 0;\r\n        var index = 0;\r\n\r\n        for (var y = ellipse.top; y < ellipse.top + ellipse.height; y++) {\r\n            for (var x = ellipse.left; x < ellipse.left + ellipse.width; x++) {\r\n                sum += sp[index];\r\n                sumSquared += sp[index] * sp[index];\r\n                count++;\r\n                index++;\r\n            }\r\n        }\r\n\r\n        if (count === 0) {\r\n            return {\r\n                count: count, mean: 0.0, variance: 0.0, stdDev: 0.0\r\n            };\r\n        }\r\n\r\n        var mean = sum / count;\r\n        var variance = sumSquared / count - mean * mean;\r\n\r\n        return {\r\n            count: count, mean: mean, variance: variance, stdDev: Math.sqrt(variance)\r\n        };\r\n    }\r\n\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        //activation color \r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var fontHeight = cornerstoneTools.textStyle.getFontSize();\r\n        \r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n\r\n            var data = toolData.data[i];\r\n\r\n            //differentiate the color of activation tool\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            // draw the rectangle\r\n            var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n            var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n            var widthCanvas = Math.abs(handleStartCanvas.x - handleEndCanvas.x);\r\n            var heightCanvas = Math.abs(handleStartCanvas.y - handleEndCanvas.y);\r\n            var leftCanvas = Math.min(handleStartCanvas.x, handleEndCanvas.x);\r\n            var topCanvas = Math.min(handleStartCanvas.y, handleEndCanvas.y);\r\n            var centerX = (handleStartCanvas.x + handleEndCanvas.x) / 2;\r\n            var centerY = (handleStartCanvas.y + handleEndCanvas.y) / 2;\r\n\r\n            context.beginPath();\r\n            context.strokeStyle = color;\r\n            context.lineWidth = lineWidth;\r\n            context.rect(leftCanvas, topCanvas, widthCanvas, heightCanvas);\r\n            context.stroke();\r\n\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles, color);\r\n\r\n            // Calculate the mean, stddev, and area\r\n            // TODO: calculate this in web worker for large pixel counts...\r\n\r\n            var width = Math.abs(data.handles.start.x - data.handles.end.x);\r\n            var height = Math.abs(data.handles.start.y - data.handles.end.y);\r\n            var left = Math.min(data.handles.start.x, data.handles.end.x);\r\n            var top = Math.min(data.handles.start.y, data.handles.end.y);\r\n            var pixels = cornerstone.getPixels(eventData.element, left, top, width, height);\r\n\r\n            var ellipse = {\r\n                left: left, top: top, width: width, height: height\r\n            };\r\n\r\n            var meanStdDev = calculateMeanStdDev(pixels, ellipse);\r\n            var area = (width * eventData.image.columnPixelSpacing) * (height * eventData.image.rowPixelSpacing);\r\n            var areaText = 'Area: ' + area.toFixed(2) + ' mm^2';\r\n\r\n            // Draw text\r\n            context.font = font;\r\n\r\n            var textSize = context.measureText(area);\r\n\r\n            var textX = centerX < (eventData.image.columns / 2) ? centerX + (widthCanvas / 2): centerX - (widthCanvas / 2) - textSize.width;\r\n            var textY = centerY < (eventData.image.rows / 2) ? centerY + (heightCanvas / 2): centerY - (heightCanvas / 2);\r\n\r\n            context.fillStyle = color;\r\n            cornerstoneTools.drawTextBox(context, 'Mean: ' + meanStdDev.mean.toFixed(2), textX, textY - fontHeight - 5, color);\r\n            cornerstoneTools.drawTextBox(context, 'StdDev: ' + meanStdDev.stdDev.toFixed(2), textX, textY, color);\r\n            cornerstoneTools.drawTextBox(context, areaText, textX, textY + fontHeight + 5, color);\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.rectangleRoi = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n    cornerstoneTools.rectangleRoiTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, pointNearTool: pointNearTool, toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/rectangleRoi.js\r\n\r\n// Begin Source: src/imageTools/rotate.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // --- Strategies --- //\r\n    function defaultStrategy(eventData) {\r\n        // Calculate distance from the center of the image\r\n        var rect = eventData.element.getBoundingClientRect(eventData.element);\r\n\r\n        var points = {\r\n            x: eventData.currentPoints.client.x, y: eventData.currentPoints.client.y\r\n        };\r\n\r\n        var width = eventData.element.clientWidth;\r\n        var height = eventData.element.clientHeight;\r\n\r\n        var pointsFromCenter = {\r\n            x: points.x - rect.left - width / 2,\r\n            // Invert the coordinate system so that up is positive\r\n            y: -1 * (points.y - rect.top - height / 2)\r\n        };\r\n\r\n        var rotationRadians = Math.atan2(pointsFromCenter.y, pointsFromCenter.x);\r\n        var rotationDegrees = rotationRadians * (180 / Math.PI);\r\n        var rotation = -1 * rotationDegrees + 90;\r\n        eventData.viewport.rotation = rotation;\r\n    }\r\n\r\n    function horizontalStrategy(eventData) {\r\n        eventData.viewport.rotation += (eventData.deltaPoints.page.x / eventData.viewport.scale);\r\n    }\r\n\r\n    function verticalStrategy(eventData) {\r\n        eventData.viewport.rotation += (eventData.deltaPoints.page.y / eventData.viewport.scale);\r\n    }\r\n\r\n    // --- Mouse event callbacks --- //\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    function mouseDragCallback(e, eventData) {\r\n        cornerstoneTools.rotate.strategy(eventData);\r\n        cornerstone.setViewport(eventData.element, eventData.viewport);\r\n        e.stopPropagation();\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function onDrag(e, eventData) {\r\n        cornerstoneTools.rotate.strategy(eventData);\r\n        cornerstone.setViewport(eventData.element, eventData.viewport);\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    cornerstoneTools.rotate = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    cornerstoneTools.rotate.strategies = {\r\n        default: defaultStrategy, horizontal: horizontalStrategy, vertical: verticalStrategy\r\n    };\r\n    \r\n    cornerstoneTools.rotate.strategy = defaultStrategy;\r\n\r\n    cornerstoneTools.rotateTouchDrag = cornerstoneTools.touchDragTool(onDrag);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/rotate.js\r\n\r\n// Begin Source: src/imageTools/rotateTouch.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function touchRotateCallback(e, eventData) {\r\n        eventData.viewport.rotation += eventData.rotation;\r\n        cornerstone.setViewport(eventData.element, eventData.viewport);\r\n        return false;\r\n    }\r\n\r\n    function disable(element) {\r\n        $(element).off('CornerstoneToolsTouchRotate', touchRotateCallback);\r\n    }\r\n\r\n    function activate(element) {\r\n        $(element).off('CornerstoneToolsTouchRotate', touchRotateCallback);\r\n        $(element).on('CornerstoneToolsTouchRotate', touchRotateCallback);\r\n    }\r\n\r\n    cornerstoneTools.rotateTouch = {\r\n        activate: activate, disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/rotateTouch.js\r\n\r\n// Begin Source: src/imageTools/saveImage.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function saveAs(element, filename) {\r\n        var canvas = $(element).find('canvas').get(0);\r\n\r\n        // Thanks to Ken Fyrstenber\r\n        // http://stackoverflow.com/questions/18480474/how-to-save-an-image-from-canvas\r\n        var lnk = document.createElement('a');\r\n\r\n        /// the key here is to set the download attribute of the a tag\r\n        lnk.download = filename;\r\n\r\n        /// convert canvas content to data-uri for link. When download\r\n        /// attribute is set the content pointed to by link will be\r\n        /// pushed as 'download' in HTML5 capable browsers\r\n        lnk.href = canvas.toDataURL();\r\n\r\n        /// create a 'fake' click-event to trigger the download\r\n        if (document.createEvent) {\r\n\r\n            var e = document.createEvent('MouseEvents');\r\n            e.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\r\n\r\n            lnk.dispatchEvent(e);\r\n\r\n        } else if (lnk.fireEvent) {\r\n\r\n            lnk.fireEvent('onclick');\r\n        }\r\n    }\r\n\r\n    cornerstoneTools.saveAs = saveAs;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/saveImage.js\r\n\r\n// Begin Source: src/imageTools/simpleAngle.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'simpleAngle';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        // create the measurement data for this tool with the end handle activated\r\n        var angleData = {\r\n            visible: true, active: true, handles: {\r\n                start: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }, middle: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: true\r\n                }, end: {\r\n                    x: mouseEventData.currentPoints.image.x, y: mouseEventData.currentPoints.image.y, highlight: true, active: false\r\n                }\r\n            }\r\n        };\r\n\r\n        return angleData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    function pointNearTool(element, data, coords) {\r\n        var lineSegment = {\r\n            start: cornerstone.pixelToCanvas(element, data.handles.start), end: cornerstone.pixelToCanvas(element, data.handles.middle)\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\r\n        if (distanceToPoint < 5) {\r\n            return true;\r\n        }\r\n\r\n        lineSegment.start = cornerstone.pixelToCanvas(element, data.handles.middle);\r\n        lineSegment.end = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        distanceToPoint = cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\r\n        return (distanceToPoint < 5);\r\n    }\r\n\r\n    function length(vector) {\r\n        return Math.sqrt(Math.pow(vector.x, 2) + Math.pow(vector.y, 2));\r\n    }\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n        \r\n        //activation color \r\n        var color;\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n\r\n            var data = toolData.data[i];\r\n\r\n            //differentiate the color of activation tool\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            } else {\r\n                color = cornerstoneTools.toolColors.getToolColor();\r\n            }\r\n\r\n            // draw the line\r\n            context.beginPath();\r\n            context.strokeStyle = color;\r\n            context.lineWidth = lineWidth;\r\n\r\n            var handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\r\n            var handleMiddleCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.middle);\r\n\r\n            context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\r\n            context.lineTo(handleMiddleCanvas.x, handleMiddleCanvas.y);\r\n\r\n            var handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\r\n\r\n            context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\r\n            context.stroke();\r\n\r\n            // draw the handles\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles);\r\n\r\n            // Draw the text\r\n            context.fillStyle = color;\r\n\r\n            // Default to isotropic pixel size, update suffix to reflect this\r\n            var columnPixelSpacing = eventData.image.columnPixelSpacing || 1;\r\n            var rowPixelSpacing = eventData.image.rowPixelSpacing || 1;\r\n            var suffix = '';\r\n            if (!eventData.image.rowPixelSpacing || !eventData.image.columnPixelSpacing) {\r\n                suffix = ' (isotropic)';\r\n            }\r\n\r\n            var sideA = {\r\n                x: (Math.ceil(data.handles.middle.x) - Math.ceil(data.handles.start.x)) * columnPixelSpacing, y: (Math.ceil(data.handles.middle.y) - Math.ceil(data.handles.start.y)) * rowPixelSpacing\r\n            };\r\n\r\n            var sideB = {\r\n                x: (Math.ceil(data.handles.end.x) - Math.ceil(data.handles.middle.x)) * columnPixelSpacing, y: (Math.ceil(data.handles.end.y) - Math.ceil(data.handles.middle.y)) * rowPixelSpacing\r\n            };\r\n\r\n            var sideC = {\r\n                x: (Math.ceil(data.handles.end.x) - Math.ceil(data.handles.start.x)) * columnPixelSpacing, y: (Math.ceil(data.handles.end.y) - Math.ceil(data.handles.start.y)) * rowPixelSpacing\r\n            };\r\n\r\n            var sideALength = length(sideA);\r\n            var sideBLength = length(sideB);\r\n            var sideCLength = length(sideC);\r\n\r\n            // Cosine law\r\n            var angle = Math.acos((Math.pow(sideALength, 2) + Math.pow(sideBLength, 2) - Math.pow(sideCLength, 2)) / (2 * sideALength * sideBLength));\r\n            angle = angle * (180 / Math.PI);\r\n\r\n            var rAngle = cornerstoneTools.roundToDecimal(angle, 2);\r\n\r\n            if (rAngle) {\r\n                var str = '00B0'; // degrees symbol\r\n                var text = rAngle.toString() + String.fromCharCode(parseInt(str, 16)) + suffix;\r\n                \r\n                var distance = 15;\r\n\r\n                var textX = handleMiddleCanvas.x + distance;\r\n                var textY = handleMiddleCanvas.y + distance;\r\n\r\n                context.font = font;\r\n                var textWidth = context.measureText(text).width;\r\n\r\n                if ((handleMiddleCanvas.x - handleStartCanvas.x) < 0) {\r\n                    textX = handleMiddleCanvas.x - distance - textWidth - 10;\r\n                } else {\r\n                    textX = handleMiddleCanvas.x + distance;\r\n                }\r\n\r\n                textY = handleMiddleCanvas.y;\r\n                cornerstoneTools.drawTextBox(context, text, textX, textY, color);\r\n            }\r\n\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function addNewMeasurement(mouseEventData) {\r\n        var measurementData = createNewMeasurement(mouseEventData);\r\n        var element = mouseEventData.element;\r\n\r\n        var eventData = {\r\n            mouseButtonMask: mouseEventData.which,\r\n        };\r\n\r\n        // associate this data with this imageId so we can render it and manipulate it\r\n        cornerstoneTools.addToolState(element, toolType, measurementData);\r\n\r\n        // since we are dragging to another place to drop the end point, we can just activate\r\n        // the end point and let the moveHandle move it for us.\r\n        $(element).off('CornerstoneToolsMouseMove', cornerstoneTools.simpleAngle.mouseMoveCallback);\r\n        $(element).off('CornerstoneToolsMouseDrag', cornerstoneTools.simpleAngle.mouseMoveCallback);\r\n        $(element).off('CornerstoneToolsMouseDown', cornerstoneTools.simpleAngle.mouseDownCallback);\r\n        $(element).off('CornerstoneToolsMouseDownActivate', cornerstoneTools.simpleAngle.mouseDownActivateCallback);\r\n        cornerstone.updateImage(element);\r\n\r\n        cornerstoneTools.moveNewHandle(mouseEventData, measurementData.handles.middle, function() {\r\n            measurementData.active = false;\r\n            if (cornerstoneTools.anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\r\n                // delete the measurement\r\n                cornerstoneTools.removeToolState(element, toolType, measurementData);\r\n            }\r\n\r\n            measurementData.handles.end.active = true;\r\n            cornerstone.updateImage(element);\r\n\r\n            cornerstoneTools.moveNewHandle(mouseEventData, measurementData.handles.end, function() {\r\n                measurementData.active = false;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(element, toolType, measurementData);\r\n                }\r\n\r\n                $(element).on('CornerstoneToolsMouseMove', cornerstoneTools.simpleAngle.mouseMoveCallback);\r\n                $(element).on('CornerstoneToolsMouseDrag', cornerstoneTools.simpleAngle.mouseMoveCallback);\r\n                $(element).on('CornerstoneToolsMouseDown', eventData, cornerstoneTools.simpleAngle.mouseDownCallback);\r\n                $(element).on('CornerstoneToolsMouseDownActivate', eventData, cornerstoneTools.simpleAngle.mouseDownActivateCallback);\r\n                cornerstone.updateImage(element);\r\n            });\r\n        });\r\n    }\r\n\r\n    function addNewMeasurementTouch(touchEventData) {\r\n        var measurementData = createNewMeasurement(touchEventData);\r\n        var element = touchEventData.element;\r\n\r\n        // associate this data with this imageId so we can render it and manipulate it\r\n        cornerstoneTools.addToolState(element, toolType, measurementData);\r\n\r\n        // since we are dragging to another place to drop the end point, we can just activate\r\n        // the end point and let the moveHandle move it for us.\r\n        $(element).off('CornerstoneToolsTouchDrag', cornerstoneTools.simpleAngleTouch.touchMoveCallback);\r\n        $(element).off('CornerstoneToolsDragStartActive', cornerstoneTools.simpleAngleTouch.touchDownActivateCallback);\r\n        $(element).off('CornerstoneToolsTap', cornerstoneTools.simpleAngleTouch.tapCallback);\r\n        cornerstone.updateImage(element);\r\n\r\n        cornerstoneTools.moveNewHandleTouch(touchEventData, measurementData.handles.middle, function() {\r\n            measurementData.active = false;\r\n            if (cornerstoneTools.anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\r\n                // delete the measurement\r\n                cornerstoneTools.removeToolState(element, toolType, measurementData);\r\n            }\r\n\r\n            measurementData.handles.end.active = true;\r\n            cornerstone.updateImage(element);\r\n\r\n            cornerstoneTools.moveNewHandleTouch(touchEventData, measurementData.handles.end, function() {\r\n                measurementData.active = false;\r\n                if (cornerstoneTools.anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\r\n                    // delete the measurement\r\n                    cornerstoneTools.removeToolState(element, toolType, measurementData);\r\n                }\r\n\r\n                $(element).on('CornerstoneToolsTouchDrag', cornerstoneTools.simpleAngleTouch.touchMoveCallback);\r\n                $(element).on('CornerstoneToolsDragStartActive', cornerstoneTools.simpleAngleTouch.touchDownActivateCallback);\r\n                $(element).on('CornerstoneToolsTap', cornerstoneTools.simpleAngleTouch.tapCallback);\r\n                cornerstone.updateImage(element);\r\n            });\r\n        });\r\n    }\r\n\r\n    cornerstoneTools.simpleAngle = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement,\r\n        addNewMeasurement: addNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType\r\n    });\r\n\r\n    cornerstoneTools.simpleAngleTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement,\r\n        addNewMeasurement: addNewMeasurementTouch,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/simpleAngle.js\r\n\r\n// Begin Source: src/imageTools/textMarker.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'textMarker';\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        var config = cornerstoneTools.textMarker.getConfiguration();\r\n\r\n        if (!config.current) {\r\n            return;\r\n        }\r\n\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            visible: true, active: true, text: config.current, handles: {\r\n                end: {\r\n                    x: mouseEventData.currentPoints.image.x,\r\n                    y: mouseEventData.currentPoints.image.y,\r\n                    highlight: true,\r\n                    active: true\r\n                }\r\n            }\r\n        };\r\n\r\n        // Update the current marker for the next marker\r\n        var currentIndex = config.markers.indexOf(config.current);\r\n        if (config.ascending) {\r\n            currentIndex += 1;\r\n            if (currentIndex >= config.markers.length) {\r\n                if (!config.loop) {\r\n                    currentIndex = -1;\r\n                } else {\r\n                    currentIndex -= config.markers.length;\r\n                }\r\n            }\r\n        } else {\r\n            currentIndex -= 1;\r\n            if (currentIndex < 0) {\r\n                if (!config.loop) {\r\n                    currentIndex = -1;\r\n                } else {\r\n                    currentIndex += config.markers.length;\r\n                }\r\n            }\r\n        }\r\n\r\n        config.current = config.markers[currentIndex];\r\n\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n    function pointNearTool(element, data, coords) {\r\n        var endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\r\n\r\n        var rect = {\r\n            left: endCanvas.x - data.textWidth / 2,\r\n            top: endCanvas.y,\r\n            width: data.textWidth,\r\n            height: data.textHeight\r\n        };\r\n\r\n        var distanceToPoint = cornerstoneMath.rect.distanceToPoint(rect, coords);\r\n        return (distanceToPoint < 10);\r\n    }\r\n\r\n    function onImageRendered(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (!toolData) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        var font = cornerstoneTools.textStyle.getFont();\r\n        var fontSize = cornerstoneTools.textStyle.getFontSize();\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            var data = toolData.data[i];\r\n\r\n            var color = cornerstoneTools.toolColors.getToolColor();\r\n            if (data.active) {\r\n                color = cornerstoneTools.toolColors.getActiveColor();\r\n            }\r\n\r\n            context.save();\r\n\r\n            // Draw text\r\n            context.font = font;\r\n            context.fillStyle = color;\r\n\r\n            var measureText = context.measureText(data.text);\r\n            data.textWidth = measureText.width;\r\n            data.textHeight = fontSize;\r\n\r\n            var coords = {\r\n                x: data.handles.end.x - data.textWidth / 2,\r\n                y: data.handles.end.y\r\n            };\r\n\r\n            var textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\r\n\r\n            cornerstoneTools.drawTextBox(context, data.text, textCoords.x, textCoords.y, color);\r\n\r\n            context.restore();\r\n        }\r\n    }\r\n\r\n    function doubleClickCallback(e, eventData) {\r\n        var element = eventData.element;\r\n        var data;\r\n\r\n        function doneChangingTextCallback(data, updatedText, deleteTool) {\r\n            if (deleteTool === true) {\r\n                cornerstoneTools.removeToolState(element, toolType, data);\r\n            } else {\r\n                data.text = updatedText;\r\n            }\r\n\r\n            data.active = false;\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        if (e.data && e.data.mouseButtonMask && !cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            return false;\r\n        }\r\n\r\n        var config = cornerstoneTools.textMarker.getConfiguration();\r\n\r\n        var coords = eventData.currentPoints.canvas;\r\n        var toolData = cornerstoneTools.getToolState(element, toolType);\r\n\r\n        // now check to see if there is a handle we can move\r\n        if (!toolData) {\r\n            return false;\r\n        }\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            data = toolData.data[i];\r\n            if (pointNearTool(element, data, coords)) {\r\n                data.active = true;\r\n                cornerstone.updateImage(element);\r\n                // Allow relabelling via a callback\r\n                config.changeTextCallback(data, doneChangingTextCallback);\r\n                \r\n                e.stopImmediatePropagation();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    cornerstoneTools.textMarker = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType,\r\n        mouseDoubleClickCallback: doubleClickCallback\r\n    });\r\n\r\n    cornerstoneTools.textMarkerTouch = cornerstoneTools.touchTool({\r\n        createNewMeasurement: createNewMeasurement,\r\n        onImageRendered: onImageRendered,\r\n        pointNearTool: pointNearTool,\r\n        toolType: toolType,\r\n        pressCallback: doubleClickCallback\r\n    });\r\n\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/textMarker.js\r\n\r\n// Begin Source: src/imageTools/wwwc.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    function defaultStrategy(eventData) {\r\n        // here we normalize the ww/wc adjustments so the same number of on screen pixels\r\n        // adjusts the same percentage of the dynamic range of the image.  This is needed to\r\n        // provide consistency for the ww/wc tool regardless of the dynamic range (e.g. an 8 bit\r\n        // image will feel the same as a 16 bit image would)\r\n        var imageDynamicRange = eventData.image.maxPixelValue - eventData.image.minPixelValue;\r\n        var multiplier = imageDynamicRange / 1024;\r\n\r\n        var deltaX = eventData.deltaPoints.page.x * multiplier;\r\n        var deltaY = eventData.deltaPoints.page.y * multiplier;\r\n\r\n        eventData.viewport.voi.windowWidth += (deltaX);\r\n        eventData.viewport.voi.windowCenter += (deltaY);\r\n    }\r\n\r\n    function mouseDragCallback(e, eventData) {\r\n        cornerstoneTools.wwwc.strategy(eventData);\r\n        cornerstone.setViewport(eventData.element, eventData.viewport);\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function touchDragCallback(e, eventData) {\r\n        var dragData = eventData;\r\n\r\n        var imageDynamicRange = dragData.image.maxPixelValue - dragData.image.minPixelValue;\r\n        var multiplier = imageDynamicRange / 1024;\r\n        var deltaX = dragData.deltaPoints.page.x * multiplier;\r\n        var deltaY = dragData.deltaPoints.page.y * multiplier;\r\n\r\n        var config = cornerstoneTools.wwwc.getConfiguration();\r\n        if (config.orientation) {\r\n            if (config.orientation === 0) {\r\n                dragData.viewport.voi.windowWidth += (deltaX);\r\n                dragData.viewport.voi.windowCenter += (deltaY);\r\n            } else {\r\n                dragData.viewport.voi.windowWidth += (deltaY);\r\n                dragData.viewport.voi.windowCenter += (deltaX);\r\n            }\r\n        } else {\r\n            dragData.viewport.voi.windowWidth += (deltaX);\r\n            dragData.viewport.voi.windowCenter += (deltaY);\r\n        }\r\n\r\n        cornerstone.setViewport(dragData.element, dragData.viewport);\r\n    }\r\n\r\n    cornerstoneTools.wwwc = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    cornerstoneTools.wwwc.strategies = {\r\n        default: defaultStrategy\r\n    };\r\n    cornerstoneTools.wwwc.strategy = defaultStrategy;\r\n    cornerstoneTools.wwwcTouchDrag = cornerstoneTools.touchDragTool(touchDragCallback);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/wwwc.js\r\n\r\n// Begin Source: src/imageTools/wwwcRegion.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'wwwcRegion';\r\n\r\n    var configuration = {\r\n        minWindowWidth: 10\r\n    };\r\n\r\n    /** Calculates the minimum, maximum, and mean value in the given pixel array */\r\n    function calculateMinMaxMean(storedPixelData, globalMin, globalMax) {\r\n        var numPixels = storedPixelData.length;\r\n\r\n        if (numPixels < 2) {\r\n            return {\r\n                min: globalMin,\r\n                max: globalMax,\r\n                mean: globalMin\r\n            };\r\n        }\r\n\r\n        var min = globalMax;\r\n        var max = globalMin;\r\n        var sum = 0;\r\n\r\n        for (var index = 0; index < numPixels; index++) {\r\n            var spv = storedPixelData[index];\r\n            min = Math.min(min, spv);\r\n            max = Math.max(max, spv);\r\n            sum += spv;\r\n        }\r\n\r\n        return {\r\n            min: min,\r\n            max: max,\r\n            mean: sum / numPixels\r\n        };\r\n    }\r\n\r\n    /* Applies the windowing procedure when the mouse drag ends */\r\n    function dragEndCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseMove', dragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', dragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', dragEndCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseClick', dragEndCallback);\r\n        \r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (!toolData) {\r\n            return;\r\n        }\r\n\r\n        if (!toolData.data.length) {\r\n            return;\r\n        }\r\n\r\n        // Update the endpoint as the mouse/touch is dragged\r\n        var endPoint = {\r\n            x: eventData.currentPoints.image.x,\r\n            y: eventData.currentPoints.image.y\r\n        };\r\n\r\n        toolData.data[0].endPoint = endPoint;\r\n\r\n        applyWWWCRegion(eventData);\r\n\r\n        var mouseData = {\r\n            mouseButtonMask: eventData.which\r\n        };\r\n\r\n        $(eventData.element).on('CornerstoneToolsMouseDown', mouseData, mouseDownCallback);\r\n    }\r\n\r\n    /** Calculates the minimum and maximum value in the given pixel array */\r\n    function applyWWWCRegion(eventData) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (!toolData.data.length) {\r\n            return;\r\n        }\r\n\r\n        var startPoint = toolData.data[0].startPoint;\r\n        var endPoint = toolData.data[0].endPoint;\r\n\r\n        // Get the rectangular region defined by the handles\r\n        var width = Math.abs(startPoint.x - endPoint.x);\r\n        var height = Math.abs(startPoint.y - endPoint.y);\r\n\r\n        var left = Math.min(startPoint.x, endPoint.x);\r\n        var top = Math.min(startPoint.y, endPoint.y);\r\n\r\n        // Bound the rectangle so we don't get undefined pixels\r\n        left = Math.max(left, 0);\r\n        left = Math.min(left, eventData.image.width);\r\n        top = Math.max(top, 0);\r\n        top = Math.min(top, eventData.image.height);\r\n        width = Math.floor(Math.min(width, Math.abs(eventData.image.width - left)));\r\n        height = Math.floor(Math.min(height, Math.abs(eventData.image.height - top)));\r\n\r\n        // Get the pixel data in the rectangular region\r\n        var pixels = cornerstone.getPixels(eventData.element, left, top, width, height);\r\n\r\n        // Calculate the minimum and maximum pixel values\r\n        var minMaxMean = calculateMinMaxMean(pixels, eventData.image.minPixelValue, eventData.image.maxPixelValue);\r\n\r\n        // Adjust the viewport window width and center based on the calculated values\r\n        var config = cornerstoneTools.wwwcRegion.getConfiguration();\r\n        var viewport = cornerstone.getViewport(eventData.element);\r\n        viewport.voi.windowWidth = Math.max(Math.abs(minMaxMean.max - minMaxMean.min), config.minWindowWidth);\r\n        viewport.voi.windowCenter = minMaxMean.mean;\r\n        cornerstone.setViewport(eventData.element, viewport);\r\n\r\n        // Clear the toolData\r\n        toolData.data = [];\r\n\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function whichMovement(e, eventData) {\r\n        var element = eventData.element;\r\n\r\n        $(element).off('CornerstoneToolsMouseMove');\r\n        $(element).off('CornerstoneToolsMouseDrag');\r\n\r\n        $(element).on('CornerstoneToolsMouseMove', dragCallback);\r\n        $(element).on('CornerstoneToolsMouseDrag', dragCallback);\r\n\r\n        $(element).on('CornerstoneToolsMouseClick', dragEndCallback);\r\n        if (e.type === 'CornerstoneToolsMouseDrag') {\r\n            $(element).on('CornerstoneToolsMouseUp', dragEndCallback);\r\n        }\r\n    }\r\n\r\n    /** Records the start point and attaches the drag event handler */\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', eventData, whichMovement);\r\n            $(eventData.element).on('CornerstoneToolsMouseMove', eventData, whichMovement);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', dragEndCallback);\r\n\r\n            $(eventData.element).off('CornerstoneToolsMouseDown');\r\n            recordStartPoint(eventData);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /** Records the start point of the click or touch */\r\n    function recordStartPoint(eventData) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData && toolData.data) {\r\n            toolData.data = [];\r\n        }\r\n\r\n        var measurementData = {\r\n            startPoint: {\r\n                x: eventData.currentPoints.image.x,\r\n                y: eventData.currentPoints.image.y\r\n            }\r\n        };\r\n\r\n        cornerstoneTools.addToolState(eventData.element, toolType, measurementData);\r\n    }\r\n\r\n    /** Draws the rectangular region while the touch or mouse event drag occurs */\r\n    function dragCallback(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (!toolData.data.length) {\r\n            return;\r\n        }\r\n\r\n        // Update the endpoint as the mouse/touch is dragged\r\n        var endPoint = {\r\n            x: eventData.currentPoints.image.x,\r\n            y: eventData.currentPoints.image.y\r\n        };\r\n\r\n        toolData.data[0].endPoint = endPoint;\r\n        cornerstone.updateImage(eventData.element);\r\n    }\r\n\r\n    function onImageRendered(e, eventData) {\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (!toolData.data.length) {\r\n            return;\r\n        }\r\n\r\n        var startPoint = toolData.data[0].startPoint;\r\n        var endPoint = toolData.data[0].endPoint;\r\n\r\n        if (!startPoint) {\r\n            return;\r\n        }\r\n\r\n        // Get the current element's canvas\r\n        var canvas = $(eventData.element).find('canvas').get(0);\r\n        var context = canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        // Set to the active tool color\r\n        var color = cornerstoneTools.toolColors.getActiveColor();\r\n        \r\n        // Calculate the rectangle parameters\r\n        var startPointCanvas = cornerstone.pixelToCanvas(eventData.element, startPoint);\r\n        var endPointCanvas = cornerstone.pixelToCanvas(eventData.element, endPoint);\r\n\r\n        var left = Math.min(startPointCanvas.x, endPointCanvas.x);\r\n        var top = Math.min(startPointCanvas.y, endPointCanvas.y);\r\n        var width = Math.abs(startPointCanvas.x - endPointCanvas.x);\r\n        var height = Math.abs(startPointCanvas.y - endPointCanvas.y);\r\n\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n\r\n        // Draw the rectangle\r\n        context.save();\r\n\r\n        context.beginPath();\r\n        context.strokeStyle = color;\r\n        context.lineWidth = lineWidth;\r\n        context.rect(left, top, width, height);\r\n        context.stroke();\r\n\r\n        context.restore();\r\n    }\r\n\r\n    // --- Mouse tool enable / disable --- ///\r\n    function disable(element) {\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    function activate(element, mouseButtonMask) {\r\n        var eventData = {\r\n            mouseButtonMask: mouseButtonMask,\r\n        };\r\n\r\n        var toolData = cornerstoneTools.getToolState(element, toolType);\r\n        if (!toolData) {\r\n            var data = [];\r\n            cornerstoneTools.addToolState(element, toolType, data);\r\n        }\r\n\r\n        $(element).off('CornerstoneToolsMouseDown', mouseDownCallback);\r\n        $(element).off('CornerstoneToolsMouseUp', dragEndCallback);\r\n        $(element).off('CornerstoneToolsMouseDrag', dragCallback);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n\r\n        $(element).on('CornerstoneToolsMouseDown', eventData, mouseDownCallback);\r\n        $(element).on('CornerstoneImageRendered', onImageRendered);\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // --- Touch tool enable / disable --- //\r\n    function disableTouchDrag(element) {\r\n        $(element).off('CornerstoneToolsTouchDrag', dragCallback);\r\n        $(element).off('CornerstoneToolsDragStart', recordStartPoint);\r\n        $(element).off('CornerstoneToolsDragEnd', applyWWWCRegion);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n    }\r\n\r\n    function activateTouchDrag(element) {\r\n        var toolData = cornerstoneTools.getToolState(element, toolType);\r\n        if (toolData === undefined) {\r\n            var data = [];\r\n            cornerstoneTools.addToolState(element, toolType, data);\r\n        }\r\n\r\n        $(element).off('CornerstoneToolsTouchDrag', dragCallback);\r\n        $(element).off('CornerstoneToolsDragStart', recordStartPoint);\r\n        $(element).off('CornerstoneToolsDragEnd', applyWWWCRegion);\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n\r\n        $(element).on('CornerstoneToolsTouchDrag', dragCallback);\r\n        $(element).on('CornerstoneToolsDragStart', recordStartPoint);\r\n        $(element).on('CornerstoneToolsDragEnd', applyWWWCRegion);\r\n        $(element).on('CornerstoneImageRendered', onImageRendered);\r\n    }\r\n\r\n    function getConfiguration() {\r\n        return configuration;\r\n    }\r\n\r\n    function setConfiguration(config) {\r\n        configuration = config;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.wwwcRegion = {\r\n        activate: activate,\r\n        deactivate: disable,\r\n        disable: disable,\r\n        setConfiguration: setConfiguration,\r\n        getConfiguration: getConfiguration\r\n    };\r\n\r\n    cornerstoneTools.wwwcRegionTouch = {\r\n        activate: activateTouchDrag,\r\n        deactivate: disableTouchDrag,\r\n        disable: disableTouchDrag\r\n    };\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/wwwcRegion.js\r\n\r\n// Begin Source: src/imageTools/zoom.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var startPoints;\r\n\r\n    function changeViewportScale(viewport, ticks) {\r\n        var config = cornerstoneTools.zoom.getConfiguration();\r\n        var pow = 1.7;\r\n        \r\n        var oldFactor = Math.log(viewport.scale) / Math.log(pow);\r\n        var factor = oldFactor + ticks;\r\n        \r\n        var scale = Math.pow(pow, factor);\r\n        viewport.scale = scale;\r\n        \r\n        if (config.maxScale && scale > config.maxScale) {\r\n            viewport.scale = config.maxScale;\r\n        } else if (config.minScale && scale < config.minScale) {\r\n            viewport.scale = config.minScale;\r\n        }\r\n\r\n        return viewport;\r\n    }\r\n\r\n    function boundPosition(position, width, height) {\r\n        position.x = Math.max(position.x, 0);\r\n        position.y = Math.max(position.y, 0);\r\n        position.x = Math.min(position.x, width);\r\n        position.y = Math.min(position.y, height);\r\n        return position;\r\n    }\r\n\r\n    function correctShift(shift, viewport) {\r\n        // Apply rotations\r\n        if (viewport.rotation !== 0) {\r\n            var angle = viewport.rotation * Math.PI / 180;\r\n    \r\n            var cosA = Math.cos(angle);\r\n            var sinA = Math.sin(angle);\r\n    \r\n            var newX = shift.x * cosA - shift.y * sinA;\r\n            var newY = shift.x * sinA + shift.y * cosA;\r\n\r\n            shift.x = newX;\r\n            shift.y = newY;\r\n        }\r\n\r\n        // Apply Flips        \r\n        if (viewport.hflip) {\r\n            shift.x *= -1;\r\n        }\r\n\r\n        if (viewport.vflip) {\r\n            shift.y *= -1;\r\n        }\r\n\r\n        return shift;\r\n    }\r\n\r\n    function defaultStrategy(eventData, ticks) {\r\n        var element = eventData.element;\r\n\r\n        // Calculate the new scale factor based on how far the mouse has changed\r\n        var viewport = changeViewportScale(eventData.viewport, ticks);\r\n        cornerstone.setViewport(element, viewport);\r\n\r\n        // Now that the scale has been updated, determine the offset we need to apply to the center so we can\r\n        // keep the original start location in the same position\r\n        var newCoords = cornerstone.pageToPixel(element, eventData.startPoints.page.x, eventData.startPoints.page.y);\r\n        var shift = {\r\n            x: eventData.startPoints.image.x - newCoords.x,\r\n            y: eventData.startPoints.image.y - newCoords.y\r\n        };\r\n\r\n        shift = correctShift(shift, viewport);\r\n        viewport.translation.x -= shift.x;\r\n        viewport.translation.y -= shift.y;\r\n        cornerstone.setViewport(element, viewport);\r\n    }\r\n\r\n    function translateStrategy(eventData, ticks) {\r\n        var element = eventData.element;\r\n        var image = eventData.image;\r\n\r\n        // Calculate the new scale factor based on how far the mouse has changed\r\n        var viewport = changeViewportScale(eventData.viewport, ticks);\r\n        cornerstone.setViewport(element, viewport);\r\n\r\n        var config = cornerstoneTools.zoom.getConfiguration();\r\n        var shift,\r\n            newCoords;\r\n\r\n        var outwardsTranslateSpeed = 8;\r\n        var inwardsTranslateSpeed = 8;\r\n        var outwardsMinScaleToTranslate = 3;\r\n        var minTranslation = 0.01;\r\n\r\n        if (ticks < 0) {\r\n            // Zoom outwards from the image center\r\n            shift = {\r\n                x: viewport.scale < outwardsMinScaleToTranslate ? viewport.translation.x / outwardsTranslateSpeed : 0,\r\n                y: viewport.scale < outwardsMinScaleToTranslate ? viewport.translation.y / outwardsTranslateSpeed : 0\r\n            };\r\n            \r\n            if (Math.abs(viewport.translation.x) < minTranslation) {\r\n                viewport.translation.x = 0;\r\n                shift.x = 0;\r\n            } else if (Math.abs(viewport.translation.y) < minTranslation) {\r\n                viewport.translation.y = 0;\r\n                shift.y = 0;\r\n            } else if (Math.abs(viewport.translation.x) < minTranslation &&\r\n                       Math.abs(viewport.translation.y) < minTranslation) {\r\n                cornerstone.setViewport(element, viewport);\r\n                return false;\r\n            }\r\n        } else {\r\n            newCoords = cornerstone.pageToPixel(element, startPoints.page.x, startPoints.page.y);\r\n            if (config && config.preventZoomOutsideImage) {\r\n                startPoints.image = boundPosition(startPoints.image, image.width, image.height);\r\n                newCoords = boundPosition(newCoords, image.width, image.height);\r\n            }\r\n            // Zoom inwards to the current image point\r\n            var desiredTranslation = {\r\n                x: image.width / 2 - startPoints.image.x,\r\n                y: image.height / 2 - startPoints.image.y\r\n            };\r\n\r\n            var distanceToDesired = {\r\n                x: viewport.translation.x - desiredTranslation.x,\r\n                y: viewport.translation.y - desiredTranslation.y\r\n            };\r\n\r\n            shift = {\r\n                x: distanceToDesired.x / inwardsTranslateSpeed,\r\n                y: distanceToDesired.y / inwardsTranslateSpeed\r\n            };\r\n\r\n            if (Math.abs(distanceToDesired.x) < minTranslation) {\r\n                viewport.translation.x = desiredTranslation.x;\r\n                shift.x = 0;\r\n            } else if (Math.abs(distanceToDesired.y) < minTranslation) {\r\n                viewport.translation.y = desiredTranslation.y;\r\n                shift.y = 0;\r\n            } else if (Math.abs(distanceToDesired.x) < minTranslation &&\r\n                       Math.abs(distanceToDesired.y) < minTranslation) {\r\n                cornerstone.setViewport(element, viewport);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        shift = correctShift(shift, viewport);\r\n        if (!shift.x && !shift.y) {\r\n            return false;\r\n        }\r\n\r\n        viewport.translation.x -= shift.x;\r\n        viewport.translation.y -= shift.y;\r\n        cornerstone.setViewport(element, viewport);\r\n    }\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', dragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n            startPoints = eventData.startPoints; // Used for translateStrategy\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', dragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n    }\r\n\r\n    function dragCallback(e, eventData) {\r\n        if (!eventData.deltaPoints.page.y) {\r\n            return false;\r\n        }\r\n\r\n        var ticks = eventData.deltaPoints.page.y / 100;\r\n        cornerstoneTools.zoom.strategy(eventData, ticks);\r\n        return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function mouseWheelCallback(e, eventData) {\r\n        var ticks = -eventData.direction / 4;\r\n        var viewport = changeViewportScale(eventData.viewport, ticks);\r\n        cornerstone.setViewport(eventData.element, viewport);\r\n    }\r\n\r\n    function touchPinchCallback(e, eventData) {\r\n        var ticks = eventData.direction / 4;\r\n        var viewport = changeViewportScale(eventData.viewport, ticks);\r\n        cornerstone.setViewport(eventData.element, viewport);\r\n    }\r\n\r\n    cornerstoneTools.zoom = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    cornerstoneTools.zoom.strategies = {\r\n        default: defaultStrategy,\r\n        translate: translateStrategy\r\n    };\r\n    cornerstoneTools.zoom.strategy = defaultStrategy;\r\n\r\n    cornerstoneTools.zoomWheel = cornerstoneTools.mouseWheelTool(mouseWheelCallback);\r\n    cornerstoneTools.zoomTouchPinch = cornerstoneTools.touchPinchTool(touchPinchCallback);\r\n    cornerstoneTools.zoomTouchDrag = cornerstoneTools.touchDragTool(dragCallback);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/imageTools/zoom.js\r\n\r\n// Begin Source: src/inputSources/keyboardInput.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var mouseX, mouseY;\r\n\r\n    function keyPress(e) {\r\n        var element = e.currentTarget;\r\n        var startingCoords = cornerstone.pageToPixel(element, mouseX, mouseY);\r\n\r\n        e = window.event || e; // old IE support\r\n\r\n        var keyPressData = {\r\n            element: element, viewport: cornerstone.getViewport(element), image: cornerstone.getEnabledElement(element).image, pageX: mouseX, pageY: mouseY, imageX: startingCoords.x, imageY: startingCoords.y, keyCode: e.keyCode, which: e.which\r\n        };\r\n\r\n        if (e.type === 'keydown') {\r\n            $(element).trigger('CornerstoneToolsKeyDown', keyPressData);\r\n        } else if (e.type === 'keypress') {\r\n            $(element).trigger('CornerstoneToolsKeyPress', keyPressData);\r\n        } else if (e.type === 'keyup') {\r\n            $(element).trigger('CornerstoneToolsKeyUp', keyPressData);\r\n        }\r\n    }\r\n\r\n    function mouseMove(e) {\r\n        mouseX = e.pageX || e.originalEvent.pageX;\r\n        mouseY = e.pageY || e.originalEvent.pageY;\r\n    }\r\n\r\n    var keyboardEvent = 'keydown keypress keyup';\r\n\r\n    function enable(element) {\r\n        $(element).bind(keyboardEvent, keyPress);\r\n        $(element).on('mousemove', mouseMove);\r\n    }\r\n\r\n    function disable(element) {\r\n        $(element).unbind(keyboardEvent, keyPress);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.keyboardInput = {\r\n        enable: enable, disable: disable\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/inputSources/keyboardInput.js\r\n\r\n// Begin Source: src/inputSources/preventGhostClick.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // Functions to prevent ghost clicks following a touch\r\n    // All credit to @kosich\r\n    // https://gist.github.com/kosich/23188dd86633b6c2efb7\r\n\r\n    var antiGhostDelay = 2000;\r\n\r\n    var pointerType = {\r\n        mouse: 0,\r\n        touch: 1\r\n    };\r\n\r\n    function preventGhostClick(element) {\r\n        var lastInteractionType,\r\n            lastInteractionTime;\r\n\r\n        function handleTap(type, e) {\r\n            var now = Date.now();\r\n            if (type !== lastInteractionType) {\r\n                if (now - lastInteractionTime <= antiGhostDelay) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    e.stopImmediatePropagation();\r\n                    return false;\r\n                }\r\n\r\n                lastInteractionType = type;\r\n            }\r\n\r\n            lastInteractionTime = now;\r\n        }\r\n\r\n        function attachEvents(eventList, interactionType) {\r\n            eventList.forEach(function(eventName) {\r\n                element.addEventListener(eventName, handleTap.bind(null, interactionType), true);\r\n            });\r\n        }\r\n\r\n        var mouseEvents = [ 'mousedown', 'mouseup', 'mousemove' ];\r\n        var touchEvents = [ 'touchstart', 'touchend' ];\r\n\r\n        attachEvents(mouseEvents, pointerType.mouse);\r\n        attachEvents(touchEvents, pointerType.touch);\r\n    }\r\n\r\n    cornerstoneTools.preventGhostClick = preventGhostClick;\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/inputSources/preventGhostClick.js\r\n\r\n// Begin Source: src/manipulators/anyHandlesOutsideImage.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function anyHandlesOutsideImage(renderData, handles) {\r\n        var image = renderData.image;\r\n        var imageRect = {\r\n            left: 0,\r\n            top: 0,\r\n            width: image.width,\r\n            height: image.height\r\n        };\r\n\r\n        var handleOutsideImage = false;\r\n\r\n        Object.keys(handles).forEach(function(name) {\r\n            var handle = handles[name];\r\n            if (cornerstoneMath.point.insideRect(handle, imageRect) === false) {\r\n                handleOutsideImage = true;\r\n            }\r\n        });\r\n\r\n        return handleOutsideImage;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.anyHandlesOutsideImage = anyHandlesOutsideImage;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/anyHandlesOutsideImage.js\r\n\r\n// Begin Source: src/manipulators/drawHandles.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var handleRadius = 6;\r\n\r\n    function drawHandles(context, renderData, handles, color, fill) {\r\n        context.strokeStyle = color;\r\n\r\n        Object.keys(handles).forEach(function(name) {\r\n            var handle = handles[name];\r\n            context.beginPath();\r\n\r\n            if (handle.active) {\r\n                context.lineWidth = cornerstoneTools.toolStyle.getActiveWidth();\r\n            } else {\r\n                context.lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n            }\r\n\r\n            var handleCanvasCoords = cornerstone.pixelToCanvas(renderData.element, handle);\r\n            context.arc(handleCanvasCoords.x, handleCanvasCoords.y, handleRadius, 0, 2 * Math.PI);\r\n\r\n            if (fill) {\r\n                context.fillStyle = fill;\r\n                context.fill();\r\n            }\r\n\r\n            context.stroke();\r\n        });\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.drawHandles = drawHandles;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/drawHandles.js\r\n\r\n// Begin Source: src/manipulators/getHandleNearImagePoint.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function getHandleNearImagePoint(element, data, coords, distanceSq) {\r\n        var nearbyHandle;\r\n        \r\n        if (!data.handles) {\r\n            return;\r\n        }\r\n\r\n        Object.keys(data.handles).forEach(function(name) {\r\n            var handle = data.handles[name];\r\n            var handleCanvas = cornerstone.pixelToCanvas(element, handle);\r\n            var distanceSquared = cornerstoneMath.point.distanceSquared(handleCanvas, coords);\r\n            if (distanceSquared < distanceSq) {\r\n                nearbyHandle = handle;\r\n                return;\r\n            }\r\n        });\r\n        \r\n        return nearbyHandle;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.getHandleNearImagePoint = getHandleNearImagePoint;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/getHandleNearImagePoint.js\r\n\r\n// Begin Source: src/manipulators/handleActivator.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function findHandleNear(element, handles, canvasPoint) {\r\n        var nearbyHandle;\r\n\r\n        Object.keys(handles).forEach(function(name) {\r\n            var handle = handles[name];\r\n            var handleCanvas = cornerstone.pixelToCanvas(element, handle);\r\n            var distance = cornerstoneMath.point.distance(handleCanvas, canvasPoint);\r\n            if (distance <= 36) {\r\n                nearbyHandle = handle;\r\n                return;\r\n            }\r\n        });\r\n\r\n        return nearbyHandle;\r\n    }\r\n\r\n    function getActiveHandle(handles) {\r\n        var activeHandle;\r\n\r\n        Object.keys(handles).forEach(function(name) {\r\n            var handle = handles[name];\r\n            if (handle.active === true) {\r\n                activeHandle = handle;\r\n                return;\r\n            }\r\n        });\r\n\r\n        return activeHandle;\r\n    }\r\n\r\n    function handleActivator(element, handles, canvasPoint) {\r\n        var activeHandle = getActiveHandle(handles);\r\n        var nearbyHandle = findHandleNear(element, handles, canvasPoint);\r\n        if (activeHandle !== nearbyHandle) {\r\n            if (nearbyHandle !== undefined) {\r\n                nearbyHandle.active = true;\r\n            }\r\n\r\n            if (activeHandle !== undefined) {\r\n                activeHandle.active = false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.handleActivator = handleActivator;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/handleActivator.js\r\n\r\n// Begin Source: src/manipulators/handleMover.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function moveHandle(mouseEventData, handle, doneMovingCallback, preventHandleOutsideImage) {\r\n        var element = mouseEventData.element;\r\n\r\n        function mouseDragCallback(e, eventData) {\r\n            handle.active = true;\r\n            handle.x = eventData.currentPoints.image.x;\r\n            handle.y = eventData.currentPoints.image.y;\r\n            if (preventHandleOutsideImage) {\r\n                handle.x = Math.max(handle.x, 0);\r\n                handle.x = Math.min(handle.x, eventData.image.width);\r\n\r\n                handle.y = Math.max(handle.y, 0);\r\n                handle.y = Math.min(handle.y, eventData.image.height);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n\r\n        function mouseUpCallback() {\r\n            handle.active = false;\r\n            $(element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n            $(element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            cornerstone.updateImage(element);\r\n\r\n            doneMovingCallback();\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.moveHandle = moveHandle;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/handleMover.js\r\n\r\n// Begin Source: src/manipulators/handleTouchMove.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function touchMoveHandle(touchEventData, handle, doneMovingCallback) {\r\n        var element = touchEventData.element;\r\n\r\n        function touchDragCallback(e, eventData) {\r\n            handle.active = true;\r\n            var touchMoveData = eventData;\r\n            handle.x = touchMoveData.currentPoints.image.x;\r\n            handle.y = touchMoveData.currentPoints.image.y;\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsTouchDrag', touchDragCallback);\r\n\r\n        function touchEndCallback() {\r\n            handle.active = false;\r\n            $(element).off('CornerstoneToolsTouchDrag', touchDragCallback);\r\n            $(element).off('CornerstoneToolsDragEnd', touchEndCallback);\r\n            $(element).off('CornerstoneToolsTap', touchEndCallback);\r\n            cornerstone.updateImage(element);\r\n\r\n            doneMovingCallback();\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsDragEnd', touchEndCallback);\r\n        $(element).on('CornerstoneToolsTap', touchEndCallback);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.touchMoveHandle = touchMoveHandle;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/handleTouchMove.js\r\n\r\n// Begin Source: src/manipulators/moveAllHandles.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function moveAllHandles(e, data, toolData, deleteIfHandleOutsideImage, preventHandleOutsideImage) {\r\n        var mouseEventData = e;\r\n        var element = mouseEventData.element;\r\n\r\n        function mouseDragCallback(e, eventData) {\r\n            data.active = true;\r\n\r\n            Object.keys(data.handles).forEach(function(name) {\r\n                var handle = data.handles[name];\r\n                handle.x += eventData.deltaPoints.image.x;\r\n                handle.y += eventData.deltaPoints.image.y;\r\n                \r\n                if (preventHandleOutsideImage) {\r\n                    handle.x = Math.max(handle.x, 0);\r\n                    handle.x = Math.min(handle.x, eventData.image.width);\r\n\r\n                    handle.y = Math.max(handle.y, 0);\r\n                    handle.y = Math.min(handle.y, eventData.image.height);\r\n                }\r\n            });\r\n            cornerstone.updateImage(element);\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n\r\n        function mouseUpCallback(e, eventData) {\r\n            data.active = false;\r\n            data.invalidated = true;\r\n\r\n            $(element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n            $(element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n\r\n            // If any handle is outside the image, delete the tool data\r\n            if (deleteIfHandleOutsideImage === true) {\r\n                var image = eventData.image;\r\n                var handleOutsideImage = false;\r\n                var rect = {\r\n                    top: 0, left: 0, width: image.width, height: image.height\r\n                };\r\n                \r\n                Object.keys(data.handles).forEach(function(name) {\r\n                    var handle = data.handles[name];\r\n                    handle.active = false;\r\n                    if (cornerstoneMath.point.insideRect(handle, rect) === false) {\r\n                        handleOutsideImage = true;\r\n                        return;\r\n                    }\r\n                });\r\n\r\n                if (handleOutsideImage) {\r\n                    // find this tool data\r\n                    var indexOfData = -1;\r\n                    toolData.data.forEach(function(thisToolData, index) {\r\n                        if (thisToolData === data) {\r\n                            indexOfData = index;\r\n                            return;\r\n                        }\r\n                    });\r\n\r\n                    if (indexOfData !== -1) {\r\n                        toolData.data.splice(indexOfData, 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n        return true;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.moveAllHandles = moveAllHandles;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/moveAllHandles.js\r\n\r\n// Begin Source: src/manipulators/moveNewHandle.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function moveNewHandle(mouseEventData, handle, doneMoveCallback, preventHandleOutsideImage) {\r\n        var element = mouseEventData.element;\r\n\r\n        function moveCallback(e, eventData) {\r\n            handle.active = true;\r\n            handle.x = eventData.currentPoints.image.x;\r\n            handle.y = eventData.currentPoints.image.y;\r\n            \r\n            if (preventHandleOutsideImage) {\r\n                handle.x = Math.max(handle.x, 0);\r\n                handle.x = Math.min(handle.x, eventData.image.width);\r\n\r\n                handle.y = Math.max(handle.y, 0);\r\n                handle.y = Math.min(handle.y, eventData.image.height);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        function whichMovement(e) {\r\n            $(element).off('CornerstoneToolsMouseMove');\r\n            $(element).off('CornerstoneToolsMouseDrag');\r\n\r\n            $(element).on('CornerstoneToolsMouseMove', moveCallback);\r\n            $(element).on('CornerstoneToolsMouseDrag', moveCallback);\r\n            \r\n            $(element).on('CornerstoneToolsMouseClick', moveEndCallback);\r\n            if (e.type === 'CornerstoneToolsMouseDrag') {\r\n                $(element).on('CornerstoneToolsMouseUp', moveEndCallback);\r\n            }\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsMouseDrag', whichMovement);\r\n        $(element).on('CornerstoneToolsMouseMove', whichMovement);\r\n        \r\n        function moveEndCallback() {\r\n            $(element).off('CornerstoneToolsMouseMove', moveCallback);\r\n            $(element).off('CornerstoneToolsMouseDrag', moveCallback);\r\n            $(element).off('CornerstoneToolsMouseClick', moveEndCallback);\r\n            $(element).off('CornerstoneToolsMouseUp', moveEndCallback);\r\n\r\n            handle.active = false;\r\n            cornerstone.updateImage(element);\r\n\r\n            doneMoveCallback();\r\n        }\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.moveNewHandle = moveNewHandle;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/moveNewHandle.js\r\n\r\n// Begin Source: src/manipulators/moveNewHandleTouch.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function moveNewHandleTouch(eventData, handle, doneMoveCallback, preventHandleOutsideImage) {\r\n        var element = eventData.element;\r\n\r\n        function moveCallback(e, eventData) {\r\n            handle.active = true;\r\n            handle.x = eventData.currentPoints.image.x;\r\n            handle.y = eventData.currentPoints.image.y;\r\n            \r\n            if (preventHandleOutsideImage) {\r\n                handle.x = Math.max(handle.x, 0);\r\n                handle.x = Math.min(handle.x, eventData.image.width);\r\n\r\n                handle.y = Math.max(handle.y, 0);\r\n                handle.y = Math.min(handle.y, eventData.image.height);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n        }\r\n        \r\n        function moveEndCallback(e, eventData) {\r\n            $(element).off('CornerstoneToolsTouchDrag', moveCallback);\r\n            $(element).off('CornerstoneToolsTap', moveEndCallback);\r\n            $(element).off('CornerstoneToolsDragEnd', moveEndCallback);\r\n\r\n            handle.active = false;\r\n            handle.x = eventData.currentPoints.image.x;\r\n            handle.y = eventData.currentPoints.image.y;\r\n            \r\n            if (preventHandleOutsideImage) {\r\n                handle.x = Math.max(handle.x, 0);\r\n                handle.x = Math.min(handle.x, eventData.image.width);\r\n\r\n                handle.y = Math.max(handle.y, 0);\r\n                handle.y = Math.min(handle.y, eventData.image.height);\r\n            }\r\n\r\n            cornerstone.updateImage(element);\r\n\r\n            doneMoveCallback();\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsTouchDrag', moveCallback);\r\n        $(element).on('CornerstoneToolsDragEnd', moveEndCallback);\r\n        $(element).on('CornerstoneToolsTap', moveEndCallback);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.moveNewHandleTouch = moveNewHandleTouch;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/moveNewHandleTouch.js\r\n\r\n// Begin Source: src/manipulators/touchmoveAllHandles.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function touchMoveAllHandles(touchEventData, data, toolData, deleteIfHandleOutsideImage, doneMovingCallback) {\r\n        var element = touchEventData.element;\r\n\r\n        function touchDragCallback(e, eventData) {\r\n            data.active = true;\r\n            \r\n            Object.keys(data.handles).forEach(function(name) {\r\n                var handle = data.handles[name];\r\n                handle.x += eventData.deltaPoints.image.x;\r\n                handle.y += eventData.deltaPoints.image.y;\r\n            });\r\n            cornerstone.updateImage(element);\r\n            return false; // false = causes jquery to preventDefault() and stopPropagation() this event\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsTouchDrag', touchDragCallback);\r\n\r\n        function touchEndCallback(e, eventData) {\r\n            data.active = false;\r\n            data.invalidated = false;\r\n\r\n            $(element).off('CornerstoneToolsTouchDrag', touchDragCallback);\r\n            $(element).off('CornerstoneToolsDragEnd', touchEndCallback);\r\n            $(element).off('CornerstoneToolsTap', touchEndCallback);\r\n\r\n            // If any handle is outside the image, delete the tool data\r\n            if (deleteIfHandleOutsideImage === true) {\r\n                var image = eventData.image;\r\n                var handleOutsideImage = false;\r\n                var rect = {\r\n                    top: 0, left: 0, width: image.width, height: image.height\r\n                };\r\n                \r\n                Object.keys(data.handles).forEach(function(name) {\r\n                    var handle = data.handles[name];\r\n                    if (cornerstoneMath.point.insideRect(handle, rect) === false) {\r\n                        handleOutsideImage = true;\r\n                        return;\r\n                    }\r\n                });\r\n\r\n                if (handleOutsideImage) {\r\n                    // find this tool data\r\n                    var indexOfData = -1;\r\n                    for (var i = 0; i < toolData.data.length; i++) {\r\n                        if (toolData.data[i] === data) {\r\n                            indexOfData = i;\r\n                        }\r\n                    }\r\n\r\n                    if (indexOfData !== -1) {\r\n                        toolData.data.splice(indexOfData, 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            doneMovingCallback();\r\n            cornerstone.updateImage(element);\r\n        }\r\n\r\n        $(element).on('CornerstoneToolsDragEnd', touchEndCallback);\r\n        $(element).on('CornerstoneToolsTap', touchEndCallback);\r\n        return true;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.touchMoveAllHandles = touchMoveAllHandles;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/manipulators/touchmoveAllHandles.js\r\n\r\n// Begin Source: src/measurementManager/lineSample.js\r\n(function($, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This object manages a collection of measurements\r\n    function LineSampleMeasurement() {\r\n\r\n        var that = this;\r\n        that.samples = [];\r\n\r\n        // adds an element as both a source and a target\r\n        this.set = function(samples) {\r\n            that.samples = samples;\r\n            // fire event\r\n            $(that).trigger('CornerstoneLineSampleUpdated');\r\n        };\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.LineSampleMeasurement = LineSampleMeasurement;\r\n\r\n})($, cornerstoneTools);\r\n \r\n// End Source; src/measurementManager/lineSample.js\r\n\r\n// Begin Source: src/measurementManager/measurementManager.js\r\n(function($, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This object manages a collection of measurements\r\n    function MeasurementManager() {\r\n\r\n        var that = this;\r\n        that.measurements = [];\r\n\r\n        // adds an element as both a source and a target\r\n        this.add = function(measurement) {\r\n            var index = that.measurements.push(measurement);\r\n            // fire event\r\n            var eventDetail = {\r\n                index: index, measurement: measurement\r\n            };\r\n            $(that).trigger('CornerstoneMeasurementAdded', eventDetail);\r\n        };\r\n\r\n        this.remove = function(index) {\r\n            var measurement = that.measurements[index];\r\n            that.measurements.splice(index, 1);\r\n            // fire event\r\n            var eventDetail = {\r\n                index: index, measurement: measurement\r\n            };\r\n            $(that).trigger('CornerstoneMeasurementRemoved', eventDetail);\r\n        };\r\n\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.MeasurementManager = new MeasurementManager();\r\n\r\n})($, cornerstoneTools);\r\n \r\n// End Source; src/measurementManager/measurementManager.js\r\n\r\n// Begin Source: src/metaData.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // this module defines a way for tools to access various metadata about an imageId.  This layer of abstraction exists\r\n    // so metadata can be provided to the tools in different ways (e.g. by parsing DICOM P10 or by a WADO-RS document)\r\n    // NOTE: We may want to push this function down into the cornerstone core library, not sure yet...\r\n\r\n    var providers = [];\r\n\r\n    function addProvider( provider) {\r\n        providers.push(provider);\r\n    }\r\n\r\n    function removeProvider( provider) {\r\n        var index = providers.indexOf(provider);\r\n        if (index === -1) {\r\n            return;\r\n        }\r\n\r\n        providers.splice(index, 1);\r\n    }\r\n\r\n    function getMetaData(type, imageId) {\r\n        var result;\r\n        $.each(providers, function(index, provider) {\r\n            result = provider(type, imageId);\r\n            if (result !== undefined) {\r\n                return true;\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.metaData = {\r\n        addProvider: addProvider,\r\n        removeProvider: removeProvider,\r\n        get: getMetaData\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/metaData.js\r\n\r\n// Begin Source: src/orientation/getOrientationString.js\r\n(function(cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function getOrientationString(vector) {\r\n        // Thanks to David Clunie\r\n        // https://sites.google.com/site/dicomnotes/\r\n\r\n        var orientation = '',\r\n            orientationX = vector.x < 0 ? 'R' : 'L',\r\n            orientationY = vector.y < 0 ? 'A' : 'P',\r\n            orientationZ = vector.z < 0 ? 'F' : 'H';\r\n\r\n        // Should probably make this a function vector3.abs\r\n        var abs = new cornerstoneMath.Vector3(Math.abs(vector.x), Math.abs(vector.y), Math.abs(vector.z));\r\n\r\n        for (var i = 0; i < 3; i++) {\r\n            if (abs.x > 0.0001 && abs.x > abs.y && abs.x > abs.z) {\r\n                orientation += orientationX;\r\n                abs.x = 0;\r\n            } else if (abs.y > 0.0001 && abs.y > abs.x && abs.y > abs.z) {\r\n                orientation += orientationY;\r\n                abs.y = 0;\r\n            } else if (abs.z > 0.0001 && abs.z > abs.x && abs.z > abs.y) {\r\n                orientation += orientationZ;\r\n                abs.z = 0;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        return orientation;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.orientation.getOrientationString = getOrientationString;\r\n\r\n})(cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/orientation/getOrientationString.js\r\n\r\n// Begin Source: src/orientation/invertOrientationString.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function invertOrientationString(string) {\r\n        var inverted = string.replace('H', 'f');\r\n        inverted = inverted.replace('F', 'h');\r\n        inverted = inverted.replace('R', 'l');\r\n        inverted = inverted.replace('L', 'r');\r\n        inverted = inverted.replace('A', 'p');\r\n        inverted = inverted.replace('P', 'a');\r\n        inverted = inverted.toUpperCase();\r\n        return inverted;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.orientation.invertOrientationString = invertOrientationString;\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/orientation/invertOrientationString.js\r\n\r\n// Begin Source: src/referenceLines/calculateReferenceLine.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // calculates a reference line between two planes by projecting the top left hand corner and bottom right hand corner\r\n    // of the reference image onto the target image.  Ideally we would calculate the intersection between the planes but\r\n    // that requires a bit more math and this works fine for most cases\r\n    function calculateReferenceLine(targetImagePlane, referenceImagePlane) {\r\n        var points = cornerstoneTools.planePlaneIntersection(targetImagePlane, referenceImagePlane);\r\n        if (!points) {\r\n            return;\r\n        }\r\n\r\n        return {\r\n            start: cornerstoneTools.projectPatientPointToImagePlane(points.start, targetImagePlane),\r\n            end: cornerstoneTools.projectPatientPointToImagePlane(points.end, targetImagePlane)\r\n        };\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.referenceLines.calculateReferenceLine = calculateReferenceLine;\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/referenceLines/calculateReferenceLine.js\r\n\r\n// Begin Source: src/referenceLines/referenceLinesTool.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'referenceLines';\r\n\r\n    function onImageRendered(e, eventData) {\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // Get the enabled elements associated with this synchronization context and draw them\r\n        var syncContext = toolData.data[0].synchronizationContext;\r\n        var enabledElements = syncContext.getSourceElements();\r\n\r\n        var renderer = toolData.data[0].renderer;\r\n\r\n        // Create the canvas context and reset it to the pixel coordinate system\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        cornerstone.setToPixelCoordinateSystem(eventData.enabledElement, context);\r\n\r\n        // Iterate over each referenced element\r\n        $.each(enabledElements, function(index, referenceEnabledElement) {\r\n\r\n            // don't draw ourselves\r\n            if (referenceEnabledElement === e.currentTarget) {\r\n                return;\r\n            }\r\n\r\n            // render it\r\n            renderer(context, eventData, e.currentTarget, referenceEnabledElement);\r\n        });\r\n    }\r\n\r\n    // enables the reference line tool for a given element.  Note that a custom renderer\r\n    // can be provided if you want different rendering (e.g. all reference lines, first/last/active, etc)\r\n    function enable(element, synchronizationContext, renderer) {\r\n        renderer = renderer || cornerstoneTools.referenceLines.renderActiveReferenceLine;\r\n\r\n        cornerstoneTools.addToolState(element, toolType, {\r\n            synchronizationContext: synchronizationContext, renderer: renderer\r\n        });\r\n        $(element).on('CornerstoneImageRendered', onImageRendered);\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // disables the reference line tool for the given element\r\n    function disable(element) {\r\n        $(element).off('CornerstoneImageRendered', onImageRendered);\r\n        cornerstone.updateImage(element);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.referenceLines.tool = {\r\n        enable: enable, disable: disable\r\n\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/referenceLines/referenceLinesTool.js\r\n\r\n// Begin Source: src/referenceLines/renderActiveReferenceLine.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // renders the active reference line\r\n    function renderActiveReferenceLine(context, eventData, targetElement, referenceElement) {\r\n        var targetImage = cornerstone.getEnabledElement(targetElement).image;\r\n        var referenceImage = cornerstone.getEnabledElement(referenceElement).image;\r\n\r\n        // make sure the images are actually loaded for the target and reference\r\n        if (!targetImage || !referenceImage) {\r\n            return;\r\n        }\r\n\r\n        var targetImagePlane = cornerstoneTools.metaData.get('imagePlane', targetImage.imageId);\r\n        var referenceImagePlane = cornerstoneTools.metaData.get('imagePlane', referenceImage.imageId);\r\n\r\n        // the image planes must be in the same frame of reference\r\n        if (targetImagePlane.frameOfReferenceUID !== referenceImagePlane.frameOfReferenceUID) {\r\n            return;\r\n        }\r\n\r\n        // the image plane normals must be > 30 degrees apart\r\n        var targetNormal = targetImagePlane.rowCosines.clone().cross(targetImagePlane.columnCosines);\r\n        var referenceNormal = referenceImagePlane.rowCosines.clone().cross(referenceImagePlane.columnCosines);\r\n        var angleInRadians = targetNormal.angleTo(referenceNormal);\r\n\r\n        angleInRadians = Math.abs(angleInRadians);\r\n        if (angleInRadians < 0.5) { // 0.5 radians = ~30 degrees\r\n            return;\r\n        }\r\n\r\n        var referenceLine = cornerstoneTools.referenceLines.calculateReferenceLine(targetImagePlane, referenceImagePlane);\r\n        if (!referenceLine) {\r\n            return;\r\n        }\r\n\r\n        var refLineStartCanvas = cornerstone.pixelToCanvas(eventData.element, referenceLine.start);\r\n        var refLineEndCanvas = cornerstone.pixelToCanvas(eventData.element, referenceLine.end);\r\n\r\n        var color = cornerstoneTools.toolColors.getActiveColor();\r\n        var lineWidth = cornerstoneTools.toolStyle.getToolWidth();\r\n\r\n        // draw the referenceLines\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        context.save();\r\n        context.beginPath();\r\n        context.strokeStyle = color;\r\n        context.lineWidth = lineWidth;\r\n        context.moveTo(refLineStartCanvas.x, refLineStartCanvas.y);\r\n        context.lineTo(refLineEndCanvas.x, refLineEndCanvas.y);\r\n        context.stroke();\r\n        context.restore();\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.referenceLines.renderActiveReferenceLine = renderActiveReferenceLine;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/referenceLines/renderActiveReferenceLine.js\r\n\r\n// Begin Source: src/requestPool/requestPoolManager.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var requestPool = {\r\n        interaction: [],\r\n        thumbnail: [],\r\n        prefetch: []\r\n    };\r\n\r\n    var numRequests = {\r\n        interaction: 0,\r\n        thumbnail: 0,\r\n        prefetch: 0\r\n    };\r\n\r\n    var maxNumRequests = {\r\n        interaction: 6,\r\n        thumbnail: 6,\r\n        prefetch: 5\r\n    };\r\n    \r\n    var lastElementInteracted;\r\n    var awake = false;\r\n    var grabDelay = 20;\r\n\r\n    function requestPoolManager() {\r\n\r\n        function addRequest(element, imageId, type, doneCallback, failCallback) {\r\n            if (!requestPool.hasOwnProperty(type)) {\r\n                throw 'Request type must be one of interaction, thumbnail, or prefetch';\r\n            }\r\n\r\n            if (!element || !imageId) {\r\n                return;\r\n            }\r\n\r\n            // Describe the request\r\n            var requestDetails = {\r\n                type: type,\r\n                imageId: imageId,\r\n                doneCallback: doneCallback,\r\n                failCallback: failCallback\r\n            };\r\n\r\n            // If this imageId is in the cache, resolve it immediately\r\n            var imagePromise = cornerstone.imageCache.getImagePromise(imageId);\r\n            if (imagePromise) {\r\n                imagePromise.then(function(image) {\r\n                    doneCallback(image);\r\n                }, function(error) {\r\n                    failCallback(error);\r\n                });\r\n                return;\r\n            }\r\n\r\n            // Add it to the end of the stack\r\n            requestPool[type].push(requestDetails);\r\n\r\n            // Store the last element interacted with,\r\n            // So we know which images to prefetch\r\n            //\r\n            // ---- Not used for now ----\r\n            if (type === 'interaction') {\r\n                lastElementInteracted = element;\r\n            }\r\n        }\r\n\r\n        function clearRequestStack(type) {\r\n            //console.log('clearRequestStack');\r\n            if (!requestPool.hasOwnProperty(type)) {\r\n                throw 'Request type must be one of interaction, thumbnail, or prefetch';\r\n            }\r\n\r\n            requestPool[type] = [];\r\n        }\r\n\r\n        function startAgain() {\r\n            if (!awake) {\r\n                return;\r\n            }\r\n\r\n            setTimeout(function() {\r\n                var requestDetails = getNextRequest();\r\n                if (!requestDetails) {\r\n                    awake = false;\r\n                    return;\r\n                }\r\n\r\n                sendRequest(requestDetails);\r\n            }, grabDelay);\r\n        }\r\n\r\n        function sendRequest(requestDetails) {\r\n            // Increment the number of current requests of this type\r\n            var type = requestDetails.type;\r\n            numRequests[type]++;\r\n\r\n            awake = true;\r\n            var imageId = requestDetails.imageId;\r\n            var doneCallback = requestDetails.doneCallback;\r\n            var failCallback = requestDetails.failCallback;\r\n            \r\n            // Check if we already have this image promise in the cache\r\n            var imagePromise = cornerstone.imageCache.getImagePromise(imageId);\r\n            if (imagePromise) {\r\n                // If we do, remove from list (when resolved, as we could have\r\n                // pending prefetch requests) and stop processing this iteration\r\n                imagePromise.then(function(image) {\r\n                    numRequests[type]--;\r\n                    // console.log(numRequests);\r\n\r\n                    doneCallback(image);\r\n                    startAgain();\r\n                }, function(error) {\r\n                    numRequests[type]--;\r\n                    // console.log(numRequests);\r\n                    failCallback(error);\r\n                });\r\n                return;\r\n            }\r\n\r\n            // Load and cache the image\r\n            cornerstone.loadAndCacheImage(imageId).then(function(image) {\r\n                numRequests[type]--;\r\n                // console.log(numRequests);\r\n                doneCallback(image);\r\n                startAgain();\r\n            }, function(error) {\r\n                numRequests[type]--;\r\n                // console.log(numRequests);\r\n                failCallback(error);\r\n            });\r\n        }\r\n\r\n        function startGrabbing() {\r\n            // Begin by grabbing X images\r\n            if (awake) {\r\n                return;\r\n            }\r\n\r\n            var maxSimultaneousRequests = cornerstoneTools.getMaxSimultaneousRequests();\r\n            \r\n            maxNumRequests = {\r\n                interaction: maxSimultaneousRequests,\r\n                thumbnail: maxSimultaneousRequests - 2,\r\n                prefetch: maxSimultaneousRequests - 1\r\n            };\r\n\r\n            for (var i = 0; i < maxSimultaneousRequests; i++) {\r\n                var requestDetails = getNextRequest();\r\n                if (requestDetails) {\r\n                    sendRequest(requestDetails);\r\n                }\r\n            }\r\n\r\n            //console.log(\"startGrabbing\");\r\n            //console.log(requestPool);\r\n        }\r\n\r\n        function getNextRequest() {\r\n            if (requestPool.interaction.length && numRequests.interaction < maxNumRequests.interaction) {\r\n                return requestPool.interaction.shift();\r\n            }\r\n\r\n            if (requestPool.thumbnail.length && numRequests.thumbnail < maxNumRequests.thumbnail) {\r\n                return requestPool.thumbnail.shift();\r\n            }\r\n\r\n            if (requestPool.prefetch.length && numRequests.prefetch < maxNumRequests.prefetch) {\r\n                return requestPool.prefetch.shift();\r\n            }\r\n\r\n            if (!requestPool.interaction.length &&\r\n                !requestPool.thumbnail.length &&\r\n                !requestPool.prefetch.length) {\r\n                awake = false;\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function getRequestPool() {\r\n            return requestPool;\r\n        }\r\n\r\n        var requestManager = {\r\n            addRequest: addRequest,\r\n            clearRequestStack: clearRequestStack,\r\n            startGrabbing: startGrabbing,\r\n            getRequestPool: getRequestPool\r\n        };\r\n\r\n        return requestManager;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.requestPoolManager = requestPoolManager();\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/requestPool/requestPoolManager.js\r\n\r\n// Begin Source: src/stackTools/playClip.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'playClip';\r\n\r\n    /**\r\n     * Starts playing a clip or adjusts the frame rate of an already playing clip.  framesPerSecond is\r\n     * optional and defaults to 30 if not specified.  A negative framesPerSecond will play the clip in reverse.\r\n     * The element must be a stack of images\r\n     * @param element\r\n     * @param framesPerSecond\r\n     */\r\n    function playClip(element, framesPerSecond) {\r\n        if (element === undefined) {\r\n            throw 'playClip: element must not be undefined';\r\n        }\r\n\r\n        if (framesPerSecond === undefined) {\r\n            framesPerSecond = 30;\r\n        }\r\n\r\n        var stackToolData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (stackToolData === undefined || stackToolData.data === undefined || stackToolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var stackData = stackToolData.data[0];\r\n\r\n        var playClipToolData = cornerstoneTools.getToolState(element, toolType);\r\n        var playClipData;\r\n        \r\n        if (playClipToolData === undefined || playClipToolData.data.length === 0) {\r\n            playClipData = {\r\n                intervalId: undefined, framesPerSecond: framesPerSecond, lastFrameTimeStamp: undefined, frameRate: 0, loop: true\r\n            };\r\n            cornerstoneTools.addToolState(element, toolType, playClipData);\r\n        } else {\r\n            playClipData = playClipToolData.data[0];\r\n            playClipData.framesPerSecond = framesPerSecond;\r\n        }\r\n\r\n        // if already playing, do not set a new interval\r\n        if (playClipData.intervalId !== undefined) {\r\n            return;\r\n        }\r\n\r\n        playClipData.intervalId = setInterval(function() {\r\n\r\n            var newImageIdIndex = stackData.currentImageIdIndex;\r\n\r\n            if (playClipData.framesPerSecond > 0) {\r\n                newImageIdIndex++;\r\n            } else {\r\n                newImageIdIndex--;\r\n            }\r\n\r\n            if (!playClipData.loop && (newImageIdIndex >= stackData.imageIds.length || newImageIdIndex < 0)) {\r\n                \r\n                var eventDetail = {\r\n                    element: element\r\n                };\r\n                var event = $.Event('CornerstoneToolsClipStopped', eventDetail);\r\n                $(element).trigger(event, eventDetail);\r\n\r\n                clearInterval(playClipData.intervalId);\r\n                playClipData.intervalId = undefined;\r\n                return;\r\n            }\r\n\r\n            // loop around if we go outside the stack\r\n            if (newImageIdIndex >= stackData.imageIds.length) {\r\n                newImageIdIndex = 0;\r\n            }\r\n\r\n            if (newImageIdIndex < 0) {\r\n                newImageIdIndex = stackData.imageIds.length - 1;\r\n            }\r\n\r\n            if (newImageIdIndex !== stackData.currentImageIdIndex) {\r\n                var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n                var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n                var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n                if (startLoadingHandler) {\r\n                    startLoadingHandler(element);\r\n                }\r\n\r\n                var viewport = cornerstone.getViewport(element);\r\n                cornerstone.loadAndCacheImage(stackData.imageIds[newImageIdIndex]).then(function(image) {\r\n                    stackData.currentImageIdIndex = newImageIdIndex;\r\n                    cornerstone.displayImage(element, image, viewport);\r\n                    if (endLoadingHandler) {\r\n                        endLoadingHandler(element);\r\n                    }\r\n                }, function(error) {\r\n                    var imageId = stackData.imageIds[newImageIdIndex];\r\n                    if (errorLoadingHandler) {\r\n                        errorLoadingHandler(element, imageId, error);\r\n                    }\r\n                });\r\n            }\r\n        }, 1000 / Math.abs(playClipData.framesPerSecond));\r\n    }\r\n\r\n    /**\r\n     * Stops an already playing clip.\r\n     * * @param element\r\n     */\r\n    function stopClip(element) {\r\n        var playClipToolData = cornerstoneTools.getToolState(element, toolType);\r\n        var playClipData;\r\n        if (playClipToolData === undefined || playClipToolData.data.length === 0) {\r\n            return;\r\n        } else {\r\n            playClipData = playClipToolData.data[0];\r\n        }\r\n\r\n        clearInterval(playClipData.intervalId);\r\n        playClipData.intervalId = undefined;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.playClip = playClip;\r\n    cornerstoneTools.stopClip = stopClip;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stackTools/playClip.js\r\n\r\n// Begin Source: src/stackTools/scrollIndicator.js\r\n/*\r\nDisplay scroll progress bar across bottom of image.\r\n */\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var scrollBarHeight = 6;\r\n\r\n    var configuration = {\r\n        backgroundColor: 'rgb(19, 63, 141)',\r\n        fillColor: 'white'\r\n    };\r\n\r\n    function onImageRendered(e, eventData){\r\n        var element = eventData.element;\r\n        var width = eventData.enabledElement.canvas.width;\r\n        var height = eventData.enabledElement.canvas.height;\r\n\r\n        if (!width || !height) {\r\n            return false;\r\n        }\r\n\r\n        var context = eventData.enabledElement.canvas.getContext('2d');\r\n        context.setTransform(1, 0, 0, 1, 0, 0);\r\n        context.save();\r\n\r\n        var config = cornerstoneTools.scrollIndicator.getConfiguration();\r\n\r\n        // draw indicator background\r\n        context.fillStyle = config.backgroundColor;\r\n        context.fillRect(0, height - scrollBarHeight, width, scrollBarHeight);\r\n\r\n        // get current image index\r\n        var stackData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (!stackData || !stackData.data || !stackData.data.length) {\r\n            return;\r\n        }\r\n\r\n        var imageIds = stackData.data[0].imageIds;\r\n        var currentImageIdIndex = stackData.data[0].currentImageIdIndex;\r\n\r\n        // draw current image cursor\r\n        var cursorWidth = width / imageIds.length;\r\n        var xPosition = cursorWidth * currentImageIdIndex;\r\n\r\n        context.fillStyle = config.fillColor;\r\n        context.fillRect(xPosition, height - scrollBarHeight, cursorWidth, scrollBarHeight);\r\n\r\n        context.restore();\r\n    }\r\n\r\n    cornerstoneTools.scrollIndicator = cornerstoneTools.displayTool(onImageRendered);\r\n    cornerstoneTools.scrollIndicator.setConfiguration(configuration);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stackTools/scrollIndicator.js\r\n\r\n// Begin Source: src/stackTools/stackPrefetch.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'stackPrefetch';\r\n    var requestType = 'prefetch';\r\n\r\n    var configuration = {};\r\n\r\n    var resetPrefetchTimeout,\r\n        resetPrefetchDelay;\r\n\r\n    function sortNumber(a, b) {\r\n        // http://stackoverflow.com/questions/1063007/how-to-sort-an-array-of-integers-correctly\r\n        return a - b;\r\n    }\r\n\r\n    function range(lowEnd, highEnd) {\r\n        // Javascript version of Python's range function\r\n        // http://stackoverflow.com/questions/3895478/does-javascript-have-a-method-like-range-to-generate-an-array-based-on-suppl\r\n        lowEnd = Math.round(lowEnd) || 0;\r\n        highEnd = Math.round(highEnd) || 0;\r\n\r\n        var arr = [],\r\n            c = highEnd - lowEnd + 1;\r\n\r\n        if (c <= 0) {\r\n            return arr;\r\n        }\r\n\r\n        while ( c-- ) {\r\n            arr[c] = highEnd--;\r\n        }\r\n\r\n        return arr;\r\n    }\r\n\r\n    var max = function(arr) {\r\n        return Math.max.apply(null, arr);\r\n    };\r\n\r\n    var min = function(arr) {\r\n        return Math.min.apply(null, arr);\r\n    };\r\n\r\n    function nearestIndex(arr, x) {\r\n        // Return index of nearest values in array\r\n        // http://stackoverflow.com/questions/25854212/return-index-of-nearest-values-in-an-array        \r\n        var l = [],\r\n            h = [];\r\n\r\n        arr.forEach(function(v) {\r\n            if (v < x) {\r\n                l.push(v);\r\n            } else if (v > x) {\r\n                h.push(v);\r\n            }\r\n        });\r\n       \r\n        return {\r\n            low: arr.indexOf(max(l)),\r\n            high: arr.indexOf(min(h))\r\n        };\r\n    }\r\n\r\n    function prefetch(element) {\r\n        // Check to make sure stack data exists\r\n        var stackData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (!stackData || !stackData.data || !stackData.data.length) {\r\n            return;\r\n        }\r\n\r\n        var stack = stackData.data[0];\r\n\r\n        // Get the stackPrefetch tool data\r\n        var stackPrefetchData = cornerstoneTools.getToolState(element, toolType);\r\n        if (!stackPrefetchData) {\r\n            return;\r\n        }\r\n\r\n        var stackPrefetch = stackPrefetchData.data[0];\r\n\r\n        // If all the requests are complete, disable the stackPrefetch tool\r\n        if (!stackPrefetch || !stackPrefetch.indicesToRequest || !stackPrefetch.indicesToRequest.length) {\r\n            stackPrefetch.enabled = false;\r\n        }\r\n\r\n        // Make sure the tool is still enabled\r\n        if (stackPrefetch.enabled === false) {\r\n            return;\r\n        }\r\n\r\n        // Remove an imageIdIndex from the list of indices to request\r\n        // This fires when the individual image loading deferred is resolved        \r\n        function removeFromList(imageIdIndex) {\r\n            var index = stackPrefetch.indicesToRequest.indexOf(imageIdIndex);\r\n            if (index > -1) { // don't remove last element if imageIdIndex not found\r\n                stackPrefetch.indicesToRequest.splice(index, 1);\r\n            }\r\n        }\r\n        \r\n        // Remove all already cached images from the\r\n        // indicesToRequest array\r\n        stackPrefetchData.data[0].indicesToRequest.sort(sortNumber);\r\n        var indicesToRequestCopy = stackPrefetch.indicesToRequest.slice();\r\n\r\n        indicesToRequestCopy.forEach(function(imageIdIndex) {\r\n            var imageId = stack.imageIds[imageIdIndex];\r\n\r\n            if (!imageId) {\r\n                return;\r\n            }\r\n\r\n            var imagePromise = cornerstone.imageCache.getImagePromise(imageId);\r\n            if (imagePromise && imagePromise.state() === 'resolved'){\r\n                removeFromList(imageIdIndex);\r\n            }\r\n        });\r\n\r\n        // Stop here if there are no images left to request\r\n        // After those in the cache have been removed\r\n        if (!stackPrefetch.indicesToRequest.length) {\r\n            return;\r\n        }\r\n\r\n        function doneCallback(image) {\r\n            //console.log('prefetch done: ' + image.imageId);\r\n            var imageIdIndex = stack.imageIds.indexOf(image.imageId);\r\n            removeFromList(imageIdIndex);\r\n        }\r\n\r\n        function failCallback(error) {\r\n            console.log('prefetch errored: ' + error);\r\n        }\r\n\r\n        // Clear the requestPool of prefetch requests\r\n        var requestPoolManager = cornerstoneTools.requestPoolManager;\r\n        requestPoolManager.clearRequestStack(requestType);\r\n\r\n        // Identify the nearest imageIdIndex to the currentImageIdIndex \r\n        var nearest = nearestIndex(stackPrefetch.indicesToRequest, stack.currentImageIdIndex);\r\n\r\n        var imageId,\r\n            nextImageIdIndex;\r\n\r\n        // Prefetch images around the current image (before and after)\r\n        var lowerIndex = nearest.low;\r\n        var higherIndex = nearest.high;\r\n        while (lowerIndex > 0 || higherIndex < stackPrefetch.indicesToRequest.length) {\r\n            if (lowerIndex >= 0 ) {\r\n                nextImageIdIndex = stackPrefetch.indicesToRequest[lowerIndex--];\r\n                imageId = stack.imageIds[nextImageIdIndex];\r\n                requestPoolManager.addRequest(element, imageId, requestType, doneCallback, failCallback);\r\n            }\r\n\r\n            if (higherIndex < stackPrefetch.indicesToRequest.length) {\r\n                nextImageIdIndex = stackPrefetch.indicesToRequest[higherIndex++];\r\n                imageId = stack.imageIds[nextImageIdIndex];\r\n                requestPoolManager.addRequest(element, imageId, requestType, doneCallback, failCallback);\r\n            }\r\n        }\r\n\r\n        // Try to start the requestPool's grabbing procedure\r\n        // in case it isn't already running\r\n        requestPoolManager.startGrabbing();\r\n    }\r\n\r\n    function handleCacheFull(e) {\r\n        // Stop prefetching if the ImageCacheFull event is fired from cornerstone\r\n        // console.log('CornerstoneImageCacheFull full, stopping');\r\n        var element = e.data.element;\r\n\r\n        var stackPrefetchData = cornerstoneTools.getToolState(element, toolType);\r\n        if (!stackPrefetchData || !stackPrefetchData.data || !stackPrefetchData.data.length) {\r\n            return;\r\n        }\r\n\r\n        // Disable the stackPrefetch tool\r\n        // stackPrefetchData.data[0].enabled = false;\r\n\r\n        // Clear current prefetch requests from the requestPool\r\n        cornerstoneTools.requestPoolManager.clearRequestStack(requestType);\r\n    }\r\n\r\n    function promiseRemovedHandler(e, eventData) {\r\n        // When an imagePromise has been pushed out of the cache, re-add its index\r\n        // it to the indicesToRequest list so that it will be retrieved later if the\r\n        // currentImageIdIndex is changed to an image nearby\r\n        var element = e.data.element;\r\n        var stackData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (!stackData || !stackData.data || !stackData.data.length) {\r\n            return;\r\n        }\r\n\r\n        var stack = stackData.data[0];\r\n        var imageIdIndex = stack.imageIds.indexOf(eventData.imageId);\r\n\r\n        // Make sure the image that was removed is actually in this stack\r\n        // before adding it to the indicesToRequest array\r\n        if (imageIdIndex < 0) {\r\n            return;\r\n        }\r\n        \r\n        var stackPrefetchData = cornerstoneTools.getToolState(element, toolType);\r\n        if (!stackPrefetchData || !stackPrefetchData.data || !stackPrefetchData.data.length) {\r\n            return;\r\n        }\r\n\r\n        stackPrefetchData.data[0].indicesToRequest.push(imageIdIndex);\r\n    }\r\n\r\n    function onImageUpdated(e) {\r\n        // Start prefetching again (after a delay)\r\n        // When the user has scrolled to a new image\r\n        clearTimeout(resetPrefetchTimeout);\r\n        resetPrefetchTimeout = setTimeout(function() {\r\n            var element = e.currentTarget;\r\n            prefetch(element);\r\n        }, resetPrefetchDelay);\r\n    }\r\n\r\n    function enable(element) {\r\n        // Clear old prefetch data. Skipping this can cause problems when changing the series inside an element\r\n        var stackPrefetchDataArray = cornerstoneTools.getToolState(element, toolType);\r\n        stackPrefetchDataArray.data = [];\r\n\r\n        // First check that there is stack data available\r\n        var stackData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (!stackData || !stackData.data || !stackData.data.length) {\r\n            return;\r\n        }\r\n\r\n        var stack = stackData.data[0];\r\n\r\n        // Use the currentImageIdIndex from the stack as the initalImageIdIndex\r\n        var stackPrefetchData = {\r\n            indicesToRequest: range(0, stack.imageIds.length - 1),\r\n            enabled: true,\r\n            direction: 1\r\n        };\r\n\r\n        // Remove the currentImageIdIndex from the list to request\r\n        var indexOfCurrentImage = stackPrefetchData.indicesToRequest.indexOf(stack.currentImageIdIndex);\r\n        stackPrefetchData.indicesToRequest.splice(indexOfCurrentImage, 1);\r\n\r\n        cornerstoneTools.addToolState(element, toolType, stackPrefetchData);\r\n\r\n        prefetch(element);\r\n\r\n        $(element).off('CornerstoneNewImage', onImageUpdated);\r\n        $(element).on('CornerstoneNewImage', onImageUpdated);\r\n\r\n        $(cornerstone).off('CornerstoneImageCacheFull', handleCacheFull);\r\n        $(cornerstone).on('CornerstoneImageCacheFull', {\r\n            element: element\r\n        }, handleCacheFull);\r\n\r\n        $(cornerstone).off('CornerstoneImageCachePromiseRemoved', promiseRemovedHandler);\r\n        $(cornerstone).on('CornerstoneImageCachePromiseRemoved', {\r\n            element: element\r\n        }, promiseRemovedHandler);\r\n    }\r\n\r\n    function disable(element) {\r\n        $(element).off('CornerstoneNewImage', onImageUpdated);\r\n\r\n        $(cornerstone).off('CornerstoneImageCacheFull', handleCacheFull);\r\n        $(cornerstone).off('CornerstoneImageCachePromiseRemoved', promiseRemovedHandler);\r\n\r\n        var stackPrefetchData = cornerstoneTools.getToolState(element, toolType);\r\n        // If there is actually something to disable, disable it\r\n        if (stackPrefetchData && stackPrefetchData.data.length) {\r\n            stackPrefetchData.data[0].enabled = false;\r\n\r\n            // Clear current prefetch requests from the requestPool\r\n            cornerstoneTools.requestPoolManager.clearRequestStack(requestType);\r\n        }\r\n    }\r\n\r\n    function getConfiguration () {\r\n        return configuration;\r\n    }\r\n\r\n    function setConfiguration(config) {\r\n        configuration = config;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.stackPrefetch = {\r\n        enable: enable,\r\n        disable: disable,\r\n        getConfiguration: getConfiguration,\r\n        setConfiguration: setConfiguration\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stackTools/stackPrefetch.js\r\n\r\n// Begin Source: src/stackTools/stackScroll.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n\r\n            var mouseDragEventData = {\r\n                deltaY: 0, options: e.data.options\r\n            };\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', mouseDragEventData, mouseDragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            e.stopImmediatePropagation();\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function mouseDragCallback(e, eventData) {\r\n        e.data.deltaY += eventData.deltaPoints.page.y;\r\n\r\n        var element = eventData.element;\r\n\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, 'stack');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var stackData = toolData.data[0];\r\n\r\n        // The Math.max here makes it easier to mouseDrag-scroll small image stacks\r\n        var pixelsPerImage = $(eventData.element).height() / Math.max(stackData.imageIds.length, 8);\r\n        if (e.data.options !== undefined && e.data.options.stackScrollSpeed !== undefined) {\r\n            pixelsPerImage = e.data.options.stackScrollSpeed;\r\n        }\r\n\r\n        if (e.data.deltaY >= pixelsPerImage || e.data.deltaY <= -pixelsPerImage) {\r\n            var imageDelta = e.data.deltaY / pixelsPerImage;\r\n            var imageDeltaMod = e.data.deltaY % pixelsPerImage;\r\n            var imageIdIndexOffset = Math.round(imageDelta);\r\n            e.data.deltaY = imageDeltaMod;\r\n\r\n            cornerstoneTools.scroll(element, imageIdIndexOffset);\r\n        }\r\n\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function mouseWheelCallback(e, eventData) {\r\n        var images = -eventData.direction;\r\n        cornerstoneTools.scroll(eventData.element, images);\r\n    }\r\n\r\n    function onDrag(e, eventData) {\r\n        var element = eventData.element;\r\n        eventData.deltaY = eventData.deltaY || 0;\r\n        eventData.deltaY += eventData.deltaPoints.page.y;\r\n\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, 'stack');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        if (eventData.deltaY >= 3 || eventData.deltaY <= -3) {\r\n            var imageDelta = eventData.deltaY / 3;\r\n            var imageDeltaMod = eventData.deltaY % 3;\r\n            var imageIdIndexOffset = Math.round(imageDelta);\r\n            eventData.deltaY = imageDeltaMod;\r\n\r\n            cornerstoneTools.scroll(element, imageIdIndexOffset);\r\n        }\r\n\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.stackScroll = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    cornerstoneTools.stackScrollWheel = cornerstoneTools.mouseWheelTool(mouseWheelCallback);\r\n    cornerstoneTools.stackScrollTouchDrag = cornerstoneTools.touchDragTool(onDrag);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stackTools/stackScroll.js\r\n\r\n// Begin Source: src/stackTools/stackScrollKeyboard.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var keys = {\r\n        UP: 38, DOWN: 40\r\n    };\r\n\r\n    function keyDownCallback(e, eventData) {\r\n        var keyCode = eventData.keyCode;\r\n        if (keyCode !== keys.UP && keyCode !== keys.DOWN) {\r\n            return;\r\n        }\r\n\r\n        var images = 1;\r\n        if (keyCode === keys.DOWN) {\r\n            images = -1;\r\n        }\r\n\r\n        cornerstoneTools.scroll(eventData.element, images);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.stackScrollKeyboard = cornerstoneTools.keyboardTool(keyDownCallback);\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/stackTools/stackScrollKeyboard.js\r\n\r\n// Begin Source: src/stateManagement/applicationState.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function saveApplicationState(elements) {\r\n        // Save imageId-specific tool state data\r\n        var appState = {\r\n            imageIdToolState: cornerstoneTools.globalImageIdSpecificToolStateManager.saveToolState(),\r\n            elementToolState: {},\r\n            elementViewport: {}\r\n        };\r\n\r\n        // For each of the given elements, save the viewport and any stack-specific tool data\r\n        elements.forEach(function(element) {\r\n            var toolStateManager = cornerstoneTools.getElementToolStateManager(element);\r\n            if (toolStateManager === cornerstoneTools.globalImageIdSpecificToolStateManager) {\r\n                return;\r\n            }\r\n\r\n            appState.elementToolState[element.id] = toolStateManager.saveToolState();\r\n\r\n            appState.elementViewport[element.id] = cornerstone.getViewport(element);\r\n        });\r\n        return appState;\r\n    }\r\n\r\n    function restoreApplicationState(appState) {\r\n        // Make sure t\r\n        if (!appState.hasOwnProperty('imageIdToolState') ||\r\n            !appState.hasOwnProperty('elementToolState') ||\r\n            !appState.hasOwnProperty('elementViewport')) {\r\n            return;\r\n        }\r\n\r\n        // Restore all the imageId specific tool data\r\n        cornerstoneTools.globalImageIdSpecificToolStateManager.restoreToolState(appState.imageIdToolState);\r\n\r\n        Object.keys(appState.elementViewport).forEach(function(elementId) {\r\n            // Restore any stack specific tool data\r\n            var element = document.getElementById(elementId);\r\n            if (!element) {\r\n                return;\r\n            }\r\n\r\n            if (!appState.elementToolState.hasOwnProperty(elementId)) {\r\n                return;\r\n            }\r\n            \r\n            var toolStateManager = cornerstoneTools.getElementToolStateManager(element);\r\n            if (toolStateManager === cornerstoneTools.globalImageIdSpecificToolStateManager) {\r\n                return;\r\n            }\r\n\r\n            toolStateManager.restoreToolState(appState.elementToolState[elementId]);\r\n\r\n            // Restore the saved viewport information\r\n            var savedViewport = appState.elementViewport[elementId];\r\n            cornerstone.setViewport(element, savedViewport);\r\n\r\n            // Update the element to apply the viewport and tool changes\r\n            cornerstone.updateImage(element);\r\n        });\r\n        return appState;\r\n    }\r\n\r\n    cornerstoneTools.appState = {\r\n        save: saveApplicationState,\r\n        restore: restoreApplicationState\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/applicationState.js\r\n\r\n// Begin Source: src/stateManagement/frameOfReferenceStateManager.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This implements a frame-of-reference specific tool state management strategy.  This means that\r\n    // measurement data are tied to a specific frame of reference UID and only visible to objects using\r\n    // that frame-of-reference UID\r\n\r\n    function newFrameOfReferenceSpecificToolStateManager() {\r\n        var toolState = {};\r\n\r\n        // here we add tool state, this is done by tools as well\r\n        // as modules that restore saved state\r\n        function addFrameOfReferenceSpecificToolState(frameOfReference, toolType, data) {\r\n            // if we don't have any tool state for this frameOfReference, add an empty object\r\n            if (toolState.hasOwnProperty(frameOfReference) === false) {\r\n                toolState[frameOfReference] = {};\r\n            }\r\n\r\n            var frameOfReferenceToolState = toolState[frameOfReference];\r\n\r\n            // if we don't have tool state for this type of tool, add an empty object\r\n            if (frameOfReferenceToolState.hasOwnProperty(toolType) === false) {\r\n                frameOfReferenceToolState[toolType] = {\r\n                    data: []\r\n                };\r\n            }\r\n\r\n            var toolData = frameOfReferenceToolState[toolType];\r\n\r\n            // finally, add this new tool to the state\r\n            toolData.data.push(data);\r\n        }\r\n\r\n        // here you can get state - used by tools as well as modules\r\n        // that save state persistently\r\n        function getFrameOfReferenceSpecificToolState(frameOfReference, toolType) {\r\n            // if we don't have any tool state for this frame of reference, return undefined\r\n            if (toolState.hasOwnProperty(frameOfReference) === false) {\r\n                return;\r\n            }\r\n\r\n            var frameOfReferenceToolState = toolState[frameOfReference];\r\n\r\n            // if we don't have tool state for this type of tool, return undefined\r\n            if (frameOfReferenceToolState.hasOwnProperty(toolType) === false) {\r\n                return;\r\n            }\r\n\r\n            var toolData = frameOfReferenceToolState[toolType];\r\n            return toolData;\r\n        }\r\n\r\n        function removeFrameOfReferenceSpecificToolState(frameOfReference, toolType, data) {\r\n            // if we don't have any tool state for this frame of reference, return undefined\r\n            if (toolState.hasOwnProperty(frameOfReference) === false) {\r\n                return;\r\n            }\r\n\r\n            var frameOfReferenceToolState = toolState[frameOfReference];\r\n\r\n            // if we don't have tool state for this type of tool, return undefined\r\n            if (frameOfReferenceToolState.hasOwnProperty(toolType) === false) {\r\n                return;\r\n            }\r\n\r\n            var toolData = frameOfReferenceToolState[toolType];\r\n            // find this tool data\r\n            var indexOfData = -1;\r\n            for (var i = 0; i < toolData.data.length; i++) {\r\n                if (toolData.data[i] === data) {\r\n                    indexOfData = i;\r\n                }\r\n            }\r\n\r\n            if (indexOfData !== -1) {\r\n                toolData.data.splice(indexOfData, 1);\r\n            }\r\n        }\r\n\r\n        var frameOfReferenceToolStateManager = {\r\n            get: getFrameOfReferenceSpecificToolState,\r\n            add: addFrameOfReferenceSpecificToolState,\r\n            remove: removeFrameOfReferenceSpecificToolState\r\n        };\r\n        return frameOfReferenceToolStateManager;\r\n    }\r\n\r\n    // a global frameOfReferenceSpecificToolStateManager - the most common case is to share 3d information\r\n    // between stacks of images\r\n    var globalFrameOfReferenceSpecificToolStateManager = newFrameOfReferenceSpecificToolStateManager();\r\n    \r\n    // module/private exports\r\n    cornerstoneTools.newFrameOfReferenceSpecificToolStateManager = newFrameOfReferenceSpecificToolStateManager;\r\n    cornerstoneTools.globalFrameOfReferenceSpecificToolStateManager = globalFrameOfReferenceSpecificToolStateManager;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/frameOfReferenceStateManager.js\r\n\r\n// Begin Source: src/stateManagement/imageIdSpecificStateManager.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This implements an imageId specific tool state management strategy.  This means that\r\n    // measurements data is tied to a specific imageId and only visible for enabled elements\r\n    // that are displaying that imageId.\r\n\r\n    function newImageIdSpecificToolStateManager() {\r\n        var toolState = {};\r\n\r\n        // here we add tool state, this is done by tools as well\r\n        // as modules that restore saved state\r\n\r\n        function saveImageIdToolState(imageId) {\r\n            return toolState[imageId];\r\n        }\r\n\r\n        function restoreImageIdToolState(imageId, imageIdToolState) {\r\n            toolState[imageId] = imageIdToolState;\r\n        }\r\n\r\n        function saveToolState() {\r\n            return toolState;\r\n        }\r\n\r\n        function restoreToolState(savedToolState) {\r\n            toolState = savedToolState;\r\n        }\r\n\r\n        // here we add tool state, this is done by tools as well\r\n        // as modules that restore saved state\r\n        function addImageIdSpecificToolState(element, toolType, data) {\r\n            var enabledImage = cornerstone.getEnabledElement(element);\r\n            // if we don't have any tool state for this imageId, add an empty object\r\n            if (!enabledImage.image || toolState.hasOwnProperty(enabledImage.image.imageId) === false) {\r\n                toolState[enabledImage.image.imageId] = {};\r\n            }\r\n\r\n            var imageIdToolState = toolState[enabledImage.image.imageId];\r\n\r\n            // if we don't have tool state for this type of tool, add an empty object\r\n            if (imageIdToolState.hasOwnProperty(toolType) === false) {\r\n                imageIdToolState[toolType] = {\r\n                    data: []\r\n                };\r\n            }\r\n\r\n            var toolData = imageIdToolState[toolType];\r\n\r\n            // finally, add this new tool to the state\r\n            toolData.data.push(data);\r\n        }\r\n\r\n        // here you can get state - used by tools as well as modules\r\n        // that save state persistently\r\n        function getImageIdSpecificToolState(element, toolType) {\r\n            var enabledImage = cornerstone.getEnabledElement(element);\r\n            // if we don't have any tool state for this imageId, return undefined\r\n            if (!enabledImage.image || toolState.hasOwnProperty(enabledImage.image.imageId) === false) {\r\n                return;\r\n            }\r\n\r\n            var imageIdToolState = toolState[enabledImage.image.imageId];\r\n\r\n            // if we don't have tool state for this type of tool, return undefined\r\n            if (imageIdToolState.hasOwnProperty(toolType) === false) {\r\n                return;\r\n            }\r\n\r\n            var toolData = imageIdToolState[toolType];\r\n            return toolData;\r\n        }\r\n\r\n        // Clears all tool data from this toolStateManager.\r\n        function clearImageIdSpecificToolStateManager(element) {\r\n            var enabledImage = cornerstone.getEnabledElement(element);\r\n            if (!enabledImage.image || toolState.hasOwnProperty(enabledImage.image.imageId) === false) {\r\n                return;\r\n            }\r\n\r\n            delete toolState[enabledImage.image.imageId];\r\n        }\r\n\r\n        var imageIdToolStateManager = {\r\n            get: getImageIdSpecificToolState,\r\n            add: addImageIdSpecificToolState,\r\n            clear: clearImageIdSpecificToolStateManager,\r\n            saveImageIdToolState: saveImageIdToolState,\r\n            restoreImageIdToolState: restoreImageIdToolState,\r\n            saveToolState: saveToolState,\r\n            restoreToolState: restoreToolState,\r\n            toolState: toolState\r\n        };\r\n        return imageIdToolStateManager;\r\n    }\r\n\r\n    // a global imageIdSpecificToolStateManager - the most common case is to share state between all\r\n    // visible enabled images\r\n    var globalImageIdSpecificToolStateManager = newImageIdSpecificToolStateManager();\r\n    \r\n    // module/private exports\r\n    cornerstoneTools.newImageIdSpecificToolStateManager = newImageIdSpecificToolStateManager;\r\n    cornerstoneTools.globalImageIdSpecificToolStateManager = globalImageIdSpecificToolStateManager;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/imageIdSpecificStateManager.js\r\n\r\n// Begin Source: src/stateManagement/loadHandlerManager.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function loadHandlerManager() {\r\n        var defaultStartLoadHandler,\r\n            defaultEndLoadHandler,\r\n            defaultErrorLoadingHandler;\r\n\r\n        function setStartLoadHandler(handler) {\r\n            defaultStartLoadHandler = handler;\r\n        }\r\n\r\n        function getStartLoadHandler() {\r\n            return defaultStartLoadHandler;\r\n        }\r\n\r\n        function setEndLoadHandler(handler) {\r\n            defaultEndLoadHandler = handler;\r\n        }\r\n\r\n        function getEndLoadHandler(){\r\n            return defaultEndLoadHandler;\r\n        }\r\n\r\n        function setErrorLoadingHandler(handler) {\r\n            defaultErrorLoadingHandler = handler;\r\n        }\r\n        \r\n        function getErrorLoadingHandler() {\r\n            return defaultErrorLoadingHandler;\r\n        }\r\n      \r\n        var loadHandlers = {\r\n            setStartLoadHandler: setStartLoadHandler,\r\n            getStartLoadHandler: getStartLoadHandler,\r\n            setEndLoadHandler: setEndLoadHandler,\r\n            getEndLoadHandler: getEndLoadHandler,\r\n            setErrorLoadingHandler: setErrorLoadingHandler,\r\n            getErrorLoadingHandler: getErrorLoadingHandler\r\n        };\r\n\r\n        return loadHandlers;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.loadHandlerManager = loadHandlerManager();\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/loadHandlerManager.js\r\n\r\n// Begin Source: src/stateManagement/stackSpecificStateManager.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This implements an Stack specific tool state management strategy.  This means\r\n    // that tool data is shared between all imageIds in a given stack\r\n    function newStackSpecificToolStateManager(toolTypes, oldStateManager) {\r\n        var toolState = {};\r\n\r\n        function saveToolState() {\r\n            return toolState;\r\n        }\r\n\r\n        function restoreToolState(stackToolState) {\r\n            toolState = stackToolState;\r\n        }\r\n\r\n        // here we add tool state, this is done by tools as well\r\n        // as modules that restore saved state\r\n        function addStackSpecificToolState(element, toolType, data) {\r\n            // if this is a tool type to apply to the stack, do so\r\n            if (toolTypes.indexOf(toolType) >= 0) {\r\n\r\n                // if we don't have tool state for this type of tool, add an empty object\r\n                if (toolState.hasOwnProperty(toolType) === false) {\r\n                    toolState[toolType] = {\r\n                        data: []\r\n                    };\r\n                }\r\n\r\n                var toolData = toolState[toolType];\r\n\r\n                // finally, add this new tool to the state\r\n                toolData.data.push(data);\r\n            } else {\r\n                // call the imageId specific tool state manager\r\n                return oldStateManager.add(element, toolType, data);\r\n            }\r\n        }\r\n\r\n        // here you can get state - used by tools as well as modules\r\n        // that save state persistently\r\n        function getStackSpecificToolState(element, toolType) {\r\n            // if this is a tool type to apply to the stack, do so\r\n            if (toolTypes.indexOf(toolType) >= 0) {\r\n                // if we don't have tool state for this type of tool, add an empty object\r\n                if (toolState.hasOwnProperty(toolType) === false) {\r\n                    toolState[toolType] = {\r\n                        data: []\r\n                    };\r\n                }\r\n\r\n                var toolData = toolState[toolType];\r\n                return toolData;\r\n            } else {\r\n                // call the imageId specific tool state manager\r\n                return oldStateManager.get(element, toolType);\r\n            }\r\n        }\r\n\r\n        var stackSpecificToolStateManager = {\r\n            get: getStackSpecificToolState,\r\n            add: addStackSpecificToolState,\r\n            saveToolState: saveToolState,\r\n            restoreToolState: restoreToolState,\r\n            toolState: toolState,\r\n        };\r\n        return stackSpecificToolStateManager;\r\n    }\r\n\r\n    var stackStateManagers = [];\r\n\r\n    function addStackStateManager(element) {\r\n        var oldStateManager = cornerstoneTools.getElementToolStateManager(element);\r\n        if (!oldStateManager) {\r\n            oldStateManager = cornerstoneTools.globalImageIdSpecificToolStateManager;\r\n        }\r\n\r\n        var stackTools = [ 'stack', 'stackPrefetch', 'playClip', 'volume', 'slab', 'referenceLines', 'crosshairs' ];\r\n        var stackSpecificStateManager = cornerstoneTools.newStackSpecificToolStateManager(stackTools, oldStateManager);\r\n        stackStateManagers.push(stackSpecificStateManager);\r\n        cornerstoneTools.setElementToolStateManager(element, stackSpecificStateManager);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.newStackSpecificToolStateManager = newStackSpecificToolStateManager;\r\n    cornerstoneTools.addStackStateManager = addStackStateManager;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/stackSpecificStateManager.js\r\n\r\n// Begin Source: src/stateManagement/textStyleManager.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function textStyleManager() {\r\n        var defaultFontSize = 15,\r\n            defaultFont = defaultFontSize + 'px Arial',\r\n            defaultBackgroundColor = 'transparent';\r\n\r\n        function setFont(font) {\r\n            defaultFont = font;\r\n        }\r\n\r\n        function getFont() {\r\n            return defaultFont;\r\n        }\r\n\r\n        function setFontSize(fontSize) {\r\n            defaultFontSize = fontSize;\r\n        }\r\n\r\n        function getFontSize() {\r\n            return defaultFontSize;\r\n        }\r\n\r\n        function setBackgroundColor(backgroundColor) {\r\n            defaultBackgroundColor = backgroundColor;\r\n        }\r\n\r\n        function getBackgroundColor() {\r\n            return defaultBackgroundColor;\r\n        }\r\n\r\n        var textStyle = {\r\n            setFont: setFont,\r\n            getFont: getFont,\r\n            setFontSize: setFontSize,\r\n            getFontSize: getFontSize,\r\n            setBackgroundColor: setBackgroundColor,\r\n            getBackgroundColor: getBackgroundColor\r\n        };\r\n\r\n        return textStyle;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.textStyle = textStyleManager();\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/textStyleManager.js\r\n\r\n// Begin Source: src/stateManagement/timeSeriesSpecificStateManager.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This implements an Stack specific tool state management strategy.  This means\r\n    // that tool data is shared between all imageIds in a given stack\r\n    function newTimeSeriesSpecificToolStateManager(toolTypes, oldStateManager) {\r\n        var toolState = {};\r\n\r\n        // here we add tool state, this is done by tools as well\r\n        // as modules that restore saved state\r\n        function addStackSpecificToolState(element, toolType, data) {\r\n            // if this is a tool type to apply to the stack, do so\r\n            if (toolTypes.indexOf(toolType) >= 0) {\r\n\r\n                // if we don't have tool state for this type of tool, add an empty object\r\n                if (toolState.hasOwnProperty(toolType) === false) {\r\n                    toolState[toolType] = {\r\n                        data: []\r\n                    };\r\n                }\r\n\r\n                var toolData = toolState[toolType];\r\n\r\n                // finally, add this new tool to the state\r\n                toolData.data.push(data);\r\n            } else {\r\n                // call the imageId specific tool state manager\r\n                return oldStateManager.add(element, toolType, data);\r\n            }\r\n        }\r\n\r\n        // here you can get state - used by tools as well as modules\r\n        // that save state persistently\r\n        function getStackSpecificToolState(element, toolType) {\r\n            // if this is a tool type to apply to the stack, do so\r\n            if (toolTypes.indexOf(toolType) >= 0) {\r\n                // if we don't have tool state for this type of tool, add an empty object\r\n                if (toolState.hasOwnProperty(toolType) === false) {\r\n                    toolState[toolType] = {\r\n                        data: []\r\n                    };\r\n                }\r\n\r\n                var toolData = toolState[toolType];\r\n                return toolData;\r\n            } else {\r\n                // call the imageId specific tool state manager\r\n                return oldStateManager.get(element, toolType);\r\n            }\r\n        }\r\n\r\n        var imageIdToolStateManager = {\r\n            get: getStackSpecificToolState, add: addStackSpecificToolState\r\n        };\r\n        return imageIdToolStateManager;\r\n    }\r\n\r\n    var timeSeriesStateManagers = [];\r\n\r\n    function addTimeSeriesStateManager(element, tools) {\r\n        tools = tools || [ 'timeSeries' ];\r\n        var oldStateManager = cornerstoneTools.getElementToolStateManager(element);\r\n        if (oldStateManager === undefined) {\r\n            oldStateManager = cornerstoneTools.globalImageIdSpecificToolStateManager;\r\n        }\r\n\r\n        var timeSeriesSpecificStateManager = cornerstoneTools.newTimeSeriesSpecificToolStateManager(tools, oldStateManager);\r\n        timeSeriesStateManagers.push(timeSeriesSpecificStateManager);\r\n        cornerstoneTools.setElementToolStateManager(element, timeSeriesSpecificStateManager);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.newTimeSeriesSpecificToolStateManager = newTimeSeriesSpecificToolStateManager;\r\n    cornerstoneTools.addTimeSeriesStateManager = addTimeSeriesStateManager;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/timeSeriesSpecificStateManager.js\r\n\r\n// Begin Source: src/stateManagement/toolColorManager.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function toolColorManager(){\r\n        var defaultColor = 'white',\r\n            activeColor = 'greenyellow',\r\n            fillColor = 'transparent';\r\n\r\n        function setFillColor(color){\r\n            fillColor = color;\r\n        }\r\n\r\n        function getFillColor(){\r\n            return fillColor;\r\n        }\r\n\r\n        function setToolColor(color){\r\n            defaultColor = color;\r\n        }\r\n\r\n        function getToolColor(){\r\n            return defaultColor;\r\n        }\r\n\r\n        function setActiveToolColor(color){\r\n            activeColor = color;\r\n        }\r\n\r\n        function getActiveToolColor(){\r\n            return activeColor;\r\n        }\r\n\r\n        var toolColors = {\r\n            setFillColor: setFillColor,\r\n            getFillColor: getFillColor,\r\n            setToolColor: setToolColor,\r\n            getToolColor: getToolColor,\r\n            setActiveColor: setActiveToolColor,\r\n            getActiveColor: getActiveToolColor\r\n        };\r\n\r\n        return toolColors;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.toolColors = toolColorManager();\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/toolColorManager.js\r\n\r\n// Begin Source: src/stateManagement/toolCoordinateManager.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function toolCoordinateManager(){\r\n        var cooordsData = '';\r\n\r\n        function setActiveToolCoords(eventData){\r\n            cooordsData = eventData.currentPoints.canvas;\r\n        }\r\n\r\n        function getActiveToolCoords(){\r\n            return cooordsData;\r\n        }\r\n\r\n        var toolCoords = {\r\n            setCoords: setActiveToolCoords, getCoords: getActiveToolCoords\r\n        };\r\n\r\n        return toolCoords;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.toolCoordinates = toolCoordinateManager();\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/toolCoordinateManager.js\r\n\r\n// Begin Source: src/stateManagement/toolStateManager.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function getElementToolStateManager(element) {\r\n        var enabledImage = cornerstone.getEnabledElement(element);\r\n        // if the enabledImage has no toolStateManager, create a default one for it\r\n        // NOTE: This makes state management element specific\r\n        if (enabledImage.toolStateManager === undefined) {\r\n            enabledImage.toolStateManager = cornerstoneTools.globalImageIdSpecificToolStateManager;\r\n        }\r\n\r\n        return enabledImage.toolStateManager;\r\n    }\r\n\r\n    // here we add tool state, this is done by tools as well\r\n    // as modules that restore saved state\r\n    function addToolState(element, toolType, data) {\r\n        var toolStateManager = getElementToolStateManager(element);\r\n        toolStateManager.add(element, toolType, data);\r\n        // TODO: figure out how to broadcast this change to all enabled elements so they can update the image\r\n        // if this change effects them\r\n    }\r\n\r\n    // here you can get state - used by tools as well as modules\r\n    // that save state persistently\r\n    function getToolState(element, toolType) {\r\n        var toolStateManager = getElementToolStateManager(element);\r\n        return toolStateManager.get(element, toolType);\r\n    }\r\n\r\n    function removeToolState(element, toolType, data) {\r\n        var toolStateManager = getElementToolStateManager(element);\r\n        var toolData = toolStateManager.get(element, toolType);\r\n        // find this tool data\r\n        var indexOfData = -1;\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            if (toolData.data[i] === data) {\r\n                indexOfData = i;\r\n            }\r\n        }\r\n\r\n        if (indexOfData !== -1) {\r\n            toolData.data.splice(indexOfData, 1);\r\n        }\r\n    }\r\n\r\n    function clearToolState(element, toolType) {\r\n        var toolStateManager = getElementToolStateManager(element);\r\n        var toolData = toolStateManager.get(element, toolType);\r\n        \r\n        // If any toolData actually exists, clear it\r\n        if (toolData !== undefined) {\r\n            toolData.data = [];\r\n        }\r\n    }\r\n\r\n    // sets the tool state manager for an element\r\n    function setElementToolStateManager(element, toolStateManager) {\r\n        var enabledImage = cornerstone.getEnabledElement(element);\r\n        enabledImage.toolStateManager = toolStateManager;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.addToolState = addToolState;\r\n    cornerstoneTools.getToolState = getToolState;\r\n    cornerstoneTools.removeToolState = removeToolState;\r\n    cornerstoneTools.clearToolState = clearToolState;\r\n    cornerstoneTools.setElementToolStateManager = setElementToolStateManager;\r\n    cornerstoneTools.getElementToolStateManager = getElementToolStateManager;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/toolStateManager.js\r\n\r\n// Begin Source: src/stateManagement/toolStyleManager.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function toolStyleManager() {\r\n        var defaultWidth = 1,\r\n            activeWidth = 2;\r\n\r\n        function setToolWidth(width){\r\n            defaultWidth = width;\r\n        }\r\n\r\n        function getToolWidth(){\r\n            return defaultWidth;\r\n        }\r\n\r\n        function setActiveToolWidth(width){\r\n            activeWidth = width;\r\n        }\r\n\r\n        function getActiveToolWidth(){\r\n            return activeWidth;\r\n        }\r\n\r\n        var toolStyle = {\r\n            setToolWidth: setToolWidth,\r\n            getToolWidth: getToolWidth,\r\n            setActiveWidth: setActiveToolWidth,\r\n            getActiveWidth: getActiveToolWidth\r\n        };\r\n\r\n        return toolStyle;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.toolStyle = toolStyleManager();\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/stateManagement/toolStyleManager.js\r\n\r\n// Begin Source: src/synchronization/panZoomSynchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This function synchronizes the target zoom and pan to match the source\r\n    function panZoomSynchronizer(synchronizer, sourceElement, targetElement) {\r\n\r\n        // ignore the case where the source and target are the same enabled element\r\n        if (targetElement === sourceElement) {\r\n            return;\r\n        }\r\n        // get the source and target viewports\r\n        var sourceViewport = cornerstone.getViewport(sourceElement);\r\n        var targetViewport = cornerstone.getViewport(targetElement);\r\n\r\n        // do nothing if the scale and translation are the same\r\n        if (targetViewport.scale === sourceViewport.scale && targetViewport.translation.x === sourceViewport.translation.x && targetViewport.translation.y === sourceViewport.translation.y) {\r\n            return;\r\n        }\r\n\r\n        // scale and/or translation are different, sync them\r\n        targetViewport.scale = sourceViewport.scale;\r\n        targetViewport.translation.x = sourceViewport.translation.x;\r\n        targetViewport.translation.y = sourceViewport.translation.y;\r\n        synchronizer.setViewport(targetElement, targetViewport);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.panZoomSynchronizer = panZoomSynchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/panZoomSynchronizer.js\r\n\r\n// Begin Source: src/synchronization/stackImageIndexSynchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This function causes the image in the target stack to be set to the one closest\r\n    // to the image in the source stack by image position\r\n    function stackImageIndexSynchronizer(synchronizer, sourceElement, targetElement) {\r\n\r\n        // ignore the case where the source and target are the same enabled element\r\n        if (targetElement === sourceElement) {\r\n            return;\r\n        }\r\n\r\n        var sourceStackToolDataSource = cornerstoneTools.getToolState(sourceElement, 'stack');\r\n        var sourceStackData = sourceStackToolDataSource.data[0];\r\n        var targetStackToolDataSource = cornerstoneTools.getToolState(targetElement, 'stack');\r\n        var targetStackData = targetStackToolDataSource.data[0];\r\n\r\n        var newImageIdIndex = sourceStackData.currentImageIdIndex;\r\n\r\n        // clamp the index\r\n        newImageIdIndex = Math.min(Math.max(newImageIdIndex, 0), targetStackData.imageIds.length - 1);\r\n\r\n        // Do nothing if the index has not changed\r\n        if (newImageIdIndex === targetStackData.currentImageIdIndex) {\r\n            return;\r\n        }\r\n\r\n        var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n        var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n        var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n        if (startLoadingHandler) {\r\n            startLoadingHandler(targetElement);\r\n        }\r\n\r\n        cornerstone.loadAndCacheImage(targetStackData.imageIds[newImageIdIndex]).then(function(image) {\r\n            var viewport = cornerstone.getViewport(targetElement);\r\n            targetStackData.currentImageIdIndex = newImageIdIndex;\r\n            synchronizer.displayImage(targetElement, image, viewport);\r\n            if (endLoadingHandler) {\r\n                endLoadingHandler(targetElement);\r\n            }\r\n        }, function(error) {\r\n            var imageId = targetStackData.imageIds[newImageIdIndex];\r\n            if (errorLoadingHandler) {\r\n                errorLoadingHandler(targetElement, imageId, error);\r\n            }\r\n        });\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.stackImageIndexSynchronizer = stackImageIndexSynchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/stackImageIndexSynchronizer.js\r\n\r\n// Begin Source: src/synchronization/stackImagePositionSynchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This function causes the image in the target stack to be set to the one closest\r\n    // to the image in the source stack by image position\r\n    function stackImagePositionSynchronizer(synchronizer, sourceElement, targetElement) {\r\n\r\n        // ignore the case where the source and target are the same enabled element\r\n        if (targetElement === sourceElement) {\r\n            return;\r\n        }\r\n\r\n        var sourceImage = cornerstone.getEnabledElement(sourceElement).image;\r\n        var sourceImagePlane = cornerstoneTools.metaData.get('imagePlane', sourceImage.imageId);\r\n        var sourceImagePosition = sourceImagePlane.imagePositionPatient;\r\n\r\n        var stackToolDataSource = cornerstoneTools.getToolState(targetElement, 'stack');\r\n        var stackData = stackToolDataSource.data[0];\r\n\r\n        var minDistance = Number.MAX_VALUE;\r\n        var newImageIdIndex = -1;\r\n\r\n        $.each(stackData.imageIds, function(index, imageId) {\r\n            var imagePlane = cornerstoneTools.metaData.get('imagePlane', imageId);\r\n            var imagePosition = imagePlane.imagePositionPatient;\r\n            var distance = imagePosition.distanceToSquared(sourceImagePosition);\r\n            //console.log(index + '=' + distance);\r\n            if (distance < minDistance) {\r\n                minDistance = distance;\r\n                newImageIdIndex = index;\r\n            }\r\n        });\r\n\r\n        if (newImageIdIndex === stackData.currentImageIdIndex) {\r\n            return;\r\n        }\r\n\r\n        var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n        var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n        var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n        if (startLoadingHandler) {\r\n            startLoadingHandler(targetElement);\r\n        }\r\n\r\n        if (newImageIdIndex !== -1) {\r\n            cornerstone.loadAndCacheImage(stackData.imageIds[newImageIdIndex]).then(function(image) {\r\n                var viewport = cornerstone.getViewport(targetElement);\r\n                stackData.currentImageIdIndex = newImageIdIndex;\r\n                synchronizer.displayImage(targetElement, image, viewport);\r\n                if (endLoadingHandler) {\r\n                    endLoadingHandler(targetElement);\r\n                }\r\n            }, function(error) {\r\n                var imageId = stackData.imageIds[newImageIdIndex];\r\n                if (errorLoadingHandler) {\r\n                    errorLoadingHandler(targetElement, imageId, error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.stackImagePositionSynchronizer = stackImagePositionSynchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/stackImagePositionSynchronizer.js\r\n\r\n// Begin Source: src/synchronization/stackScrollSynchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This function causes any scrolling actions within the stack to propagate to \r\n    // all of the other viewports that are synced\r\n    function stackScrollSynchronizer(synchronizer, sourceElement, targetElement, eventData) {\r\n        // If the target and source are the same, stop\r\n        if (sourceElement === targetElement) {\r\n            return;\r\n        }\r\n\r\n        // If there is no event, or direction is 0, stop\r\n        if (!eventData || !eventData.direction) {\r\n            return;\r\n        }\r\n\r\n        // Get the stack of the target viewport\r\n        var stackToolDataSource = cornerstoneTools.getToolState(targetElement, 'stack');\r\n        var stackData = stackToolDataSource.data[0];\r\n\r\n        // Get the new index for the stack\r\n        var newImageIdIndex = stackData.currentImageIdIndex + eventData.direction;\r\n\r\n        // Ensure the index does not exceed the bounds of the stack\r\n        newImageIdIndex = Math.min(Math.max(newImageIdIndex, 0), stackData.imageIds.length - 1);\r\n\r\n        // If the index has not changed, stop here\r\n        if (stackData.currentImageIdIndex === newImageIdIndex) {\r\n            return;\r\n        }\r\n\r\n        var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n        var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n        var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n        if (startLoadingHandler) {\r\n            startLoadingHandler(targetElement);\r\n        }\r\n\r\n        cornerstone.loadAndCacheImage(stackData.imageIds[newImageIdIndex]).then(function(image) {\r\n            var viewport = cornerstone.getViewport(targetElement);\r\n            stackData.currentImageIdIndex = newImageIdIndex;\r\n            synchronizer.displayImage(targetElement, image, viewport);\r\n            if (endLoadingHandler) {\r\n                endLoadingHandler(targetElement);\r\n            }\r\n        }, function(error) {\r\n            var imageId = stackData.imageIds[newImageIdIndex];\r\n            if (errorLoadingHandler) {\r\n                errorLoadingHandler(targetElement, imageId, error);\r\n            }\r\n        });\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.stackScrollSynchronizer = stackScrollSynchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/stackScrollSynchronizer.js\r\n\r\n// Begin Source: src/synchronization/synchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This object is responsible for synchronizing target elements when an event fires on a source\r\n    // element\r\n    function Synchronizer(event, handler) {\r\n\r\n        var that = this;\r\n        var sourceElements = []; // source elements fire the events we want to synchronize to\r\n        var targetElements = []; // target elements we want to synchronize to source elements\r\n\r\n        var ignoreFiredEvents = false;\r\n\r\n        function fireEvent(sourceEnabledElement, eventData) {\r\n\r\n            // Broadcast an event that something changed\r\n            ignoreFiredEvents = true;\r\n            $.each(targetElements, function(index, targetEnabledElement) {\r\n                handler(that, sourceEnabledElement, targetEnabledElement, eventData);\r\n            });\r\n            ignoreFiredEvents = false;\r\n        }\r\n\r\n        function onEvent(e, eventData) {\r\n            if (ignoreFiredEvents === true) {\r\n                return;\r\n            }\r\n\r\n            fireEvent(e.currentTarget, eventData);\r\n        }\r\n\r\n        // adds an element as a source\r\n        this.addSource = function(element) {\r\n            // Return if this element was previously added\r\n            var index = sourceElements.indexOf(element);\r\n            if (index !== -1) {\r\n                return;\r\n            }\r\n\r\n            // Add to our list of enabled elements\r\n            sourceElements.push(element);\r\n\r\n            // subscribe to the event\r\n            $(element).on(event, onEvent);\r\n\r\n            // Update everyone listening for events\r\n            fireEvent(element);\r\n        };\r\n\r\n        // adds an element as a target\r\n        this.addTarget = function(element) {\r\n            // Return if this element was previously added\r\n            var index = targetElements.indexOf(element);\r\n            if (index !== -1) {\r\n                return;\r\n            }\r\n\r\n            // Add to our list of enabled elements\r\n            targetElements.push(element);\r\n\r\n            // Invoke the handler for this new target element\r\n            handler(that, element, element);\r\n        };\r\n\r\n        // adds an element as both a source and a target\r\n        this.add = function(element) {\r\n            that.addSource(element);\r\n            that.addTarget(element);\r\n        };\r\n\r\n        // removes an element as a source\r\n        this.removeSource = function(element) {\r\n            // Find the index of this element\r\n            var index = sourceElements.indexOf(element);\r\n            if (index === -1) {\r\n                return;\r\n            }\r\n\r\n            // remove this element from the array\r\n            sourceElements.splice(index, 1);\r\n\r\n            // stop listening for the event\r\n            $(element).off(event, onEvent);\r\n\r\n            // Update everyone listening for events\r\n            fireEvent(element);\r\n        };\r\n\r\n        // removes an element as a target\r\n        this.removeTarget = function(element) {\r\n            // Find the index of this element\r\n            var index = targetElements.indexOf(element);\r\n            if (index === -1) {\r\n                return;\r\n            }\r\n\r\n            // remove this element from the array\r\n            targetElements.splice(index, 1);\r\n\r\n            // Invoke the handler for the removed target\r\n            handler(that, element, element);\r\n        };\r\n\r\n        // removes an element as both a source and target\r\n        this.remove = function(element) {\r\n            that.removeTarget(element);\r\n            that.removeSource(element);\r\n        };\r\n\r\n        // returns the source elements\r\n        this.getSourceElements = function() {\r\n            return sourceElements;\r\n        };\r\n\r\n        this.displayImage = function(element, image, viewport) {\r\n            ignoreFiredEvents = true;\r\n            cornerstone.displayImage(element, image, viewport);\r\n            ignoreFiredEvents = false;\r\n        };\r\n\r\n        this.setViewport = function(element, viewport) {\r\n            ignoreFiredEvents = true;\r\n            cornerstone.setViewport(element, viewport);\r\n            ignoreFiredEvents = false;\r\n        };\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.Synchronizer = Synchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/synchronizer.js\r\n\r\n// Begin Source: src/synchronization/updateImageSynchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This function causes the target image to be drawn immediately\r\n    function updateImageSynchronizer(synchronizer, sourceElement, targetElement) {\r\n\r\n        // ignore the case where the source and target are the same enabled element\r\n        if (targetElement === sourceElement) {\r\n            return;\r\n        }\r\n\r\n        cornerstone.updateImage(targetElement);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.updateImageSynchronizer = updateImageSynchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/updateImageSynchronizer.js\r\n\r\n// Begin Source: src/synchronization/wwwcSynchronizer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // This function synchronizes the target element ww/wc to match the source element\r\n    function wwwcSynchronizer(synchronizer, sourceElement, targetElement) {\r\n\r\n        // ignore the case where the source and target are the same enabled element\r\n        if (targetElement === sourceElement) {\r\n            return;\r\n        }\r\n        // get the source and target viewports\r\n        var sourceViewport = cornerstone.getViewport(sourceElement);\r\n        var targetViewport = cornerstone.getViewport(targetElement);\r\n\r\n        // do nothing if the ww/wc already match\r\n        if (targetViewport.voi.windowWidth === sourceViewport.voi.windowWidth && targetViewport.voi.windowCenter === sourceViewport.voi.windowCenter && targetViewport.invert === sourceViewport.invert) {\r\n            return;\r\n        }\r\n\r\n        // www/wc are different, sync them\r\n        targetViewport.voi.windowWidth = sourceViewport.voi.windowWidth;\r\n        targetViewport.voi.windowCenter = sourceViewport.voi.windowCenter;\r\n        targetViewport.invert = sourceViewport.invert;\r\n        synchronizer.setViewport(targetElement, targetViewport);\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.wwwcSynchronizer = wwwcSynchronizer;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/synchronization/wwwcSynchronizer.js\r\n\r\n// Begin Source: src/timeSeriesTools/ProbeTool4D.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'probe4D';\r\n\r\n    function updateLineSample(measurementData) {\r\n        var samples = [];\r\n\r\n        measurementData.timeSeries.stacks.forEach(function(stack) {\r\n            cornerstone.loadAndCacheImage(stack.imageIds[measurementData.imageIdIndex]).then(function(image) {\r\n                var offset = Math.round(measurementData.handles.end.x) + Math.round(measurementData.handles.end.y) * image.width;\r\n                var sample = image.getPixelData()[offset];\r\n                samples.push(sample);\r\n                //console.log(sample);\r\n            });\r\n        });\r\n        measurementData.lineSample.set(samples);\r\n    }\r\n\r\n    ///////// BEGIN ACTIVE TOOL ///////\r\n    function createNewMeasurement(mouseEventData) {\r\n        var timeSeriestoolData = cornerstoneTools.getToolState(mouseEventData.element, 'timeSeries');\r\n        if (timeSeriestoolData === undefined || timeSeriestoolData.data === undefined || timeSeriestoolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var timeSeries = timeSeriestoolData.data[0];\r\n\r\n        // create the measurement data for this tool with the end handle activated\r\n        var measurementData = {\r\n            timeSeries: timeSeries, lineSample: new cornerstoneTools.LineSampleMeasurement(), imageIdIndex: timeSeries.stacks[timeSeries.currentStackIndex].currentImageIdIndex, visible: true, handles: {\r\n                end: {\r\n                    x: mouseEventData.currentPoints.image.x,\r\n                    y: mouseEventData.currentPoints.image.y,\r\n                    highlight: true,\r\n                    active: true\r\n                }\r\n            }\r\n        };\r\n        updateLineSample(measurementData);\r\n        cornerstoneTools.MeasurementManager.add(measurementData);\r\n        return measurementData;\r\n    }\r\n    ///////// END ACTIVE TOOL ///////\r\n\r\n    ///////// BEGIN IMAGE RENDERING ///////\r\n\r\n    function onImageRendered(e, eventData) {\r\n\r\n        // if we have no toolData for this element, return immediately as there is nothing to do\r\n        var toolData = cornerstoneTools.getToolState(e.currentTarget, toolType);\r\n        if (toolData === undefined) {\r\n            return;\r\n        }\r\n\r\n        // we have tool data for this element - iterate over each one and draw it\r\n        var context = eventData.canvasContext.canvas.getContext('2d');\r\n        cornerstone.setToPixelCoordinateSystem(eventData.enabledElement, context);\r\n        var color = 'white';\r\n\r\n        for (var i = 0; i < toolData.data.length; i++) {\r\n            context.save();\r\n            var data = toolData.data[i];\r\n\r\n            // draw the handles\r\n            context.beginPath();\r\n            cornerstoneTools.drawHandles(context, eventData, data.handles, color);\r\n            context.stroke();\r\n\r\n            // Draw text\r\n            var fontParameters = cornerstoneTools.setContextToDisplayFontSize(eventData.enabledElement, eventData.canvasContext, 15);\r\n            context.font = '' + fontParameters.fontSize + 'px Arial';\r\n\r\n            // translate the x/y away from the cursor\r\n            var x = Math.round(data.handles.end.x);\r\n            var y = Math.round(data.handles.end.y);\r\n            var textX = data.handles.end.x + 3;\r\n            var textY = data.handles.end.y - 3;\r\n\r\n            context.fillStyle = color;\r\n\r\n            context.fillText('' + x + ',' + y, textX, textY);\r\n\r\n            context.restore();\r\n        }\r\n    }\r\n    ///////// END IMAGE RENDERING ///////\r\n\r\n    // module exports\r\n    cornerstoneTools.probeTool4D = cornerstoneTools.mouseButtonTool({\r\n        createNewMeasurement: createNewMeasurement, onImageRendered: onImageRendered, toolType: toolType\r\n    });\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/timeSeriesTools/ProbeTool4D.js\r\n\r\n// Begin Source: src/timeSeriesTools/timeSeries.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function incrementTimePoint(element, timePoints, wrap) {\r\n        var toolData = cornerstoneTools.getToolState(element, 'timeSeries');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var timeSeriesData = toolData.data[0];\r\n        var currentStack = timeSeriesData.stacks[timeSeriesData.currentStackIndex];\r\n        var currentImageIdIndex = currentStack.currentImageIdIndex;\r\n        var newStackIndex = timeSeriesData.currentStackIndex + timePoints;\r\n\r\n        // loop around if we go outside the stack\r\n        if (wrap) {\r\n            if (newStackIndex >= timeSeriesData.stacks.length) {\r\n                newStackIndex = 0;\r\n            }\r\n\r\n            if (newStackIndex < 0) {\r\n                newStackIndex = timeSeriesData.stacks.length - 1;\r\n            }\r\n        } else {\r\n            newStackIndex = Math.min(timeSeriesData.stacks.length - 1, newStackIndex);\r\n            newStackIndex = Math.max(0, newStackIndex);\r\n        }\r\n\r\n        if (newStackIndex !== timeSeriesData.currentStackIndex) {\r\n            var viewport = cornerstone.getViewport(element);\r\n            var newStack = timeSeriesData.stacks[newStackIndex];\r\n\r\n            var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n            var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n            var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n            if (startLoadingHandler) {\r\n                startLoadingHandler(element);\r\n            }\r\n\r\n            cornerstone.loadAndCacheImage(newStack.imageIds[currentImageIdIndex]).then(function(image) {\r\n                if (timeSeriesData.currentImageIdIndex !== currentImageIdIndex) {\r\n                    newStack.currentImageIdIndex = currentImageIdIndex;\r\n                    timeSeriesData.currentStackIndex = newStackIndex;\r\n                    cornerstone.displayImage(element, image, viewport);\r\n                    if (endLoadingHandler) {\r\n                        endLoadingHandler(element);\r\n                    }\r\n                }\r\n            }, function(error) {\r\n                var imageId = newStack.imageIds[currentImageIdIndex];\r\n                if (errorLoadingHandler) {\r\n                    errorLoadingHandler(element, imageId, error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.incrementTimePoint = incrementTimePoint;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/timeSeriesTools/timeSeries.js\r\n\r\n// Begin Source: src/timeSeriesTools/timeSeriesPlayer.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    var toolType = 'timeSeriesPlayer';\r\n\r\n    /**\r\n     * Starts playing a clip or adjusts the frame rate of an already playing clip.  framesPerSecond is\r\n     * optional and defaults to 30 if not specified.  A negative framesPerSecond will play the clip in reverse.\r\n     * The element must be a stack of images\r\n     * @param element\r\n     * @param framesPerSecond\r\n     */\r\n    function playClip(element, framesPerSecond) {\r\n        if (element === undefined) {\r\n            throw 'playClip: element must not be undefined';\r\n        }\r\n\r\n        if (framesPerSecond === undefined) {\r\n            framesPerSecond = 30;\r\n        }\r\n\r\n        var timeSeriesToolData = cornerstoneTools.getToolState(element, 'timeSeries');\r\n        if (timeSeriesToolData === undefined || timeSeriesToolData.data === undefined || timeSeriesToolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var playClipToolData = cornerstoneTools.getToolState(element, toolType);\r\n        var playClipData;\r\n        if (playClipToolData === undefined || playClipToolData.data.length === 0) {\r\n            playClipData = {\r\n                intervalId: undefined, framesPerSecond: framesPerSecond, lastFrameTimeStamp: undefined, frameRate: 0\r\n            };\r\n            cornerstoneTools.addToolState(element, toolType, playClipData);\r\n        } else {\r\n            playClipData = playClipToolData.data[0];\r\n            playClipData.framesPerSecond = framesPerSecond;\r\n        }\r\n\r\n        // if already playing, do not set a new interval\r\n        if (playClipData.intervalId !== undefined) {\r\n            return;\r\n        }\r\n\r\n        playClipData.intervalId = setInterval(function() {\r\n            if (playClipData.framesPerSecond > 0) {\r\n                cornerstoneTools.incrementTimePoint(element, 1, true);\r\n            } else {\r\n                cornerstoneTools.incrementTimePoint(element, -1, true);\r\n            }\r\n        }, 1000 / Math.abs(playClipData.framesPerSecond));\r\n    }\r\n\r\n    /**\r\n     * Stops an already playing clip.\r\n     * * @param element\r\n     */\r\n    function stopClip(element) {\r\n        var playClipToolData = cornerstoneTools.getToolState(element, toolType);\r\n        var playClipData;\r\n        if (playClipToolData === undefined || playClipToolData.data.length === 0) {\r\n            return;\r\n        } else {\r\n            playClipData = playClipToolData.data[0];\r\n        }\r\n\r\n        clearInterval(playClipData.intervalId);\r\n        playClipData.intervalId = undefined;\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.timeSeriesPlayer = {\r\n        start: playClip, stop: stopClip\r\n    };\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/timeSeriesTools/timeSeriesPlayer.js\r\n\r\n// Begin Source: src/timeSeriesTools/timeSeriesScroll.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function mouseUpCallback(e, eventData) {\r\n        $(eventData.element).off('CornerstoneToolsMouseDrag', mouseDragCallback);\r\n        $(eventData.element).off('CornerstoneToolsMouseUp', mouseUpCallback);\r\n    }\r\n\r\n    function mouseDownCallback(e, eventData) {\r\n        if (cornerstoneTools.isMouseButtonEnabled(eventData.which, e.data.mouseButtonMask)) {\r\n\r\n            var mouseDragEventData = {\r\n                deltaY: 0,\r\n                options: e.data.options\r\n            };\r\n            $(eventData.element).on('CornerstoneToolsMouseDrag', mouseDragEventData, mouseDragCallback);\r\n            $(eventData.element).on('CornerstoneToolsMouseUp', mouseUpCallback);\r\n            e.stopImmediatePropagation();\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function mouseDragCallback(e, eventData) {\r\n        e.data.deltaY += eventData.deltaPoints.page.y;\r\n\r\n        var toolData = cornerstoneTools.getToolState(eventData.element, 'timeSeries');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var timeSeriesData = toolData.data[0];\r\n\r\n        var pixelsPerTimeSeries = $(eventData.element).height() / timeSeriesData.stacks.length ;\r\n        if (e.data.options !== undefined && e.data.options.timeSeriesScrollSpeed !== undefined) {\r\n            pixelsPerTimeSeries = e.data.options.timeSeriesScrollSpeed;\r\n        }\r\n\r\n        if (e.data.deltaY >= pixelsPerTimeSeries || e.data.deltaY <= -pixelsPerTimeSeries) {\r\n            var timeSeriesDelta = Math.round(e.data.deltaY / pixelsPerTimeSeries);\r\n            var timeSeriesDeltaMod = e.data.deltaY % pixelsPerTimeSeries;\r\n            cornerstoneTools.incrementTimePoint(eventData.element, timeSeriesDelta);\r\n            e.data.deltaY = timeSeriesDeltaMod;\r\n        }\r\n\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    function mouseWheelCallback(e, eventData) {\r\n        var images = -eventData.direction;\r\n        cornerstoneTools.incrementTimePoint(eventData.element, images);\r\n    }\r\n\r\n    function onDrag(e) {\r\n        var mouseMoveData = e.originalEvent.detail;\r\n        var eventData = {\r\n            deltaY: 0\r\n        };\r\n        eventData.deltaY += mouseMoveData.deltaPoints.page.y;\r\n\r\n        var toolData = cornerstoneTools.getToolState(mouseMoveData.element, 'stack');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        if (eventData.deltaY >= 3 || eventData.deltaY <= -3) {\r\n            var timeSeriesDelta = eventData.deltaY / 3;\r\n            var timeSeriesDeltaMod = eventData.deltaY % 3;\r\n            cornerstoneTools.setTimePoint(eventData.element, timeSeriesDelta);\r\n            eventData.deltaY = timeSeriesDeltaMod;\r\n        }\r\n\r\n        return false; // false = cases jquery to preventDefault() and stopPropagation() this event\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.timeSeriesScroll = cornerstoneTools.simpleMouseButtonTool(mouseDownCallback);\r\n    cornerstoneTools.timeSeriesScrollWheel = cornerstoneTools.mouseWheelTool(mouseWheelCallback);\r\n    cornerstoneTools.timeSeriesScrollTouchDrag = cornerstoneTools.touchDragTool(onDrag);\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/timeSeriesTools/timeSeriesScroll.js\r\n\r\n// Begin Source: src/util/RoundToDecimal.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function roundToDecimal(value, precision) {\r\n        var multiplier = Math.pow(10, precision);\r\n        return (Math.round(value * multiplier) / multiplier);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.roundToDecimal = roundToDecimal;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/RoundToDecimal.js\r\n\r\n// Begin Source: src/util/calculateSUV.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function calculateSUV(image, storedPixelValue) {\r\n        // if no dicom data set, return undefined\r\n        if (image.data === undefined) {\r\n            return undefined;\r\n        }\r\n        \r\n        // image must be PET\r\n        if (image.data.string('x00080060') !== 'PT') {\r\n            return undefined;\r\n        }\r\n\r\n        var modalityPixelValue = storedPixelValue * image.slope + image.intercept;\r\n\r\n        var patientWeight = image.data.floatString('x00101030'); // in kg\r\n        if (patientWeight === undefined) {\r\n            return undefined;\r\n        }\r\n\r\n        var petSequence = image.data.elements.x00540016;\r\n        if (petSequence === undefined) {\r\n            return undefined;\r\n        }\r\n\r\n        petSequence = petSequence.items[0].dataSet;\r\n        var startTime = petSequence.time('x00181072');\r\n        var totalDose = petSequence.floatString('x00181074');\r\n        var halfLife = petSequence.floatString('x00181075');\r\n        var acquisitionTime = image.data.time('x00080032');\r\n        \r\n        if (!startTime || !totalDose || !halfLife || !acquisitionTime) {\r\n            return undefined;\r\n        }\r\n\r\n        var acquisitionTimeInSeconds = acquisitionTime.fractionalSeconds + acquisitionTime.seconds + acquisitionTime.minutes * 60 + acquisitionTime.hours * 60 * 60;\r\n        var injectionStartTimeInSeconds = startTime.fractionalSeconds + startTime.seconds + startTime.minutes * 60 + startTime.hours * 60 * 60;\r\n        var durationInSeconds = acquisitionTimeInSeconds - injectionStartTimeInSeconds;\r\n        var correctedDose = totalDose * Math.exp(-durationInSeconds * Math.log(2) / halfLife);\r\n        var suv = modalityPixelValue * patientWeight / correctedDose * 1000;\r\n\r\n        return suv;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.calculateSUV = calculateSUV;\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/util/calculateSUV.js\r\n\r\n// Begin Source: src/util/copyPoints.js\r\n(function($, cornerstone, cornerstoneMath, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function copyPoints(points) {\r\n        var page = cornerstoneMath.point.copy(points.page);\r\n        var image = cornerstoneMath.point.copy(points.image);\r\n        var client = cornerstoneMath.point.copy(points.client);\r\n        var canvas = cornerstoneMath.point.copy(points.canvas);\r\n        return {\r\n            page: page, image: image, client: client, canvas: canvas\r\n        };\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.copyPoints = copyPoints;\r\n\r\n})($, cornerstone, cornerstoneMath, cornerstoneTools);\r\n \r\n// End Source; src/util/copyPoints.js\r\n\r\n// Begin Source: src/util/drawEllipse.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // http://stackoverflow.com/questions/2172798/how-to-draw-an-oval-in-html5-canvas\r\n    function drawEllipse(context, x, y, w, h) {\r\n        var kappa = 0.5522848,\r\n            ox = (w / 2) * kappa, // control point offset horizontal\r\n            oy = (h / 2) * kappa, // control point offset vertical\r\n            xe = x + w, // x-end\r\n            ye = y + h, // y-end\r\n            xm = x + w / 2, // x-middle\r\n            ym = y + h / 2; // y-middle\r\n\r\n        context.beginPath();\r\n        context.moveTo(x, ym);\r\n        context.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\r\n        context.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\r\n        context.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\r\n        context.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\r\n        context.closePath();\r\n        context.stroke();\r\n    }\r\n\r\n    // Module exports\r\n    cornerstoneTools.drawEllipse = drawEllipse;\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/util/drawEllipse.js\r\n\r\n// Begin Source: src/util/drawTextBox.js\r\n(function(cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function drawTextBox(context, text, x, y, color) {\r\n        var padding = 5,\r\n            font = cornerstoneTools.textStyle.getFont(),\r\n            fontSize = cornerstoneTools.textStyle.getFontSize(),\r\n            backgroundColor = cornerstoneTools.textStyle.getBackgroundColor();\r\n\r\n        context.save();\r\n\r\n        // Get the text width in the current font\r\n        context.font = font;\r\n        var width = context.measureText(text).width;\r\n\r\n        // Draw the background box with padding\r\n        context.textBaseline = 'top';\r\n        context.fillStyle = backgroundColor;\r\n        context.fillRect(x, y - fontSize, width + (padding * 2), fontSize + (padding * 2));\r\n        \r\n        // Draw the text\r\n        context.fillStyle = color;\r\n        context.fillText(text, x + padding, y - fontSize + padding);\r\n        \r\n        context.restore();\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.drawTextBox = drawTextBox;\r\n\r\n})(cornerstoneTools);\r\n \r\n// End Source; src/util/drawTextBox.js\r\n\r\n// Begin Source: src/util/getMaxSimultaneousRequests.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // Maximum concurrent connections to the same server\r\n    // Information from http://sgdev-blog.blogspot.fr/2014/01/maximum-concurrent-connection-to-same.html\r\n    var maxSimultaneousRequests = {\r\n        default: 6,\r\n        IE: {\r\n            9: 6,\r\n            10: 8,\r\n            default: 8\r\n        },\r\n        Firefox: {\r\n            default: 6\r\n        },\r\n        Opera: {\r\n            10: 8,\r\n            11: 6,\r\n            12: 6,\r\n            default: 6\r\n        },\r\n        Chrome: {\r\n            default: 6\r\n        },\r\n        Safari: {\r\n            default: 4\r\n        }\r\n    };\r\n\r\n    // Browser name / version detection\r\n    // http://stackoverflow.com/questions/2400935/browser-detection-in-javascript\r\n    function getBrowserInfo() {\r\n        var ua = navigator.userAgent,\r\n            M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [],\r\n            tem;\r\n        \r\n        if (/trident/i.test(M[1])) {\r\n            tem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\r\n            return 'IE ' + (tem[1] || '');\r\n        }\r\n\r\n        if (M[1] === 'Chrome') {\r\n            tem = ua.match(/\\b(OPR|Edge)\\/(\\d+)/);\r\n            if (tem !== null) {\r\n                return tem.slice(1).join(' ').replace('OPR', 'Opera');\r\n            }\r\n        }\r\n\r\n        M = M[2]? [ M[1], M[2] ]: [ navigator.appName, navigator.appVersion, '-?' ];\r\n        if ((tem = ua.match(/version\\/(\\d+)/i)) !== null) {\r\n            M.splice(1, 1, tem[1]);\r\n        }\r\n\r\n        return M.join(' ');\r\n    }\r\n\r\n    function getMaxSimultaneousRequests() {\r\n        var config = cornerstoneTools.stackPrefetch.getConfiguration();\r\n\r\n        // Give preference to user-chosen values\r\n        if (config.maxSimultaneousRequests) {\r\n            return config.maxSimultaneousRequests;\r\n        }\r\n\r\n        var infoString = getBrowserInfo();\r\n        var info = infoString.split(' ');\r\n        var browserName = info[0];\r\n        var browserVersion = info[1];\r\n        var browserData = maxSimultaneousRequests[browserName];\r\n\r\n        if (!browserData) {\r\n            return maxSimultaneousRequests['default'];\r\n        }\r\n\r\n        if (!browserData[browserVersion]) {\r\n            return browserData['default'];\r\n        }\r\n\r\n        return browserData[browserVersion];\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.getMaxSimultaneousRequests = getMaxSimultaneousRequests;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/getMaxSimultaneousRequests.js\r\n\r\n// Begin Source: src/util/isMouseButtonEnabled.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function isMouseButtonEnabled(which, mouseButtonMask) {\r\n        /*jshint bitwise: false*/\r\n        var mouseButton = (1 << (which - 1));\r\n        return ((mouseButtonMask & mouseButton) !== 0);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.isMouseButtonEnabled = isMouseButtonEnabled;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/isMouseButtonEnabled.js\r\n\r\n// Begin Source: src/util/pauseEvent.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    /**\r\n     * This function is used to prevent selection from occuring when left click dragging on the image\r\n     * @param e the event that is provided to your event handler\r\n     * Based on: http://stackoverflow.com/questions/5429827/how-can-i-prevent-text-element-selection-with-cursor-drag\r\n     * @returns {boolean}\r\n     */\r\n    function pauseEvent(e) {\r\n        if (e.stopPropagation) {\r\n            e.stopPropagation();\r\n        }\r\n\r\n        if (e.preventDefault) {\r\n            e.preventDefault();\r\n        }\r\n\r\n        e.cancelBubble = true;\r\n        e.returnValue = false;\r\n        return false;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.pauseEvent = pauseEvent;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/pauseEvent.js\r\n\r\n// Begin Source: src/util/pointProjector.js\r\n(function($, cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    // projects a patient point to an image point\r\n    function projectPatientPointToImagePlane(patientPoint, imagePlane) {\r\n        var point = patientPoint.clone().sub(imagePlane.imagePositionPatient);\r\n        var x = imagePlane.rowCosines.dot(point) / imagePlane.columnPixelSpacing;\r\n        var y = imagePlane.columnCosines.dot(point) / imagePlane.rowPixelSpacing;\r\n        return {\r\n            x: x, y: y\r\n        };\r\n    }\r\n\r\n    // projects an image point to a patient point\r\n    function imagePointToPatientPoint(imagePoint, imagePlane) {\r\n        var x = imagePlane.rowCosines.clone().multiplyScalar(imagePoint.x);\r\n        x.multiplyScalar(imagePlane.columnPixelSpacing);\r\n        var y = imagePlane.columnCosines.clone().multiplyScalar(imagePoint.y);\r\n        y.multiplyScalar(imagePlane.rowPixelSpacing);\r\n        var patientPoint = x.add(y);\r\n        patientPoint.add(imagePlane.imagePositionPatient);\r\n        return patientPoint;\r\n    }\r\n\r\n    function getRectangleFromImagePlane(imagePlane) {\r\n        // Get the points\r\n        var topLeft = imagePointToPatientPoint({\r\n            x: 0,\r\n            y: 0\r\n        }, imagePlane);\r\n        var topRight = imagePointToPatientPoint({\r\n            x: imagePlane.columns,\r\n            y: 0\r\n        }, imagePlane);\r\n        var bottomLeft = imagePointToPatientPoint({\r\n            x: 0,\r\n            y: imagePlane.rows\r\n        }, imagePlane);\r\n        var bottomRight = imagePointToPatientPoint({\r\n            x: imagePlane.columns,\r\n            y: imagePlane.rows\r\n        }, imagePlane);\r\n\r\n        // Get each side as a vector\r\n        var rect = {\r\n            top: new cornerstoneMath.Line3(topLeft, topRight),\r\n            left: new cornerstoneMath.Line3(topLeft, bottomLeft),\r\n            right: new cornerstoneMath.Line3(topRight, bottomRight),\r\n            bottom: new cornerstoneMath.Line3(bottomLeft, bottomRight),\r\n        };\r\n        return rect;\r\n    }\r\n\r\n    function lineRectangleIntersection(line, rect) {\r\n        var intersections = [];\r\n        Object.keys(rect).forEach(function(side) {\r\n            var segment = rect[side];\r\n            var intersection = line.intersectLine(segment);\r\n            if (intersection) {\r\n                intersections.push(intersection);\r\n            }\r\n        });\r\n        return intersections;\r\n    }\r\n\r\n    function planePlaneIntersection(targetImagePlane, referenceImagePlane) {\r\n        // Gets the line of intersection between two planes in patient space\r\n\r\n        // First, get the normals of each image plane\r\n        var targetNormal = targetImagePlane.rowCosines.clone().cross(targetImagePlane.columnCosines);\r\n        var targetPlane = new cornerstoneMath.Plane();\r\n        targetPlane.setFromNormalAndCoplanarPoint(targetNormal, targetImagePlane.imagePositionPatient);\r\n\r\n        var referenceNormal = referenceImagePlane.rowCosines.clone().cross(referenceImagePlane.columnCosines);\r\n        var referencePlane = new cornerstoneMath.Plane();\r\n        referencePlane.setFromNormalAndCoplanarPoint(referenceNormal, referenceImagePlane.imagePositionPatient);\r\n\r\n        var originDirection = referencePlane.clone().intersectPlane(targetPlane);\r\n        var origin = originDirection.origin;\r\n        var direction = originDirection.direction;\r\n\r\n        // Calculate the longest possible length in the reference image plane (the length of the diagonal)\r\n        var bottomRight = imagePointToPatientPoint({\r\n            x: referenceImagePlane.columns,\r\n            y: referenceImagePlane.rows\r\n        }, referenceImagePlane);\r\n        var distance = referenceImagePlane.imagePositionPatient.distanceTo(bottomRight);\r\n\r\n        // Use this distance to bound the ray intersecting the two planes\r\n        var line = new cornerstoneMath.Line3();\r\n        line.start = origin;\r\n        line.end = origin.clone().add(direction.multiplyScalar(distance));\r\n\r\n        // Find the intersections between this line and the reference image plane's four sides\r\n        var rect = getRectangleFromImagePlane(referenceImagePlane);\r\n        var intersections = lineRectangleIntersection(line, rect);\r\n\r\n        // Return the intersections between this line and the reference image plane's sides\r\n        // in order to draw the reference line from the target image.\r\n        if (intersections.length !== 2) {\r\n            return;\r\n        }\r\n\r\n        var points = {\r\n            start: intersections[0],\r\n            end: intersections[1]\r\n        };\r\n        return points;\r\n\r\n    }\r\n\r\n    // module/private exports\r\n    cornerstoneTools.projectPatientPointToImagePlane = projectPatientPointToImagePlane;\r\n    cornerstoneTools.imagePointToPatientPoint = imagePointToPatientPoint;\r\n    cornerstoneTools.planePlaneIntersection = planePlaneIntersection;\r\n\r\n})($, cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/pointProjector.js\r\n\r\n// Begin Source: src/util/scroll.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function scroll(element, images) {\r\n        var toolData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var stackData = toolData.data[0];\r\n\r\n        var newImageIdIndex = stackData.currentImageIdIndex + images;\r\n        newImageIdIndex = Math.min(stackData.imageIds.length - 1, newImageIdIndex);\r\n        newImageIdIndex = Math.max(0, newImageIdIndex);\r\n\r\n        cornerstoneTools.scrollToIndex(element, newImageIdIndex);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.scroll = scroll;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/scroll.js\r\n\r\n// Begin Source: src/util/scrollToIndex.js\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    function scrollToIndex(element, newImageIdIndex) {\r\n        var toolData = cornerstoneTools.getToolState(element, 'stack');\r\n        if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var stackData = toolData.data[0];\r\n\r\n        // Allow for negative indexing\r\n        if (newImageIdIndex < 0) {\r\n            newImageIdIndex += stackData.imageIds.length;\r\n        }\r\n\r\n        var startLoadingHandler = cornerstoneTools.loadHandlerManager.getStartLoadHandler();\r\n        var endLoadingHandler = cornerstoneTools.loadHandlerManager.getEndLoadHandler();\r\n        var errorLoadingHandler = cornerstoneTools.loadHandlerManager.getErrorLoadingHandler();\r\n\r\n        function doneCallback(image) {\r\n            //console.log('interaction done: ' + image.imageId);\r\n            if (stackData.currentImageIdIndex === newImageIdIndex) {\r\n                cornerstone.displayImage(element, image, viewport);\r\n                if (endLoadingHandler) {\r\n                    endLoadingHandler(element);\r\n                }\r\n            }\r\n        }\r\n\r\n        function failCallback(error) {\r\n            var imageId = stackData.imageIds[newImageIdIndex];\r\n            if (errorLoadingHandler) {\r\n                errorLoadingHandler(element, imageId, error);\r\n            }\r\n        }\r\n\r\n        if (newImageIdIndex === stackData.currentImageIdIndex) {\r\n            return;\r\n        }\r\n\r\n        if (startLoadingHandler) {\r\n            startLoadingHandler(element);\r\n        }\r\n\r\n        var eventData = {\r\n            newImageIdIndex: newImageIdIndex,\r\n            direction: newImageIdIndex - stackData.currentImageIdIndex\r\n        };\r\n\r\n        stackData.currentImageIdIndex = newImageIdIndex;\r\n        var viewport = cornerstone.getViewport(element);\r\n        var newImageId = stackData.imageIds[newImageIdIndex];\r\n\r\n        // Retry image loading in cases where previous image promise\r\n        // was rejected, if the option is set\r\n        var config = cornerstoneTools.stackScroll.getConfiguration();\r\n        if (config && config.retryLoadOnScroll === true) {\r\n            var newImagePromise = cornerstone.imageCache.getImagePromise(newImageId);\r\n            if (newImagePromise && newImagePromise.state() === 'rejected') {\r\n                cornerstone.imageCache.removeImagePromise(newImageId);\r\n            }\r\n        }\r\n\r\n        var requestPoolManager = cornerstoneTools.requestPoolManager;\r\n        var type = 'interaction';\r\n\r\n        cornerstoneTools.requestPoolManager.clearRequestStack(type);\r\n\r\n        requestPoolManager.addRequest(element, newImageId, type, doneCallback, failCallback);\r\n        requestPoolManager.startGrabbing();\r\n\r\n        $(element).trigger('CornerstoneStackScroll', eventData);\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneTools.scrollToIndex = scrollToIndex;\r\n    cornerstoneTools.loadHandlers = {};\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/scrollToIndex.js\r\n\r\n// Begin Source: src/util/setContextToDisplayFontSize.js\r\n/**\r\n * This module sets the transformation matrix for a canvas context so it displays fonts\r\n * smoothly even when the image is highly scaled up\r\n */\r\n(function(cornerstone, cornerstoneTools) {\r\n\r\n    'use strict';\r\n\r\n    /**\r\n     * Sets the canvas context transformation matrix so it is scaled to show text\r\n     * more cleanly even if the image is scaled up.  See\r\n     * https://github.com/chafey/cornerstoneTools/wiki/DrawingText\r\n     * for more information\r\n     *\r\n     * @param ee\r\n     * @param context\r\n     * @param fontSize\r\n     * @returns {{fontSize: number, lineHeight: number, fontScale: number}}\r\n     */\r\n    function setContextToDisplayFontSize(ee, context, fontSize) {\r\n        var fontScale = 0.1;\r\n        cornerstone.setToPixelCoordinateSystem(ee, context, fontScale);\r\n        // return the font size to use\r\n        var scaledFontSize = fontSize / ee.viewport.scale / fontScale;\r\n        // TODO: actually calculate this?\r\n        var lineHeight = fontSize / ee.viewport.scale / fontScale;\r\n        return {\r\n            fontSize: scaledFontSize, lineHeight: lineHeight, fontScale: fontScale\r\n        };\r\n    }\r\n\r\n    // Module exports\r\n    cornerstoneTools.setContextToDisplayFontSize = setContextToDisplayFontSize;\r\n\r\n})(cornerstone, cornerstoneTools);\r\n \r\n// End Source; src/util/setContextToDisplayFontSize.js\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/cornerstoneTools.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 72,
    "kind": "file",
    "name": "src/client/lib/cornerstoneWADOImageLoader.js",
    "content": "/*! cornerstone-wado-image-loader - v0.7.0 - 2015-09-06 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */\r\n//\r\n// This is a cornerstone image loader for WADO-URI requests.  It has limited support for compressed\r\n// transfer syntaxes, check here to see what is currently supported:\r\n//\r\n// https://github.com/chafey/cornerstoneWADOImageLoader/blob/master/docs/TransferSyntaxes.md\r\n//\r\n// It will support implicit little endian transfer syntaxes but explicit little endian is strongly preferred\r\n// to avoid any parsing issues related to SQ elements.  To request that the WADO object be returned as explicit little endian, append\r\n// the following on your WADO url: &transferSyntax=1.2.840.10008.1.2.1\r\n//\r\n\r\nif(typeof cornerstone === 'undefined'){\r\n  cornerstone = {};\r\n}\r\nif(typeof cornerstoneWADOImageLoader === 'undefined'){\r\n  cornerstoneWADOImageLoader = {\r\n    internal: {\r\n      options : {\r\n        // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\r\n        beforeSend: function (xhr) {\r\n        }\r\n      },\r\n      multiFrameCacheHack : {}\r\n    }\r\n  };\r\n}\r\n\r\n\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function convertRGB(dataSet, decodedImageFrame, rgbaBuffer) {\r\n    var planarConfiguration = dataSet.uint16('x00280006');\r\n    if(planarConfiguration === 0) {\r\n      cornerstoneWADOImageLoader.convertRGBColorByPixel(decodedImageFrame, rgbaBuffer);\r\n    } else {\r\n      cornerstoneWADOImageLoader.convertRGBColorByPlane(decodedImageFrame, rgbaBuffer);\r\n    }\r\n  }\r\n\r\n  function convertColorSpace(canvas, dataSet, imageFrame) {\r\n    // extract the fields we need\r\n    var height = dataSet.uint16('x00280010');\r\n    var width = dataSet.uint16('x00280011');\r\n    var photometricInterpretation = dataSet.string('x00280004');\r\n\r\n    // setup the canvas context\r\n    canvas.height = height;\r\n    canvas.width = width;\r\n    var context = canvas.getContext('2d');\r\n    var imageData = context.createImageData(width, height);\r\n\r\n\r\n    // convert based on the photometric interpretation\r\n    var deferred = $.Deferred();\r\n    try {\r\n      if (photometricInterpretation === \"RGB\" )\r\n      {\r\n        convertRGB(dataSet, imageFrame, imageData.data);\r\n      }\r\n      else if (photometricInterpretation === \"YBR_RCT\")\r\n      {\r\n        convertRGB(dataSet, imageFrame, imageData.data);\r\n      }\r\n      else if (photometricInterpretation === \"YBR_ICT\")\r\n      {\r\n        convertRGB(dataSet, imageFrame, imageData.data);\r\n      }\r\n      else if( photometricInterpretation === \"PALETTE COLOR\" )\r\n      {\r\n        cornerstoneWADOImageLoader.convertPALETTECOLOR(imageFrame, imageData.data, dataSet );\r\n      }\r\n      else if( photometricInterpretation === \"YBR_FULL_422\" )\r\n      {\r\n        cornerstoneWADOImageLoader.convertYBRFull(imageFrame, imageData.data);\r\n      }\r\n      else if(photometricInterpretation === \"YBR_FULL\" )\r\n      {\r\n        cornerstoneWADOImageLoader.convertYBRFull(imageFrame, imageData.data);\r\n      }\r\n      else\r\n      {\r\n        throw \"no color space conversion for photometric interpretation \" + photometricInterpretation;\r\n      }\r\n      deferred.resolve(imageData);\r\n      return deferred;\r\n    } catch (error) {\r\n      deferred.reject(error);\r\n      return deferred;\r\n    }\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.convertColorSpace = convertColorSpace;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function convertPALETTECOLOR( imageFrame, rgbaBuffer, dataSet ) {\r\n    var len=dataSet.int16('x00281101',0);\r\n    var start=dataSet.int16('x00281101',1);\r\n    var bits=dataSet.int16('x00281101',2);\r\n    var shift = (bits===8 ? 0 : 8 );\r\n\r\n    var buffer = dataSet.byteArray.buffer;\r\n    var rData=new Uint16Array( buffer, dataSet.elements.x00281201.dataOffset, len );\r\n    var gData=new Uint16Array( buffer, dataSet.elements.x00281202.dataOffset, len );\r\n    var bData=new Uint16Array( buffer, dataSet.elements.x00281203.dataOffset, len );\r\n\r\n    var numPixels = dataSet.uint16('x00280010') * dataSet.uint16('x00280011');\r\n    var palIndex=0;\r\n    var rgbaIndex=0;\r\n\r\n    for( var i=0 ; i < numPixels ; ++i ) {\r\n      var value=imageFrame[palIndex++];\r\n      if( value < start )\r\n        value=0;\r\n      else if( value > start + len -1 )\r\n        value=len-1;\r\n      else\r\n        value=value-start;\r\n\r\n      rgbaBuffer[ rgbaIndex++ ] = rData[value] >> shift;\r\n      rgbaBuffer[ rgbaIndex++ ] = gData[value] >> shift;\r\n      rgbaBuffer[ rgbaIndex++ ] = bData[value] >> shift;\r\n      rgbaBuffer[ rgbaIndex++ ] = 255;\r\n    }\r\n\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.convertPALETTECOLOR = convertPALETTECOLOR;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n/**\r\n */\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    function convertRGBColorByPixel(imageFrame, rgbaBuffer) {\r\n        if(imageFrame === undefined) {\r\n            throw \"decodeRGB: rgbBuffer must not be undefined\";\r\n        }\r\n        if(imageFrame.length % 3 !== 0) {\r\n            throw \"decodeRGB: rgbBuffer length must be divisible by 3\";\r\n        }\r\n\r\n        var numPixels = imageFrame.length / 3;\r\n        var rgbIndex = 0;\r\n        var rgbaIndex = 0;\r\n        for(var i= 0; i < numPixels; i++) {\r\n            rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\r\n            rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\r\n            rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\r\n            rgbaBuffer[rgbaIndex++] = 255; //alpha\r\n        }\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneWADOImageLoader.convertRGBColorByPixel = convertRGBColorByPixel;\r\n}(cornerstoneWADOImageLoader));\r\n/**\r\n */\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function convertRGBColorByPlane(imageFrame, rgbaBuffer) {\r\n    if(imageFrame === undefined) {\r\n      throw \"decodeRGB: rgbBuffer must not be undefined\";\r\n    }\r\n    if(imageFrame.length % 3 !== 0) {\r\n      throw \"decodeRGB: rgbBuffer length must be divisible by 3\";\r\n    }\r\n\r\n    var numPixels = imageFrame.length / 3;\r\n    var rgbaIndex = 0;\r\n    for(var i= 0; i < numPixels; i++) {\r\n      var rIndex = 0;\r\n      var gIndex = numPixels;\r\n      var bIndex = numPixels*2;\r\n      for(var i= 0; i < numPixels; i++) {\r\n        rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\r\n        rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\r\n        rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\r\n        rgbaBuffer[rgbaIndex++] = 255; //alpha\r\n      }\r\n    }\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.convertRGBColorByPlane = convertRGBColorByPlane;\r\n}(cornerstoneWADOImageLoader));\r\n/**\r\n */\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    function convertYBRFull(imageFrame, rgbaBuffer) {\r\n        if(imageFrame === undefined) {\r\n            throw \"decodeRGB: ybrBuffer must not be undefined\";\r\n        }\r\n        if(imageFrame.length % 3 !== 0) {\r\n            throw \"decodeRGB: ybrBuffer length must be divisble by 3\";\r\n        }\r\n\r\n        var numPixels = imageFrame.length / 3;\r\n        var ybrIndex = 0;\r\n        var rgbaIndex = 0;\r\n        for(var i= 0; i < numPixels; i++) {\r\n            var y = imageFrame[ybrIndex++];\r\n            var cb = imageFrame[ybrIndex++];\r\n            var cr = imageFrame[ybrIndex++];\r\n            rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\r\n            rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb -128) - 0.71414 * (cr- 128); // green\r\n            rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\r\n            rgbaBuffer[rgbaIndex++] = 255; //alpha\r\n        }\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneWADOImageLoader.convertYBRFull = convertYBRFull;\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function configure(options) {\r\n    cornerstoneWADOImageLoader.internal.options = options;\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.configure = configure;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    // Loads an image given an imageId\r\n    // wado url example:\r\n    // http://localhost:3333/wado?requestType=WADO&studyUID=1.3.6.1.4.1.25403.166563008443.5076.20120418075541.1&seriesUID=1.3.6.1.4.1.25403.166563008443.5076.20120418075541.2&objectUID=1.3.6.1.4.1.25403.166563008443.5076.20120418075557.1&contentType=application%2Fdicom&transferSyntax=1.2.840.10008.1.2.1\r\n    // NOTE: supposedly the instance will be returned in Explicit Little Endian transfer syntax if you don't\r\n    // specify a transferSyntax but Osirix doesn't do this and seems to return it with the transfer syntax it is\r\n    // stored as.\r\n    function loadImage(imageId) {\r\n        // create a deferred object\r\n\r\n        // build a url by parsing out the url scheme and frame index from the imageId\r\n        var firstColonIndex = imageId.indexOf(':');\r\n        var url = imageId.substring(firstColonIndex + 1);\r\n        var frameIndex = url.indexOf('frame=');\r\n        var frame;\r\n        if(frameIndex !== -1) {\r\n            var frameStr = url.substr(frameIndex + 6);\r\n            frame = parseInt(frameStr);\r\n            url = url.substr(0, frameIndex-1);\r\n        }\r\n\r\n        // if multiframe and cached, use the cached data set to extract the frame\r\n        if(frame !== undefined &&\r\n          cornerstoneWADOImageLoader.internal.multiFrameCacheHack.hasOwnProperty(url))\r\n        {\r\n            var deferred = $.Deferred();\r\n            var dataSet = cornerstoneWADOImageLoader.internal.multiFrameCacheHack[url];\r\n            var imagePromise = cornerstoneWADOImageLoader.createImageObject(dataSet, imageId, frame);\r\n            imagePromise.then(function(image) {\r\n                deferred.resolve(image);\r\n            }, function(error) {\r\n                deferred.reject(error);\r\n            });\r\n            return deferred;\r\n        }\r\n\r\n        return cornerstoneWADOImageLoader.internal.xhrRequest(imageId, frame, url);\r\n    }\r\n\r\n    // registery dicomweb and wadouri image loader prefixes\r\n    cornerstone.loadImage = loadImage;\r\n    cornerstone.registerImageLoader('dicomweb', loadImage);\r\n    cornerstone.registerImageLoader('wadouri', loadImage);\r\n\r\n}($, cornerstone, cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function createImageObject( dataSet, imageId, frame ) {\r\n    if(frame === undefined) {\r\n      frame = 0;\r\n    }\r\n\r\n    // make the image based on whether it is color or not\r\n    var photometricInterpretation = dataSet.string('x00280004');\r\n    var isColor = cornerstoneWADOImageLoader.isColorImage(photometricInterpretation);\r\n    if(isColor === false) {\r\n      return cornerstoneWADOImageLoader.makeGrayscaleImage(imageId, dataSet, frame);\r\n    } else {\r\n      return cornerstoneWADOImageLoader.makeColorImage(imageId, dataSet, frame);\r\n    }\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.createImageObject = createImageObject;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n  function decodeJPEG2000(dataSet, frame)\r\n  {\r\n    var height = dataSet.uint16('x00280010');\r\n    var width = dataSet.uint16('x00280011');\r\n    var compressedPixelData = dicomParser.readEncapsulatedPixelData(dataSet, dataSet.elements.x7fe00010, frame);\r\n    var jpxImage = new JpxImage();\r\n    jpxImage.parse(compressedPixelData);\r\n\r\n    var j2kWidth = jpxImage.width;\r\n    var j2kHeight = jpxImage.height;\r\n    if(j2kWidth !== width) {\r\n      throw 'JPEG2000 decoder returned width of ' + j2kWidth + ', when ' + width + ' is expected';\r\n    }\r\n    if(j2kHeight !== height) {\r\n      throw 'JPEG2000 decoder returned width of ' + j2kHeight + ', when ' + height + ' is expected';\r\n    }\r\n    var tileCount = jpxImage.tiles.length;\r\n    if(tileCount !== 1) {\r\n      throw 'JPEG2000 decoder returned a tileCount of ' + tileCount + ', when 1 is expected';\r\n    }\r\n    var tileComponents = jpxImage.tiles[0];\r\n    var pixelData = tileComponents.items;\r\n    return pixelData;\r\n  }\r\n\r\n  cornerstoneWADOImageLoader.decodeJPEG2000 = decodeJPEG2000;\r\n}($, cornerstone, cornerstoneWADOImageLoader));\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n  function decodeJPEGBaseline(dataSet, frame)\r\n  {\r\n    var pixelDataElement = dataSet.elements.x7fe00010;\r\n    var height = dataSet.uint16('x00280010');\r\n    var width = dataSet.uint16('x00280011');\r\n    var bitsAllocated = dataSet.uint16('x00280100');\r\n    var frameData = dicomParser.readEncapsulatedPixelData(dataSet, pixelDataElement, frame);\r\n    var jpeg = new JpegImage();\r\n    jpeg.parse( frameData );\r\n    if(bitsAllocated === 8) {\r\n      return jpeg.getData(width, height);\r\n    }\r\n    else if(bitsAllocated === 16) {\r\n      return jpeg.getData16(width, height);\r\n    }\r\n  }\r\n\r\n  cornerstoneWADOImageLoader.decodeJPEGBaseline = decodeJPEGBaseline;\r\n}($, cornerstone, cornerstoneWADOImageLoader));\r\n/**\r\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\r\n */\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function arrayBufferToString(buffer) {\r\n    return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\r\n  }\r\n\r\n  function binaryToString(binary) {\r\n    var error;\r\n\r\n    try {\r\n      return decodeURIComponent(escape(binary));\r\n    } catch (_error) {\r\n      error = _error;\r\n      if (error instanceof URIError) {\r\n        return binary;\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  function decodeJPEGBaseline8Bit(canvas, dataSet, frame) {\r\n    var deferred = $.Deferred();\r\n\r\n    var height = dataSet.uint16('x00280010');\r\n    var width = dataSet.uint16('x00280011');\r\n    // resize the canvas\r\n    canvas.height = height;\r\n    canvas.width = width;\r\n\r\n    var encodedPixelData = dicomParser.readEncapsulatedPixelData(dataSet, dataSet.elements.x7fe00010, frame);\r\n\r\n    var imgBlob = new Blob([encodedPixelData], {type: \"image/jpeg\"});\r\n\r\n    var r = new FileReader();\r\n    if(r.readAsBinaryString === undefined) {\r\n      r.readAsArrayBuffer(imgBlob);\r\n    }\r\n    else {\r\n      r.readAsBinaryString(imgBlob); // doesn't work on IE11\r\n    }\r\n\r\n    r.onload = function(){\r\n      var img=new Image();\r\n      img.onload = function() {\r\n        var context = canvas.getContext('2d');\r\n        context.drawImage(this, 0, 0);\r\n        var imageData = context.getImageData(0, 0, width, height);\r\n        deferred.resolve(imageData);\r\n      };\r\n      img.onerror = function(error) {\r\n        deferred.reject(error);\r\n      };\r\n      if(r.readAsBinaryString === undefined) {\r\n        img.src = \"data:image/jpeg;base64,\"+window.btoa(arrayBufferToString(r.result));\r\n      }\r\n      else {\r\n        img.src = \"data:image/jpeg;base64,\"+window.btoa(r.result); // doesn't work on IE11\r\n      }\r\n\r\n    };\r\n    return deferred;\r\n  }\r\n\r\n  function isJPEGBaseline8Bit(dataSet) {\r\n    var transferSyntax = dataSet.string('x00020010');\r\n    var bitsAllocated = dataSet.uint16('x00280100');\r\n\r\n    if((bitsAllocated === 8) &&\r\n      transferSyntax === \"1.2.840.10008.1.2.4.50\")\r\n    {\r\n      return true;\r\n    }\r\n\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.decodeJPEGBaseline8Bit = decodeJPEGBaseline8Bit;\r\n  cornerstoneWADOImageLoader.isJPEGBaseline8Bit = isJPEGBaseline8Bit;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n\"use strict\";\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  function decodeJPEGLossless(dataSet, frame) {\r\n    var pixelDataElement = dataSet.elements.x7fe00010;\r\n    var bitsAllocated = dataSet.uint16('x00280100');\r\n    var pixelRepresentation = dataSet.uint16('x00280103');\r\n    var frameData = dicomParser.readEncapsulatedPixelData(dataSet, pixelDataElement, frame);\r\n    var byteOutput = bitsAllocated <= 8 ? 1 : 2;\r\n    //console.time('jpeglossless');\r\n    var decoder = new jpeg.lossless.Decoder();\r\n    var decompressedData = decoder.decode(frameData.buffer, frameData.byteOffset, frameData.length, byteOutput);\r\n    //console.timeEnd('jpeglossless');\r\n    if (pixelRepresentation === 0) {\r\n      if (byteOutput === 2) {\r\n        return new Uint16Array(decompressedData.buffer);\r\n      } else {\r\n        // untested!\r\n        return new Uint8Array(decompressedData.buffer);\r\n      }\r\n    } else {\r\n      return new Int16Array(decompressedData.buffer);\r\n    }\r\n  }\r\n  // module exports\r\n  cornerstoneWADOImageLoader.decodeJPEGLossless = decodeJPEGLossless;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n/**\r\n */\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  function decodeRLE(dataSet, frame) {\r\n    var height = dataSet.uint16('x00280010');\r\n    var width = dataSet.uint16('x00280011');\r\n    var samplesPerPixel = dataSet.uint16('x00280002');\r\n    var pixelDataElement = dataSet.elements.x7fe00010;\r\n\r\n    var frameData = dicomParser.readEncapsulatedPixelData(dataSet, pixelDataElement, frame);\r\n    var pixelFormat = cornerstoneWADOImageLoader.getPixelFormat(dataSet);\r\n\r\n\r\n    var frameSize = width*height;\r\n    var buffer;\r\n    if( pixelFormat===1 ) {\r\n      buffer = new ArrayBuffer(frameSize*samplesPerPixel);\r\n      decode8( frameData, buffer, frameSize, samplesPerPixel);\r\n      return new Uint8Array(buffer);\r\n    } else if( pixelFormat===2 ) {\r\n      buffer = new ArrayBuffer(frameSize*samplesPerPixel*2);\r\n      decode16( frameData, buffer, frameSize );\r\n      return new Uint16Array(buffer);\r\n    } else if( pixelFormat===3 ) {\r\n      buffer = new ArrayBuffer(frameSize*samplesPerPixel*2);\r\n      decode16( frameData, buffer, frameSize );\r\n      return new Int16Array(buffer);\r\n    }\r\n  }\r\n\r\n  function decode8( frameData, outFrame, frameSize, samplesSize ) {\r\n    var header=new DataView(frameData.buffer, frameData.byteOffset);\r\n    var data=new DataView( frameData.buffer, frameData.byteOffset );\r\n    var out=new DataView( outFrame );\r\n\r\n    var outIndex=0;\r\n    var numSegments = header.getInt32(0,true);\r\n    for( var s=0 ; s < numSegments ; ++s ) {\r\n      outIndex = s;\r\n\r\n      var inIndex=header.getInt32( (s+1)*4,true);\r\n      var maxIndex=header.getInt32( (s+2)*4,true);\r\n      if( maxIndex===0 )\r\n        maxIndex = frameData.length;\r\n\r\n      var endOfSegment = frameSize * numSegments;\r\n\r\n      while( inIndex < maxIndex ) {\r\n        var n=data.getInt8(inIndex++);\r\n        if( n >=0 && n <=127 ) {\r\n          // copy n bytes\r\n          for( var i=0 ; i < n+1 && outIndex < endOfSegment; ++i ) {\r\n            out.setInt8(outIndex, data.getInt8(inIndex++));\r\n            outIndex+=samplesSize;\r\n          }\r\n        } else if( n<= -1 && n>=-127 ) {\r\n          var value=data.getInt8(inIndex++);\r\n          // run of n bytes\r\n          for( var j=0 ; j < -n+1 && outIndex < endOfSegment; ++j ) {\r\n            out.setInt8(outIndex, value );\r\n            outIndex+=samplesSize;\r\n          }\r\n        } else if (n===-128)\r\n          ; // do nothing\r\n      }\r\n    }\r\n  }\r\n\r\n  function decode16( frameData, outFrame, frameSize ) {\r\n    var header=new DataView(frameData.buffer, frameData.byteOffset);\r\n    var data=new DataView( frameData.buffer, frameData.byteOffset );\r\n    var out=new DataView( outFrame );\r\n\r\n    var numSegments = header.getInt32(0,true);\r\n    for( var s=0 ; s < numSegments ; ++s ) {\r\n      var outIndex=0;\r\n      var highByte=( s===0 ? 1 : 0);\r\n\r\n      var inIndex=header.getInt32( (s+1)*4,true);\r\n      var maxIndex=header.getInt32( (s+2)*4,true);\r\n      if( maxIndex===0 )\r\n        maxIndex = frameData.length;\r\n\r\n      while( inIndex < maxIndex ) {\r\n        var n=data.getInt8(inIndex++);\r\n        if( n >=0 && n <=127 ) {\r\n          for( var i=0 ; i < n+1 && outIndex < frameSize ; ++i ) {\r\n            out.setInt8( (outIndex*2)+highByte, data.getInt8(inIndex++) );\r\n            outIndex++;\r\n          }\r\n        } else if( n<= -1 && n>=-127 ) {\r\n          var value=data.getInt8(inIndex++);\r\n          for( var j=0 ; j < -n+1 && outIndex < frameSize ; ++j ) {\r\n            out.setInt8( (outIndex*2)+highByte, value );\r\n            outIndex++;\r\n          }\r\n        } else if (n===-128)\r\n          ; // do nothing\r\n      }\r\n    }\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.decodeRLE = decodeRLE;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function decodeTransferSyntax(dataSet, frame) {\r\n    var transferSyntax = dataSet.string('x00020010');\r\n\r\n    // Implicit VR Little Endian\r\n    if( transferSyntax === \"1.2.840.10008.1.2\") {\r\n      return cornerstoneWADOImageLoader.extractUncompressedPixels(dataSet, frame);\r\n    }\r\n    // Explicit VR Little Endian\r\n    else if( transferSyntax === \"1.2.840.10008.1.2.1\") {\r\n      return cornerstoneWADOImageLoader.extractUncompressedPixels(dataSet, frame);\r\n    }\r\n    // JPEG 2000 Lossless\r\n    else if(transferSyntax === \"1.2.840.10008.1.2.4.90\")\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n    }\r\n    // JPEG 2000 Lossy\r\n    else if(transferSyntax === \"1.2.840.10008.1.2.4.91\")\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n    }\r\n    /* Don't know if these work...\r\n    // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\r\n    else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n    }\r\n    // JPEG 2000 Part 2 Multicomponent Image Compression\r\n    else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\r\n    }\r\n    */\r\n    // RLE Lossless\r\n    else if ( transferSyntax === \"1.2.840.10008.1.2.5\" )\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeRLE( dataSet, frame);\r\n    }\r\n    // JPEG Baseline lossy process 1 (8 bit)\r\n    else if ( transferSyntax === \"1.2.840.10008.1.2.4.50\" )\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEGBaseline(dataSet, frame);\r\n    }\r\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\r\n    else if ( transferSyntax === \"1.2.840.10008.1.2.4.51\" )\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEGBaseline(dataSet, frame);\r\n    }\r\n    // JPEG Lossless, Nonhierarchical (Processes 14)\r\n    else if ( transferSyntax === \"1.2.840.10008.1.2.4.57\" )\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEGLossless(dataSet, frame);\r\n    }\r\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\r\n    else if ( transferSyntax === \"1.2.840.10008.1.2.4.70\" )\r\n    {\r\n      return cornerstoneWADOImageLoader.decodeJPEGLossless(dataSet, frame);\r\n    }\r\n    else\r\n    {\r\n      throw \"no decoder for transfer syntax \" + transferSyntax;\r\n    }\r\n  }\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.decodeTransferSyntax = decodeTransferSyntax;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n// jshint ignore: start\r\n\r\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- /\r\n /* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\r\n/*\r\n Copyright 2011 notmasteryet\r\n\r\n Licensed under the Apache License, Version 2.0 (the \"License\");\r\n you may not use this file except in compliance with the License.\r\n You may obtain a copy of the License at\r\n\r\n http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n Unless required by applicable law or agreed to in writing, software\r\n distributed under the License is distributed on an \"AS IS\" BASIS,\r\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n See the License for the specific language governing permissions and\r\n limitations under the License.\r\n */\r\n\r\n// - The JPEG specification can be found in the ITU CCITT Recommendation T.81\r\n//   (www.w3.org/Graphics/JPEG/itu-t81.pdf)\r\n// - The JFIF specification can be found in the JPEG File Interchange Format\r\n//   (www.w3.org/Graphics/JPEG/jfif3.pdf)\r\n// - The Adobe Application-Specific JPEG markers in the Supporting the DCT Filters\r\n//   in PostScript Level 2, Technical Note #5116\r\n//   (partners.adobe.com/public/developer/en/ps/sdk/5116.DCT_Filter.pdf)\r\n\r\nvar ColorSpace = {Unkown: 0, Grayscale: 1, AdobeRGB: 2, RGB: 3, CYMK: 4};\r\nvar JpegImage = (function jpegImage() {\r\n  \"use strict\";\r\n  var dctZigZag = new Int32Array([\r\n    0,\r\n    1, 8,\r\n    16, 9, 2,\r\n    3, 10, 17, 24,\r\n    32, 25, 18, 11, 4,\r\n    5, 12, 19, 26, 33, 40,\r\n    48, 41, 34, 27, 20, 13, 6,\r\n    7, 14, 21, 28, 35, 42, 49, 56,\r\n    57, 50, 43, 36, 29, 22, 15,\r\n    23, 30, 37, 44, 51, 58,\r\n    59, 52, 45, 38, 31,\r\n    39, 46, 53, 60,\r\n    61, 54, 47,\r\n    55, 62,\r\n    63\r\n  ]);\r\n\r\n  var dctCos1 = 4017;   // cos(pi/16)\r\n  var dctSin1 = 799;   // sin(pi/16)\r\n  var dctCos3 = 3406;   // cos(3*pi/16)\r\n  var dctSin3 = 2276;   // sin(3*pi/16)\r\n  var dctCos6 = 1567;   // cos(6*pi/16)\r\n  var dctSin6 = 3784;   // sin(6*pi/16)\r\n  var dctSqrt2 = 5793;   // sqrt(2)\r\n  var dctSqrt1d2 = 2896;  // sqrt(2) / 2\r\n\r\n  function constructor() {\r\n  }\r\n\r\n  function buildHuffmanTable(codeLengths, values) {\r\n    var k = 0, code = [], i, j, length = 16;\r\n    while (length > 0 && !codeLengths[length - 1])\r\n      length--;\r\n    code.push({children: [], index: 0});\r\n    var p = code[0], q;\r\n    for (i = 0; i < length; i++) {\r\n      for (j = 0; j < codeLengths[i]; j++) {\r\n        p = code.pop();\r\n        p.children[p.index] = values[k];\r\n        while (p.index > 0) {\r\n          p = code.pop();\r\n        }\r\n        p.index++;\r\n        code.push(p);\r\n        while (code.length <= i) {\r\n          code.push(q = {children: [], index: 0});\r\n          p.children[p.index] = q.children;\r\n          p = q;\r\n        }\r\n        k++;\r\n      }\r\n      if (i + 1 < length) {\r\n        // p here points to last code\r\n        code.push(q = {children: [], index: 0});\r\n        p.children[p.index] = q.children;\r\n        p = q;\r\n      }\r\n    }\r\n    return code[0].children;\r\n  }\r\n\r\n  function getBlockBufferOffset(component, row, col) {\r\n    return 64 * ((component.blocksPerLine + 1) * row + col);\r\n  }\r\n\r\n  function decodeScan(data, offset,\r\n                      frame, components, resetInterval,\r\n                      spectralStart, spectralEnd,\r\n                      successivePrev, successive) {\r\n    var precision = frame.precision;\r\n    var samplesPerLine = frame.samplesPerLine;\r\n    var scanLines = frame.scanLines;\r\n    var mcusPerLine = frame.mcusPerLine;\r\n    var progressive = frame.progressive;\r\n    var maxH = frame.maxH, maxV = frame.maxV;\r\n\r\n    var startOffset = offset, bitsData = 0, bitsCount = 0;\r\n\r\n    function readBit() {\r\n      if (bitsCount > 0) {\r\n        bitsCount--;\r\n        return (bitsData >> bitsCount) & 1;\r\n      }\r\n      bitsData = data[offset++];\r\n      if (bitsData == 0xFF) {\r\n        var nextByte = data[offset++];\r\n        if (nextByte) {\r\n          throw \"unexpected marker: \" + ((bitsData << 8) | nextByte).toString(16);\r\n        }\r\n        // unstuff 0\r\n      }\r\n      bitsCount = 7;\r\n      return bitsData >>> 7;\r\n    }\r\n\r\n    function decodeHuffman(tree) {\r\n      var node = tree;\r\n      var bit;\r\n      while ((bit = readBit()) !== null) {\r\n        node = node[bit];\r\n        if (typeof node === 'number')\r\n          return node;\r\n        if (typeof node !== 'object')\r\n          throw \"invalid huffman sequence\";\r\n      }\r\n      return null;\r\n    }\r\n\r\n    function receive(length) {\r\n      var n = 0;\r\n      while (length > 0) {\r\n        var bit = readBit();\r\n        if (bit === null)\r\n          return;\r\n        n = (n << 1) | bit;\r\n        length--;\r\n      }\r\n      return n;\r\n    }\r\n\r\n    function receiveAndExtend(length) {\r\n      var n = receive(length);\r\n      if (n >= 1 << (length - 1))\r\n        return n;\r\n      return n + (-1 << length) + 1;\r\n    }\r\n\r\n    function decodeBaseline(component, offset) {\r\n      var t = decodeHuffman(component.huffmanTableDC);\r\n      var diff = t === 0 ? 0 : receiveAndExtend(t);\r\n      component.blockData[offset] = (component.pred += diff);\r\n      var k = 1;\r\n      while (k < 64) {\r\n        var rs = decodeHuffman(component.huffmanTableAC);\r\n        var s = rs & 15, r = rs >> 4;\r\n        if (s === 0) {\r\n          if (r < 15)\r\n            break;\r\n          k += 16;\r\n          continue;\r\n        }\r\n        k += r;\r\n        var z = dctZigZag[k];\r\n        component.blockData[offset + z] = receiveAndExtend(s);\r\n        k++;\r\n      }\r\n    }\r\n\r\n    function decodeDCFirst(component, offset) {\r\n      var t = decodeHuffman(component.huffmanTableDC);\r\n      var diff = t === 0 ? 0 : (receiveAndExtend(t) << successive);\r\n      component.blockData[offset] = (component.pred += diff);\r\n    }\r\n\r\n    function decodeDCSuccessive(component, offset) {\r\n      component.blockData[offset] |= readBit() << successive;\r\n    }\r\n\r\n    var eobrun = 0;\r\n    function decodeACFirst(component, offset) {\r\n      if (eobrun > 0) {\r\n        eobrun--;\r\n        return;\r\n      }\r\n      var k = spectralStart, e = spectralEnd;\r\n      while (k <= e) {\r\n        var rs = decodeHuffman(component.huffmanTableAC);\r\n        var s = rs & 15, r = rs >> 4;\r\n        if (s === 0) {\r\n          if (r < 15) {\r\n            eobrun = receive(r) + (1 << r) - 1;\r\n            break;\r\n          }\r\n          k += 16;\r\n          continue;\r\n        }\r\n        k += r;\r\n        var z = dctZigZag[k];\r\n        component.blockData[offset + z] = receiveAndExtend(s) * (1 << successive);\r\n        k++;\r\n      }\r\n    }\r\n\r\n    var successiveACState = 0, successiveACNextValue;\r\n    function decodeACSuccessive(component, offset) {\r\n      var k = spectralStart, e = spectralEnd, r = 0;\r\n      while (k <= e) {\r\n        var z = dctZigZag[k];\r\n        switch (successiveACState) {\r\n          case 0: // initial state\r\n            var rs = decodeHuffman(component.huffmanTableAC);\r\n            var s = rs & 15;\r\n            r = rs >> 4;\r\n            if (s === 0) {\r\n              if (r < 15) {\r\n                eobrun = receive(r) + (1 << r);\r\n                successiveACState = 4;\r\n              } else {\r\n                r = 16;\r\n                successiveACState = 1;\r\n              }\r\n            } else {\r\n              if (s !== 1)\r\n                throw \"invalid ACn encoding\";\r\n              successiveACNextValue = receiveAndExtend(s);\r\n              successiveACState = r ? 2 : 3;\r\n            }\r\n            continue;\r\n          case 1: // skipping r zero items\r\n          case 2:\r\n            if (component.blockData[offset + z]) {\r\n              component.blockData[offset + z] += (readBit() << successive);\r\n            } else {\r\n              r--;\r\n              if (r === 0)\r\n                successiveACState = successiveACState == 2 ? 3 : 0;\r\n            }\r\n            break;\r\n          case 3: // set value for a zero item\r\n            if (component.blockData[offset + z]) {\r\n              component.blockData[offset + z] += (readBit() << successive);\r\n            } else {\r\n              component.blockData[offset + z] = successiveACNextValue << successive;\r\n              successiveACState = 0;\r\n            }\r\n            break;\r\n          case 4: // eob\r\n            if (component.blockData[offset + z]) {\r\n              component.blockData[offset + z] += (readBit() << successive);\r\n            }\r\n            break;\r\n        }\r\n        k++;\r\n      }\r\n      if (successiveACState === 4) {\r\n        eobrun--;\r\n        if (eobrun === 0)\r\n          successiveACState = 0;\r\n      }\r\n    }\r\n\r\n    function decodeMcu(component, decode, mcu, row, col) {\r\n      var mcuRow = (mcu / mcusPerLine) | 0;\r\n      var mcuCol = mcu % mcusPerLine;\r\n      var blockRow = mcuRow * component.v + row;\r\n      var blockCol = mcuCol * component.h + col;\r\n      var offset = getBlockBufferOffset(component, blockRow, blockCol);\r\n      decode(component, offset);\r\n    }\r\n\r\n    function decodeBlock(component, decode, mcu) {\r\n      var blockRow = (mcu / component.blocksPerLine) | 0;\r\n      var blockCol = mcu % component.blocksPerLine;\r\n      var offset = getBlockBufferOffset(component, blockRow, blockCol);\r\n      decode(component, offset);\r\n    }\r\n\r\n    var componentsLength = components.length;\r\n    var component, i, j, k, n;\r\n    var decodeFn;\r\n    if (progressive) {\r\n      if (spectralStart === 0)\r\n        decodeFn = successivePrev === 0 ? decodeDCFirst : decodeDCSuccessive;\r\n      else\r\n        decodeFn = successivePrev === 0 ? decodeACFirst : decodeACSuccessive;\r\n    } else {\r\n      decodeFn = decodeBaseline;\r\n    }\r\n\r\n    var mcu = 0, marker;\r\n    var mcuExpected;\r\n    if (componentsLength == 1) {\r\n      mcuExpected = components[0].blocksPerLine * components[0].blocksPerColumn;\r\n    } else {\r\n      mcuExpected = mcusPerLine * frame.mcusPerColumn;\r\n    }\r\n    if (!resetInterval) {\r\n      resetInterval = mcuExpected;\r\n    }\r\n\r\n    var h, v;\r\n    while (mcu < mcuExpected) {\r\n      // reset interval stuff\r\n      for (i = 0; i < componentsLength; i++) {\r\n        components[i].pred = 0;\r\n      }\r\n      eobrun = 0;\r\n\r\n      if (componentsLength == 1) {\r\n        component = components[0];\r\n        for (n = 0; n < resetInterval; n++) {\r\n          decodeBlock(component, decodeFn, mcu);\r\n          mcu++;\r\n        }\r\n      } else {\r\n        for (n = 0; n < resetInterval; n++) {\r\n          for (i = 0; i < componentsLength; i++) {\r\n            component = components[i];\r\n            h = component.h;\r\n            v = component.v;\r\n            for (j = 0; j < v; j++) {\r\n              for (k = 0; k < h; k++) {\r\n                decodeMcu(component, decodeFn, mcu, j, k);\r\n              }\r\n            }\r\n          }\r\n          mcu++;\r\n        }\r\n      }\r\n\r\n      // find marker\r\n      bitsCount = 0;\r\n      marker = (data[offset] << 8) | data[offset + 1];\r\n      if (marker <= 0xFF00) {\r\n        throw \"marker was not found\";\r\n      }\r\n\r\n      if (marker >= 0xFFD0 && marker <= 0xFFD7) { // RSTx\r\n        offset += 2;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return offset - startOffset;\r\n  }\r\n\r\n  // A port of poppler's IDCT method which in turn is taken from:\r\n  //   Christoph Loeffler, Adriaan Ligtenberg, George S. Moschytz,\r\n  //   \"Practical Fast 1-D DCT Algorithms with 11 Multiplications\",\r\n  //   IEEE Intl. Conf. on Acoustics, Speech & Signal Processing, 1989,\r\n  //   988-991.\r\n  function quantizeAndInverse(component, blockBufferOffset, p) {\r\n    var qt = component.quantizationTable;\r\n    var v0, v1, v2, v3, v4, v5, v6, v7, t;\r\n    var i;\r\n\r\n    // dequant\r\n    for (i = 0; i < 64; i++) {\r\n      p[i] = component.blockData[blockBufferOffset + i] * qt[i];\r\n    }\r\n\r\n    // inverse DCT on rows\r\n    for (i = 0; i < 8; ++i) {\r\n      var row = 8 * i;\r\n\r\n      // check for all-zero AC coefficients\r\n      if (p[1 + row] === 0 && p[2 + row] === 0 && p[3 + row] === 0 &&\r\n        p[4 + row] === 0 && p[5 + row] === 0 && p[6 + row] === 0 &&\r\n        p[7 + row] === 0) {\r\n        t = (dctSqrt2 * p[0 + row] + 512) >> 10;\r\n        p[0 + row] = t;\r\n        p[1 + row] = t;\r\n        p[2 + row] = t;\r\n        p[3 + row] = t;\r\n        p[4 + row] = t;\r\n        p[5 + row] = t;\r\n        p[6 + row] = t;\r\n        p[7 + row] = t;\r\n        continue;\r\n      }\r\n\r\n      // stage 4\r\n      v0 = (dctSqrt2 * p[0 + row] + 128) >> 8;\r\n      v1 = (dctSqrt2 * p[4 + row] + 128) >> 8;\r\n      v2 = p[2 + row];\r\n      v3 = p[6 + row];\r\n      v4 = (dctSqrt1d2 * (p[1 + row] - p[7 + row]) + 128) >> 8;\r\n      v7 = (dctSqrt1d2 * (p[1 + row] + p[7 + row]) + 128) >> 8;\r\n      v5 = p[3 + row] << 4;\r\n      v6 = p[5 + row] << 4;\r\n\r\n      // stage 3\r\n      t = (v0 - v1 + 1) >> 1;\r\n      v0 = (v0 + v1 + 1) >> 1;\r\n      v1 = t;\r\n      t = (v2 * dctSin6 + v3 * dctCos6 + 128) >> 8;\r\n      v2 = (v2 * dctCos6 - v3 * dctSin6 + 128) >> 8;\r\n      v3 = t;\r\n      t = (v4 - v6 + 1) >> 1;\r\n      v4 = (v4 + v6 + 1) >> 1;\r\n      v6 = t;\r\n      t = (v7 + v5 + 1) >> 1;\r\n      v5 = (v7 - v5 + 1) >> 1;\r\n      v7 = t;\r\n\r\n      // stage 2\r\n      t = (v0 - v3 + 1) >> 1;\r\n      v0 = (v0 + v3 + 1) >> 1;\r\n      v3 = t;\r\n      t = (v1 - v2 + 1) >> 1;\r\n      v1 = (v1 + v2 + 1) >> 1;\r\n      v2 = t;\r\n      t = (v4 * dctSin3 + v7 * dctCos3 + 2048) >> 12;\r\n      v4 = (v4 * dctCos3 - v7 * dctSin3 + 2048) >> 12;\r\n      v7 = t;\r\n      t = (v5 * dctSin1 + v6 * dctCos1 + 2048) >> 12;\r\n      v5 = (v5 * dctCos1 - v6 * dctSin1 + 2048) >> 12;\r\n      v6 = t;\r\n\r\n      // stage 1\r\n      p[0 + row] = v0 + v7;\r\n      p[7 + row] = v0 - v7;\r\n      p[1 + row] = v1 + v6;\r\n      p[6 + row] = v1 - v6;\r\n      p[2 + row] = v2 + v5;\r\n      p[5 + row] = v2 - v5;\r\n      p[3 + row] = v3 + v4;\r\n      p[4 + row] = v3 - v4;\r\n    }\r\n\r\n    // inverse DCT on columns\r\n    for (i = 0; i < 8; ++i) {\r\n      var col = i;\r\n\r\n      // check for all-zero AC coefficients\r\n      if (p[1 * 8 + col] === 0 && p[2 * 8 + col] === 0 && p[3 * 8 + col] === 0 &&\r\n        p[4 * 8 + col] === 0 && p[5 * 8 + col] === 0 && p[6 * 8 + col] === 0 &&\r\n        p[7 * 8 + col] === 0) {\r\n        t = (dctSqrt2 * p[i + 0] + 8192) >> 14;\r\n        p[0 * 8 + col] = t;\r\n        p[1 * 8 + col] = t;\r\n        p[2 * 8 + col] = t;\r\n        p[3 * 8 + col] = t;\r\n        p[4 * 8 + col] = t;\r\n        p[5 * 8 + col] = t;\r\n        p[6 * 8 + col] = t;\r\n        p[7 * 8 + col] = t;\r\n        continue;\r\n      }\r\n\r\n      // stage 4\r\n      v0 = (dctSqrt2 * p[0 * 8 + col] + 2048) >> 12;\r\n      v1 = (dctSqrt2 * p[4 * 8 + col] + 2048) >> 12;\r\n      v2 = p[2 * 8 + col];\r\n      v3 = p[6 * 8 + col];\r\n      v4 = (dctSqrt1d2 * (p[1 * 8 + col] - p[7 * 8 + col]) + 2048) >> 12;\r\n      v7 = (dctSqrt1d2 * (p[1 * 8 + col] + p[7 * 8 + col]) + 2048) >> 12;\r\n      v5 = p[3 * 8 + col];\r\n      v6 = p[5 * 8 + col];\r\n\r\n      // stage 3\r\n      t = (v0 - v1 + 1) >> 1;\r\n      v0 = (v0 + v1 + 1) >> 1;\r\n      v1 = t;\r\n      t = (v2 * dctSin6 + v3 * dctCos6 + 2048) >> 12;\r\n      v2 = (v2 * dctCos6 - v3 * dctSin6 + 2048) >> 12;\r\n      v3 = t;\r\n      t = (v4 - v6 + 1) >> 1;\r\n      v4 = (v4 + v6 + 1) >> 1;\r\n      v6 = t;\r\n      t = (v7 + v5 + 1) >> 1;\r\n      v5 = (v7 - v5 + 1) >> 1;\r\n      v7 = t;\r\n\r\n      // stage 2\r\n      t = (v0 - v3 + 1) >> 1;\r\n      v0 = (v0 + v3 + 1) >> 1;\r\n      v3 = t;\r\n      t = (v1 - v2 + 1) >> 1;\r\n      v1 = (v1 + v2 + 1) >> 1;\r\n      v2 = t;\r\n      t = (v4 * dctSin3 + v7 * dctCos3 + 2048) >> 12;\r\n      v4 = (v4 * dctCos3 - v7 * dctSin3 + 2048) >> 12;\r\n      v7 = t;\r\n      t = (v5 * dctSin1 + v6 * dctCos1 + 2048) >> 12;\r\n      v5 = (v5 * dctCos1 - v6 * dctSin1 + 2048) >> 12;\r\n      v6 = t;\r\n\r\n      // stage 1\r\n      p[0 * 8 + col] = v0 + v7;\r\n      p[7 * 8 + col] = v0 - v7;\r\n      p[1 * 8 + col] = v1 + v6;\r\n      p[6 * 8 + col] = v1 - v6;\r\n      p[2 * 8 + col] = v2 + v5;\r\n      p[5 * 8 + col] = v2 - v5;\r\n      p[3 * 8 + col] = v3 + v4;\r\n      p[4 * 8 + col] = v3 - v4;\r\n    }\r\n\r\n    // convert to 8-bit integers\r\n    for (i = 0; i < 64; ++i) {\r\n      var index = blockBufferOffset + i;\r\n      var q = p[i];\r\n      q = (q <= -2056 / component.bitConversion) ? 0 :\r\n        (q >= 2024 / component.bitConversion) ? 255 / component.bitConversion :\r\n        (q + 2056 / component.bitConversion) >> 4;\r\n      component.blockData[index] = q;\r\n    }\r\n  }\r\n\r\n  function buildComponentData(frame, component) {\r\n    var lines = [];\r\n    var blocksPerLine = component.blocksPerLine;\r\n    var blocksPerColumn = component.blocksPerColumn;\r\n    var samplesPerLine = blocksPerLine << 3;\r\n    var computationBuffer = new Int32Array(64);\r\n\r\n    var i, j, ll = 0;\r\n    for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {\r\n      for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {\r\n        var offset = getBlockBufferOffset(component, blockRow, blockCol);\r\n        quantizeAndInverse(component, offset, computationBuffer);\r\n      }\r\n    }\r\n    return component.blockData;\r\n  }\r\n\r\n  function clampToUint8(a) {\r\n    return a <= 0 ? 0 : a >= 255 ? 255 : a | 0;\r\n  }\r\n\r\n  constructor.prototype = {\r\n    load: function load(path) {\r\n      var handleData = (function (data) {\r\n        this.parse(data);\r\n        if (this.onload)\r\n          this.onload();\r\n      }).bind(this);\r\n\r\n      if (path.indexOf(\"data:\") > -1) {\r\n        var offset = path.indexOf(\"base64,\") + 7;\r\n        var data = atob(path.substring(offset));\r\n        var arr = new Uint8Array(data.length);\r\n        for (var i = data.length - 1; i >= 0; i--) {\r\n          arr[i] = data.charCodeAt(i);\r\n        }\r\n        handleData(data);\r\n      } else {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", path, true);\r\n        xhr.responseType = \"arraybuffer\";\r\n        xhr.onload = (function () {\r\n          // TODO catch parse error\r\n          var data = new Uint8Array(xhr.response);\r\n          handleData(data);\r\n        }).bind(this);\r\n        xhr.send(null);\r\n      }\r\n    },\r\n    parse: function parse(data) {\r\n\r\n      function readUint16() {\r\n        var value = (data[offset] << 8) | data[offset + 1];\r\n        offset += 2;\r\n        return value;\r\n      }\r\n\r\n      function readDataBlock() {\r\n        var length = readUint16();\r\n        var array = data.subarray(offset, offset + length - 2);\r\n        offset += array.length;\r\n        return array;\r\n      }\r\n\r\n      function prepareComponents(frame) {\r\n        var mcusPerLine = Math.ceil(frame.samplesPerLine / 8 / frame.maxH);\r\n        var mcusPerColumn = Math.ceil(frame.scanLines / 8 / frame.maxV);\r\n        for (var i = 0; i < frame.components.length; i++) {\r\n          component = frame.components[i];\r\n          var blocksPerLine = Math.ceil(Math.ceil(frame.samplesPerLine / 8) * component.h / frame.maxH);\r\n          var blocksPerColumn = Math.ceil(Math.ceil(frame.scanLines / 8) * component.v / frame.maxV);\r\n          var blocksPerLineForMcu = mcusPerLine * component.h;\r\n          var blocksPerColumnForMcu = mcusPerColumn * component.v;\r\n\r\n          var blocksBufferSize = 64 * blocksPerColumnForMcu * (blocksPerLineForMcu + 1);\r\n          component.blockData = new Int16Array(blocksBufferSize);\r\n          component.blocksPerLine = blocksPerLine;\r\n          component.blocksPerColumn = blocksPerColumn;\r\n        }\r\n        frame.mcusPerLine = mcusPerLine;\r\n        frame.mcusPerColumn = mcusPerColumn;\r\n      }\r\n\r\n      var offset = 0, length = data.length;\r\n      var jfif = null;\r\n      var adobe = null;\r\n      var pixels = null;\r\n      var frame, resetInterval;\r\n      var quantizationTables = [];\r\n      var huffmanTablesAC = [], huffmanTablesDC = [];\r\n      var fileMarker = readUint16();\r\n      if (fileMarker != 0xFFD8) { // SOI (Start of Image)\r\n        throw \"SOI not found\";\r\n      }\r\n\r\n      fileMarker = readUint16();\r\n      while (fileMarker != 0xFFD9) { // EOI (End of image)\r\n        var i, j, l;\r\n        switch (fileMarker) {\r\n          case 0xFFE0: // APP0 (Application Specific)\r\n          case 0xFFE1: // APP1\r\n          case 0xFFE2: // APP2\r\n          case 0xFFE3: // APP3\r\n          case 0xFFE4: // APP4\r\n          case 0xFFE5: // APP5\r\n          case 0xFFE6: // APP6\r\n          case 0xFFE7: // APP7\r\n          case 0xFFE8: // APP8\r\n          case 0xFFE9: // APP9\r\n          case 0xFFEA: // APP10\r\n          case 0xFFEB: // APP11\r\n          case 0xFFEC: // APP12\r\n          case 0xFFED: // APP13\r\n          case 0xFFEE: // APP14\r\n          case 0xFFEF: // APP15\r\n          case 0xFFFE: // COM (Comment)\r\n            var appData = readDataBlock();\r\n\r\n            if (fileMarker === 0xFFE0) {\r\n              if (appData[0] === 0x4A && appData[1] === 0x46 && appData[2] === 0x49 &&\r\n                appData[3] === 0x46 && appData[4] === 0) { // 'JFIF\\x00'\r\n                jfif = {\r\n                  version: {major: appData[5], minor: appData[6]},\r\n                  densityUnits: appData[7],\r\n                  xDensity: (appData[8] << 8) | appData[9],\r\n                  yDensity: (appData[10] << 8) | appData[11],\r\n                  thumbWidth: appData[12],\r\n                  thumbHeight: appData[13],\r\n                  thumbData: appData.subarray(14, 14 + 3 * appData[12] * appData[13])\r\n                };\r\n              }\r\n            }\r\n            // TODO APP1 - Exif\r\n            if (fileMarker === 0xFFEE) {\r\n              if (appData[0] === 0x41 && appData[1] === 0x64 && appData[2] === 0x6F &&\r\n                appData[3] === 0x62 && appData[4] === 0x65 && appData[5] === 0) { // 'Adobe\\x00'\r\n                adobe = {\r\n                  version: appData[6],\r\n                  flags0: (appData[7] << 8) | appData[8],\r\n                  flags1: (appData[9] << 8) | appData[10],\r\n                  transformCode: appData[11]\r\n                };\r\n              }\r\n            }\r\n            break;\r\n\r\n          case 0xFFDB: // DQT (Define Quantization Tables)\r\n            var quantizationTablesLength = readUint16();\r\n            var quantizationTablesEnd = quantizationTablesLength + offset - 2;\r\n            while (offset < quantizationTablesEnd) {\r\n              var quantizationTableSpec = data[offset++];\r\n              var tableData = new Int32Array(64);\r\n              if ((quantizationTableSpec >> 4) === 0) { // 8 bit values\r\n                for (j = 0; j < 64; j++) {\r\n                  var z = dctZigZag[j];\r\n                  tableData[z] = data[offset++];\r\n                }\r\n              } else if ((quantizationTableSpec >> 4) === 1) { //16 bit\r\n                for (j = 0; j < 64; j++) {\r\n                  var zz = dctZigZag[j];\r\n                  tableData[zz] = readUint16();\r\n                }\r\n              } else\r\n                throw \"DQT: invalid table spec\";\r\n              quantizationTables[quantizationTableSpec & 15] = tableData;\r\n            }\r\n            break;\r\n\r\n          case 0xFFC0: // SOF0 (Start of Frame, Baseline DCT)\r\n          case 0xFFC1: // SOF1 (Start of Frame, Extended DCT)\r\n          case 0xFFC2: // SOF2 (Start of Frame, Progressive DCT)\r\n            if (frame) {\r\n              throw \"Only single frame JPEGs supported\";\r\n            }\r\n            readUint16(); // skip data length\r\n            frame = {};\r\n            frame.extended = (fileMarker === 0xFFC1);\r\n            frame.progressive = (fileMarker === 0xFFC2);\r\n            frame.precision = data[offset++];\r\n            frame.scanLines = readUint16();\r\n            frame.samplesPerLine = readUint16();\r\n            frame.components = [];\r\n            frame.componentIds = {};\r\n            var componentsCount = data[offset++], componentId;\r\n            var maxH = 0, maxV = 0;\r\n            for (i = 0; i < componentsCount; i++) {\r\n              componentId = data[offset];\r\n              var h = data[offset + 1] >> 4;\r\n              var v = data[offset + 1] & 15;\r\n              if (maxH < h)\r\n                maxH = h;\r\n              if (maxV < v)\r\n                maxV = v;\r\n              var qId = data[offset + 2];\r\n              l = frame.components.push({\r\n                h: h,\r\n                v: v,\r\n                quantizationTable: quantizationTables[qId],\r\n                quantizationTableId: qId,\r\n                bitConversion: 255 / ((1 << frame.precision) - 1)\r\n              });\r\n              frame.componentIds[componentId] = l - 1;\r\n              offset += 3;\r\n            }\r\n            frame.maxH = maxH;\r\n            frame.maxV = maxV;\r\n            prepareComponents(frame);\r\n            break;\r\n\r\n          case 0xFFC4: // DHT (Define Huffman Tables)\r\n            var huffmanLength = readUint16();\r\n            for (i = 2; i < huffmanLength; ) {\r\n              var huffmanTableSpec = data[offset++];\r\n              var codeLengths = new Uint8Array(16);\r\n              var codeLengthSum = 0;\r\n              for (j = 0; j < 16; j++, offset++)\r\n                codeLengthSum += (codeLengths[j] = data[offset]);\r\n              var huffmanValues = new Uint8Array(codeLengthSum);\r\n              for (j = 0; j < codeLengthSum; j++, offset++)\r\n                huffmanValues[j] = data[offset];\r\n              i += 17 + codeLengthSum;\r\n\r\n              ((huffmanTableSpec >> 4) === 0 ?\r\n                huffmanTablesDC : huffmanTablesAC)[huffmanTableSpec & 15] =\r\n                buildHuffmanTable(codeLengths, huffmanValues);\r\n            }\r\n            break;\r\n\r\n          case 0xFFDD: // DRI (Define Restart Interval)\r\n            readUint16(); // skip data length\r\n            resetInterval = readUint16();\r\n            break;\r\n\r\n          case 0xFFDA: // SOS (Start of Scan)\r\n            var scanLength = readUint16();\r\n            var selectorsCount = data[offset++];\r\n            var components = [], component;\r\n            for (i = 0; i < selectorsCount; i++) {\r\n              var componentIndex = frame.componentIds[data[offset++]];\r\n              component = frame.components[componentIndex];\r\n              var tableSpec = data[offset++];\r\n              component.huffmanTableDC = huffmanTablesDC[tableSpec >> 4];\r\n              component.huffmanTableAC = huffmanTablesAC[tableSpec & 15];\r\n              components.push(component);\r\n            }\r\n            var spectralStart = data[offset++];\r\n            var spectralEnd = data[offset++];\r\n            var successiveApproximation = data[offset++];\r\n            var processed = decodeScan(data, offset,\r\n              frame, components, resetInterval,\r\n              spectralStart, spectralEnd,\r\n              successiveApproximation >> 4, successiveApproximation & 15);\r\n            offset += processed;\r\n            break;\r\n          default:\r\n            if (data[offset - 3] == 0xFF &&\r\n              data[offset - 2] >= 0xC0 && data[offset - 2] <= 0xFE) {\r\n              // could be incorrect encoding -- last 0xFF byte of the previous\r\n              // block was eaten by the encoder\r\n              offset -= 3;\r\n              break;\r\n            }\r\n            throw \"unknown JPEG marker \" + fileMarker.toString(16);\r\n        }\r\n        fileMarker = readUint16();\r\n      }\r\n\r\n      this.width = frame.samplesPerLine;\r\n      this.height = frame.scanLines;\r\n      this.jfif = jfif;\r\n      this.adobe = adobe;\r\n      this.components = [];\r\n      switch (frame.components.length)\r\n      {\r\n        case 1:\r\n          this.colorspace = ColorSpace.Grayscale;\r\n          break;\r\n        case 3:\r\n          if (this.adobe)\r\n            this.colorspace = ColorSpace.AdobeRGB;\r\n          else\r\n            this.colorspace = ColorSpace.RGB;\r\n          break;\r\n        case 4:\r\n          this.colorspace = ColorSpace.CYMK;\r\n          break;\r\n        default:\r\n          this.colorspace = ColorSpace.Unknown;\r\n      }\r\n      for (var i = 0; i < frame.components.length; i++) {\r\n        var component = frame.components[i];\r\n        if (!component.quantizationTable && component.quantizationTableId !== null)\r\n          component.quantizationTable = quantizationTables[component.quantizationTableId];\r\n        this.components.push({\r\n          output: buildComponentData(frame, component),\r\n          scaleX: component.h / frame.maxH,\r\n          scaleY: component.v / frame.maxV,\r\n          blocksPerLine: component.blocksPerLine,\r\n          blocksPerColumn: component.blocksPerColumn,\r\n          bitConversion: component.bitConversion\r\n        });\r\n      }\r\n    },\r\n    getData16: function getData16(width, height) {\r\n      if (this.components.length !== 1)\r\n        throw 'Unsupported color mode';\r\n      var scaleX = this.width / width, scaleY = this.height / height;\r\n\r\n      var component, componentScaleX, componentScaleY;\r\n      var x, y, i;\r\n      var offset = 0;\r\n      var numComponents = this.components.length;\r\n      var dataLength = width * height * numComponents;\r\n      var data = new Uint16Array(dataLength);\r\n      var componentLine;\r\n\r\n      // lineData is reused for all components. Assume first component is\r\n      // the biggest\r\n      var lineData = new Uint16Array((this.components[0].blocksPerLine << 3) *\r\n      this.components[0].blocksPerColumn * 8);\r\n\r\n      // First construct image data ...\r\n      for (i = 0; i < numComponents; i++) {\r\n        component = this.components[i];\r\n        var blocksPerLine = component.blocksPerLine;\r\n        var blocksPerColumn = component.blocksPerColumn;\r\n        var samplesPerLine = blocksPerLine << 3;\r\n\r\n        var j, k, ll = 0;\r\n        var lineOffset = 0;\r\n        for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {\r\n          var scanLine = blockRow << 3;\r\n          for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {\r\n            var bufferOffset = getBlockBufferOffset(component, blockRow, blockCol);\r\n            var offset = 0, sample = blockCol << 3;\r\n            for (j = 0; j < 8; j++) {\r\n              var lineOffset = (scanLine + j) * samplesPerLine;\r\n              for (k = 0; k < 8; k++) {\r\n                lineData[lineOffset + sample + k] =\r\n                  component.output[bufferOffset + offset++];\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        componentScaleX = component.scaleX * scaleX;\r\n        componentScaleY = component.scaleY * scaleY;\r\n        offset = i;\r\n\r\n        var cx, cy;\r\n        var index;\r\n        for (y = 0; y < height; y++) {\r\n          for (x = 0; x < width; x++) {\r\n            cy = 0 | (y * componentScaleY);\r\n            cx = 0 | (x * componentScaleX);\r\n            index = cy * samplesPerLine + cx;\r\n            data[offset] = lineData[index];\r\n            offset += numComponents;\r\n          }\r\n        }\r\n      }\r\n      return data;\r\n    },\r\n    getData: function getData(width, height) {\r\n      var scaleX = this.width / width, scaleY = this.height / height;\r\n\r\n      var component, componentScaleX, componentScaleY;\r\n      var x, y, i;\r\n      var offset = 0;\r\n      var Y, Cb, Cr, K, C, M, Ye, R, G, B;\r\n      var colorTransform;\r\n      var numComponents = this.components.length;\r\n      var dataLength = width * height * numComponents;\r\n      var data = new Uint8Array(dataLength);\r\n      var componentLine;\r\n\r\n      // lineData is reused for all components. Assume first component is\r\n      // the biggest\r\n      var lineData = new Uint8Array((this.components[0].blocksPerLine << 3) *\r\n      this.components[0].blocksPerColumn * 8);\r\n\r\n      // First construct image data ...\r\n      for (i = 0; i < numComponents; i++) {\r\n        component = this.components[i];\r\n        var blocksPerLine = component.blocksPerLine;\r\n        var blocksPerColumn = component.blocksPerColumn;\r\n        var samplesPerLine = blocksPerLine << 3;\r\n\r\n        var j, k, ll = 0;\r\n        var lineOffset = 0;\r\n        for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {\r\n          var scanLine = blockRow << 3;\r\n          for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {\r\n            var bufferOffset = getBlockBufferOffset(component, blockRow, blockCol);\r\n            var offset = 0, sample = blockCol << 3;\r\n            for (j = 0; j < 8; j++) {\r\n              var lineOffset = (scanLine + j) * samplesPerLine;\r\n              for (k = 0; k < 8; k++) {\r\n                lineData[lineOffset + sample + k] =\r\n                  component.output[bufferOffset + offset++] * component.bitConversion;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        componentScaleX = component.scaleX * scaleX;\r\n        componentScaleY = component.scaleY * scaleY;\r\n        offset = i;\r\n\r\n        var cx, cy;\r\n        var index;\r\n        for (y = 0; y < height; y++) {\r\n          for (x = 0; x < width; x++) {\r\n            cy = 0 | (y * componentScaleY);\r\n            cx = 0 | (x * componentScaleX);\r\n            index = cy * samplesPerLine + cx;\r\n            data[offset] = lineData[index];\r\n            offset += numComponents;\r\n          }\r\n        }\r\n      }\r\n\r\n      // ... then transform colors, if necessary\r\n      switch (numComponents) {\r\n        case 1:\r\n        case 2:\r\n          break;\r\n        // no color conversion for one or two compoenents\r\n\r\n        case 3:\r\n          // The default transform for three components is true\r\n          colorTransform = true;\r\n          // The adobe transform marker overrides any previous setting\r\n          if (this.adobe && this.adobe.transformCode)\r\n            colorTransform = true;\r\n          else if (typeof this.colorTransform !== 'undefined')\r\n            colorTransform = !!this.colorTransform;\r\n\r\n          if (colorTransform) {\r\n            for (i = 0; i < dataLength; i += numComponents) {\r\n              Y = data[i    ];\r\n              Cb = data[i + 1];\r\n              Cr = data[i + 2];\r\n\r\n              R = clampToUint8(Y - 179.456 + 1.402 * Cr);\r\n              G = clampToUint8(Y + 135.459 - 0.344 * Cb - 0.714 * Cr);\r\n              B = clampToUint8(Y - 226.816 + 1.772 * Cb);\r\n\r\n              data[i    ] = R;\r\n              data[i + 1] = G;\r\n              data[i + 2] = B;\r\n            }\r\n          }\r\n          break;\r\n        case 4:\r\n          if (!this.adobe)\r\n            throw 'Unsupported color mode (4 components)';\r\n          // The default transform for four components is false\r\n          colorTransform = false;\r\n          // The adobe transform marker overrides any previous setting\r\n          if (this.adobe && this.adobe.transformCode)\r\n            colorTransform = true;\r\n          else if (typeof this.colorTransform !== 'undefined')\r\n            colorTransform = !!this.colorTransform;\r\n\r\n          if (colorTransform) {\r\n            for (i = 0; i < dataLength; i += numComponents) {\r\n              Y = data[i];\r\n              Cb = data[i + 1];\r\n              Cr = data[i + 2];\r\n\r\n              C = clampToUint8(434.456 - Y - 1.402 * Cr);\r\n              M = clampToUint8(119.541 - Y + 0.344 * Cb + 0.714 * Cr);\r\n              Y = clampToUint8(481.816 - Y - 1.772 * Cb);\r\n\r\n              data[i    ] = C;\r\n              data[i + 1] = M;\r\n              data[i + 2] = Y;\r\n              // K is unchanged\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n          throw 'Unsupported color mode';\r\n      }\r\n      return data;\r\n    }\r\n  };\r\n\r\n  return constructor;\r\n})();\r\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.jpeg = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.ComponentSpec = jpeg.lossless.ComponentSpec || function () {\r\n    this.hSamp = 0; // Horizontal sampling factor\r\n    this.quantTableSel = 0; // Quantization table destination selector\r\n    this.vSamp = 0; // Vertical\r\n  };\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.ComponentSpec;\r\n  }\r\n\r\n},{}],2:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || function (data, offset, length) {\r\n    this.buffer = new DataView(data, offset, length);\r\n    this.index = 0;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.DataStream.prototype.get16 = function () {\r\n    var value = this.buffer.getUint16(this.index, false);\r\n    this.index += 2;\r\n    return value;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.DataStream.prototype.get8 = function () {\r\n    var value = this.buffer.getUint8(this.index);\r\n    this.index += 1;\r\n    return value;\r\n  };\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.DataStream;\r\n  }\r\n\r\n},{}],3:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\r\n  jpeg.lossless.HuffmanTable = jpeg.lossless.HuffmanTable || ((typeof require !== 'undefined') ? require('./huffman-table.js') : null);\r\n  jpeg.lossless.QuantizationTable = jpeg.lossless.QuantizationTable || ((typeof require !== 'undefined') ? require('./quantization-table.js') : null);\r\n  jpeg.lossless.ScanHeader = jpeg.lossless.ScanHeader || ((typeof require !== 'undefined') ? require('./scan-header.js') : null);\r\n  jpeg.lossless.FrameHeader = jpeg.lossless.FrameHeader || ((typeof require !== 'undefined') ? require('./frame-header.js') : null);\r\n  jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.Decoder = jpeg.lossless.Decoder || function (buffer, numBytes) {\r\n    this.buffer = buffer;\r\n    this.frame = new jpeg.lossless.FrameHeader();\r\n    this.huffTable = new jpeg.lossless.HuffmanTable();\r\n    this.quantTable = new jpeg.lossless.QuantizationTable();\r\n    this.scan = new jpeg.lossless.ScanHeader();\r\n    this.DU = jpeg.lossless.Utils.createArray(10, 4, 64); // at most 10 data units in a MCU, at most 4 data units in one component\r\n    this.HuffTab = jpeg.lossless.Utils.createArray(4, 2, 50 * 256);\r\n    this.IDCT_Source = [];\r\n    this.nBlock = []; // number of blocks in the i-th Comp in a scan\r\n    this.acTab = jpeg.lossless.Utils.createArray(10, 1); // ac HuffTab for the i-th Comp in a scan\r\n    this.dcTab = jpeg.lossless.Utils.createArray(10, 1); // dc HuffTab for the i-th Comp in a scan\r\n    this.qTab = jpeg.lossless.Utils.createArray(10, 1); // quantization table for the i-th Comp in a scan\r\n    this.marker = 0;\r\n    this.markerIndex = 0;\r\n    this.numComp = 0;\r\n    this.restartInterval = 0;\r\n    this.selection = 0;\r\n    this.xDim = 0;\r\n    this.yDim = 0;\r\n    this.xLoc = 0;\r\n    this.yLoc = 0;\r\n    this.outputData = null;\r\n\r\n    if (typeof numBytes === \"undefined\") {\r\n      this.numBytes = 2;\r\n    } else {\r\n      this.numBytes = numBytes;\r\n    }\r\n  };\r\n\r\n\r\n  /*** Static Pseudo-constants ***/\r\n\r\n  jpeg.lossless.Decoder.IDCT_P = [0, 5, 40, 16, 45, 2, 7, 42, 21, 56, 8, 61, 18, 47, 1, 4, 41, 23, 58, 13, 32, 24, 37, 10, 63, 17, 44, 3, 6, 43, 20,\r\n    57, 15, 34, 29, 48, 53, 26, 39, 9, 60, 19, 46, 22, 59, 12, 33, 31, 50, 55, 25, 36, 11, 62, 14, 35, 28, 49, 52, 27, 38, 30, 51, 54];\r\n  jpeg.lossless.Decoder.TABLE = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53,\r\n    10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63];\r\n  jpeg.lossless.Decoder.MAX_HUFFMAN_SUBTREE = 50;\r\n  jpeg.lossless.Decoder.MSB = 0x80000000;\r\n\r\n\r\n  /*** Prototype Methods ***/\r\n\r\n  jpeg.lossless.Decoder.prototype.decode = function (buffer, offset, length, numBytes) {\r\n    /*jslint bitwise: true */\r\n\r\n    var current, scanNum = 0, pred = [], i, compN, temp = [], index = [], mcuNum;\r\n\r\n    if (typeof buffer !== \"undefined\") {\r\n      this.buffer = buffer;\r\n    }\r\n\r\n    if (typeof numBytes !== \"undefined\") {\r\n      this.numBytes = numBytes;\r\n    }\r\n\r\n    if (this.numBytes === 2) {\r\n      this.getter = this.getValue16;\r\n      this.setter = this.setValue16;\r\n    } else if (this.numBytes === 1) {\r\n      this.getter = this.getValue8;\r\n      this.setter = this.setValue8;\r\n    }\r\n\r\n    this.stream = new jpeg.lossless.DataStream(this.buffer, offset, length);\r\n    this.buffer = null;\r\n\r\n    this.xLoc = 0;\r\n    this.yLoc = 0;\r\n    current = this.stream.get16();\r\n\r\n    if (current !== 0xFFD8) { // SOI\r\n      throw new Error(\"Not a JPEG file\");\r\n    }\r\n\r\n    current = this.stream.get16();\r\n\r\n    while ((((current >> 4) !== 0x0FFC) || (current === 0xFFC4))) { // SOF 0~15\r\n      switch (current) {\r\n        case 0xFFC4: // DHT\r\n          this.huffTable.read(this.stream, this.HuffTab);\r\n          break;\r\n        case 0xFFCC: // DAC\r\n          throw new Error(\"Program doesn't support arithmetic coding. (format throw new IOException)\");\r\n        case 0xFFDB:\r\n          this.quantTable.read(this.stream, jpeg.lossless.Decoder.TABLE);\r\n          break;\r\n        case 0xFFDD:\r\n          this.restartInterval = this.readNumber();\r\n          break;\r\n        case 0xFFE0:\r\n        case 0xFFE1:\r\n        case 0xFFE2:\r\n        case 0xFFE3:\r\n        case 0xFFE4:\r\n        case 0xFFE5:\r\n        case 0xFFE6:\r\n        case 0xFFE7:\r\n        case 0xFFE8:\r\n        case 0xFFE9:\r\n        case 0xFFEA:\r\n        case 0xFFEB:\r\n        case 0xFFEC:\r\n        case 0xFFED:\r\n        case 0xFFEE:\r\n        case 0xFFEF:\r\n          this.readApp();\r\n          break;\r\n        case 0xFFFE:\r\n          this.readComment();\r\n          break;\r\n        default:\r\n          if ((current >> 8) !== 0xFF) {\r\n            throw new Error(\"ERROR: format throw new IOException! (decode)\");\r\n          }\r\n      }\r\n\r\n      current = this.stream.get16();\r\n    }\r\n\r\n    if ((current < 0xFFC0) || (current > 0xFFC7)) {\r\n      throw new Error(\"ERROR: could not handle arithmetic code!\");\r\n    }\r\n\r\n    this.frame.read(this.stream);\r\n    current = this.stream.get16();\r\n\r\n    do {\r\n      while (current !== 0x0FFDA) { // SOS\r\n        switch (current) {\r\n          case 0xFFC4: // DHT\r\n            this.huffTable.read(this.stream, this.HuffTab);\r\n            break;\r\n          case 0xFFCC: // DAC\r\n            throw new Error(\"Program doesn't support arithmetic coding. (format throw new IOException)\");\r\n          case 0xFFDB:\r\n            this.quantTable.read(this.stream, jpeg.lossless.Decoder.TABLE);\r\n            break;\r\n          case 0xFFDD:\r\n            this.restartInterval = this.readNumber();\r\n            break;\r\n          case 0xFFE0:\r\n          case 0xFFE1:\r\n          case 0xFFE2:\r\n          case 0xFFE3:\r\n          case 0xFFE4:\r\n          case 0xFFE5:\r\n          case 0xFFE6:\r\n          case 0xFFE7:\r\n          case 0xFFE8:\r\n          case 0xFFE9:\r\n          case 0xFFEA:\r\n          case 0xFFEB:\r\n          case 0xFFEC:\r\n          case 0xFFED:\r\n          case 0xFFEE:\r\n          case 0xFFEF:\r\n            this.readApp();\r\n            break;\r\n          case 0xFFFE:\r\n            this.readComment();\r\n            break;\r\n          default:\r\n            if ((current >> 8) !== 0xFF) {\r\n              throw new Error(\"ERROR: format throw new IOException! (Parser.decode)\");\r\n            }\r\n        }\r\n\r\n        current = this.stream.get16();\r\n      }\r\n\r\n      this.precision = this.frame.precision;\r\n      this.components = this.frame.components;\r\n\r\n      this.scan.read(this.stream);\r\n      this.numComp = this.scan.numComp;\r\n      this.selection = this.scan.selection;\r\n\r\n      this.scanComps = this.scan.components;\r\n      this.quantTables = this.quantTable.quantTables;\r\n\r\n      for (i = 0; i < this.numComp; i+=1) {\r\n        compN = this.scanComps[i].scanCompSel;\r\n        this.qTab[i] = this.quantTables[this.components[compN].quantTableSel];\r\n        this.nBlock[i] = this.components[compN].vSamp * this.components[compN].hSamp;\r\n        this.dcTab[i] = this.HuffTab[this.scanComps[i].dcTabSel][0];\r\n        this.acTab[i] = this.HuffTab[this.scanComps[i].acTabSel][1];\r\n      }\r\n\r\n      this.xDim = this.frame.dimX;\r\n      this.yDim = this.frame.dimY;\r\n      this.outputData = new DataView(new ArrayBuffer(this.xDim * this.yDim * this.numBytes));\r\n\r\n      scanNum+=1;\r\n\r\n      while (true) { // Decode one scan\r\n        temp[0] = 0;\r\n        index[0] = 0;\r\n\r\n        for (i = 0; i < 10; i+=1) {\r\n          pred[i] = (1 << (this.precision - 1));\r\n        }\r\n\r\n        if (this.restartInterval === 0) {\r\n          current = this.decodeUnit(pred, temp, index);\r\n\r\n          while ((current === 0) && ((this.xLoc < this.xDim) && (this.yLoc < this.yDim))) {\r\n            this.output(pred);\r\n            current = this.decodeUnit(pred, temp, index);\r\n          }\r\n\r\n          break; //current=MARKER\r\n        }\r\n\r\n        for (mcuNum = 0; mcuNum < this.restartInterval; mcuNum+=1) {\r\n          current = this.decodeUnit(pred, temp, index);\r\n          this.output(pred);\r\n\r\n          if (current !== 0) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (current === 0) {\r\n          if (this.markerIndex !== 0) {\r\n            current = (0xFF00 | this.marker);\r\n            this.markerIndex = 0;\r\n          } else {\r\n            current = this.stream.get16();\r\n          }\r\n        }\r\n\r\n        if (!((current >= 0xFFD0) && (current <= 0xFFD7))) {\r\n          break; //current=MARKER\r\n        }\r\n      }\r\n\r\n      if ((current === 0xFFDC) && (scanNum === 1)) { //DNL\r\n        this.readNumber();\r\n        current = this.stream.get16();\r\n      }\r\n    } while ((current !== 0xFFD9) && ((this.xLoc < this.xDim) && (this.yLoc < this.yDim)) && (scanNum === 0));\r\n\r\n    return this.outputData;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.decodeUnit = function (prev, temp, index) {\r\n    /*jslint bitwise: true */\r\n\r\n    var value, actab, dctab, qtab, ctrC, i, k, j;\r\n\r\n    switch (this.selection) {\r\n      case 2:\r\n        prev[0] = this.getPreviousY();\r\n        break;\r\n      case 3:\r\n        prev[0] = this.getPreviousXY();\r\n        break;\r\n      case 4:\r\n        prev[0] = (this.getPreviousX() + this.getPreviousY()) - this.getPreviousXY();\r\n        break;\r\n      case 5:\r\n        prev[0] = this.getPreviousX() + ((this.getPreviousY() - this.getPreviousXY()) >> 1);\r\n        break;\r\n      case 6:\r\n        prev[0] = this.getPreviousY() + ((this.getPreviousX() - this.getPreviousXY()) >> 1);\r\n        break;\r\n      case 7:\r\n        prev[0] = ((this.getPreviousX() + this.getPreviousY()) / 2);\r\n        break;\r\n      default:\r\n        prev[0] = this.getPreviousX();\r\n        break;\r\n    }\r\n\r\n    if (this.numComp > 1) {\r\n      for (ctrC = 0; ctrC < this.numComp; ctrC+=1) {\r\n        qtab = this.qTab[ctrC];\r\n        actab = this.acTab[ctrC];\r\n        dctab = this.dcTab[ctrC];\r\n        for (i = 0; i < this.nBlock[ctrC]; i+=1) {\r\n          for (k = 0; k < this.IDCT_Source.length; k+=1) {\r\n            this.IDCT_Source[k] = 0;\r\n          }\r\n\r\n          value = this.getHuffmanValue(dctab, temp, index);\r\n\r\n          if (value >= 0xFF00) {\r\n            return value;\r\n          }\r\n\r\n          prev[ctrC] = this.IDCT_Source[0] = prev[ctrC] + this.getn(index, value, temp, index);\r\n          this.IDCT_Source[0] *= qtab[0];\r\n\r\n          for (j = 1; j < 64; j+=1) {\r\n            value = this.getHuffmanValue(actab, temp, index);\r\n\r\n            if (value >= 0xFF00) {\r\n              return value;\r\n            }\r\n\r\n            j += (value >> 4);\r\n\r\n            if ((value & 0x0F) === 0) {\r\n              if ((value >> 4) === 0) {\r\n                break;\r\n              }\r\n            } else {\r\n              this.IDCT_Source[jpeg.lossless.Decoder.IDCT_P[j]] = this.getn(index, value & 0x0F, temp, index) * qtab[j];\r\n            }\r\n          }\r\n\r\n          this.scaleIDCT(this.DU[ctrC][i]);\r\n        }\r\n      }\r\n\r\n      return 0;\r\n    } else {\r\n      for (i = 0; i < this.nBlock[0]; i+=1) {\r\n        value = this.getHuffmanValue(this.dcTab[0], temp, index);\r\n        if (value >= 0xFF00) {\r\n          return value;\r\n        }\r\n\r\n        prev[0] += this.getn(prev, value, temp, index);\r\n      }\r\n\r\n      return 0;\r\n    }\r\n  };\r\n\r\n\r\n\r\n//\tHuffman table for fast search: (HuffTab) 8-bit Look up table 2-layer search architecture, 1st-layer represent 256 node (8 bits) if codeword-length > 8\r\n//\tbits, then the entry of 1st-layer = (# of 2nd-layer table) | MSB and it is stored in the 2nd-layer Size of tables in each layer are 256.\r\n//\tHuffTab[*][*][0-256] is always the only 1st-layer table.\r\n//\r\n//\tAn entry can be: (1) (# of 2nd-layer table) | MSB , for code length > 8 in 1st-layer (2) (Code length) << 8 | HuffVal\r\n//\r\n//\tHuffmanValue(table   HuffTab[x][y] (ex) HuffmanValue(HuffTab[1][0],...)\r\n//\t                ):\r\n//\t    return: Huffman Value of table\r\n//\t            0xFF?? if it receives a MARKER\r\n//\t    Parameter:  table   HuffTab[x][y] (ex) HuffmanValue(HuffTab[1][0],...)\r\n//\t                temp    temp storage for remainded bits\r\n//\t                index   index to bit of temp\r\n//\t                in      FILE pointer\r\n//\t    Effect:\r\n//\t        temp  store new remainded bits\r\n//\t        index change to new index\r\n//\t        in    change to new position\r\n//\t    NOTE:\r\n//\t      Initial by   temp=0; index=0;\r\n//\t    NOTE: (explain temp and index)\r\n//\t      temp: is always in the form at calling time or returning time\r\n//\t       |  byte 4  |  byte 3  |  byte 2  |  byte 1  |\r\n//\t       |     0    |     0    | 00000000 | 00000??? |  if not a MARKER\r\n//\t                                               ^index=3 (from 0 to 15)\r\n//\t                                               321\r\n//\t    NOTE (marker and marker_index):\r\n//\t      If get a MARKER from 'in', marker=the low-byte of the MARKER\r\n//\t        and marker_index=9\r\n//\t      If marker_index=9 then index is always > 8, or HuffmanValue()\r\n//\t        will not be called\r\n  jpeg.lossless.Decoder.prototype.getHuffmanValue = function (table, temp, index) {\r\n    /*jslint bitwise: true */\r\n\r\n    var code, input, mask;\r\n    mask = 0xFFFF;\r\n\r\n    if (index[0] < 8) {\r\n      temp[0] <<= 8;\r\n      input = this.stream.get8();\r\n      if (input === 0xFF) {\r\n        this.marker = this.stream.get8();\r\n        if (this.marker !== 0) {\r\n          this.markerIndex = 9;\r\n        }\r\n      }\r\n      temp[0] |= input;\r\n    } else {\r\n      index[0] -= 8;\r\n    }\r\n\r\n    code = table[temp[0] >> index[0]];\r\n\r\n    if ((code & jpeg.lossless.Decoder.MSB) !== 0) {\r\n      if (this.markerIndex !== 0) {\r\n        this.markerIndex = 0;\r\n        return 0xFF00 | this.marker;\r\n      }\r\n\r\n      temp[0] &= (mask >> (16 - index[0]));\r\n      temp[0] <<= 8;\r\n      input = this.stream.get8();\r\n\r\n      if (input === 0xFF) {\r\n        this.marker = this.stream.get8();\r\n        if (this.marker !== 0) {\r\n          this.markerIndex = 9;\r\n        }\r\n      }\r\n\r\n      temp[0] |= input;\r\n      code = table[((code & 0xFF) * 256) + (temp[0] >> index[0])];\r\n      index[0] += 8;\r\n    }\r\n\r\n    index[0] += 8 - (code >> 8);\r\n\r\n    if (index[0] < 0) {\r\n      throw new Error(\"index=\" + index[0] + \" temp=\" + temp[0] + \" code=\" + code + \" in HuffmanValue()\");\r\n    }\r\n\r\n    if (index[0] < this.markerIndex) {\r\n      this.markerIndex = 0;\r\n      return 0xFF00 | this.marker;\r\n    }\r\n\r\n    temp[0] &= (mask >> (16 - index[0]));\r\n    return code & 0xFF;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.getn = function (PRED, n, temp, index) {\r\n    /*jslint bitwise: true */\r\n\r\n    var result, one, n_one, mask, input;\r\n    one = 1;\r\n    n_one = -1;\r\n    mask = 0xFFFF;\r\n\r\n    if (n === 0) {\r\n      return 0;\r\n    }\r\n\r\n    if (n === 16) {\r\n      if (PRED[0] >= 0) {\r\n        return -32768;\r\n      } else {\r\n        return 32768;\r\n      }\r\n    }\r\n\r\n    index[0] -= n;\r\n\r\n    if (index[0] >= 0) {\r\n      if ((index[0] < this.markerIndex) && !this.isLastPixel()) { // this was corrupting the last pixel in some cases\r\n        this.markerIndex = 0;\r\n        return (0xFF00 | this.marker) << 8;\r\n      }\r\n\r\n      result = temp[0] >> index[0];\r\n      temp[0] &= (mask >> (16 - index[0]));\r\n    } else {\r\n      temp[0] <<= 8;\r\n      input = this.stream.get8();\r\n\r\n      if (input === 0xFF) {\r\n        this.marker = this.stream.get8();\r\n        if (this.marker !== 0) {\r\n          this.markerIndex = 9;\r\n        }\r\n      }\r\n\r\n      temp[0] |= input;\r\n      index[0] += 8;\r\n\r\n      if (index[0] < 0) {\r\n        if (this.markerIndex !== 0) {\r\n          this.markerIndex = 0;\r\n          return (0xFF00 | this.marker) << 8;\r\n        }\r\n\r\n        temp[0] <<= 8;\r\n        input = this.stream.get8();\r\n\r\n        if (input === 0xFF) {\r\n          this.marker = this.stream.get8();\r\n          if (this.marker !== 0) {\r\n            this.markerIndex = 9;\r\n          }\r\n        }\r\n\r\n        temp[0] |= input;\r\n        index[0] += 8;\r\n      }\r\n\r\n      if (index[0] < 0) {\r\n        throw new Error(\"index=\" + index[0] + \" in getn()\");\r\n      }\r\n\r\n      if (index[0] < this.markerIndex) {\r\n        this.markerIndex = 0;\r\n        return (0xFF00 | this.marker) << 8;\r\n      }\r\n\r\n      result = temp[0] >> index[0];\r\n      temp[0] &= (mask >> (16 - index[0]));\r\n    }\r\n\r\n    if (result < (one << (n - 1))) {\r\n      result += (n_one << n) + 1;\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.getPreviousX = function () {\r\n    /*jslint bitwise: true */\r\n\r\n    if (this.xLoc > 0) {\r\n      return this.getter((((this.yLoc * this.xDim) + this.xLoc) - 1));\r\n    } else if (this.yLoc > 0) {\r\n      return this.getPreviousY();\r\n    } else {\r\n      return (1 << (this.frame.precision - 1));\r\n    }\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.getPreviousXY = function () {\r\n    /*jslint bitwise: true */\r\n\r\n    if ((this.xLoc > 0) && (this.yLoc > 0)) {\r\n      return this.getter(((((this.yLoc - 1) * this.xDim) + this.xLoc) - 1));\r\n    } else {\r\n      return this.getPreviousY();\r\n    }\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.getPreviousY = function () {\r\n    /*jslint bitwise: true */\r\n\r\n    if (this.yLoc > 0) {\r\n      return this.getter((((this.yLoc - 1) * this.xDim) + this.xLoc));\r\n    } else {\r\n      return this.getPreviousX();\r\n    }\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.isLastPixel = function () {\r\n    return (this.xLoc === (this.xDim - 1)) && (this.yLoc === (this.yDim - 1));\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.output = function (PRED) {\r\n    if ((this.xLoc < this.xDim) && (this.yLoc < this.yDim)) {\r\n      this.setter((((this.yLoc * this.xDim) + this.xLoc)), PRED[0]);\r\n\r\n      this.xLoc+=1;\r\n\r\n      if (this.xLoc >= this.xDim) {\r\n        this.yLoc+=1;\r\n        this.xLoc = 0;\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.setValue16 = function (index, val) {\r\n    this.outputData.setInt16(index * 2, val, true);\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.getValue16 = function (index) {\r\n    return this.outputData.getInt16(index * 2, true);\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.setValue8 = function (index, val) {\r\n    this.outputData.setInt8(index, val);\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.getValue8 = function (index) {\r\n    return this.outputData.getInt8(index);\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.readApp = function() {\r\n    var count = 0, length = this.stream.get16();\r\n    count += 2;\r\n\r\n    while (count < length) {\r\n      this.stream.get8();\r\n      count+=1;\r\n    }\r\n\r\n    return length;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.readComment = function () {\r\n    var sb = \"\", count = 0, length;\r\n\r\n    length = this.stream.get16();\r\n    count += 2;\r\n\r\n    while (count < length) {\r\n      sb += this.stream.get8();\r\n      count+=1;\r\n    }\r\n\r\n    return sb;\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.readNumber = function() {\r\n    var Ld = this.stream.get16();\r\n\r\n    if (Ld !== 4) {\r\n      throw new Error(\"ERROR: Define number format throw new IOException [Ld!=4]\");\r\n    }\r\n\r\n    return this.stream.get16();\r\n  };\r\n\r\n\r\n\r\n  jpeg.lossless.Decoder.prototype.scaleIDCT = function (matrix) {\r\n    /*jslint bitwise: true */\r\n\r\n    var p = jpeg.lossless.Utils.createArray(8, 8), t0, t1, t2, t3, i, src0, src1, src2, src3, src4, src5, src6, src7, det0, det1, det2, det3, det4,\r\n      det5, det6, det7, mindex = 0;\r\n\r\n    for (i = 0; i < 8; i+=1) {\r\n      src0 = this.IDCT_Source[(0) + i];\r\n      src1 = this.IDCT_Source[(8) + i];\r\n      src2 = this.IDCT_Source[(16) + i] - this.IDCT_Source[(24) + i];\r\n      src3 = this.IDCT_Source[(24) + i] + this.IDCT_Source[(16) + i];\r\n      src4 = this.IDCT_Source[(32) + i] - this.IDCT_Source[(56) + i];\r\n      src6 = this.IDCT_Source[(40) + i] - this.IDCT_Source[(48) + i];\r\n      t0 = this.IDCT_Source[(40) + i] + this.IDCT_Source[(48) + i];\r\n      t1 = this.IDCT_Source[(32) + i] + this.IDCT_Source[(56) + i];\r\n      src5 = t0 - t1;\r\n      src7 = t0 + t1;\r\n\r\n      det4 = (-src4 * 480) - (src6 * 192);\r\n      det5 = src5 * 384;\r\n      det6 = (src6 * 480) - (src4 * 192);\r\n      det7 = src7 * 256;\r\n      t0 = src0 * 256;\r\n      t1 = src1 * 256;\r\n      t2 = src2 * 384;\r\n      t3 = src3 * 256;\r\n      det3 = t3;\r\n      det0 = t0 + t1;\r\n      det1 = t0 - t1;\r\n      det2 = t2 - t3;\r\n\r\n      src0 = det0 + det3;\r\n      src1 = det1 + det2;\r\n      src2 = det1 - det2;\r\n      src3 = det0 - det3;\r\n      src4 = det6 - det4 - det5 - det7;\r\n      src5 = (det5 - det6) + det7;\r\n      src6 = det6 - det7;\r\n      src7 = det7;\r\n\r\n      p[0][i] = (src0 + src7 + (1 << 12)) >> 13;\r\n      p[1][i] = (src1 + src6 + (1 << 12)) >> 13;\r\n      p[2][i] = (src2 + src5 + (1 << 12)) >> 13;\r\n      p[3][i] = (src3 + src4 + (1 << 12)) >> 13;\r\n      p[4][i] = ((src3 - src4) + (1 << 12)) >> 13;\r\n      p[5][i] = ((src2 - src5) + (1 << 12)) >> 13;\r\n      p[6][i] = ((src1 - src6) + (1 << 12)) >> 13;\r\n      p[7][i] = ((src0 - src7) + (1 << 12)) >> 13;\r\n    }\r\n\r\n    for (i = 0; i < 8; i+=1) {\r\n      src0 = p[i][0];\r\n      src1 = p[i][1];\r\n      src2 = p[i][2] - p[i][3];\r\n      src3 = p[i][3] + p[i][2];\r\n      src4 = p[i][4] - p[i][7];\r\n      src6 = p[i][5] - p[i][6];\r\n      t0 = p[i][5] + p[i][6];\r\n      t1 = p[i][4] + p[i][7];\r\n      src5 = t0 - t1;\r\n      src7 = t0 + t1;\r\n\r\n      det4 = (-src4 * 480) - (src6 * 192);\r\n      det5 = src5 * 384;\r\n      det6 = (src6 * 480) - (src4 * 192);\r\n      det7 = src7 * 256;\r\n      t0 = src0 * 256;\r\n      t1 = src1 * 256;\r\n      t2 = src2 * 384;\r\n      t3 = src3 * 256;\r\n      det3 = t3;\r\n      det0 = t0 + t1;\r\n      det1 = t0 - t1;\r\n      det2 = t2 - t3;\r\n\r\n      src0 = det0 + det3;\r\n      src1 = det1 + det2;\r\n      src2 = det1 - det2;\r\n      src3 = det0 - det3;\r\n      src4 = det6 - det4 - det5 - det7;\r\n      src5 = (det5 - det6) + det7;\r\n      src6 = det6 - det7;\r\n      src7 = det7;\r\n\r\n      matrix[mindex+=1] = (src0 + src7 + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = (src1 + src6 + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = (src2 + src5 + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = (src3 + src4 + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = ((src3 - src4) + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = ((src2 - src5) + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = ((src1 - src6) + (1 << 12)) >> 13;\r\n      matrix[mindex+=1] = ((src0 - src7) + (1 << 12)) >> 13;\r\n    }\r\n  };\r\n\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.Decoder;\r\n  }\r\n\r\n},{\"./data-stream.js\":2,\"./frame-header.js\":4,\"./huffman-table.js\":5,\"./quantization-table.js\":7,\"./scan-header.js\":9,\"./utils.js\":10}],4:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n  jpeg.lossless.ComponentSpec = jpeg.lossless.ComponentSpec || ((typeof require !== 'undefined') ? require('./component-spec.js') : null);\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.FrameHeader = jpeg.lossless.FrameHeader || function () {\r\n    this.components = []; // Components\r\n    this.dimX = 0; // Number of samples per line\r\n    this.dimY = 0; // Number of lines\r\n    this.numComp = 0; // Number of component in the frame\r\n    this.precision = 0; // Sample Precision (from the original image)\r\n  };\r\n\r\n\r\n\r\n  /*** Prototype Methods ***/\r\n\r\n  jpeg.lossless.FrameHeader.prototype.read = function (data) {\r\n    /*jslint bitwise: true */\r\n\r\n    var count = 0, length, i, c, temp;\r\n\r\n    length = data.get16();\r\n    count += 2;\r\n\r\n    this.precision = data.get8();\r\n    count+=1;\r\n\r\n    this.dimY = data.get16();\r\n    count += 2;\r\n\r\n    this.dimX = data.get16();\r\n    count += 2;\r\n\r\n    this.numComp = data.get8();\r\n    count+=1;\r\n    for (i = 1; i <= this.numComp; i+=1) {\r\n      if (count > length) {\r\n        throw new Error(\"ERROR: frame format error\");\r\n      }\r\n\r\n      c = data.get8();\r\n      count+=1;\r\n\r\n      if (count >= length) {\r\n        throw new Error(\"ERROR: frame format error [c>=Lf]\");\r\n      }\r\n\r\n      temp = data.get8();\r\n      count+=1;\r\n\r\n      if (!this.components[c]) {\r\n        this.components[c] = new jpeg.lossless.ComponentSpec();\r\n      }\r\n\r\n      this.components[c].hSamp = temp >> 4;\r\n      this.components[c].vSamp = temp & 0x0F;\r\n      this.components[c].quantTableSel = data.get8();\r\n      count+=1;\r\n    }\r\n\r\n    if (count !== length) {\r\n      throw new Error(\"ERROR: frame format error [Lf!=count]\");\r\n    }\r\n\r\n    return 1;\r\n  };\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.FrameHeader;\r\n  }\r\n\r\n},{\"./component-spec.js\":1,\"./data-stream.js\":2}],5:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\r\n  jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.HuffmanTable = jpeg.lossless.HuffmanTable || function () {\r\n    this.l = jpeg.lossless.Utils.createArray(4, 2, 16);\r\n    this.th = [];\r\n    this.v = jpeg.lossless.Utils.createArray(4, 2, 16, 200);\r\n    this.tc = jpeg.lossless.Utils.createArray(4, 2);\r\n\r\n    this.tc[0][0] = 0;\r\n    this.tc[1][0] = 0;\r\n    this.tc[2][0] = 0;\r\n    this.tc[3][0] = 0;\r\n    this.tc[0][1] = 0;\r\n    this.tc[1][1] = 0;\r\n    this.tc[2][1] = 0;\r\n    this.tc[3][1] = 0;\r\n    this.th[0] = 0;\r\n    this.th[1] = 0;\r\n    this.th[2] = 0;\r\n    this.th[3] = 0;\r\n  };\r\n\r\n\r\n\r\n  /*** Static Pseudo-constants ***/\r\n\r\n  jpeg.lossless.HuffmanTable.MSB = 0x80000000;\r\n\r\n\r\n  /*** Prototype Methods ***/\r\n\r\n  jpeg.lossless.HuffmanTable.prototype.read = function(data, HuffTab) {\r\n    /*jslint bitwise: true */\r\n\r\n    var count = 0, length, temp, t, c, i, j;\r\n\r\n    length = data.get16();\r\n    count += 2;\r\n\r\n    while (count < length) {\r\n      temp = data.get8();\r\n      count+=1;\r\n      t = temp & 0x0F;\r\n      if (t > 3) {\r\n        throw new Error(\"ERROR: Huffman table ID > 3\");\r\n      }\r\n\r\n      c = temp >> 4;\r\n      if (c > 2) {\r\n        throw new Error(\"ERROR: Huffman table [Table class > 2 ]\");\r\n      }\r\n\r\n      this.th[t] = 1;\r\n      this.tc[t][c] = 1;\r\n\r\n      for (i = 0; i < 16; i+=1) {\r\n        this.l[t][c][i] = data.get8();\r\n        count+=1;\r\n      }\r\n\r\n      for (i = 0; i < 16; i+=1) {\r\n        for (j = 0; j < this.l[t][c][i]; j+=1) {\r\n          if (count > length) {\r\n            throw new Error(\"ERROR: Huffman table format error [count>Lh]\");\r\n          }\r\n\r\n          this.v[t][c][i][j] = data.get8();\r\n          count+=1;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (count !== length) {\r\n      throw new Error(\"ERROR: Huffman table format error [count!=Lf]\");\r\n    }\r\n\r\n    for (i = 0; i < 4; i+=1) {\r\n      for (j = 0; j < 2; j+=1) {\r\n        if (this.tc[i][j] !== 0) {\r\n          this.buildHuffTable(HuffTab[i][j], this.l[i][j], this.v[i][j]);\r\n        }\r\n      }\r\n    }\r\n\r\n    return 1;\r\n  };\r\n\r\n\r\n\r\n//\tBuild_HuffTab()\r\n//\tParameter:  t       table ID\r\n//\t            c       table class ( 0 for DC, 1 for AC )\r\n//\t            L[i]    # of codewords which length is i\r\n//\t            V[i][j] Huffman Value (length=i)\r\n//\tEffect:\r\n//\t    build up HuffTab[t][c] using L and V.\r\n  jpeg.lossless.HuffmanTable.prototype.buildHuffTable = function(tab, L, V) {\r\n    /*jslint bitwise: true */\r\n\r\n    var currentTable, temp, k, i, j, n;\r\n    temp = 256;\r\n    k = 0;\r\n\r\n    for (i = 0; i < 8; i+=1) { // i+1 is Code length\r\n      for (j = 0; j < L[i]; j+=1) {\r\n        for (n = 0; n < (temp >> (i + 1)); n+=1) {\r\n          tab[k] = V[i][j] | ((i + 1) << 8);\r\n          k+=1;\r\n        }\r\n      }\r\n    }\r\n\r\n    for (i = 1; k < 256; i+=1, k+=1) {\r\n      tab[k] = i | jpeg.lossless.HuffmanTable.MSB;\r\n    }\r\n\r\n    currentTable = 1;\r\n    k = 0;\r\n\r\n    for (i = 8; i < 16; i+=1) { // i+1 is Code length\r\n      for (j = 0; j < L[i]; j+=1) {\r\n        for (n = 0; n < (temp >> (i - 7)); n+=1) {\r\n          tab[(currentTable * 256) + k] = V[i][j] | ((i + 1) << 8);\r\n          k+=1;\r\n        }\r\n\r\n        if (k >= 256) {\r\n          if (k > 256) {\r\n            throw new Error(\"ERROR: Huffman table error(1)!\");\r\n          }\r\n\r\n          k = 0;\r\n          currentTable+=1;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.HuffmanTable;\r\n  }\r\n\r\n},{\"./data-stream.js\":2,\"./utils.js\":10}],6:[function(require,module,exports){\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n  jpeg.lossless.ComponentSpec = jpeg.lossless.ComponentSpec || ((typeof require !== 'undefined') ? require('./component-spec.js') : null);\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\r\n  jpeg.lossless.Decoder = jpeg.lossless.Decoder || ((typeof require !== 'undefined') ? require('./decoder.js') : null);\r\n  jpeg.lossless.FrameHeader = jpeg.lossless.FrameHeader || ((typeof require !== 'undefined') ? require('./frame-header.js') : null);\r\n  jpeg.lossless.HuffmanTable = jpeg.lossless.HuffmanTable || ((typeof require !== 'undefined') ? require('./huffman-table.js') : null);\r\n  jpeg.lossless.QuantizationTable = jpeg.lossless.QuantizationTable || ((typeof require !== 'undefined') ? require('./quantization-table.js') : null);\r\n  jpeg.lossless.ScanComponent = jpeg.lossless.ScanComponent || ((typeof require !== 'undefined') ? require('./scan-component.js') : null);\r\n  jpeg.lossless.ScanHeader = jpeg.lossless.ScanHeader || ((typeof require !== 'undefined') ? require('./scan-header.js') : null);\r\n  jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\r\n\r\n\r\n  /*** Exports ***/\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg;\r\n  }\r\n\r\n},{\"./component-spec.js\":1,\"./data-stream.js\":2,\"./decoder.js\":3,\"./frame-header.js\":4,\"./huffman-table.js\":5,\"./quantization-table.js\":7,\"./scan-component.js\":8,\"./scan-header.js\":9,\"./utils.js\":10}],7:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\r\n  jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.QuantizationTable = jpeg.lossless.QuantizationTable || function () {\r\n    this.precision = []; // Quantization precision 8 or 16\r\n    this.tq = []; // 1: this table is presented\r\n    this.quantTables = jpeg.lossless.Utils.createArray(4, 64); // Tables\r\n\r\n    this.tq[0] = 0;\r\n    this.tq[1] = 0;\r\n    this.tq[2] = 0;\r\n    this.tq[3] = 0;\r\n  };\r\n\r\n\r\n\r\n  /*** Static Methods ***/\r\n\r\n  jpeg.lossless.QuantizationTable.enhanceQuantizationTable = function(qtab, table) {\r\n    /*jslint bitwise: true */\r\n\r\n    var i;\r\n\r\n    for (i = 0; i < 8; i+=1) {\r\n      qtab[table[(0 * 8) + i]] *= 90;\r\n      qtab[table[(4 * 8) + i]] *= 90;\r\n      qtab[table[(2 * 8) + i]] *= 118;\r\n      qtab[table[(6 * 8) + i]] *= 49;\r\n      qtab[table[(5 * 8) + i]] *= 71;\r\n      qtab[table[(1 * 8) + i]] *= 126;\r\n      qtab[table[(7 * 8) + i]] *= 25;\r\n      qtab[table[(3 * 8) + i]] *= 106;\r\n    }\r\n\r\n    for (i = 0; i < 8; i+=1) {\r\n      qtab[table[0 + (8 * i)]] *= 90;\r\n      qtab[table[4 + (8 * i)]] *= 90;\r\n      qtab[table[2 + (8 * i)]] *= 118;\r\n      qtab[table[6 + (8 * i)]] *= 49;\r\n      qtab[table[5 + (8 * i)]] *= 71;\r\n      qtab[table[1 + (8 * i)]] *= 126;\r\n      qtab[table[7 + (8 * i)]] *= 25;\r\n      qtab[table[3 + (8 * i)]] *= 106;\r\n    }\r\n\r\n    for (i = 0; i < 64; i+=1) {\r\n      qtab[i] >>= 6;\r\n    }\r\n  };\r\n\r\n\r\n  /*** Prototype Methods ***/\r\n\r\n  jpeg.lossless.QuantizationTable.prototype.read = function (data, table) {\r\n    /*jslint bitwise: true */\r\n\r\n    var count = 0, length, temp, t, i;\r\n\r\n    length = data.get16();\r\n    count += 2;\r\n\r\n    while (count < length) {\r\n      temp = data.get8();\r\n      count+=1;\r\n      t = temp & 0x0F;\r\n\r\n      if (t > 3) {\r\n        throw new Error(\"ERROR: Quantization table ID > 3\");\r\n      }\r\n\r\n      this.precision[t] = temp >> 4;\r\n\r\n      if (this.precision[t] === 0) {\r\n        this.precision[t] = 8;\r\n      } else if (this.precision[t] === 1) {\r\n        this.precision[t] = 16;\r\n      } else {\r\n        throw new Error(\"ERROR: Quantization table precision error\");\r\n      }\r\n\r\n      this.tq[t] = 1;\r\n\r\n      if (this.precision[t] === 8) {\r\n        for (i = 0; i < 64; i+=1) {\r\n          if (count > length) {\r\n            throw new Error(\"ERROR: Quantization table format error\");\r\n          }\r\n\r\n          this.quantTables[t][i] = data.get8();\r\n          count+=1;\r\n        }\r\n\r\n        jpeg.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[t], table);\r\n      } else {\r\n        for (i = 0; i < 64; i+=1) {\r\n          if (count > length) {\r\n            throw new Error(\"ERROR: Quantization table format error\");\r\n          }\r\n\r\n          this.quantTables[t][i] = data.get16();\r\n          count += 2;\r\n        }\r\n\r\n        jpeg.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[t], table);\r\n      }\r\n    }\r\n\r\n    if (count !== length) {\r\n      throw new Error(\"ERROR: Quantization table error [count!=Lq]\");\r\n    }\r\n\r\n    return 1;\r\n  };\r\n\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.QuantizationTable;\r\n  }\r\n\r\n},{\"./data-stream.js\":2,\"./utils.js\":10}],8:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.ScanComponent = jpeg.lossless.ScanComponent || function () {\r\n    this.acTabSel = 0; // AC table selector\r\n    this.dcTabSel = 0; // DC table selector\r\n    this.scanCompSel = 0; // Scan component selector\r\n  };\r\n\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.ScanComponent;\r\n  }\r\n\r\n},{}],9:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n  jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\r\n  jpeg.lossless.ScanComponent = jpeg.lossless.ScanComponent || ((typeof require !== 'undefined') ? require('./scan-component.js') : null);\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.ScanHeader = jpeg.lossless.ScanHeader || function () {\r\n    this.ah = 0;\r\n    this.al = 0;\r\n    this.numComp = 0; // Number of components in the scan\r\n    this.selection = 0; // Start of spectral or predictor selection\r\n    this.spectralEnd = 0; // End of spectral selection\r\n    this.components = [];\r\n  };\r\n\r\n\r\n  /*** Prototype Methods ***/\r\n\r\n  jpeg.lossless.ScanHeader.prototype.read = function(data) {\r\n    /*jslint bitwise: true */\r\n\r\n    var count = 0, length, i, temp;\r\n\r\n    length = data.get16();\r\n    count += 2;\r\n\r\n    this.numComp = data.get8();\r\n    count+=1;\r\n\r\n    for (i = 0; i < this.numComp; i+=1) {\r\n      this.components[i] = new jpeg.lossless.ScanComponent();\r\n\r\n      if (count > length) {\r\n        throw new Error(\"ERROR: scan header format error\");\r\n      }\r\n\r\n      this.components[i].scanCompSel = data.get8();\r\n      count+=1;\r\n\r\n      temp = data.get8();\r\n      count+=1;\r\n\r\n      this.components[i].dcTabSel = (temp >> 4);\r\n      this.components[i].acTabSel = (temp & 0x0F);\r\n    }\r\n\r\n    this.selection = data.get8();\r\n    count+=1;\r\n\r\n    this.spectralEnd = data.get8();\r\n    count+=1;\r\n\r\n    temp = data.get8();\r\n    this.ah = (temp >> 4);\r\n    this.al = (temp & 0x0F);\r\n    count+=1;\r\n\r\n    if (count !== length) {\r\n      throw new Error(\"ERROR: scan header format error [count!=Ns]\");\r\n    }\r\n\r\n    return 1;\r\n  };\r\n\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.ScanHeader;\r\n  }\r\n\r\n},{\"./data-stream.js\":2,\"./scan-component.js\":8}],10:[function(require,module,exports){\r\n  /*\r\n   * Copyright (C) 2015 Michael Martinez\r\n   * Changes: Added support for selection values 2-7, fixed minor bugs &\r\n   * warnings, split into multiple class files, and general clean up.\r\n   *\r\n   * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\r\n   */\r\n\r\n  /*\r\n   * Copyright (C) Helmut Dersch\r\n   *\r\n   * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n   * of this software and associated documentation files (the \"Software\"), to deal\r\n   * in the Software without restriction, including without limitation the rights\r\n   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n   * copies of the Software, and to permit persons to whom the Software is\r\n   * furnished to do so, subject to the following conditions:\r\n\r\n   * The above copyright notice and this permission notice shall be included in\r\n   * all copies or substantial portions of the Software.\r\n\r\n   * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n   * THE SOFTWARE.\r\n   */\r\n\r\n  /*jslint browser: true, node: true */\r\n  /*global require, module */\r\n\r\n  \"use strict\";\r\n\r\n  /*** Imports ***/\r\n  var jpeg = jpeg || {};\r\n  jpeg.lossless = jpeg.lossless || {};\r\n\r\n\r\n  /*** Constructor ***/\r\n  jpeg.lossless.Utils = jpeg.lossless.Utils || {};\r\n\r\n\r\n  /*** Static methods ***/\r\n\r\n// http://stackoverflow.com/questions/966225/how-can-i-create-a-two-dimensional-array-in-javascript\r\n  jpeg.lossless.Utils.createArray = function (length) {\r\n    var arr = new Array(length || 0),\r\n      i = length;\r\n\r\n    if (arguments.length > 1) {\r\n      var args = Array.prototype.slice.call(arguments, 1);\r\n      while(i--) arr[length-1 - i] = jpeg.lossless.Utils.createArray.apply(this, args);\r\n    }\r\n\r\n    return arr;\r\n  };\r\n\r\n\r\n  /*** Exports ***/\r\n\r\n  var moduleType = typeof module;\r\n  if ((moduleType !== 'undefined') && module.exports) {\r\n    module.exports = jpeg.lossless.Utils;\r\n  }\r\n\r\n},{}]},{},[6])(6)\r\n});\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n  function extractUncompressedPixels(dataSet, frame)\r\n  {\r\n    var pixelFormat = cornerstoneWADOImageLoader.getPixelFormat(dataSet);\r\n    var pixelDataElement = dataSet.elements.x7fe00010;\r\n    var height = dataSet.uint16('x00280010');\r\n    var width = dataSet.uint16('x00280011');\r\n    var samplesPerPixel = dataSet.uint16('x00280002');\r\n    var pixelDataOffset = pixelDataElement.dataOffset;\r\n    var numPixels = width * height * samplesPerPixel;\r\n    // Note - we may want to sanity check the rows * columns * bitsAllocated * samplesPerPixel against the buffer size\r\n\r\n    var frameOffset = 0;\r\n    if(pixelFormat === 1) {\r\n      frameOffset = pixelDataOffset + frame * numPixels;\r\n      return new Uint8Array(dataSet.byteArray.buffer, frameOffset, numPixels);\r\n    }\r\n    else if(pixelFormat === 2) {\r\n      frameOffset = pixelDataOffset + frame * numPixels * 2;\r\n      return new Uint16Array(dataSet.byteArray.buffer, frameOffset, numPixels);\r\n    }\r\n    else if(pixelFormat === 3) {\r\n      frameOffset = pixelDataOffset + frame * numPixels * 2;\r\n      return new Int16Array(dataSet.byteArray.buffer, frameOffset, numPixels);\r\n    }\r\n  }\r\n\r\n  cornerstoneWADOImageLoader.extractUncompressedPixels = extractUncompressedPixels;\r\n}($, cornerstone, cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function getPixelFormat(dataSet) {\r\n    var pixelRepresentation = dataSet.uint16('x00280103');\r\n    var bitsAllocated = dataSet.uint16('x00280100');\r\n    if(pixelRepresentation === 0 && bitsAllocated === 8) {\r\n      return 1; // unsigned 8 bit\r\n    } else if(pixelRepresentation === 0 && bitsAllocated === 16) {\r\n      return 2; // unsigned 16 bit\r\n    } else if(pixelRepresentation === 1 && bitsAllocated === 16) {\r\n      return 3; // signed 16 bit data\r\n    }\r\n  }\r\n\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.getPixelFormat = getPixelFormat;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    function getPixelSpacing(dataSet)\r\n    {\r\n        // NOTE - these are not required for all SOP Classes\r\n        // so we return them as undefined.  We also do not\r\n        // deal with the complexity associated with projection\r\n        // radiographs here and leave that to a higher layer\r\n        var pixelSpacing = dataSet.string('x00280030');\r\n        if(pixelSpacing && pixelSpacing.length > 0) {\r\n            var split = pixelSpacing.split('\\\\');\r\n            return {\r\n                row: parseFloat(split[0]),\r\n                column: parseFloat(split[1])\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                row: undefined,\r\n                column: undefined\r\n            };\r\n        }\r\n    }\r\n    // module exports\r\n    cornerstoneWADOImageLoader.getPixelSpacing = getPixelSpacing;\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    function getRescaleSlopeAndIntercept(dataSet)\r\n    {\r\n        // NOTE - we default these to an identity transform since modality LUT\r\n        // module is not required for all SOP Classes\r\n        var result = {\r\n            intercept : 0.0,\r\n            slope: 1.0\r\n        };\r\n\r\n        var rescaleIntercept = dataSet.floatString('x00281052');\r\n        var rescaleSlope = dataSet.floatString('x00281053');\r\n\r\n        if(rescaleIntercept && rescaleSlope) {\r\n            result.intercept = rescaleIntercept;\r\n            result.slope = rescaleSlope;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneWADOImageLoader.getRescaleSlopeAndIntercept = getRescaleSlopeAndIntercept;\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    function getWindowWidthAndCenter(dataSet)\r\n    {\r\n        // NOTE - Default these to undefined since they may not be present as\r\n        // they are not present or required for all sop classes.  We leave it up\r\n        // to a higher layer to determine reasonable default values for these\r\n        // if they are not provided.  We also use the first ww/wc values if\r\n        // there are multiple and again leave it up the higher levels to deal with\r\n        // this\r\n        var result = {\r\n            windowCenter : undefined,\r\n            windowWidth: undefined\r\n        };\r\n\r\n        var windowCenter = dataSet.floatString('x00281050');\r\n        var windowWidth = dataSet.floatString('x00281051');\r\n\r\n        if(windowCenter && windowWidth) {\r\n          result.windowCenter = windowCenter;\r\n          result.windowWidth = windowWidth;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneWADOImageLoader.getWindowWidthAndCenter = getWindowWidthAndCenter;\r\n}(cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  var options = {\r\n    // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\r\n    beforeSend : function(xhr) {}\r\n  };\r\n\r\n  function configure(opts) {\r\n    options = opts;\r\n  }\r\n\r\n  function isColorImage(photoMetricInterpretation)\r\n  {\r\n    if(photoMetricInterpretation === \"RGB\" ||\r\n      photoMetricInterpretation === \"PALETTE COLOR\" ||\r\n      photoMetricInterpretation === \"YBR_FULL\" ||\r\n      photoMetricInterpretation === \"YBR_FULL_422\" ||\r\n      photoMetricInterpretation === \"YBR_PARTIAL_422\" ||\r\n      photoMetricInterpretation === \"YBR_PARTIAL_420\" ||\r\n      photoMetricInterpretation === \"YBR_RCT\" ||\r\n      photoMetricInterpretation === \"YBR_ICT\")\r\n    {\r\n      return true;\r\n    }\r\n    else\r\n    {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  cornerstoneWADOImageLoader.isColorImage = isColorImage;\r\n\r\n}(cornerstoneWADOImageLoader));\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    var canvas = document.createElement('canvas');\r\n    var lastImageIdDrawn = \"\";\r\n\r\n    function extractStoredPixels(dataSet, frame) {\r\n\r\n        // special case for JPEG Baseline 8 bit\r\n        if(cornerstoneWADOImageLoader.isJPEGBaseline8Bit(dataSet) === true)\r\n        {\r\n          return cornerstoneWADOImageLoader.decodeJPEGBaseline8Bit(canvas, dataSet, frame);\r\n        }\r\n\r\n        var decodedImageFrame = cornerstoneWADOImageLoader.decodeTransferSyntax(dataSet, frame);\r\n\r\n        return cornerstoneWADOImageLoader.convertColorSpace(canvas, dataSet, decodedImageFrame);\r\n    }\r\n\r\n    function makeColorImage(imageId, dataSet, frame) {\r\n\r\n        // extract the DICOM attributes we need\r\n        var pixelSpacing = cornerstoneWADOImageLoader.getPixelSpacing(dataSet);\r\n        var rows = dataSet.uint16('x00280010');\r\n        var columns = dataSet.uint16('x00280011');\r\n        var rescaleSlopeAndIntercept = cornerstoneWADOImageLoader.getRescaleSlopeAndIntercept(dataSet);\r\n        var bytesPerPixel = 4;\r\n        var numPixels = rows * columns;\r\n        var sizeInBytes = numPixels * bytesPerPixel;\r\n        var windowWidthAndCenter = cornerstoneWADOImageLoader.getWindowWidthAndCenter(dataSet);\r\n\r\n        // clear the lastImageIdDrawn so we update the canvas\r\n        lastImageIdDrawn = undefined;\r\n\r\n        var deferred = $.Deferred();\r\n\r\n        // Decompress and decode the pixel data for this image\r\n        var imageDataPromise;\r\n        try {\r\n          imageDataPromise = extractStoredPixels(dataSet, frame);\r\n        }\r\n        catch(err) {\r\n          deferred.reject(err);\r\n          return deferred;\r\n        }\r\n\r\n        imageDataPromise.then(function(imageData) {\r\n            function getPixelData() {\r\n                return imageData.data;\r\n            }\r\n\r\n            function getImageData() {\r\n                return imageData;\r\n            }\r\n\r\n            function getCanvas() {\r\n                if(lastImageIdDrawn === imageId) {\r\n                    return canvas;\r\n                }\r\n\r\n                canvas.height = rows;\r\n                canvas.width = columns;\r\n                var context = canvas.getContext('2d');\r\n                context.putImageData(imageData, 0, 0 );\r\n                lastImageIdDrawn = imageId;\r\n                return canvas;\r\n            }\r\n\r\n            // Extract the various attributes we need\r\n            var image = {\r\n                imageId : imageId,\r\n                minPixelValue : 0,\r\n                maxPixelValue : 255,\r\n                slope: rescaleSlopeAndIntercept.slope,\r\n                intercept: rescaleSlopeAndIntercept.intercept,\r\n                windowCenter : windowWidthAndCenter.windowCenter,\r\n                windowWidth : windowWidthAndCenter.windowWidth,\r\n                render: cornerstone.renderColorImage,\r\n                getPixelData: getPixelData,\r\n                getImageData: getImageData,\r\n                getCanvas: getCanvas,\r\n                rows: rows,\r\n                columns: columns,\r\n                height: rows,\r\n                width: columns,\r\n                color: true,\r\n                columnPixelSpacing: pixelSpacing.column,\r\n                rowPixelSpacing: pixelSpacing.row,\r\n                data: dataSet,\r\n                invert: false,\r\n                sizeInBytes: sizeInBytes\r\n            };\r\n\r\n            if(image.windowCenter === undefined) {\r\n                image.windowWidth = 255;\r\n                image.windowCenter = 128;\r\n            }\r\n            deferred.resolve(image);\r\n        }, function(error) {\r\n            deferred.reject(error);\r\n        });\r\n\r\n        return deferred;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneWADOImageLoader.makeColorImage = makeColorImage;\r\n}($, cornerstone, cornerstoneWADOImageLoader));\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    function getBytesPerPixel(dataSet)\r\n    {\r\n        var pixelFormat = cornerstoneWADOImageLoader.getPixelFormat(dataSet);\r\n        if(pixelFormat ===1) {\r\n            return 1;\r\n        }\r\n        else if(pixelFormat ===2 || pixelFormat ===3){\r\n            return 2;\r\n        }\r\n        throw \"unknown pixel format\";\r\n    }\r\n\r\n    function getMinMax(storedPixelData)\r\n    {\r\n        // we always calculate the min max values since they are not always\r\n        // present in DICOM and we don't want to trust them anyway as cornerstone\r\n        // depends on us providing reliable values for these\r\n        var min = 65535;\r\n        var max = -32768;\r\n        var numPixels = storedPixelData.length;\r\n        var pixelData = storedPixelData;\r\n        for(var index = 0; index < numPixels; index++) {\r\n            var spv = pixelData[index];\r\n            // TODO: test to see if it is faster to use conditional here rather than calling min/max functions\r\n            min = Math.min(min, spv);\r\n            max = Math.max(max, spv);\r\n        }\r\n\r\n        return {\r\n            min: min,\r\n            max: max\r\n        };\r\n    }\r\n\r\n    function makeGrayscaleImage(imageId, dataSet, frame) {\r\n        var deferred = $.Deferred();\r\n\r\n        // extract the DICOM attributes we need\r\n        var pixelSpacing = cornerstoneWADOImageLoader.getPixelSpacing(dataSet);\r\n        var rows = dataSet.uint16('x00280010');\r\n        var columns = dataSet.uint16('x00280011');\r\n        var rescaleSlopeAndIntercept = cornerstoneWADOImageLoader.getRescaleSlopeAndIntercept(dataSet);\r\n        \r\n        var bytesPerPixel;\r\n        try {\r\n            bytesPerPixel = getBytesPerPixel(dataSet);\r\n        } catch(error) {\r\n            deferred.reject(error);\r\n            return deferred;\r\n        }\r\n\r\n        var numPixels = rows * columns;\r\n        var sizeInBytes = numPixels * bytesPerPixel;\r\n        var photometricInterpretation = dataSet.string('x00280004');\r\n        var invert = (photometricInterpretation === \"MONOCHROME1\");\r\n        var windowWidthAndCenter = cornerstoneWADOImageLoader.getWindowWidthAndCenter(dataSet);\r\n\r\n        // Decompress and decode the pixel data for this image\r\n        var storedPixelData;\r\n        try {\r\n          storedPixelData = cornerstoneWADOImageLoader.decodeTransferSyntax(dataSet, frame);\r\n        }\r\n        catch(err) {\r\n          deferred.reject(err);\r\n          return deferred;\r\n        }\r\n\r\n        var minMax = getMinMax(storedPixelData);\r\n\r\n        function getPixelData() {\r\n            return storedPixelData;\r\n        }\r\n\r\n        // Extract the various attributes we need\r\n        var image = {\r\n            imageId : imageId,\r\n            minPixelValue : minMax.min,\r\n            maxPixelValue : minMax.max,\r\n            slope: rescaleSlopeAndIntercept.slope,\r\n            intercept: rescaleSlopeAndIntercept.intercept,\r\n            windowCenter : windowWidthAndCenter.windowCenter,\r\n            windowWidth : windowWidthAndCenter.windowWidth,\r\n            render: cornerstone.renderGrayscaleImage,\r\n            getPixelData: getPixelData,\r\n            rows: rows,\r\n            columns: columns,\r\n            height: rows,\r\n            width: columns,\r\n            color: false,\r\n            columnPixelSpacing: pixelSpacing.column,\r\n            rowPixelSpacing: pixelSpacing.row,\r\n            data: dataSet,\r\n            invert: invert,\r\n            sizeInBytes: sizeInBytes\r\n        };\r\n\r\n        // TODO: deal with pixel padding and all of the various issues by setting it to min pixel value (or lower)\r\n        // TODO: Mask out overlays embedded in pixel data above high bit\r\n\r\n        if(image.windowCenter === undefined) {\r\n            var maxVoi = image.maxPixelValue * image.slope + image.intercept;\r\n            var minVoi = image.minPixelValue * image.slope + image.intercept;\r\n            image.windowWidth = maxVoi - minVoi;\r\n            image.windowCenter = (maxVoi + minVoi) / 2;\r\n        }\r\n\r\n        deferred.resolve(image);\r\n        return deferred;\r\n    }\r\n\r\n    // module exports\r\n    cornerstoneWADOImageLoader.makeGrayscaleImage = makeGrayscaleImage;\r\n}($, cornerstone, cornerstoneWADOImageLoader));\r\n(function (cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  // module exports\r\n  cornerstoneWADOImageLoader.version = '0.7.0';\r\n\r\n}(cornerstoneWADOImageLoader));\r\n(function ($, cornerstone, cornerstoneWADOImageLoader) {\r\n\r\n  \"use strict\";\r\n\r\n  function xhrRequest(imageId, frame, url) {\r\n\r\n    var deferred = $.Deferred();\r\n\r\n    // Make the request for the DICOM P10 SOP Instance\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.responseType = \"arraybuffer\";\r\n    xhr.open(\"get\", url, true);\r\n    cornerstoneWADOImageLoader.internal.options.beforeSend(xhr);\r\n    xhr.onreadystatechange = function (oEvent) {\r\n      // TODO: consider sending out progress messages here as we receive the pixel data\r\n      if (xhr.readyState === 4) {\r\n        if (xhr.status === 200) {\r\n          // request succeeded, create an image object and resolve the deferred\r\n\r\n          // Parse the DICOM File\r\n          var dicomPart10AsArrayBuffer = xhr.response;\r\n          var byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\r\n          var dataSet = dicomParser.parseDicom(byteArray);\r\n\r\n          // if multiframe, cache the parsed data set to speed up subsequent\r\n          // requests for the other frames\r\n          if (frame !== undefined) {\r\n            cornerstoneWADOImageLoader.internal.multiFrameCacheHack[url] = dataSet;\r\n          }\r\n\r\n          var imagePromise = cornerstoneWADOImageLoader.createImageObject(dataSet, imageId, frame);\r\n          imagePromise.then(function (image) {\r\n            deferred.resolve(image);\r\n          }, function (error) {\r\n            deferred.reject(error);\r\n          });\r\n        }\r\n        else {\r\n          // request failed, reject the deferred\r\n          deferred.reject(xhr.response);\r\n        }\r\n      }\r\n    };\r\n    xhr.onprogress = function (oProgress) {\r\n      // console.log('progress:',oProgress)\r\n\r\n      if (oProgress.lengthComputable) {  //evt.loaded the bytes browser receive\r\n        //evt.total the total bytes seted by the header\r\n        //\r\n        var loaded = oProgress.loaded;\r\n        var total = oProgress.total;\r\n        var percentComplete = Math.round((loaded / total) * 100);\r\n\r\n        $(cornerstone).trigger('CornerstoneImageLoadProgress', {\r\n          imageId: imageId,\r\n          loaded: loaded,\r\n          total: total,\r\n          percentComplete: percentComplete\r\n        });\r\n      }\r\n    };\r\n\r\n    xhr.send();\r\n\r\n    return deferred;\r\n  }\r\n\r\n  cornerstoneWADOImageLoader.internal.xhrRequest = xhrRequest;\r\n}($, cornerstone, cornerstoneWADOImageLoader));",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/cornerstoneWADOImageLoader.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 73,
    "kind": "variable",
    "name": "ColorSpace",
    "memberof": "src/client/lib/cornerstoneWADOImageLoader.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneWADOImageLoader.js~ColorSpace",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneWADOImageLoader.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 687,
    "undocument": true,
    "type": {
      "types": [
        "{\"Unkown\": *, \"Grayscale\": number, \"AdobeRGB\": number, \"RGB\": number, \"CYMK\": number}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 74,
    "kind": "variable",
    "name": "JpegImage",
    "memberof": "src/client/lib/cornerstoneWADOImageLoader.js",
    "static": true,
    "longname": "src/client/lib/cornerstoneWADOImageLoader.js~JpegImage",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/cornerstoneWADOImageLoader.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 688,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 75,
    "kind": "file",
    "name": "src/client/lib/cornerstoneWebImageLoader.js",
    "content": "/*! cornerstoneWebImageLoader - v0.5.2 - 2015-09-06 | (c) 2015 Chris Hafey | https://github.com/chafey/cornerstoneWebImageLoader */\r\ncornerstoneWebImageLoader = {};\r\n//\r\n// This is a cornerstone image loader for web images such as PNG and JPEG\r\n//\r\n\r\n(function ($, cornerstone, cornerstoneWebImageLoader) {\r\n\r\n    \"use strict\";\r\n\r\n    var canvas = document.createElement('canvas');\r\n    var lastImageIdDrawn = \"\";\r\n\r\n\r\n    var options = {\r\n      // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\r\n      beforeSend : function(xhr) {}\r\n    };\r\n\r\n    function createImageObject(image, imageId)\r\n    {\r\n        // extract the attributes we need\r\n        var rows = image.naturalHeight;\r\n        var columns = image.naturalWidth;\r\n\r\n        function getPixelData()\r\n        {\r\n            var imageData = getImageData();\r\n            var imageDataData = imageData.data;\r\n            var numPixels = image.naturalHeight * image.naturalWidth;\r\n            var storedPixelData = new Uint8Array(numPixels * 4);\r\n            var imageDataIndex = 0;\r\n            var storedPixelDataIndex = 0;\r\n            for(var i=0; i < numPixels; i++) {\r\n                storedPixelData[storedPixelDataIndex++] = imageDataData[imageDataIndex++];\r\n                storedPixelData[storedPixelDataIndex++] = imageDataData[imageDataIndex++];\r\n                storedPixelData[storedPixelDataIndex++] = imageDataData[imageDataIndex++];\r\n                storedPixelData[storedPixelDataIndex++] = 255; // alpha\r\n                imageDataIndex++;\r\n            }\r\n            return storedPixelData;\r\n        }\r\n\r\n        function getImageData()\r\n        {\r\n            var context;\r\n            if(lastImageIdDrawn !== imageId) {\r\n                canvas.height = image.naturalHeight;\r\n                canvas.width = image.naturalWidth;\r\n                context = canvas.getContext('2d');\r\n                context.drawImage(image, 0, 0);\r\n                lastImageIdDrawn = imageId;\r\n            }\r\n            else {\r\n                context = canvas.getContext('2d');\r\n            }\r\n            var imageData = context.getImageData(0, 0, image.naturalWidth, image.naturalHeight);\r\n            return imageData;\r\n        }\r\n\r\n        function getCanvas()\r\n        {\r\n            if(lastImageIdDrawn === imageId) {\r\n                return canvas;\r\n            }\r\n\r\n            canvas.height = image.naturalHeight;\r\n            canvas.width = image.naturalWidth;\r\n            var context = canvas.getContext('2d');\r\n            context.drawImage(image, 0, 0);\r\n            lastImageIdDrawn = imageId;\r\n            return canvas;\r\n        }\r\n\r\n        function getImage()\r\n        {\r\n            return image;\r\n        }\r\n\r\n        // Extract the various attributes we need\r\n        var imageObject = {\r\n            imageId : imageId,\r\n            minPixelValue : 0, // calculated below\r\n            maxPixelValue : 255, // calculated below\r\n            slope: 1.0,\r\n            intercept: 0,\r\n            windowCenter : 127,\r\n            windowWidth : 256,\r\n            render: cornerstone.renderColorImage,\r\n            getPixelData: getPixelData,\r\n            getImageData: getImageData,\r\n            getCanvas: getCanvas,\r\n            getImage: getImage,\r\n            //storedPixelData: extractStoredPixels(image),\r\n            rows: rows,\r\n            columns: columns,\r\n            height: rows,\r\n            width: columns,\r\n            color: true,\r\n            columnPixelSpacing: 1.0,\r\n            rowPixelSpacing: 1.0,\r\n            invert: false,\r\n            sizeInBytes : rows * columns * 4 // we don't know for sure so we over estimate to be safe\r\n        };\r\n\r\n        return imageObject;\r\n    }\r\n\r\n    // Loads an image given a url to an image\r\n    function loadImage(imageId) {\r\n\r\n      // create a deferred object\r\n      var deferred = $.Deferred();\r\n\r\n      var image = new Image();\r\n\r\n      var xhr = new XMLHttpRequest();\r\n      xhr.responseType = \"arraybuffer\";\r\n      xhr.open(\"GET\", imageId, true);\r\n      options.beforeSend(xhr);\r\n      xhr.onload = function(e) {\r\n        var arrayBufferView = new Uint8Array(this.response);\r\n        var blob = new Blob([arrayBufferView], {type: \"image/jpeg\"});\r\n        var urlCreator = window.URL || window.webkitURL;\r\n        var imageUrl = urlCreator.createObjectURL(blob);\r\n        image.src = imageUrl;\r\n        image.onload = function() {\r\n          var imageObject = createImageObject(image, imageId);\r\n          deferred.resolve(imageObject);\r\n          urlCreator.revokeObjectURL(imageUrl);\r\n        };\r\n        image.onerror = function() {\r\n          urlCreator.revokeObjectURL(imageUrl);\r\n          deferred.reject();\r\n        };\r\n      }\r\n      xhr.onprogress = function(oProgress) {\r\n\r\n        if (oProgress.lengthComputable) {  //evt.loaded the bytes browser receive\r\n            //evt.total the total bytes seted by the header\r\n            //\r\n            var loaded = oProgress.loaded;\r\n            var total = oProgress.total;\r\n            var percentComplete = Math.round((loaded / total)*100);\r\n\r\n            $(cornerstone).trigger('CornerstoneImageLoadProgress', {\r\n                imageId: imageId,\r\n                loaded: loaded,\r\n                total: total,\r\n                percentComplete: percentComplete\r\n            });\r\n        }\r\n      };   \r\n      xhr.send();\r\n      return deferred;\r\n    }\r\n\r\n    function configure(opts) {\r\n      options = opts;\r\n    }\r\n\r\n    // steam the http and https prefixes so we can use standard web urls directly\r\n    cornerstone.registerImageLoader('http', loadImage);\r\n    cornerstone.registerImageLoader('https', loadImage);\r\n    cornerstoneWebImageLoader.configure = configure;\r\n    return cornerstone;\r\n}($, cornerstone, cornerstoneWebImageLoader));\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/cornerstoneWebImageLoader.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 76,
    "kind": "file",
    "name": "src/client/lib/dicomParser.js",
    "content": "/*! dicom-parser - v1.1.5 - 2015-08-12 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */\r\n(function (root, factory) {\r\n\r\n    // node.js\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        module.exports = factory();\r\n    }\r\n    else if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define([], factory);\r\n    } else {\r\n        // Browser globals\r\n        if(typeof cornerstone === 'undefined'){\r\n            dicomParser = {};\r\n\r\n            // meteor\r\n            if (typeof Package !== 'undefined') {\r\n                root.dicomParser = dicomParser;\r\n            }\r\n        }\r\n        dicomParser = factory();\r\n    }\r\n}(this, function () {\r\n\r\n    /**\r\n     * Parses a DICOM P10 byte array and returns a DataSet object with the parsed elements.  If the options\r\n     * argument is supplied and it contains the untilTag property, parsing will stop once that\r\n     * tag is encoutered.  This can be used to parse partial byte streams.\r\n     *\r\n     * @param byteArray the byte array\r\n     * @param options object to control parsing behavior (optional)\r\n     * @returns {DataSet}\r\n     * @throws error if an error occurs while parsing.  The exception object will contain a property dataSet with the\r\n     *         elements successfully parsed before the error.\r\n     */\r\nvar dicomParser = (function(dicomParser) {\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    dicomParser.parseDicom = function(byteArray, options) {\r\n\r\n        if(byteArray === undefined)\r\n        {\r\n            throw \"dicomParser.parseDicom: missing required parameter 'byteArray'\";\r\n        }\r\n\r\n        var littleEndianByteStream = new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser, byteArray);\r\n\r\n        function readPrefix()\r\n        {\r\n            littleEndianByteStream.seek(128);\r\n            var prefix = littleEndianByteStream.readFixedString(4);\r\n            if(prefix !== \"DICM\")\r\n            {\r\n                throw \"dicomParser.parseDicom: DICM prefix not found at location 132\";\r\n            }\r\n        }\r\n\r\n        function readPart10Header()\r\n        {\r\n            // Per the DICOM standard, the header is always encoded in Explicit VR Little Endian (see PS3.10, section 7.1)\r\n            // so use littleEndianByteStream throughout this method regardless of the transfer syntax\r\n            readPrefix();\r\n\r\n            var warnings = [];\r\n            var elements = {};\r\n            while(littleEndianByteStream.position < littleEndianByteStream.byteArray.length) {\r\n                var position = littleEndianByteStream.position;\r\n                var element = dicomParser.readDicomElementExplicit(littleEndianByteStream, warnings);\r\n                if(element.tag > 'x0002ffff') {\r\n                    littleEndianByteStream.position = position;\r\n                    break;\r\n                }\r\n                // Cache the littleEndianByteArrayParser for meta header elements, since the rest of the data set may be big endian\r\n                // and this parser will be needed later if the meta header values are to be read.\r\n                element.parser = dicomParser.littleEndianByteArrayParser;\r\n                elements[element.tag] = element;\r\n            }\r\n            var metaHeaderDataSet = new dicomParser.DataSet(littleEndianByteStream.byteArrayParser, littleEndianByteStream.byteArray, elements);\r\n            metaHeaderDataSet.warnings = littleEndianByteStream.warnings;\r\n            return metaHeaderDataSet;\r\n        }\r\n\r\n        function readTransferSyntax(metaHeaderDataSet) {\r\n            if(metaHeaderDataSet.elements.x00020010 === undefined) {\r\n                throw 'dicomParser.parseDicom: missing required meta header attribute 0002,0010';\r\n            }\r\n            var transferSyntaxElement = metaHeaderDataSet.elements.x00020010;\r\n            return dicomParser.readFixedString(littleEndianByteStream.byteArray, transferSyntaxElement.dataOffset, transferSyntaxElement.length);\r\n        }\r\n\r\n        function isExplicit(transferSyntax) {\r\n            if(transferSyntax === '1.2.840.10008.1.2') // implicit little endian\r\n            {\r\n                return false;\r\n            }\r\n            // all other transfer syntaxes should be explicit\r\n            return true;\r\n        }\r\n\r\n        function getDataSetByteStream(transferSyntax) {\r\n            if(transferSyntax === '1.2.840.10008.1.2.2') // explicit big endian\r\n            {\r\n                return new dicomParser.ByteStream(dicomParser.bigEndianByteArrayParser, byteArray, littleEndianByteStream.position);\r\n            }\r\n            else\r\n            {\r\n                // all other transfer syntaxes are little endian; only the pixel encoding differs\r\n                // make a new stream so the metaheader warnings don't come along for the ride\r\n                return new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser, byteArray, littleEndianByteStream.position);\r\n            }\r\n        }\r\n\r\n        function mergeDataSets(metaHeaderDataSet, instanceDataSet)\r\n        {\r\n            for (var propertyName in metaHeaderDataSet.elements)\r\n            {\r\n                if(metaHeaderDataSet.elements.hasOwnProperty(propertyName))\r\n                {\r\n                    instanceDataSet.elements[propertyName] = metaHeaderDataSet.elements[propertyName];\r\n                }\r\n            }\r\n            if (metaHeaderDataSet.warnings !== undefined) {\r\n                instanceDataSet.warnings = metaHeaderDataSet.warnings.concat(instanceDataSet.warnings);\r\n            }\r\n            return instanceDataSet;\r\n        }\r\n\r\n        function readDataSet(metaHeaderDataSet)\r\n        {\r\n            var transferSyntax = readTransferSyntax(metaHeaderDataSet);\r\n            var explicit = isExplicit(transferSyntax);\r\n            var dataSetByteStream = getDataSetByteStream(transferSyntax);\r\n\r\n            var elements = {};\r\n            var dataSet = new dicomParser.DataSet(dataSetByteStream.byteArrayParser, dataSetByteStream.byteArray, elements);\r\n            dataSet.warnings = dataSetByteStream.warnings;\r\n\r\n            try{\r\n                if(explicit) {\r\n                    dicomParser.parseDicomDataSetExplicit(dataSet, dataSetByteStream, dataSetByteStream.byteArray.length, options);\r\n                }\r\n                else\r\n                {\r\n                    dicomParser.parseDicomDataSetImplicit(dataSet, dataSetByteStream, dataSetByteStream.byteArray.length, options);\r\n                }\r\n            }\r\n            catch(e) {\r\n                var ex = {\r\n                    exception: e,\r\n                    dataSet: dataSet\r\n                };\r\n                throw ex;\r\n            }\r\n            return dataSet;\r\n        }\r\n\r\n        // main function here\r\n        function parseTheByteStream() {\r\n            var metaHeaderDataSet = readPart10Header();\r\n\r\n            var dataSet = readDataSet(metaHeaderDataSet);\r\n\r\n            return mergeDataSets(metaHeaderDataSet, dataSet);\r\n        }\r\n\r\n        // This is where we actually start parsing\r\n        return parseTheByteStream();\r\n    };\r\n\r\n    return dicomParser;\r\n})(dicomParser);\r\n\r\nvar dicomParser = (function (dicomParser) {\r\n    \"use strict\";\r\n\r\n    if (dicomParser === undefined) {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * converts an explicit dataSet to a javascript object\r\n     * @param dataSet\r\n     * @param options\r\n     */\r\n    dicomParser.explicitDataSetToJS = function (dataSet, options) {\r\n\r\n        if(dataSet === undefined) {\r\n            throw 'dicomParser.explicitDataSetToJS: missing required parameter dataSet';\r\n        }\r\n\r\n        options = options || {\r\n            omitPrivateAttibutes: true, // true if private elements should be omitted\r\n            maxElementLength : 128      // maximum element length to try and convert to string format\r\n        };\r\n\r\n        var result = {\r\n\r\n        };\r\n\r\n        for(var tag in dataSet.elements) {\r\n            var element = dataSet.elements[tag];\r\n\r\n            // skip this element if it a private element and our options specify that we should\r\n            if(options.omitPrivateAttibutes === true && dicomParser.isPrivateTag(tag))\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(element.items) {\r\n                // handle sequences\r\n                var sequenceItems = [];\r\n                for(var i=0; i < element.items.length; i++) {\r\n                    sequenceItems.push(dicomParser.explicitDataSetToJS(element.items[i].dataSet, options));\r\n                }\r\n                result[tag] = sequenceItems;\r\n            } else {\r\n                var asString;\r\n                asString = undefined;\r\n                if(element.length < options.maxElementLength) {\r\n                    asString = dicomParser.explicitElementToString(dataSet, element);\r\n                }\r\n\r\n                if(asString !== undefined) {\r\n                    result[tag] = asString;\r\n                }  else {\r\n                    result[tag] = {\r\n                        dataOffset: element.dataOffset,\r\n                        length : element.length\r\n                    };\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\nvar dicomParser = (function (dicomParser) {\r\n    \"use strict\";\r\n\r\n    if (dicomParser === undefined) {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * Converts an explicit VR element to a string or undefined if it is not possible to convert.\r\n     * Throws an error if an implicit element is supplied\r\n     * @param dataSet\r\n     * @param element\r\n     * @returns {*}\r\n     */\r\n    dicomParser.explicitElementToString = function(dataSet, element)\r\n    {\r\n        if(dataSet === undefined || element === undefined) {\r\n            throw 'dicomParser.explicitElementToString: missing required parameters';\r\n        }\r\n        if(element.vr === undefined) {\r\n            throw 'dicomParser.explicitElementToString: cannot convert implicit element to string';\r\n        }\r\n        var vr = element.vr;\r\n        var tag = element.tag;\r\n\r\n        var textResult;\r\n\r\n        function multiElementToString(numItems, func) {\r\n            var result = \"\";\r\n            for(var i=0; i < numItems; i++) {\r\n                if(i !== 0) {\r\n                    result += '/';\r\n                }\r\n                result += func.call(dataSet, tag).toString();\r\n            }\r\n            return result;\r\n        }\r\n\r\n        if(dicomParser.isStringVr(vr) === true)\r\n        {\r\n            textResult = dataSet.string(tag);\r\n        }\r\n        else if (vr == 'AT') {\r\n            var num = dataSet.uint32(tag);\r\n            if(num === undefined) {\r\n                return undefined;\r\n            }\r\n            if (num < 0)\r\n            {\r\n                num = 0xFFFFFFFF + num + 1;\r\n            }\r\n\r\n            return 'x' + num.toString(16).toUpperCase();\r\n        }\r\n        else if (vr == 'US')\r\n        {\r\n            textResult = multiElementToString(element.length / 2, dataSet.uint16);\r\n        }\r\n        else if(vr === 'SS')\r\n        {\r\n            textResult = multiElementToString(element.length / 2, dataSet.int16);\r\n        }\r\n        else if (vr == 'UL')\r\n        {\r\n            textResult = multiElementToString(element.length / 4, dataSet.uint32);\r\n        }\r\n        else if(vr === 'SL')\r\n        {\r\n            textResult = multiElementToString(element.length / 4, dataSet.int32);\r\n        }\r\n        else if(vr == 'FD')\r\n        {\r\n            textResult = multiElementToString(element.length / 8, dataSet.double);\r\n        }\r\n        else if(vr == 'FL')\r\n        {\r\n            textResult = multiElementToString(element.length / 4, dataSet.float);\r\n        }\r\n\r\n        return textResult;\r\n    };\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Utility functions for dealing with DICOM\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n  \"use strict\";\r\n\r\n  if(dicomParser === undefined)\r\n  {\r\n    dicomParser = {};\r\n  }\r\n\r\n  // algorithm based on http://stackoverflow.com/questions/1433030/validate-number-of-days-in-a-given-month\r\n  function daysInMonth(m, y) { // m is 0 indexed: 0-11\r\n    switch (m) {\r\n      case 2 :\r\n        return (y % 4 == 0 && y % 100) || y % 400 == 0 ? 29 : 28;\r\n      case 9 : case 4 : case 6 : case 11 :\r\n      return 30;\r\n      default :\r\n        return 31\r\n    }\r\n  }\r\n\r\n  function isValidDate(d, m, y) {\r\n    // make year is a number\r\n    if(isNaN(y)) {\r\n      return false;\r\n    }\r\n    return m > 0 && m <= 12 && d > 0 && d <= daysInMonth(m, y);\r\n  }\r\n\r\n\r\n  /**\r\n   * Parses a DA formatted string into a Javascript object\r\n   * @param {string} date a string in the DA VR format\r\n   * @param {boolean} [validate] - true if an exception should be thrown if the date is invalid\r\n   * @returns {*} Javascript object with properties year, month and day or undefined if not present or not 8 bytes long\r\n   */\r\n  dicomParser.parseDA = function(date, validate)\r\n  {\r\n    if(date && date.length === 8)\r\n    {\r\n      var yyyy = parseInt(date.substring(0, 4), 10);\r\n      var mm = parseInt(date.substring(4, 6), 10);\r\n      var dd = parseInt(date.substring(6, 8), 10);\r\n\r\n      if(validate) {\r\n        if (isValidDate(dd, mm, yyyy) !== true) {\r\n          throw \"invalid DA '\" + date + \"'\";\r\n        }\r\n      }\r\n      return {\r\n        year: yyyy,\r\n        month: mm,\r\n        day: dd\r\n      };\r\n    }\r\n    if(validate) {\r\n      throw \"invalid DA '\" + date + \"'\";\r\n    }\r\n    return undefined;\r\n  };\r\n\r\n  return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Utility functions for dealing with DICOM\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n  \"use strict\";\r\n\r\n  if(dicomParser === undefined)\r\n  {\r\n    dicomParser = {};\r\n  }\r\n\r\n  /**\r\n   * Parses a TM formatted string into a javascript object with properties for hours, minutes, seconds and fractionalSeconds\r\n   * @param {string} time - a string in the TM VR format\r\n   * @param {boolean} [validate] - true if an exception should be thrown if the date is invalid\r\n   * @returns {*} javascript object with properties for hours, minutes, seconds and fractionalSeconds or undefined if no element or data.  Missing fields are set to undefined\r\n   */\r\n  dicomParser.parseTM = function(time, validate) {\r\n\r\n    if (time.length >= 2) // must at least have HH\r\n    {\r\n      // 0123456789\r\n      // HHMMSS.FFFFFF\r\n      var hh = parseInt(time.substring(0, 2), 10);\r\n      var mm = time.length >= 4 ? parseInt(time.substring(2, 4), 10) : undefined;\r\n      var ss = time.length >= 6 ? parseInt(time.substring(4, 6), 10) : undefined;\r\n      var ffffff = time.length >= 8 ? parseInt(time.substring(7, 13), 10) : undefined;\r\n\r\n      if(validate) {\r\n        if((isNaN(hh)) ||\r\n          (mm !== undefined && isNaN(mm)) ||\r\n          (ss !== undefined && isNaN(ss)) ||\r\n          (ffffff !== undefined && isNaN(ffffff)) ||\r\n          (hh < 0 || hh > 23) ||\r\n          (mm && (mm <0 || mm > 59))  ||\r\n          (ss && (ss <0 || ss > 59))  ||\r\n          (ffffff && (ffffff <0 || ffffff > 999999)))\r\n        {\r\n          throw \"invalid TM '\" + time + \"'\";\r\n        }\r\n      }\r\n\r\n      return {\r\n        hours: hh,\r\n        minutes: mm,\r\n        seconds: ss,\r\n        fractionalSeconds: ffffff\r\n      };\r\n    }\r\n\r\n    if(validate) {\r\n      throw \"invalid TM '\" + time + \"'\";\r\n    }\r\n\r\n    return undefined;\r\n  };\r\n\r\n  return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Utility functions for dealing with DICOM\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    var stringVrs = {\r\n        AE: true,\r\n        AS: true,\r\n        AT: false,\r\n        CS: true,\r\n        DA: true,\r\n        DS: true,\r\n        DT: true,\r\n        FL: false,\r\n        FD: false,\r\n        IS: true,\r\n        LO: true,\r\n        LT: true,\r\n        OB: false,\r\n        OD: false,\r\n        OF: false,\r\n        OW: false,\r\n        PN: true,\r\n        SH: true,\r\n        SL: false,\r\n        SQ: false,\r\n        SS: false,\r\n        ST: true,\r\n        TM: true,\r\n        UI: true,\r\n        UL: false,\r\n        UN: undefined, // dunno\r\n        UR: true,\r\n        US: false,\r\n        UT: true\r\n    };\r\n\r\n    /**\r\n     * Tests to see if vr is a string or not.\r\n     * @param vr\r\n     * @returns true if string, false it not string, undefined if unknown vr or UN type\r\n     */\r\n    dicomParser.isStringVr = function(vr)\r\n    {\r\n        return stringVrs[vr];\r\n    };\r\n\r\n    /**\r\n     * Tests to see if a given tag in the format xggggeeee is a private tag or not\r\n     * @param tag\r\n     * @returns {boolean}\r\n     */\r\n    dicomParser.isPrivateTag = function(tag)\r\n    {\r\n        var lastGroupDigit = parseInt(tag[4]);\r\n        var groupIsOdd = (lastGroupDigit % 2) === 1;\r\n        return groupIsOdd;\r\n    };\r\n\r\n    /**\r\n     * Parses a PN formatted string into a javascript object with properties for givenName, familyName, middleName, prefix and suffix\r\n     * @param personName a string in the PN VR format\r\n     * @param index\r\n     * @returns {*} javascript object with properties for givenName, familyName, middleName, prefix and suffix or undefined if no element or data\r\n     */\r\n    dicomParser.parsePN = function(personName) {\r\n        if(personName === undefined) {\r\n            return undefined;\r\n        }\r\n        var stringValues = personName.split('^');\r\n        return {\r\n            familyName: stringValues[0],\r\n            givenName: stringValues[1],\r\n            middleName: stringValues[2],\r\n            prefix: stringValues[3],\r\n            suffix: stringValues[4]\r\n        };\r\n    };\r\n\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Functionality for extracting encapsulated pixel data\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    function getPixelDataFromFragments(byteStream, fragments, bufferSize)\r\n    {\r\n        // if there is only one fragment, return a view on this array to avoid copying\r\n        if(fragments.length === 1) {\r\n            return new Uint8Array(byteStream.byteArray.buffer, fragments[0].dataOffset, fragments[0].length);\r\n        }\r\n\r\n        // more than one fragment, combine all of the fragments into one buffer\r\n        var pixelData = new Uint8Array(bufferSize);\r\n        var pixelDataIndex = 0;\r\n        for(var i=0; i < fragments.length; i++) {\r\n            var fragmentOffset = fragments[i].dataOffset;\r\n            for(var j=0; j < fragments[i].length; j++) {\r\n                pixelData[pixelDataIndex++] = byteStream.byteArray[fragmentOffset++];\r\n            }\r\n        }\r\n\r\n        return pixelData;\r\n    }\r\n\r\n    function readFragmentsUntil(byteStream, endOfFrame) {\r\n        // Read fragments until we reach endOfFrame\r\n        var fragments = [];\r\n        var bufferSize = 0;\r\n        while(byteStream.position < endOfFrame && byteStream.position < byteStream.byteArray.length) {\r\n            var fragment = dicomParser.readSequenceItem(byteStream);\r\n            // NOTE: we only encounter this for the sequence delimiter tag when extracting the last frame\r\n            if(fragment.tag === 'xfffee0dd') {\r\n                break;\r\n            }\r\n            fragments.push(fragment);\r\n            byteStream.seek(fragment.length);\r\n            bufferSize += fragment.length;\r\n        }\r\n\r\n        // Convert the fragments into a single pixelData buffer\r\n        var pixelData = getPixelDataFromFragments(byteStream, fragments, bufferSize);\r\n        return pixelData;\r\n    }\r\n\r\n    function readEncapsulatedPixelDataWithBasicOffsetTable(pixelDataElement, byteStream, frame) {\r\n        //  validate that we have an offset for this frame\r\n        var numFrames = pixelDataElement.basicOffsetTable.length;\r\n        if(frame > numFrames) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table\";\r\n        }\r\n\r\n        // move to the start of this frame\r\n        var frameOffset = pixelDataElement.basicOffsetTable[frame];\r\n        byteStream.seek(frameOffset);\r\n\r\n        // Find the end of this frame\r\n        var endOfFrameOffset = pixelDataElement.basicOffsetTable[frame + 1];\r\n        if(endOfFrameOffset === undefined) { // special case for last frame\r\n            endOfFrameOffset = byteStream.position + pixelDataElement.length;\r\n        }\r\n\r\n        // read this frame\r\n        var pixelData = readFragmentsUntil(byteStream, endOfFrameOffset);\r\n        return pixelData;\r\n    }\r\n\r\n    function readEncapsulatedDataNoBasicOffsetTable(pixelDataElement, byteStream, frame) {\r\n        // if the basic offset table is empty, this is a single frame so make sure the requested\r\n        // frame is 0\r\n        if(frame !== 0) {\r\n            throw 'dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data';\r\n        }\r\n\r\n        // read this frame\r\n        var endOfFrame = byteStream.position + pixelDataElement.length;\r\n        var pixelData = readFragmentsUntil(byteStream, endOfFrame);\r\n        return pixelData;\r\n    }\r\n\r\n    /**\r\n     * Returns the pixel data for the specified frame in an encapsulated pixel data element\r\n     *\r\n     * @param dataSet - the dataSet containing the encapsulated pixel data\r\n     * @param pixelDataElement - the pixel data element (x7fe00010) to extract the frame from\r\n     * @param frame - the zero based frame index\r\n     * @returns Uint8Array with the encapsulated pixel data\r\n     */\r\n    dicomParser.readEncapsulatedPixelData = function(dataSet, pixelDataElement, frame)\r\n    {\r\n        if(dataSet === undefined) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'\";\r\n        }\r\n        if(pixelDataElement === undefined) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'\";\r\n        }\r\n        if(frame === undefined) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'\";\r\n        }\r\n        if(pixelDataElement.tag !== 'x7fe00010') {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'\";\r\n        }\r\n        if(pixelDataElement.encapsulatedPixelData !== true) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data\";\r\n        }\r\n        if(pixelDataElement.hadUndefinedLength !== true) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data\";\r\n        }\r\n        if(pixelDataElement.basicOffsetTable === undefined) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data\";\r\n        }\r\n        if(pixelDataElement.fragments === undefined) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data\";\r\n        }\r\n        if(frame < 0) {\r\n            throw \"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0\";\r\n        }\r\n\r\n        // seek past the basic offset table (no need to parse it again since we already have)\r\n        var byteStream = new dicomParser.ByteStream(dataSet.byteArrayParser, dataSet.byteArray, pixelDataElement.dataOffset);\r\n        var basicOffsetTable = dicomParser.readSequenceItem(byteStream);\r\n        if(basicOffsetTable.tag !== 'xfffee000')\r\n        {\r\n            throw \"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000\";\r\n        }\r\n        byteStream.seek(basicOffsetTable.length);\r\n\r\n        // If the basic offset table is empty (no entries), it is a single frame.  If it is not empty,\r\n        // it has at least one frame so use the basic offset table to find the bytes\r\n        if(pixelDataElement.basicOffsetTable.length !== 0)\r\n        {\r\n            return readEncapsulatedPixelDataWithBasicOffsetTable(pixelDataElement, byteStream, frame);\r\n        }\r\n        else\r\n        {\r\n            return readEncapsulatedDataNoBasicOffsetTable(pixelDataElement, byteStream, frame);\r\n        }\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n\r\n/**\r\n * Internal helper functions for parsing different types from a big-endian byte array\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    dicomParser.bigEndianByteArrayParser = {\r\n        /**\r\n         *\r\n         * Parses an unsigned int 16 from a big-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed unsigned int 16\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readUint16: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'bigEndianByteArrayParser.readUint16: position cannot be less than 0';\r\n            }\r\n            if (position + 2 > byteArray.length) {\r\n                throw 'bigEndianByteArrayParser.readUint16: attempt to read past end of buffer';\r\n            }\r\n            return (byteArray[position] << 8) + byteArray[position + 1];\r\n        },\r\n\r\n        /**\r\n         *\r\n         * Parses a signed int 16 from a big-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed signed int 16\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readInt16: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'bigEndianByteArrayParser.readInt16: position cannot be less than 0';\r\n            }\r\n            if (position + 2 > byteArray.length) {\r\n                throw 'bigEndianByteArrayParser.readInt16: attempt to read past end of buffer';\r\n            }\r\n            var int16 = (byteArray[position] << 8) + byteArray[position + 1];\r\n            // fix sign\r\n            if (int16 & 0x8000) {\r\n                int16 = int16 - 0xFFFF - 1;\r\n            }\r\n            return int16;\r\n        },\r\n\r\n        /**\r\n         * Parses an unsigned int 32 from a big-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed unsigned int 32\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readUint32: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'bigEndianByteArrayParser.readUint32: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 4 > byteArray.length) {\r\n                throw 'bigEndianByteArrayParser.readUint32: attempt to read past end of buffer';\r\n            }\r\n\r\n            var uint32 = (256 * (256 * (256 * byteArray[position] +\r\n                                              byteArray[position + 1]) +\r\n                                              byteArray[position + 2]) +\r\n                                              byteArray[position + 3]);\r\n\r\n            return uint32;\r\n        },\r\n\r\n        /**\r\n         * Parses a signed int 32 from a big-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed signed int 32\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readInt32: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'bigEndianByteArrayParser.readInt32: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 4 > byteArray.length) {\r\n                throw 'bigEndianByteArrayParser.readInt32: attempt to read past end of buffer';\r\n            }\r\n\r\n            var int32 = ((byteArray[position] << 24) +\r\n                         (byteArray[position + 1] << 16) +\r\n                         (byteArray[position + 2] << 8) +\r\n                          byteArray[position + 3]);\r\n\r\n            return int32;\r\n        },\r\n\r\n        /**\r\n         * Parses 32-bit float from a big-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed 32-bit float\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readFloat: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'bigEndianByteArrayParser.readFloat: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 4 > byteArray.length) {\r\n                throw 'bigEndianByteArrayParser.readFloat: attempt to read past end of buffer';\r\n            }\r\n\r\n            // I am sure there is a better way than this but this should be safe\r\n            var byteArrayForParsingFloat = new Uint8Array(4);\r\n            byteArrayForParsingFloat[3] = byteArray[position];\r\n            byteArrayForParsingFloat[2] = byteArray[position + 1];\r\n            byteArrayForParsingFloat[1] = byteArray[position + 2];\r\n            byteArrayForParsingFloat[0] = byteArray[position + 3];\r\n            var floatArray = new Float32Array(byteArrayForParsingFloat.buffer);\r\n            return floatArray[0];\r\n        },\r\n\r\n        /**\r\n         * Parses 64-bit float from a big-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed 64-bit float\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readDouble: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'bigEndianByteArrayParser.readDouble: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 8 > byteArray.length) {\r\n                throw 'bigEndianByteArrayParser.readDouble: attempt to read past end of buffer';\r\n            }\r\n\r\n            // I am sure there is a better way than this but this should be safe\r\n            var byteArrayForParsingFloat = new Uint8Array(8);\r\n            byteArrayForParsingFloat[7] = byteArray[position];\r\n            byteArrayForParsingFloat[6] = byteArray[position + 1];\r\n            byteArrayForParsingFloat[5] = byteArray[position + 2];\r\n            byteArrayForParsingFloat[4] = byteArray[position + 3];\r\n            byteArrayForParsingFloat[3] = byteArray[position + 4];\r\n            byteArrayForParsingFloat[2] = byteArray[position + 5];\r\n            byteArrayForParsingFloat[1] = byteArray[position + 6];\r\n            byteArrayForParsingFloat[0] = byteArray[position + 7];\r\n            var floatArray = new Float64Array(byteArrayForParsingFloat.buffer);\r\n            return floatArray[0];\r\n        }\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions common to parsing byte arrays of any type\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * Reads a string of 8-bit characters from an array of bytes and advances\r\n     * the position by length bytes.  A null terminator will end the string\r\n     * but will not effect advancement of the position.  Trailing and leading\r\n     * spaces are preserved (not trimmed)\r\n     * @param byteArray the byteArray to read from\r\n     * @param position the position in the byte array to read from\r\n     * @param length the maximum number of bytes to parse\r\n     * @returns {string} the parsed string\r\n     * @throws error if buffer overread would occur\r\n     * @access private\r\n     */\r\n    dicomParser.readFixedString = function(byteArray, position, length)\r\n    {\r\n        if(length < 0)\r\n        {\r\n            throw 'readFixedString - length cannot be less than 0';\r\n        }\r\n\r\n        if(position + length > byteArray.length) {\r\n            throw 'dicomParser.readFixedString: attempt to read past end of buffer';\r\n        }\r\n\r\n        var result = \"\";\r\n        for(var i=0; i < length; i++)\r\n        {\r\n            var byte = byteArray[position + i];\r\n            if(byte === 0) {\r\n                position +=  length;\r\n                return result;\r\n            }\r\n            result += String.fromCharCode(byte);\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n *\r\n * Internal helper class to assist with parsing. Supports reading from a byte\r\n * stream contained in a Uint8Array.  Example usage:\r\n *\r\n *  var byteArray = new Uint8Array(32);\r\n *  var byteStream = new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser, byteArray);\r\n *\r\n * */\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * Constructor for ByteStream objects.\r\n     * @param byteArrayParser a parser for parsing the byte array\r\n     * @param byteArray a Uint8Array containing the byte stream\r\n     * @param position (optional) the position to start reading from.  0 if not specified\r\n     * @constructor\r\n     * @throws will throw an error if the byteArrayParser parameter is not present\r\n     * @throws will throw an error if the byteArray parameter is not present or invalid\r\n     * @throws will throw an error if the position parameter is not inside the byte array\r\n     */\r\n    dicomParser.ByteStream = function(byteArrayParser, byteArray, position) {\r\n        if(byteArrayParser === undefined)\r\n        {\r\n            throw \"dicomParser.ByteStream: missing required parameter 'byteArrayParser'\";\r\n        }\r\n        if(byteArray === undefined)\r\n        {\r\n            throw \"dicomParser.ByteStream: missing required parameter 'byteArray'\";\r\n        }\r\n        if((byteArray instanceof Uint8Array) === false) {\r\n            throw 'dicomParser.ByteStream: parameter byteArray is not of type Uint8Array';\r\n        }\r\n        if(position < 0)\r\n        {\r\n            throw \"dicomParser.ByteStream: parameter 'position' cannot be less than 0\";\r\n        }\r\n        if(position >= byteArray.length)\r\n        {\r\n            throw \"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length\";\r\n\r\n        }\r\n        this.byteArrayParser = byteArrayParser;\r\n        this.byteArray = byteArray;\r\n        this.position = position ? position : 0;\r\n        this.warnings = []; // array of string warnings encountered while parsing\r\n    };\r\n\r\n    /**\r\n     * Safely seeks through the byte stream.  Will throw an exception if an attempt\r\n     * is made to seek outside of the byte array.\r\n     * @param offset the number of bytes to add to the position\r\n     * @throws error if seek would cause position to be outside of the byteArray\r\n     */\r\n    dicomParser.ByteStream.prototype.seek = function(offset)\r\n    {\r\n        if(this.position + offset < 0)\r\n        {\r\n            throw \"cannot seek to position < 0\";\r\n        }\r\n        this.position += offset;\r\n    };\r\n\r\n    /**\r\n     * Returns a new ByteStream object from the current position and of the requested number of bytes\r\n     * @param numBytes the length of the byte array for the ByteStream to contain\r\n     * @returns {dicomParser.ByteStream}\r\n     * @throws error if buffer overread would occur\r\n     */\r\n    dicomParser.ByteStream.prototype.readByteStream = function(numBytes)\r\n    {\r\n        if(this.position + numBytes > this.byteArray.length) {\r\n            throw 'readByteStream - buffer overread';\r\n        }\r\n        var byteArrayView = new Uint8Array(this.byteArray.buffer, this.position, numBytes);\r\n        this.position += numBytes;\r\n        return new dicomParser.ByteStream(this.byteArrayParser, byteArrayView);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * Parses an unsigned int 16 from a byte array and advances\r\n     * the position by 2 bytes\r\n     *\r\n     * @returns {*} the parsed unsigned int 16\r\n     * @throws error if buffer overread would occur\r\n     */\r\n    dicomParser.ByteStream.prototype.readUint16 = function()\r\n    {\r\n        var result = this.byteArrayParser.readUint16(this.byteArray, this.position);\r\n        this.position += 2;\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Parses an unsigned int 32 from a byte array and advances\r\n     * the position by 2 bytes\r\n     *\r\n     * @returns {*} the parse unsigned int 32\r\n     * @throws error if buffer overread would occur\r\n     */\r\n    dicomParser.ByteStream.prototype.readUint32 = function()\r\n    {\r\n        var result = this.byteArrayParser.readUint32(this.byteArray, this.position);\r\n        this.position += 4;\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Reads a string of 8-bit characters from an array of bytes and advances\r\n     * the position by length bytes.  A null terminator will end the string\r\n     * but will not effect advancement of the position.\r\n     * @param length the maximum number of bytes to parse\r\n     * @returns {string} the parsed string\r\n     * @throws error if buffer overread would occur\r\n     */\r\n    dicomParser.ByteStream.prototype.readFixedString = function(length)\r\n    {\r\n        var result = dicomParser.readFixedString(this.byteArray, this.position, length);\r\n        this.position += length;\r\n        return result;\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n *\r\n * The DataSet class encapsulates a collection of DICOM Elements and provides various functions\r\n * to access the data in those elements\r\n *\r\n * Rules for handling padded spaces:\r\n * DS = Strip leading and trailing spaces\r\n * DT = Strip trailing spaces\r\n * IS = Strip leading and trailing spaces\r\n * PN = Strip trailing spaces\r\n * TM = Strip trailing spaces\r\n * AE = Strip leading and trailing spaces\r\n * CS = Strip leading and trailing spaces\r\n * SH = Strip leading and trailing spaces\r\n * LO = Strip leading and trailing spaces\r\n * LT = Strip trailing spaces\r\n * ST = Strip trailing spaces\r\n * UT = Strip trailing spaces\r\n *\r\n */\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    function getByteArrayParser(element, defaultParser)\r\n    {\r\n        return (element.parser !== undefined ? element.parser : defaultParser);\r\n    }\r\n\r\n    /**\r\n     * Constructs a new DataSet given byteArray and collection of elements\r\n     * @param byteArrayParser\r\n     * @param byteArray\r\n     * @param elements\r\n     * @constructor\r\n     */\r\n    dicomParser.DataSet = function(byteArrayParser, byteArray, elements)\r\n    {\r\n        this.byteArrayParser = byteArrayParser;\r\n        this.byteArray = byteArray;\r\n        this.elements = elements;\r\n    };\r\n\r\n    /**\r\n     * Finds the element for tag and returns an unsigned int 16 if it exists and has data\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the value in a multivalued element.  Default is index 0 if not supplied\r\n     * @returns {*} unsigned int 16 or undefined if the attribute is not present or has data of length 0\r\n     */\r\n    dicomParser.DataSet.prototype.uint16 = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        index = (index !== undefined) ? index : 0;\r\n        if(element && element.length !== 0)\r\n        {\r\n            return getByteArrayParser(element, this.byteArrayParser).readUint16(this.byteArray, element.dataOffset + (index *2));\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Finds the element for tag and returns an signed int 16 if it exists and has data\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the value in a multivalued element.  Default is index 0 if not supplied\r\n     * @returns {*} signed int 16 or undefined if the attribute is not present or has data of length 0\r\n     */\r\n    dicomParser.DataSet.prototype.int16 = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        index = (index !== undefined) ? index : 0;\r\n        if(element && element.length !== 0)\r\n        {\r\n            return getByteArrayParser(element, this.byteArrayParser).readInt16(this.byteArray, element.dataOffset + (index * 2));\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Finds the element for tag and returns an unsigned int 32 if it exists and has data\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the value in a multivalued element.  Default is index 0 if not supplied\r\n     * @returns {*} unsigned int 32 or undefined if the attribute is not present or has data of length 0\r\n     */\r\n    dicomParser.DataSet.prototype.uint32 = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        index = (index !== undefined) ? index : 0;\r\n        if(element && element.length !== 0)\r\n        {\r\n            return getByteArrayParser(element, this.byteArrayParser).readUint32(this.byteArray, element.dataOffset + (index * 4));\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Finds the element for tag and returns an signed int 32 if it exists and has data\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the value in a multivalued element.  Default is index 0 if not supplied\r\n     * @returns {*} signed int 32 or undefined if the attribute is not present or has data of length 0\r\n     */\r\n    dicomParser.DataSet.prototype.int32 = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        index = (index !== undefined) ? index : 0;\r\n        if(element && element.length !== 0)\r\n        {\r\n            return getByteArrayParser(element, this.byteArrayParser).readInt32(this.byteArray, element.dataOffset + (index * 4));\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Finds the element for tag and returns a 32 bit floating point number (VR=FL) if it exists and has data\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the value in a multivalued element.  Default is index 0 if not supplied\r\n     * @returns {*} float or undefined if the attribute is not present or has data of length 0\r\n     */\r\n    dicomParser.DataSet.prototype.float = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        index = (index !== undefined) ? index : 0;\r\n        if(element && element.length !== 0)\r\n        {\r\n            return getByteArrayParser(element, this.byteArrayParser).readFloat(this.byteArray, element.dataOffset + (index * 4));\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Finds the element for tag and returns a 64 bit floating point number (VR=FD) if it exists and has data\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the value in a multivalued element.  Default is index 0 if not supplied\r\n     * @returns {*} float or undefined if the attribute is not present or doesn't has data of length 0\r\n     */\r\n    dicomParser.DataSet.prototype.double = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        index = (index !== undefined) ? index : 0;\r\n        if(element && element.length !== 0)\r\n        {\r\n            return getByteArrayParser(element, this.byteArrayParser).readDouble(this.byteArray, element.dataOffset + (index * 8));\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Returns the number of string values for the element\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @returns {*} the number of string values or undefined if the attribute is not present or has zero length data\r\n     */\r\n    dicomParser.DataSet.prototype.numStringValues = function(tag)\r\n    {\r\n        var element = this.elements[tag];\r\n        if(element && element.length > 0)\r\n        {\r\n            var fixedString = dicomParser.readFixedString(this.byteArray, element.dataOffset, element.length);\r\n            var numMatching = fixedString.match(/\\\\/g);\r\n            if(numMatching === null)\r\n            {\r\n                return 1;\r\n            }\r\n            return numMatching.length + 1;\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Returns a string for the element.  If index is provided, the element is assumed to be\r\n     * multi-valued and will return the component specified by index.  Undefined is returned\r\n     * if there is no component with the specified index, the element does not exist or is zero length.\r\n     *\r\n     * Use this function for VR types of AE, CS, SH and LO\r\n     *\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the desired value in a multi valued string or undefined for the entire string\r\n     * @returns {*}\r\n     */\r\n    dicomParser.DataSet.prototype.string = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        if(element && element.length > 0)\r\n        {\r\n            var fixedString = dicomParser.readFixedString(this.byteArray, element.dataOffset, element.length);\r\n            if(index >= 0)\r\n            {\r\n                var values = fixedString.split('\\\\');\r\n                // trim trailing spaces\r\n                return values[index].trim();\r\n            }\r\n            else\r\n            {\r\n                // trim trailing spaces\r\n                return fixedString.trim();\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Returns a string with the leading spaces preserved and trailing spaces removed.\r\n     *\r\n     * Use this function to access data for VRs of type UT, ST and LT\r\n     *\r\n     * @param tag\r\n     * @param index\r\n     * @returns {*}\r\n     */\r\n    dicomParser.DataSet.prototype.text = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        if(element && element.length > 0)\r\n        {\r\n            var fixedString = dicomParser.readFixedString(this.byteArray, element.dataOffset, element.length);\r\n            if(index >= 0)\r\n            {\r\n                var values = fixedString.split('\\\\');\r\n                return values[index].replace(/ +$/, '');\r\n            }\r\n            else\r\n            {\r\n                return fixedString.replace(/ +$/, '');\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Parses a string to a float for the specified index in a multi-valued element.  If index is not specified,\r\n     * the first value in a multi-valued VR will be parsed if present.\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the desired value in a multi valued string or undefined for the first value\r\n     * @returns {*} a floating point number or undefined if not present or data not long enough\r\n     */\r\n    dicomParser.DataSet.prototype.floatString = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        if(element && element.length > 0)\r\n        {\r\n            index = (index !== undefined) ? index : 0;\r\n            var value = this.string(tag, index);\r\n            if(value !== undefined) {\r\n                return parseFloat(value);\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    /**\r\n     * Parses a string to an integer for the specified index in a multi-valued element.  If index is not specified,\r\n     * the first value in a multi-valued VR will be parsed if present.\r\n     * @param tag The DICOM tag in the format xGGGGEEEE\r\n     * @param index the index of the desired value in a multi valued string or undefined for the first value\r\n     * @returns {*} an integer or undefined if not present or data not long enough\r\n     */\r\n    dicomParser.DataSet.prototype.intString = function(tag, index)\r\n    {\r\n        var element = this.elements[tag];\r\n        if(element && element.length > 0) {\r\n            index = (index !== undefined) ? index : 0;\r\n            var value = this.string(tag, index);\r\n            if(value !== undefined) {\r\n                return parseInt(value);\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    //dicomParser.DataSet = DataSet;\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * Reads an encapsulated pixel data element and adds an array of fragments to the element\r\n     * containing the offset and length of each fragment and any offsets from the basic offset\r\n     * table\r\n     * @param byteStream\r\n     * @param element\r\n     */\r\n    dicomParser.findEndOfEncapsulatedElement = function(byteStream, element, warnings)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'\";\r\n        }\r\n        if(element === undefined)\r\n        {\r\n            throw \"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'\";\r\n        }\r\n\r\n        element.encapsulatedPixelData = true;\r\n        element.basicOffsetTable = [];\r\n        element.fragments = [];\r\n        var basicOffsetTableItemTag = dicomParser.readTag(byteStream);\r\n        if(basicOffsetTableItemTag !== 'xfffee000') {\r\n            throw \"dicomParser.findEndOfEncapsulatedElement: basic offset table not found\";\r\n        }\r\n        var basicOffsetTableItemlength = byteStream.readUint32();\r\n        var numFragments = basicOffsetTableItemlength / 4;\r\n        for(var i =0; i < numFragments; i++) {\r\n            var offset = byteStream.readUint32();\r\n            element.basicOffsetTable.push(offset);\r\n        }\r\n        var baseOffset = byteStream.position;\r\n\r\n        while(byteStream.position < byteStream.byteArray.length)\r\n        {\r\n            var tag = dicomParser.readTag(byteStream);\r\n            var length = byteStream.readUint32();\r\n            if(tag === 'xfffee0dd')\r\n            {\r\n                byteStream.seek(length);\r\n                element.length = byteStream.position - element.dataOffset;\r\n                return;\r\n            }\r\n            else if(tag === 'xfffee000')\r\n            {\r\n                element.fragments.push({\r\n                    offset: byteStream.position - baseOffset - 8,\r\n                    position : byteStream.position,\r\n                    length : length\r\n                });\r\n            }\r\n            else {\r\n                if(warnings) {\r\n                    warnings.push('unexpected tag ' + tag + ' while searching for end of pixel data element with undefined length');\r\n                }\r\n                if(length > byteStream.byteArray.length - byteStream.position)\r\n                {\r\n                    // fix length\r\n                    length = byteStream.byteArray.length - byteStream.position;\r\n                }\r\n                element.fragments.push({\r\n                    offset: byteStream.position - baseOffset - 8,\r\n                    position : byteStream.position,\r\n                    length : length\r\n                });\r\n                byteStream.seek(length);\r\n                element.length = byteStream.position - element.dataOffset;\r\n                return;\r\n            }\r\n\r\n            byteStream.seek(length);\r\n        }\r\n\r\n        if(warnings) {\r\n            warnings.push(\"pixel data element \" + element.tag + \" missing sequence delimiter tag xfffee0dd\");\r\n        }\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * reads from the byte stream until it finds the magic numbers for the item delimitation item\r\n     * and then sets the length of the element\r\n     * @param byteStream\r\n     * @param element\r\n     */\r\n    dicomParser.findItemDelimitationItemAndSetElementLength = function(byteStream, element)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'\";\r\n        }\r\n\r\n        var itemDelimitationItemLength = 8; // group, element, length\r\n        var maxPosition = byteStream.byteArray.length - itemDelimitationItemLength;\r\n        while(byteStream.position <= maxPosition)\r\n        {\r\n            var groupNumber = byteStream.readUint16();\r\n            if(groupNumber === 0xfffe)\r\n            {\r\n                var elementNumber = byteStream.readUint16();\r\n                if(elementNumber === 0xe00d)\r\n                {\r\n                    // NOTE: It would be better to also check for the length to be 0 as part of the check above\r\n                    // but we will just log a warning for now\r\n                    var itemDelimiterLength = byteStream.readUint32(); // the length\r\n                    if(itemDelimiterLength !== 0) {\r\n                        byteStream.warnings('encountered non zero length following item delimiter at position' + byteStream.position - 4 + \" while reading element of undefined length with tag ' + element.tag\");\r\n                    }\r\n                    element.length = byteStream.position - element.dataOffset;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        // No item delimitation item - silently set the length to the end of the buffer and set the position past the end of the buffer\r\n        element.length = byteStream.byteArray.length - element.dataOffset;\r\n        byteStream.seek(byteStream.byteArray.length - byteStream.position);\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing different types from a little-endian byte array\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    dicomParser.littleEndianByteArrayParser = {\r\n        /**\r\n         *\r\n         * Parses an unsigned int 16 from a little-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed unsigned int 16\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readUint16: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'littleEndianByteArrayParser.readUint16: position cannot be less than 0';\r\n            }\r\n            if (position + 2 > byteArray.length) {\r\n                throw 'littleEndianByteArrayParser.readUint16: attempt to read past end of buffer';\r\n            }\r\n            return byteArray[position] + (byteArray[position + 1] * 256);\r\n        },\r\n\r\n        /**\r\n         *\r\n         * Parses a signed int 16 from a little-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed signed int 16\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readInt16: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'littleEndianByteArrayParser.readInt16: position cannot be less than 0';\r\n            }\r\n            if (position + 2 > byteArray.length) {\r\n                throw 'littleEndianByteArrayParser.readInt16: attempt to read past end of buffer';\r\n            }\r\n            var int16 = byteArray[position] + (byteArray[position + 1] << 8);\r\n            // fix sign\r\n            if (int16 & 0x8000) {\r\n                int16 = int16 - 0xFFFF - 1;\r\n            }\r\n            return int16;\r\n        },\r\n\r\n\r\n        /**\r\n         * Parses an unsigned int 32 from a little-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed unsigned int 32\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readUint32: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'littleEndianByteArrayParser.readUint32: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 4 > byteArray.length) {\r\n                throw 'littleEndianByteArrayParser.readUint32: attempt to read past end of buffer';\r\n            }\r\n\r\n            var uint32 = (byteArray[position] +\r\n            (byteArray[position + 1] * 256) +\r\n            (byteArray[position + 2] * 256 * 256) +\r\n            (byteArray[position + 3] * 256 * 256 * 256 ));\r\n\r\n            return uint32;\r\n        },\r\n\r\n        /**\r\n         * Parses a signed int 32 from a little-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed unsigned int 32\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readInt32: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'littleEndianByteArrayParser.readInt32: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 4 > byteArray.length) {\r\n                throw 'littleEndianByteArrayParser.readInt32: attempt to read past end of buffer';\r\n            }\r\n\r\n            var int32 = (byteArray[position] +\r\n            (byteArray[position + 1] << 8) +\r\n            (byteArray[position + 2] << 16) +\r\n            (byteArray[position + 3] << 24));\r\n\r\n            return int32;\r\n\r\n        },\r\n\r\n        /**\r\n         * Parses 32-bit float from a little-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed 32-bit float\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readFloat: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'littleEndianByteArrayParser.readFloat: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 4 > byteArray.length) {\r\n                throw 'littleEndianByteArrayParser.readFloat: attempt to read past end of buffer';\r\n            }\r\n\r\n            // I am sure there is a better way than this but this should be safe\r\n            var byteArrayForParsingFloat = new Uint8Array(4);\r\n            byteArrayForParsingFloat[0] = byteArray[position];\r\n            byteArrayForParsingFloat[1] = byteArray[position + 1];\r\n            byteArrayForParsingFloat[2] = byteArray[position + 2];\r\n            byteArrayForParsingFloat[3] = byteArray[position + 3];\r\n            var floatArray = new Float32Array(byteArrayForParsingFloat.buffer);\r\n            return floatArray[0];\r\n        },\r\n\r\n        /**\r\n         * Parses 64-bit float from a little-endian byte array\r\n         *\r\n         * @param byteArray the byte array to read from\r\n         * @param position the position in the byte array to read from\r\n         * @returns {*} the parsed 64-bit float\r\n         * @throws error if buffer overread would occur\r\n         * @access private\r\n         */\r\n        readDouble: function (byteArray, position) {\r\n            if (position < 0) {\r\n                throw 'littleEndianByteArrayParser.readDouble: position cannot be less than 0';\r\n            }\r\n\r\n            if (position + 8 > byteArray.length) {\r\n                throw 'littleEndianByteArrayParser.readDouble: attempt to read past end of buffer';\r\n            }\r\n\r\n            // I am sure there is a better way than this but this should be safe\r\n            var byteArrayForParsingFloat = new Uint8Array(8);\r\n            byteArrayForParsingFloat[0] = byteArray[position];\r\n            byteArrayForParsingFloat[1] = byteArray[position + 1];\r\n            byteArrayForParsingFloat[2] = byteArray[position + 2];\r\n            byteArrayForParsingFloat[3] = byteArray[position + 3];\r\n            byteArrayForParsingFloat[4] = byteArray[position + 4];\r\n            byteArrayForParsingFloat[5] = byteArray[position + 5];\r\n            byteArrayForParsingFloat[6] = byteArray[position + 6];\r\n            byteArrayForParsingFloat[7] = byteArray[position + 7];\r\n            var floatArray = new Float64Array(byteArrayForParsingFloat.buffer);\r\n            return floatArray[0];\r\n        }\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing implicit and explicit DICOM data sets\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * reads an explicit data set\r\n     * @param byteStream the byte stream to read from\r\n     * @param maxPosition the maximum position to read up to (optional - only needed when reading sequence items)\r\n     */\r\n    dicomParser.parseDicomDataSetExplicit = function (dataSet, byteStream, maxPosition, options) {\r\n\r\n        maxPosition = (maxPosition === undefined) ? byteStream.byteArray.length : maxPosition ;\r\n        options = options || {};\r\n\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'\";\r\n        }\r\n        if(maxPosition < byteStream.position || maxPosition > byteStream.byteArray.length)\r\n        {\r\n            throw \"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'\";\r\n        }\r\n        var elements = dataSet.elements;\r\n\r\n        while(byteStream.position < maxPosition)\r\n        {\r\n            var element = dicomParser.readDicomElementExplicit(byteStream, dataSet.warnings, options.untilTag);\r\n            elements[element.tag] = element;\r\n            if(element.tag === options.untilTag) {\r\n                return;\r\n            }\r\n        }\r\n        if(byteStream.position > maxPosition) {\r\n            throw \"dicomParser:parseDicomDataSetExplicit: buffer overrun\";\r\n        }\r\n    };\r\n\r\n    /**\r\n     * reads an implicit data set\r\n     * @param byteStream the byte stream to read from\r\n     * @param maxPosition the maximum position to read up to (optional - only needed when reading sequence items)\r\n     */\r\n    dicomParser.parseDicomDataSetImplicit = function(dataSet, byteStream, maxPosition, options)\r\n    {\r\n        maxPosition = (maxPosition === undefined) ? dataSet.byteArray.length : maxPosition ;\r\n        options = options || {};\r\n\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'\";\r\n        }\r\n        if(maxPosition < byteStream.position || maxPosition > byteStream.byteArray.length)\r\n        {\r\n            throw \"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'\";\r\n        }\r\n\r\n        var elements = dataSet.elements;\r\n\r\n        while(byteStream.position < maxPosition)\r\n        {\r\n            var element = dicomParser.readDicomElementImplicit(byteStream, options.untilTag);\r\n            elements[element.tag] = element;\r\n            if(element.tag === options.untilTag) {\r\n                return;\r\n            }\r\n        }\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n\r\n/**\r\n * Internal helper functions for for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    function getDataLengthSizeInBytesForVR(vr)\r\n    {\r\n        if( vr === 'OB' ||\r\n            vr === 'OW' ||\r\n            vr === 'SQ' ||\r\n            vr === 'OF' ||\r\n            vr === 'UT' ||\r\n            vr === 'UN')\r\n        {\r\n            return 4;\r\n        }\r\n        else\r\n        {\r\n            return 2;\r\n        }\r\n    }\r\n\r\n    dicomParser.readDicomElementExplicit = function(byteStream, warnings, untilTag)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'\";\r\n        }\r\n\r\n        var element = {\r\n            tag : dicomParser.readTag(byteStream),\r\n            vr : byteStream.readFixedString(2)\r\n            // length set below based on VR\r\n            // dataOffset set below based on VR and size of length\r\n        };\r\n\r\n        var dataLengthSizeBytes = getDataLengthSizeInBytesForVR(element.vr);\r\n        if(dataLengthSizeBytes === 2)\r\n        {\r\n            element.length = byteStream.readUint16();\r\n            element.dataOffset = byteStream.position;\r\n        }\r\n        else\r\n        {\r\n            byteStream.seek(2);\r\n            element.length = byteStream.readUint32();\r\n            element.dataOffset = byteStream.position;\r\n        }\r\n\r\n        if(element.length === 4294967295)\r\n        {\r\n            element.hadUndefinedLength = true;\r\n        }\r\n\r\n        if(element.tag === untilTag) {\r\n            return element;\r\n        }\r\n\r\n        // if VR is SQ, parse the sequence items\r\n        if(element.vr === 'SQ')\r\n        {\r\n            dicomParser.readSequenceItemsExplicit(byteStream, element, warnings);\r\n            return element;\r\n        }\r\n        if(element.length === 4294967295)\r\n        {\r\n            if(element.tag === 'x7fe00010') {\r\n                dicomParser.findEndOfEncapsulatedElement(byteStream, element, warnings);\r\n                return element;\r\n            } else {\r\n                dicomParser.findItemDelimitationItemAndSetElementLength(byteStream, element);\r\n                return element;\r\n            }\r\n        }\r\n\r\n        byteStream.seek(element.length);\r\n        return element;\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    dicomParser.readDicomElementImplicit = function(byteStream, untilTag)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'\";\r\n        }\r\n\r\n        var element = {\r\n            tag : dicomParser.readTag(byteStream),\r\n            length: byteStream.readUint32(),\r\n            dataOffset :  byteStream.position\r\n        };\r\n\r\n        if(element.length === 4294967295)\r\n        {\r\n            element.hadUndefinedLength = true;\r\n        }\r\n\r\n        if(element.tag === untilTag) {\r\n            return element;\r\n        }\r\n\r\n        // peek ahead at the next tag to see if it looks like a sequence.  This is not 100%\r\n        // safe because a non sequence item could have data that has these bytes, but this\r\n        // is how to do it without a data dictionary.\r\n        if ((byteStream.position + 4) <= byteStream.byteArray.length) {\r\n            var nextTag = dicomParser.readTag(byteStream);\r\n            byteStream.seek(-4);\r\n\r\n            // zero length sequence\r\n            if (element.hadUndefinedLength && nextTag === 'xfffee0dd') {\r\n              element.length = 0;\r\n              byteStream.seek(8);\r\n              return element;\r\n            }\r\n\r\n            if (nextTag === 'xfffee000') {\r\n                // parse the sequence\r\n                dicomParser.readSequenceItemsImplicit(byteStream, element);\r\n                //element.length = byteStream.byteArray.length - element.dataOffset;\r\n                return element;\r\n            }\r\n        }\r\n\r\n        // if element is not a sequence and has undefined length, we have to\r\n        // scan the data for a magic number to figure out when it ends.\r\n        if(element.length === 4294967295)\r\n        {\r\n            dicomParser.findItemDelimitationItemAndSetElementLength(byteStream, element);\r\n            return element;\r\n        }\r\n\r\n        // non sequence element with known length, skip over the data part\r\n        byteStream.seek(element.length);\r\n        return element;\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    function readDicomDataSetExplicitUndefinedLength(byteStream, warnings)\r\n    {\r\n        var elements = {};\r\n\r\n        while(byteStream.position < byteStream.byteArray.length)\r\n        {\r\n            var element = dicomParser.readDicomElementExplicit(byteStream, warnings);\r\n            elements[element.tag] = element;\r\n\r\n            // we hit an item delimiter tag, return the current offset to mark\r\n            // the end of this sequence item\r\n            if(element.tag === 'xfffee00d')\r\n            {\r\n                return new dicomParser.DataSet(byteStream.byteArrayParser, byteStream.byteArray, elements);\r\n            }\r\n\r\n        }\r\n\r\n        // eof encountered - log a warning and return what we have for the element\r\n        byteStream.warnings.push('eof encountered before finding sequence delimitation item while reading sequence item of undefined length');\r\n        return new dicomParser.DataSet(byteStream.byteArrayParser, byteStream.byteArray, elements);\r\n    }\r\n\r\n    function readSequenceItemExplicit(byteStream, warnings)\r\n    {\r\n        var item = dicomParser.readSequenceItem(byteStream);\r\n\r\n        if(item.length === 4294967295)\r\n        {\r\n            item.hadUndefinedLength = true;\r\n            item.dataSet = readDicomDataSetExplicitUndefinedLength(byteStream, warnings);\r\n            item.length = byteStream.position - item.dataOffset;\r\n        }\r\n        else\r\n        {\r\n            item.dataSet = new dicomParser.DataSet(byteStream.byteArrayParser, byteStream.byteArray, {});\r\n            dicomParser.parseDicomDataSetExplicit(item.dataSet, byteStream, byteStream.position + item.length);\r\n        }\r\n        return item;\r\n    }\r\n\r\n    function readSQElementUndefinedLengthExplicit(byteStream, element, warnings)\r\n    {\r\n        while(byteStream.position < byteStream.byteArray.length)\r\n        {\r\n          // end reading this sequence if the next tag is the sequence delimitation item\r\n          var nextTag = dicomParser.readTag(byteStream);\r\n          byteStream.seek(-4);\r\n          if (nextTag === 'xfffee0dd') {\r\n            // set the correct length\r\n            element.length = byteStream.position - element.dataOffset;\r\n            byteStream.seek(8);\r\n            return element;\r\n          }\r\n\r\n            var item = readSequenceItemExplicit(byteStream, warnings);\r\n            element.items.push(item);\r\n        }\r\n        element.length = byteStream.position - element.dataOffset;\r\n    }\r\n\r\n    function readSQElementKnownLengthExplicit(byteStream, element, warnings)\r\n    {\r\n        var maxPosition = element.dataOffset + element.length;\r\n        while(byteStream.position < maxPosition)\r\n        {\r\n            var item = readSequenceItemExplicit(byteStream, warnings);\r\n            element.items.push(item);\r\n        }\r\n    }\r\n\r\n    dicomParser.readSequenceItemsExplicit = function(byteStream, element, warnings)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'\";\r\n        }\r\n        if(element === undefined)\r\n        {\r\n            throw \"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'\";\r\n        }\r\n\r\n        element.items = [];\r\n\r\n        if(element.length === 4294967295)\r\n        {\r\n            readSQElementUndefinedLengthExplicit(byteStream, element);\r\n        }\r\n        else\r\n        {\r\n            readSQElementKnownLengthExplicit(byteStream, element, warnings);\r\n        }\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    function readDicomDataSetImplicitUndefinedLength(byteStream)\r\n    {\r\n        var elements = {};\r\n\r\n        while(byteStream.position < byteStream.byteArray.length)\r\n        {\r\n            var element = dicomParser.readDicomElementImplicit(byteStream);\r\n            elements[element.tag] = element;\r\n\r\n            // we hit an item delimiter tag, return the current offset to mark\r\n            // the end of this sequence item\r\n            if(element.tag === 'xfffee00d')\r\n            {\r\n                return new dicomParser.DataSet(byteStream.byteArrayParser, byteStream.byteArray, elements);\r\n            }\r\n        }\r\n        // eof encountered - log a warning and return what we have for the element\r\n        byteStream.warnings.push('eof encountered before finding sequence item delimiter in sequence item of undefined length');\r\n        return new dicomParser.DataSet(byteStream.byteArrayParser, byteStream.byteArray, elements);\r\n    }\r\n\r\n    function readSequenceItemImplicit(byteStream)\r\n    {\r\n        var item = dicomParser.readSequenceItem(byteStream);\r\n\r\n        if(item.length === 4294967295)\r\n        {\r\n            item.hadUndefinedLength = true;\r\n            item.dataSet = readDicomDataSetImplicitUndefinedLength(byteStream);\r\n            item.length = byteStream.position - item.dataOffset;\r\n        }\r\n        else\r\n        {\r\n            item.dataSet = new dicomParser.DataSet(byteStream.byteArrayParser, byteStream.byteArray, {});\r\n            dicomParser.parseDicomDataSetImplicit(item.dataSet, byteStream, byteStream.position + item.length);\r\n        }\r\n        return item;\r\n    }\r\n\r\n    function readSQElementUndefinedLengthImplicit(byteStream, element)\r\n    {\r\n        while(byteStream.position < byteStream.byteArray.length)\r\n        {\r\n          // end reading this sequence if the next tag is the sequence delimitation item\r\n          var nextTag = dicomParser.readTag(byteStream);\r\n          byteStream.seek(-4);\r\n          if (nextTag === 'xfffee0dd') {\r\n            // set the correct length\r\n            element.length = byteStream.position - element.dataOffset;\r\n            byteStream.seek(8);\r\n            return element;\r\n          }\r\n\r\n          var item = readSequenceItemImplicit(byteStream);\r\n          element.items.push(item);\r\n        }\r\n        element.length = byteStream.byteArray.length - element.dataOffset;\r\n    }\r\n\r\n    function readSQElementKnownLengthImplicit(byteStream, element)\r\n    {\r\n        var maxPosition = element.dataOffset + element.length;\r\n        while(byteStream.position < maxPosition)\r\n        {\r\n            var item = readSequenceItemImplicit(byteStream);\r\n            element.items.push(item);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reads sequence items for an element in an implicit little endian byte stream\r\n     * @param byteStream the implicit little endian byte stream\r\n     * @param element the element to read the sequence items for\r\n     */\r\n    dicomParser.readSequenceItemsImplicit = function(byteStream, element)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'\";\r\n        }\r\n        if(element === undefined)\r\n        {\r\n            throw \"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'\";\r\n        }\r\n\r\n        element.items = [];\r\n\r\n        if(element.length === 4294967295)\r\n        {\r\n            readSQElementUndefinedLengthImplicit(byteStream, element);\r\n        }\r\n        else\r\n        {\r\n            readSQElementKnownLengthImplicit(byteStream, element);\r\n        }\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * Reads the tag and length of a sequence item and returns them as an object with the following properties\r\n     *  tag : string for the tag of this element in the format xggggeeee\r\n     *  length: the number of bytes in this item or 4294967295 if undefined\r\n     *  dataOffset: the offset into the byteStream of the data for this item\r\n     * @param byteStream the byte\r\n     * @returns {{tag: string, length: integer, dataOffset: integer}}\r\n     */\r\n    dicomParser.readSequenceItem = function(byteStream)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readSequenceItem: missing required parameter 'byteStream'\";\r\n        }\r\n\r\n        var element = {\r\n            tag : dicomParser.readTag(byteStream),\r\n            length : byteStream.readUint32(),\r\n            dataOffset :  byteStream.position\r\n        };\r\n\r\n        return element;\r\n    };\r\n\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Internal helper functions for parsing DICOM elements\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n    \"use strict\";\r\n\r\n    if(dicomParser === undefined)\r\n    {\r\n        dicomParser = {};\r\n    }\r\n\r\n    /**\r\n     * Reads a tag (group number and element number) from a byteStream\r\n     * @param byteStream the byte stream to read from\r\n     * @returns {string} the tag in format xggggeeee where gggg is the lowercase hex value of the group number\r\n     * and eeee is the lower case hex value of the element number\r\n     */\r\n    dicomParser.readTag = function(byteStream)\r\n    {\r\n        if(byteStream === undefined)\r\n        {\r\n            throw \"dicomParser.readTag: missing required parameter 'byteStream'\";\r\n        }\r\n\r\n        var groupNumber =  byteStream.readUint16() * 256 * 256;\r\n        var elementNumber = byteStream.readUint16();\r\n        var tag = \"x\" + ('00000000' + (groupNumber + elementNumber).toString(16)).substr(-8);\r\n        return tag;\r\n    };\r\n\r\n    return dicomParser;\r\n}(dicomParser));\r\n/**\r\n * Version\r\n */\r\n\r\nvar dicomParser = (function (dicomParser)\r\n{\r\n  \"use strict\";\r\n\r\n  if(dicomParser === undefined)\r\n  {\r\n    dicomParser = {};\r\n  }\r\n\r\n  dicomParser.version = \"1.1.5\";\r\n\r\n  return dicomParser;\r\n}(dicomParser));\r\n    return dicomParser;\r\n}));\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/dicomParser.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 77,
    "kind": "file",
    "name": "src/client/lib/hammer.min.js",
    "content": "/*! Hammer.JS - v2.0.4 - 2014-09-28\r\n * http://hammerjs.github.io/\r\n *\r\n * Copyright (c) 2014 Jorik Tangelder;\r\n * Licensed under the MIT license */\r\n!function(a,b,c,d){\"use strict\";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==kb?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ib.length;){if(c=ib[g],e=c?c+f:b,e in a)return e;g++}return d}function w(){return ob++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b,c=a.options.inputClass;return new(b=c?c:rb?N:sb?Q:qb?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&yb&&d-e===0,g=b&(Ab|Bb)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit(\"hammer.input\",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=nb(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===yb||f.eventType===Ab)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Bb&&(i>xb||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=mb(l.x)>mb(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:lb(a.pointers[c].clientX),clientY:lb(a.pointers[c].clientY)},c++;return{timeStamp:nb(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:lb(a[0].clientX),y:lb(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:lb(c/b),y:lb(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Cb:mb(a)>=mb(b)?a>0?Db:Eb:b>0?Fb:Gb}function I(a,b,c){c||(c=Kb);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Kb);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],Lb)-J(a[1],a[0],Lb)}function L(a,b){return I(b[0],b[1],Lb)/I(a[0],a[1],Lb)}function M(){this.evEl=Nb,this.evWin=Ob,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Rb,this.evWin=Sb,y.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Ub,this.evWin=Vb,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(Ab|Bb)&&(c=u(c.concat(d),\"identifier\",!0)),[c,d]}function Q(){this.evTarget=Xb,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(yb|zb)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===yb)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ab|Bb)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),\"identifier\",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,bc))return bc;var b=q(a,cc),c=q(a,dc);return b&&c?cc+\" \"+dc:b||c?b?cc:dc:q(a,ac)?ac:_b}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=ec,this.simultaneous={},this.requireFail=[]}function W(a){return a&jc?\"cancel\":a&hc?\"end\":a&gc?\"move\":a&fc?\"start\":\"\"}function X(a){return a==Gb?\"down\":a==Fb?\"up\":a==Db?\"left\":a==Eb?\"right\":\"\"}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function ab(){V.apply(this,arguments),this._timer=null,this._input=null}function bb(){Z.apply(this,arguments)}function cb(){Z.apply(this,arguments)}function db(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function eb(a,b){return b=b||{},b.recognizers=m(b.recognizers,eb.defaults.preset),new fb(a,b)}function fb(a,b){b=b||{},this.options=i(b,eb.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),gb(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function gb(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:\"\"})}function hb(a,c){var d=b.createEvent(\"Event\");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ib=[\"\",\"webkit\",\"moz\",\"MS\",\"ms\",\"o\"],jb=b.createElement(\"div\"),kb=\"function\",lb=Math.round,mb=Math.abs,nb=Date.now,ob=1,pb=/mobile|tablet|ip(ad|hone|od)|android/i,qb=\"ontouchstart\"in a,rb=v(a,\"PointerEvent\")!==d,sb=qb&&pb.test(navigator.userAgent),tb=\"touch\",ub=\"pen\",vb=\"mouse\",wb=\"kinect\",xb=25,yb=1,zb=2,Ab=4,Bb=8,Cb=1,Db=2,Eb=4,Fb=8,Gb=16,Hb=Db|Eb,Ib=Fb|Gb,Jb=Hb|Ib,Kb=[\"x\",\"y\"],Lb=[\"clientX\",\"clientY\"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Mb={mousedown:yb,mousemove:zb,mouseup:Ab},Nb=\"mousedown\",Ob=\"mousemove mouseup\";j(M,y,{handler:function(a){var b=Mb[a.type];b&yb&&0===a.button&&(this.pressed=!0),b&zb&&1!==a.which&&(b=Ab),this.pressed&&this.allow&&(b&Ab&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:vb,srcEvent:a}))}});var Pb={pointerdown:yb,pointermove:zb,pointerup:Ab,pointercancel:Bb,pointerout:Bb},Qb={2:tb,3:ub,4:vb,5:wb},Rb=\"pointerdown\",Sb=\"pointermove pointerup pointercancel\";a.MSPointerEvent&&(Rb=\"MSPointerDown\",Sb=\"MSPointerMove MSPointerUp MSPointerCancel\"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace(\"ms\",\"\"),e=Pb[d],f=Qb[a.pointerType]||a.pointerType,g=f==tb,h=s(b,a.pointerId,\"pointerId\");e&yb&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ab|Bb)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Tb={touchstart:yb,touchmove:zb,touchend:Ab,touchcancel:Bb},Ub=\"touchstart\",Vb=\"touchstart touchmove touchend touchcancel\";j(O,y,{handler:function(a){var b=Tb[a.type];if(b===yb&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(Ab|Bb)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:tb,srcEvent:a})}}});var Wb={touchstart:yb,touchmove:zb,touchend:Ab,touchcancel:Bb},Xb=\"touchstart touchmove touchend touchcancel\";j(Q,y,{handler:function(a){var b=Wb[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:tb,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==tb,e=c.pointerType==vb;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Ab|Bb)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Yb=v(jb.style,\"touchAction\"),Zb=Yb!==d,$b=\"compute\",_b=\"auto\",ac=\"manipulation\",bc=\"none\",cc=\"pan-x\",dc=\"pan-y\";T.prototype={set:function(a){a==$b&&(a=this.compute()),Zb&&(this.manager.element.style[Yb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(\" \"))},preventDefaults:function(a){if(!Zb){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,bc),f=q(d,dc),g=q(d,cc);return e||f&&c&Hb||g&&c&Ib?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var ec=1,fc=2,gc=4,hc=8,ic=hc,jc=16,kc=32;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,\"recognizeWith\",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,\"dropRecognizeWith\",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,\"requireFailure\",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,\"dropRequireFailure\",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):\"\"),a)}var c=this,d=this.state;hc>d&&b(!0),b(),d>=hc&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=kc)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(kc|ec)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(ic|jc|kc)&&(this.state=ec),this.state=this.process(b),void(this.state&(fc|gc|hc|jc)&&this.tryEmit(b))):(this.reset(),void(this.state=kc))},process:function(){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(fc|gc),e=this.attrTest(a);return d&&(c&Bb||!e)?b|jc:d||e?c&Ab?b|hc:b&fc?b|gc:fc:kc}}),j($,Z,{defaults:{event:\"pan\",threshold:10,pointers:1,direction:Jb},getTouchAction:function(){var a=this.options.direction,b=[];return a&Hb&&b.push(dc),a&Ib&&b.push(cc),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Hb?(e=0===f?Cb:0>f?Db:Eb,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Cb:0>g?Fb:Gb,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&fc||!(this.state&fc)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:\"pinch\",threshold:0,pointers:2},getTouchAction:function(){return[bc]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&fc)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?\"in\":\"out\";this.manager.emit(this.options.event+b,a)}}}),j(ab,V,{defaults:{event:\"press\",pointers:1,time:500,threshold:5},getTouchAction:function(){return[_b]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ab|Bb)&&!f)this.reset();else if(a.eventType&yb)this.reset(),this._timer=e(function(){this.state=ic,this.tryEmit()},b.time,this);else if(a.eventType&Ab)return ic;return kc},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===ic&&(a&&a.eventType&Ab?this.manager.emit(this.options.event+\"up\",a):(this._input.timeStamp=nb(),this.manager.emit(this.options.event,this._input)))}}),j(bb,Z,{defaults:{event:\"rotate\",threshold:0,pointers:2},getTouchAction:function(){return[bc]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&fc)}}),j(cb,Z,{defaults:{event:\"swipe\",threshold:10,velocity:.65,direction:Hb|Ib,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Hb|Ib)?b=a.velocity:c&Hb?b=a.velocityX:c&Ib&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&mb(b)>this.options.velocity&&a.eventType&Ab},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(db,V,{defaults:{event:\"tap\",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ac]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&yb&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ab)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=ic,this.tryEmit()},b.interval,this),fc):ic}return kc},failTimeout:function(){return this._timer=e(function(){this.state=kc},this.options.interval,this),kc},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ic&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),eb.VERSION=\"2.0.4\",eb.defaults={domEvents:!1,touchAction:$b,enable:!0,inputTarget:null,inputClass:null,preset:[[bb,{enable:!1}],[_,{enable:!1},[\"rotate\"]],[cb,{direction:Hb}],[$,{direction:Hb},[\"swipe\"]],[db],[db,{event:\"doubletap\",taps:2},[\"tap\"]],[ab]],cssProps:{userSelect:\"none\",touchSelect:\"none\",touchCallout:\"none\",contentZooming:\"none\",userDrag:\"none\",tapHighlightColor:\"rgba(0,0,0,0)\"}};var lc=1,mc=2;fb.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?mc:lc},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&ic)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===mc||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(fc|gc|hc)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,\"add\",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,\"remove\",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&hb(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&gb(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(eb,{INPUT_START:yb,INPUT_MOVE:zb,INPUT_END:Ab,INPUT_CANCEL:Bb,STATE_POSSIBLE:ec,STATE_BEGAN:fc,STATE_CHANGED:gc,STATE_ENDED:hc,STATE_RECOGNIZED:ic,STATE_CANCELLED:jc,STATE_FAILED:kc,DIRECTION_NONE:Cb,DIRECTION_LEFT:Db,DIRECTION_RIGHT:Eb,DIRECTION_UP:Fb,DIRECTION_DOWN:Gb,DIRECTION_HORIZONTAL:Hb,DIRECTION_VERTICAL:Ib,DIRECTION_ALL:Jb,Manager:fb,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:db,Pan:$,Swipe:cb,Pinch:_,Rotate:bb,Press:ab,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==kb&&define.amd?define(function(){return eb}):\"undefined\"!=typeof module&&module.exports?module.exports=eb:a[c]=eb}(window,document,\"Hammer\");\r\n//# sourceMappingURL=hammer.min.map",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/hammer.min.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 78,
    "kind": "file",
    "name": "src/client/lib/jpx.js",
    "content": "/*! image-JPEG2000 - v0.3.1 - 2015-08-26 | https://github.com/OHIF/image-JPEG2000 */\r\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\r\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\r\n/* Copyright 2012 Mozilla Foundation\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/* globals ArithmeticDecoder, globalScope, log2, readUint16, readUint32,\r\n           info, warn */\r\n\r\n'use strict';\r\n\r\nvar JpxImage = (function JpxImageClosure() {\r\n  // Table E.1\r\n  var SubbandsGainLog2 = {\r\n    'LL': 0,\r\n    'LH': 1,\r\n    'HL': 1,\r\n    'HH': 2\r\n  };\r\n  function JpxImage() {\r\n    this.failOnCorruptedImage = false;\r\n  }\r\n  JpxImage.prototype = {\r\n    parse: function JpxImage_parse(data) {\r\n\r\n      var head = readUint16(data, 0);\r\n      // No box header, immediate start of codestream (SOC)\r\n      if (head === 0xFF4F) {\r\n        this.parseCodestream(data, 0, data.length);\r\n        return;\r\n      }\r\n\r\n      var position = 0, length = data.length;\r\n      while (position < length) {\r\n        var headerSize = 8;\r\n        var lbox = readUint32(data, position);\r\n        var tbox = readUint32(data, position + 4);\r\n        position += headerSize;\r\n        if (lbox === 1) {\r\n          // XLBox: read UInt64 according to spec.\r\n          // JavaScript's int precision of 53 bit should be sufficient here.\r\n          lbox = readUint32(data, position) * 4294967296 +\r\n                 readUint32(data, position + 4);\r\n          position += 8;\r\n          headerSize += 8;\r\n        }\r\n        if (lbox === 0) {\r\n          lbox = length - position + headerSize;\r\n        }\r\n        if (lbox < headerSize) {\r\n          throw new Error('JPX Error: Invalid box field size');\r\n        }\r\n        var dataLength = lbox - headerSize;\r\n        var jumpDataLength = true;\r\n        switch (tbox) {\r\n          case 0x6A703268: // 'jp2h'\r\n            jumpDataLength = false; // parsing child boxes\r\n            break;\r\n          case 0x636F6C72: // 'colr'\r\n            // Colorspaces are not used, the CS from the PDF is used.\r\n            var method = data[position];\r\n            var precedence = data[position + 1];\r\n            var approximation = data[position + 2];\r\n            if (method === 1) {\r\n              // enumerated colorspace\r\n              var colorspace = readUint32(data, position + 3);\r\n              switch (colorspace) {\r\n                case 16: // this indicates a sRGB colorspace\r\n                case 17: // this indicates a grayscale colorspace\r\n                case 18: // this indicates a YUV colorspace\r\n                  break;\r\n                default:\r\n                  warn('Unknown colorspace ' + colorspace);\r\n                  break;\r\n              }\r\n            } else if (method === 2) {\r\n              info('ICC profile not supported');\r\n            }\r\n            break;\r\n          case 0x6A703263: // 'jp2c'\r\n            this.parseCodestream(data, position, position + dataLength);\r\n            break;\r\n          case 0x6A502020: // 'jP\\024\\024'\r\n            if (0x0d0a870a !== readUint32(data, position)) {\r\n              warn('Invalid JP2 signature');\r\n            }\r\n            break;\r\n          // The following header types are valid but currently not used:\r\n          case 0x6A501A1A: // 'jP\\032\\032'\r\n          case 0x66747970: // 'ftyp'\r\n          case 0x72726571: // 'rreq'\r\n          case 0x72657320: // 'res '\r\n          case 0x69686472: // 'ihdr'\r\n            break;\r\n          default:\r\n            var headerType = String.fromCharCode((tbox >> 24) & 0xFF,\r\n                                                 (tbox >> 16) & 0xFF,\r\n                                                 (tbox >> 8) & 0xFF,\r\n                                                 tbox & 0xFF);\r\n            warn('Unsupported header type ' + tbox + ' (' + headerType + ')');\r\n            break;\r\n        }\r\n        if (jumpDataLength) {\r\n          position += dataLength;\r\n        }\r\n      }\r\n    },\r\n    parseImageProperties: function JpxImage_parseImageProperties(stream) {\r\n      var newByte = stream.getByte();\r\n      while (newByte >= 0) {\r\n        var oldByte = newByte;\r\n        newByte = stream.getByte();\r\n        var code = (oldByte << 8) | newByte;\r\n        // Image and tile size (SIZ)\r\n        if (code === 0xFF51) {\r\n          stream.skip(4);\r\n          var Xsiz = stream.getInt32() >>> 0; // Byte 4\r\n          var Ysiz = stream.getInt32() >>> 0; // Byte 8\r\n          var XOsiz = stream.getInt32() >>> 0; // Byte 12\r\n          var YOsiz = stream.getInt32() >>> 0; // Byte 16\r\n          stream.skip(16);\r\n          var Csiz = stream.getUint16(); // Byte 36\r\n          this.width = Xsiz - XOsiz;\r\n          this.height = Ysiz - YOsiz;\r\n          this.componentsCount = Csiz;\r\n          // Results are always returned as Uint8Arrays\r\n          this.bitsPerComponent = 8;\r\n          return;\r\n        }\r\n      }\r\n      throw new Error('JPX Error: No size marker found in JPX stream');\r\n    },\r\n    parseCodestream: function JpxImage_parseCodestream(data, start, end) {\r\n      var context = {};\r\n      try {\r\n        var doNotRecover = false;\r\n        var position = start;\r\n        while (position + 1 < end) {\r\n          var code = readUint16(data, position);\r\n          position += 2;\r\n\r\n          var length = 0, j, sqcd, spqcds, spqcdSize, scalarExpounded, tile;\r\n          switch (code) {\r\n            case 0xFF4F: // Start of codestream (SOC)\r\n              context.mainHeader = true;\r\n              break;\r\n            case 0xFFD9: // End of codestream (EOC)\r\n              break;\r\n            case 0xFF51: // Image and tile size (SIZ)\r\n              length = readUint16(data, position);\r\n              var siz = {};\r\n              siz.Xsiz = readUint32(data, position + 4);\r\n              siz.Ysiz = readUint32(data, position + 8);\r\n              siz.XOsiz = readUint32(data, position + 12);\r\n              siz.YOsiz = readUint32(data, position + 16);\r\n              siz.XTsiz = readUint32(data, position + 20);\r\n              siz.YTsiz = readUint32(data, position + 24);\r\n              siz.XTOsiz = readUint32(data, position + 28);\r\n              siz.YTOsiz = readUint32(data, position + 32);\r\n              var componentsCount = readUint16(data, position + 36);\r\n              siz.Csiz = componentsCount;\r\n              var components = [];\r\n              j = position + 38;\r\n              for (var i = 0; i < componentsCount; i++) {\r\n                var component = {\r\n                  precision: (data[j] & 0x7F) + 1,\r\n                  isSigned: !!(data[j] & 0x80),\r\n                  XRsiz: data[j + 1],\r\n                  YRsiz: data[j + 1]\r\n                };\r\n                calculateComponentDimensions(component, siz);\r\n                components.push(component);\r\n              }\r\n              context.SIZ = siz;\r\n              context.components = components;\r\n              calculateTileGrids(context, components);\r\n              context.QCC = [];\r\n              context.COC = [];\r\n              break;\r\n            case 0xFF5C: // Quantization default (QCD)\r\n              length = readUint16(data, position);\r\n              var qcd = {};\r\n              j = position + 2;\r\n              sqcd = data[j++];\r\n              switch (sqcd & 0x1F) {\r\n                case 0:\r\n                  spqcdSize = 8;\r\n                  scalarExpounded = true;\r\n                  break;\r\n                case 1:\r\n                  spqcdSize = 16;\r\n                  scalarExpounded = false;\r\n                  break;\r\n                case 2:\r\n                  spqcdSize = 16;\r\n                  scalarExpounded = true;\r\n                  break;\r\n                default:\r\n                  throw new Error('JPX Error: Invalid SQcd value ' + sqcd);\r\n              }\r\n              qcd.noQuantization = (spqcdSize === 8);\r\n              qcd.scalarExpounded = scalarExpounded;\r\n              qcd.guardBits = sqcd >> 5;\r\n              spqcds = [];\r\n              while (j < length + position) {\r\n                var spqcd = {};\r\n                if (spqcdSize === 8) {\r\n                  spqcd.epsilon = data[j++] >> 3;\r\n                  spqcd.mu = 0;\r\n                } else {\r\n                  spqcd.epsilon = data[j] >> 3;\r\n                  spqcd.mu = ((data[j] & 0x7) << 8) | data[j + 1];\r\n                  j += 2;\r\n                }\r\n                spqcds.push(spqcd);\r\n              }\r\n              qcd.SPqcds = spqcds;\r\n              if (context.mainHeader) {\r\n                context.QCD = qcd;\r\n              } else {\r\n                context.currentTile.QCD = qcd;\r\n                context.currentTile.QCC = [];\r\n              }\r\n              break;\r\n            case 0xFF5D: // Quantization component (QCC)\r\n              length = readUint16(data, position);\r\n              var qcc = {};\r\n              j = position + 2;\r\n              var cqcc;\r\n              if (context.SIZ.Csiz < 257) {\r\n                cqcc = data[j++];\r\n              } else {\r\n                cqcc = readUint16(data, j);\r\n                j += 2;\r\n              }\r\n              sqcd = data[j++];\r\n              switch (sqcd & 0x1F) {\r\n                case 0:\r\n                  spqcdSize = 8;\r\n                  scalarExpounded = true;\r\n                  break;\r\n                case 1:\r\n                  spqcdSize = 16;\r\n                  scalarExpounded = false;\r\n                  break;\r\n                case 2:\r\n                  spqcdSize = 16;\r\n                  scalarExpounded = true;\r\n                  break;\r\n                default:\r\n                  throw new Error('JPX Error: Invalid SQcd value ' + sqcd);\r\n              }\r\n              qcc.noQuantization = (spqcdSize === 8);\r\n              qcc.scalarExpounded = scalarExpounded;\r\n              qcc.guardBits = sqcd >> 5;\r\n              spqcds = [];\r\n              while (j < (length + position)) {\r\n                spqcd = {};\r\n                if (spqcdSize === 8) {\r\n                  spqcd.epsilon = data[j++] >> 3;\r\n                  spqcd.mu = 0;\r\n                } else {\r\n                  spqcd.epsilon = data[j] >> 3;\r\n                  spqcd.mu = ((data[j] & 0x7) << 8) | data[j + 1];\r\n                  j += 2;\r\n                }\r\n                spqcds.push(spqcd);\r\n              }\r\n              qcc.SPqcds = spqcds;\r\n              if (context.mainHeader) {\r\n                context.QCC[cqcc] = qcc;\r\n              } else {\r\n                context.currentTile.QCC[cqcc] = qcc;\r\n              }\r\n              break;\r\n            case 0xFF52: // Coding style default (COD)\r\n              length = readUint16(data, position);\r\n              var cod = {};\r\n              j = position + 2;\r\n              var scod = data[j++];\r\n              cod.entropyCoderWithCustomPrecincts = !!(scod & 1);\r\n              cod.sopMarkerUsed = !!(scod & 2);\r\n              cod.ephMarkerUsed = !!(scod & 4);\r\n              cod.progressionOrder = data[j++];\r\n              cod.layersCount = readUint16(data, j);\r\n              j += 2;\r\n              cod.multipleComponentTransform = data[j++];\r\n\r\n              cod.decompositionLevelsCount = data[j++];\r\n              cod.xcb = (data[j++] & 0xF) + 2;\r\n              cod.ycb = (data[j++] & 0xF) + 2;\r\n              var blockStyle = data[j++];\r\n              cod.selectiveArithmeticCodingBypass = !!(blockStyle & 1);\r\n              cod.resetContextProbabilities = !!(blockStyle & 2);\r\n              cod.terminationOnEachCodingPass = !!(blockStyle & 4);\r\n              cod.verticalyStripe = !!(blockStyle & 8);\r\n              cod.predictableTermination = !!(blockStyle & 16);\r\n              cod.segmentationSymbolUsed = !!(blockStyle & 32);\r\n              cod.reversibleTransformation = data[j++];\r\n              if (cod.entropyCoderWithCustomPrecincts) {\r\n                var precinctsSizes = [];\r\n                while (j < length + position) {\r\n                  var precinctsSize = data[j++];\r\n                  precinctsSizes.push({\r\n                    PPx: precinctsSize & 0xF,\r\n                    PPy: precinctsSize >> 4\r\n                  });\r\n                }\r\n                cod.precinctsSizes = precinctsSizes;\r\n              }\r\n              var unsupported = [];\r\n              if (cod.selectiveArithmeticCodingBypass) {\r\n                unsupported.push('selectiveArithmeticCodingBypass');\r\n              }\r\n              if (cod.resetContextProbabilities) {\r\n                unsupported.push('resetContextProbabilities');\r\n              }\r\n              if (cod.terminationOnEachCodingPass) {\r\n                unsupported.push('terminationOnEachCodingPass');\r\n              }\r\n              if (cod.verticalyStripe) {\r\n                unsupported.push('verticalyStripe');\r\n              }\r\n              if (cod.predictableTermination) {\r\n                unsupported.push('predictableTermination');\r\n              }\r\n              if (unsupported.length > 0) {\r\n                doNotRecover = true;\r\n                throw new Error('JPX Error: Unsupported COD options (' +\r\n                                unsupported.join(', ') + ')');\r\n              }\r\n              if (context.mainHeader) {\r\n                context.COD = cod;\r\n              } else {\r\n                context.currentTile.COD = cod;\r\n                context.currentTile.COC = [];\r\n              }\r\n              break;\r\n            case 0xFF90: // Start of tile-part (SOT)\r\n              length = readUint16(data, position);\r\n              tile = {};\r\n              tile.index = readUint16(data, position + 2);\r\n              tile.length = readUint32(data, position + 4);\r\n              tile.dataEnd = tile.length + position - 2;\r\n              tile.partIndex = data[position + 8];\r\n              tile.partsCount = data[position + 9];\r\n\r\n              context.mainHeader = false;\r\n              if (tile.partIndex === 0) {\r\n                // reset component specific settings\r\n                tile.COD = context.COD;\r\n                tile.COC = context.COC.slice(0); // clone of the global COC\r\n                tile.QCD = context.QCD;\r\n                tile.QCC = context.QCC.slice(0); // clone of the global COC\r\n              }\r\n              context.currentTile = tile;\r\n              break;\r\n            case 0xFF93: // Start of data (SOD)\r\n              tile = context.currentTile;\r\n              if (tile.partIndex === 0) {\r\n                initializeTile(context, tile.index);\r\n                buildPackets(context);\r\n              }\r\n\r\n              // moving to the end of the data\r\n              length = tile.dataEnd - position;\r\n              parseTilePackets(context, data, position, length);\r\n              break;\r\n            case 0xFF55: // Tile-part lengths, main header (TLM)\r\n            case 0xFF57: // Packet length, main header (PLM)\r\n            case 0xFF58: // Packet length, tile-part header (PLT)\r\n            case 0xFF64: // Comment (COM)\r\n              length = readUint16(data, position);\r\n              // skipping content\r\n              break;\r\n            case 0xFF53: // Coding style component (COC)\r\n              throw new Error('JPX Error: Codestream code 0xFF53 (COC) is ' +\r\n                              'not implemented');\r\n            default:\r\n              throw new Error('JPX Error: Unknown codestream code: ' +\r\n                              code.toString(16));\r\n          }\r\n          position += length;\r\n        }\r\n      } catch (e) {\r\n        if (doNotRecover || this.failOnCorruptedImage) {\r\n          throw e;\r\n        } else {\r\n          warn('Trying to recover from ' + e.message);\r\n        }\r\n      }\r\n      this.tiles = transformComponents(context);\r\n      this.width = context.SIZ.Xsiz - context.SIZ.XOsiz;\r\n      this.height = context.SIZ.Ysiz - context.SIZ.YOsiz;\r\n      this.componentsCount = context.SIZ.Csiz;\r\n    }\r\n  };\r\n  function calculateComponentDimensions(component, siz) {\r\n    // Section B.2 Component mapping\r\n    component.x0 = Math.ceil(siz.XOsiz / component.XRsiz);\r\n    component.x1 = Math.ceil(siz.Xsiz / component.XRsiz);\r\n    component.y0 = Math.ceil(siz.YOsiz / component.YRsiz);\r\n    component.y1 = Math.ceil(siz.Ysiz / component.YRsiz);\r\n    component.width = component.x1 - component.x0;\r\n    component.height = component.y1 - component.y0;\r\n  }\r\n  function calculateTileGrids(context, components) {\r\n    var siz = context.SIZ;\r\n    // Section B.3 Division into tile and tile-components\r\n    var tile, tiles = [];\r\n    var numXtiles = Math.ceil((siz.Xsiz - siz.XTOsiz) / siz.XTsiz);\r\n    var numYtiles = Math.ceil((siz.Ysiz - siz.YTOsiz) / siz.YTsiz);\r\n    for (var q = 0; q < numYtiles; q++) {\r\n      for (var p = 0; p < numXtiles; p++) {\r\n        tile = {};\r\n        tile.tx0 = Math.max(siz.XTOsiz + p * siz.XTsiz, siz.XOsiz);\r\n        tile.ty0 = Math.max(siz.YTOsiz + q * siz.YTsiz, siz.YOsiz);\r\n        tile.tx1 = Math.min(siz.XTOsiz + (p + 1) * siz.XTsiz, siz.Xsiz);\r\n        tile.ty1 = Math.min(siz.YTOsiz + (q + 1) * siz.YTsiz, siz.Ysiz);\r\n        tile.width = tile.tx1 - tile.tx0;\r\n        tile.height = tile.ty1 - tile.ty0;\r\n        tile.components = [];\r\n        tiles.push(tile);\r\n      }\r\n    }\r\n    context.tiles = tiles;\r\n\r\n    var componentsCount = siz.Csiz;\r\n    for (var i = 0, ii = componentsCount; i < ii; i++) {\r\n      var component = components[i];\r\n      for (var j = 0, jj = tiles.length; j < jj; j++) {\r\n        var tileComponent = {};\r\n        tile = tiles[j];\r\n        tileComponent.tcx0 = Math.ceil(tile.tx0 / component.XRsiz);\r\n        tileComponent.tcy0 = Math.ceil(tile.ty0 / component.YRsiz);\r\n        tileComponent.tcx1 = Math.ceil(tile.tx1 / component.XRsiz);\r\n        tileComponent.tcy1 = Math.ceil(tile.ty1 / component.YRsiz);\r\n        tileComponent.width = tileComponent.tcx1 - tileComponent.tcx0;\r\n        tileComponent.height = tileComponent.tcy1 - tileComponent.tcy0;\r\n        tile.components[i] = tileComponent;\r\n      }\r\n    }\r\n  }\r\n  function getBlocksDimensions(context, component, r) {\r\n    var codOrCoc = component.codingStyleParameters;\r\n    var result = {};\r\n    if (!codOrCoc.entropyCoderWithCustomPrecincts) {\r\n      result.PPx = 15;\r\n      result.PPy = 15;\r\n    } else {\r\n      result.PPx = codOrCoc.precinctsSizes[r].PPx;\r\n      result.PPy = codOrCoc.precinctsSizes[r].PPy;\r\n    }\r\n    // calculate codeblock size as described in section B.7\r\n    result.xcb_ = (r > 0 ? Math.min(codOrCoc.xcb, result.PPx - 1) :\r\n                   Math.min(codOrCoc.xcb, result.PPx));\r\n    result.ycb_ = (r > 0 ? Math.min(codOrCoc.ycb, result.PPy - 1) :\r\n                   Math.min(codOrCoc.ycb, result.PPy));\r\n    return result;\r\n  }\r\n  function buildPrecincts(context, resolution, dimensions) {\r\n    // Section B.6 Division resolution to precincts\r\n    var precinctWidth = 1 << dimensions.PPx;\r\n    var precinctHeight = 1 << dimensions.PPy;\r\n    // Jasper introduces codeblock groups for mapping each subband codeblocks\r\n    // to precincts. Precinct partition divides a resolution according to width\r\n    // and height parameters. The subband that belongs to the resolution level\r\n    // has a different size than the level, unless it is the zero resolution.\r\n\r\n    // From Jasper documentation: jpeg2000.pdf, section K: Tier-2 coding:\r\n    // The precinct partitioning for a particular subband is derived from a\r\n    // partitioning of its parent LL band (i.e., the LL band at the next higher\r\n    // resolution level)... The LL band associated with each resolution level is\r\n    // divided into precincts... Each of the resulting precinct regions is then\r\n    // mapped into its child subbands (if any) at the next lower resolution\r\n    // level. This is accomplished by using the coordinate transformation\r\n    // (u, v) = (ceil(x/2), ceil(y/2)) where (x, y) and (u, v) are the\r\n    // coordinates of a point in the LL band and child subband, respectively.\r\n    var isZeroRes = resolution.resLevel === 0;\r\n    var precinctWidthInSubband = 1 << (dimensions.PPx + (isZeroRes ? 0 : -1));\r\n    var precinctHeightInSubband = 1 << (dimensions.PPy + (isZeroRes ? 0 : -1));\r\n    var numprecinctswide = (resolution.trx1 > resolution.trx0 ?\r\n      Math.ceil(resolution.trx1 / precinctWidth) -\r\n      Math.floor(resolution.trx0 / precinctWidth) : 0);\r\n    var numprecinctshigh = (resolution.try1 > resolution.try0 ?\r\n      Math.ceil(resolution.try1 / precinctHeight) -\r\n      Math.floor(resolution.try0 / precinctHeight) : 0);\r\n    var numprecincts = numprecinctswide * numprecinctshigh;\r\n\r\n    resolution.precinctParameters = {\r\n      precinctWidth: precinctWidth,\r\n      precinctHeight: precinctHeight,\r\n      numprecinctswide: numprecinctswide,\r\n      numprecinctshigh: numprecinctshigh,\r\n      numprecincts: numprecincts,\r\n      precinctWidthInSubband: precinctWidthInSubband,\r\n      precinctHeightInSubband: precinctHeightInSubband\r\n    };\r\n  }\r\n  function buildCodeblocks(context, subband, dimensions) {\r\n    // Section B.7 Division sub-band into code-blocks\r\n    var xcb_ = dimensions.xcb_;\r\n    var ycb_ = dimensions.ycb_;\r\n    var codeblockWidth = 1 << xcb_;\r\n    var codeblockHeight = 1 << ycb_;\r\n    var cbx0 = subband.tbx0 >> xcb_;\r\n    var cby0 = subband.tby0 >> ycb_;\r\n    var cbx1 = (subband.tbx1 + codeblockWidth - 1) >> xcb_;\r\n    var cby1 = (subband.tby1 + codeblockHeight - 1) >> ycb_;\r\n    var precinctParameters = subband.resolution.precinctParameters;\r\n    var codeblocks = [];\r\n    var precincts = [];\r\n    var i, j, codeblock, precinctNumber;\r\n    for (j = cby0; j < cby1; j++) {\r\n      for (i = cbx0; i < cbx1; i++) {\r\n        codeblock = {\r\n          cbx: i,\r\n          cby: j,\r\n          tbx0: codeblockWidth * i,\r\n          tby0: codeblockHeight * j,\r\n          tbx1: codeblockWidth * (i + 1),\r\n          tby1: codeblockHeight * (j + 1)\r\n        };\r\n\r\n        codeblock.tbx0_ = Math.max(subband.tbx0, codeblock.tbx0);\r\n        codeblock.tby0_ = Math.max(subband.tby0, codeblock.tby0);\r\n        codeblock.tbx1_ = Math.min(subband.tbx1, codeblock.tbx1);\r\n        codeblock.tby1_ = Math.min(subband.tby1, codeblock.tby1);\r\n\r\n        // Calculate precinct number for this codeblock, codeblock position\r\n        // should be relative to its subband, use actual dimension and position\r\n        // See comment about codeblock group width and height\r\n        var pi = Math.floor((codeblock.tbx0_ - subband.tbx0) /\r\n          precinctParameters.precinctWidthInSubband);\r\n        var pj = Math.floor((codeblock.tby0_ - subband.tby0) /\r\n          precinctParameters.precinctHeightInSubband);\r\n        precinctNumber = pi + (pj * precinctParameters.numprecinctswide);\r\n\r\n        codeblock.precinctNumber = precinctNumber;\r\n        codeblock.subbandType = subband.type;\r\n        codeblock.Lblock = 3;\r\n\r\n        if (codeblock.tbx1_ <= codeblock.tbx0_ ||\r\n            codeblock.tby1_ <= codeblock.tby0_) {\r\n          continue;\r\n        }\r\n        codeblocks.push(codeblock);\r\n        // building precinct for the sub-band\r\n        var precinct = precincts[precinctNumber];\r\n        if (precinct !== undefined) {\r\n          if (i < precinct.cbxMin) {\r\n            precinct.cbxMin = i;\r\n          } else if (i > precinct.cbxMax) {\r\n            precinct.cbxMax = i;\r\n          }\r\n          if (j < precinct.cbyMin) {\r\n            precinct.cbxMin = j;\r\n          } else if (j > precinct.cbyMax) {\r\n            precinct.cbyMax = j;\r\n          }\r\n        } else {\r\n          precincts[precinctNumber] = precinct = {\r\n            cbxMin: i,\r\n            cbyMin: j,\r\n            cbxMax: i,\r\n            cbyMax: j\r\n          };\r\n        }\r\n        codeblock.precinct = precinct;\r\n      }\r\n    }\r\n    subband.codeblockParameters = {\r\n      codeblockWidth: xcb_,\r\n      codeblockHeight: ycb_,\r\n      numcodeblockwide: cbx1 - cbx0 + 1,\r\n      numcodeblockhigh: cby1 - cby0 + 1\r\n    };\r\n    subband.codeblocks = codeblocks;\r\n    subband.precincts = precincts;\r\n  }\r\n  function createPacket(resolution, precinctNumber, layerNumber) {\r\n    var precinctCodeblocks = [];\r\n    // Section B.10.8 Order of info in packet\r\n    var subbands = resolution.subbands;\r\n    // sub-bands already ordered in 'LL', 'HL', 'LH', and 'HH' sequence\r\n    for (var i = 0, ii = subbands.length; i < ii; i++) {\r\n      var subband = subbands[i];\r\n      var codeblocks = subband.codeblocks;\r\n      for (var j = 0, jj = codeblocks.length; j < jj; j++) {\r\n        var codeblock = codeblocks[j];\r\n        if (codeblock.precinctNumber !== precinctNumber) {\r\n          continue;\r\n        }\r\n        precinctCodeblocks.push(codeblock);\r\n      }\r\n    }\r\n    return {\r\n      layerNumber: layerNumber,\r\n      codeblocks: precinctCodeblocks\r\n    };\r\n  }\r\n  function LayerResolutionComponentPositionIterator(context) {\r\n    var siz = context.SIZ;\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var layersCount = tile.codingStyleDefaultParameters.layersCount;\r\n    var componentsCount = siz.Csiz;\r\n    var maxDecompositionLevelsCount = 0;\r\n    for (var q = 0; q < componentsCount; q++) {\r\n      maxDecompositionLevelsCount = Math.max(maxDecompositionLevelsCount,\r\n        tile.components[q].codingStyleParameters.decompositionLevelsCount);\r\n    }\r\n\r\n    var l = 0, r = 0, i = 0, k = 0;\r\n\r\n    this.nextPacket = function JpxImage_nextPacket() {\r\n      // Section B.12.1.1 Layer-resolution-component-position\r\n      for (; l < layersCount; l++) {\r\n        for (; r <= maxDecompositionLevelsCount; r++) {\r\n          for (; i < componentsCount; i++) {\r\n            var component = tile.components[i];\r\n            if (r > component.codingStyleParameters.decompositionLevelsCount) {\r\n              continue;\r\n            }\r\n\r\n            var resolution = component.resolutions[r];\r\n            var numprecincts = resolution.precinctParameters.numprecincts;\r\n            for (; k < numprecincts;) {\r\n              var packet = createPacket(resolution, k, l);\r\n              k++;\r\n              return packet;\r\n            }\r\n            k = 0;\r\n          }\r\n          i = 0;\r\n        }\r\n        r = 0;\r\n      }\r\n    };\r\n  }\r\n  function ResolutionLayerComponentPositionIterator(context) {\r\n    var siz = context.SIZ;\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var layersCount = tile.codingStyleDefaultParameters.layersCount;\r\n    var componentsCount = siz.Csiz;\r\n    var maxDecompositionLevelsCount = 0;\r\n    for (var q = 0; q < componentsCount; q++) {\r\n      maxDecompositionLevelsCount = Math.max(maxDecompositionLevelsCount,\r\n        tile.components[q].codingStyleParameters.decompositionLevelsCount);\r\n    }\r\n\r\n    var r = 0, l = 0, i = 0, k = 0;\r\n\r\n    this.nextPacket = function JpxImage_nextPacket() {\r\n      // Section B.12.1.2 Resolution-layer-component-position\r\n      for (; r <= maxDecompositionLevelsCount; r++) {\r\n        for (; l < layersCount; l++) {\r\n          for (; i < componentsCount; i++) {\r\n            var component = tile.components[i];\r\n            if (r > component.codingStyleParameters.decompositionLevelsCount) {\r\n              continue;\r\n            }\r\n\r\n            var resolution = component.resolutions[r];\r\n            var numprecincts = resolution.precinctParameters.numprecincts;\r\n            for (; k < numprecincts;) {\r\n              var packet = createPacket(resolution, k, l);\r\n              k++;\r\n              return packet;\r\n            }\r\n            k = 0;\r\n          }\r\n          i = 0;\r\n        }\r\n        l = 0;\r\n      }\r\n    };\r\n  }\r\n  function ResolutionPositionComponentLayerIterator(context) {\r\n    var siz = context.SIZ;\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var layersCount = tile.codingStyleDefaultParameters.layersCount;\r\n    var componentsCount = siz.Csiz;\r\n    var l, r, c, p;\r\n    var maxDecompositionLevelsCount = 0;\r\n    for (c = 0; c < componentsCount; c++) {\r\n      var component = tile.components[c];\r\n      maxDecompositionLevelsCount = Math.max(maxDecompositionLevelsCount,\r\n        component.codingStyleParameters.decompositionLevelsCount);\r\n    }\r\n    var maxNumPrecinctsInLevel = new Int32Array(\r\n      maxDecompositionLevelsCount + 1);\r\n    for (r = 0; r <= maxDecompositionLevelsCount; ++r) {\r\n      var maxNumPrecincts = 0;\r\n      for (c = 0; c < componentsCount; ++c) {\r\n        var resolutions = tile.components[c].resolutions;\r\n        if (r < resolutions.length) {\r\n          maxNumPrecincts = Math.max(maxNumPrecincts,\r\n            resolutions[r].precinctParameters.numprecincts);\r\n        }\r\n      }\r\n      maxNumPrecinctsInLevel[r] = maxNumPrecincts;\r\n    }\r\n    l = 0;\r\n    r = 0;\r\n    c = 0;\r\n    p = 0;\r\n\r\n    this.nextPacket = function JpxImage_nextPacket() {\r\n      // Section B.12.1.3 Resolution-position-component-layer\r\n      for (; r <= maxDecompositionLevelsCount; r++) {\r\n        for (; p < maxNumPrecinctsInLevel[r]; p++) {\r\n          for (; c < componentsCount; c++) {\r\n            var component = tile.components[c];\r\n            if (r > component.codingStyleParameters.decompositionLevelsCount) {\r\n              continue;\r\n            }\r\n            var resolution = component.resolutions[r];\r\n            var numprecincts = resolution.precinctParameters.numprecincts;\r\n            if (p >= numprecincts) {\r\n              continue;\r\n            }\r\n            for (; l < layersCount;) {\r\n              var packet = createPacket(resolution, p, l);\r\n              l++;\r\n              return packet;\r\n            }\r\n            l = 0;\r\n          }\r\n          c = 0;\r\n        }\r\n        p = 0;\r\n      }\r\n    };\r\n  }\r\n  function PositionComponentResolutionLayerIterator(context) {\r\n    var siz = context.SIZ;\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var layersCount = tile.codingStyleDefaultParameters.layersCount;\r\n    var componentsCount = siz.Csiz;\r\n    var precinctsSizes = getPrecinctSizesInImageScale(tile);\r\n    var precinctsIterationSizes = precinctsSizes;\r\n    var l = 0, r = 0, c = 0, px = 0, py = 0;\r\n\r\n    this.nextPacket = function JpxImage_nextPacket() {\r\n      // Section B.12.1.4 Position-component-resolution-layer\r\n      for (; py < precinctsIterationSizes.maxNumHigh; py++) {\r\n        for (; px < precinctsIterationSizes.maxNumWide; px++) {\r\n          for (; c < componentsCount; c++) {\r\n            var component = tile.components[c];\r\n            var decompositionLevelsCount =\r\n              component.codingStyleParameters.decompositionLevelsCount;\r\n            for (; r <= decompositionLevelsCount; r++) {\r\n              var resolution = component.resolutions[r];\r\n              var sizeInImageScale =\r\n                precinctsSizes.components[c].resolutions[r];\r\n              var k = getPrecinctIndexIfExist(\r\n                px,\r\n                py,\r\n                sizeInImageScale,\r\n                precinctsIterationSizes,\r\n                resolution);\r\n              if (k === null) {\r\n                continue;\r\n              }\r\n              for (; l < layersCount;) {\r\n                var packet = createPacket(resolution, k, l);\r\n                l++;\r\n                return packet;\r\n              }\r\n              l = 0;\r\n            }\r\n            r = 0;\r\n          }\r\n          c = 0;\r\n        }\r\n        px = 0;\r\n      }\r\n    };\r\n  }\r\n  function ComponentPositionResolutionLayerIterator(context) {\r\n    var siz = context.SIZ;\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var layersCount = tile.codingStyleDefaultParameters.layersCount;\r\n    var componentsCount = siz.Csiz;\r\n    var precinctsSizes = getPrecinctSizesInImageScale(tile);\r\n    var l = 0, r = 0, c = 0, px = 0, py = 0;\r\n\r\n    this.nextPacket = function JpxImage_nextPacket() {\r\n      // Section B.12.1.5 Component-position-resolution-layer\r\n      for (; c < componentsCount; ++c) {\r\n        var component = tile.components[c];\r\n        var precinctsIterationSizes = precinctsSizes.components[c];\r\n        var decompositionLevelsCount =\r\n          component.codingStyleParameters.decompositionLevelsCount;\r\n        for (; py < precinctsIterationSizes.maxNumHigh; py++) {\r\n          for (; px < precinctsIterationSizes.maxNumWide; px++) {\r\n            for (; r <= decompositionLevelsCount; r++) {\r\n              var resolution = component.resolutions[r];\r\n              var sizeInImageScale = precinctsIterationSizes.resolutions[r];\r\n              var k = getPrecinctIndexIfExist(\r\n                px,\r\n                py,\r\n                sizeInImageScale,\r\n                precinctsIterationSizes,\r\n                resolution);\r\n              if (k === null) {\r\n                continue;\r\n              }\r\n              for (; l < layersCount;) {\r\n                var packet = createPacket(resolution, k, l);\r\n                l++;\r\n                return packet;\r\n              }\r\n              l = 0;\r\n            }\r\n            r = 0;\r\n          }\r\n          px = 0;\r\n        }\r\n        py = 0;\r\n      }\r\n    };\r\n  }\r\n  function getPrecinctIndexIfExist(\r\n    pxIndex, pyIndex, sizeInImageScale, precinctIterationSizes, resolution) {\r\n    var posX = pxIndex * precinctIterationSizes.minWidth;\r\n    var posY = pyIndex * precinctIterationSizes.minHeight;\r\n    if (posX % sizeInImageScale.width !== 0 ||\r\n        posY % sizeInImageScale.height !== 0) {\r\n      return null;\r\n    }\r\n    var startPrecinctRowIndex =\r\n      (posY / sizeInImageScale.width) *\r\n      resolution.precinctParameters.numprecinctswide;\r\n    return (posX / sizeInImageScale.height) + startPrecinctRowIndex;\r\n  }\r\n  function getPrecinctSizesInImageScale(tile) {\r\n    var componentsCount = tile.components.length;\r\n    var minWidth = Number.MAX_VALUE;\r\n    var minHeight = Number.MAX_VALUE;\r\n    var maxNumWide = 0;\r\n    var maxNumHigh = 0;\r\n    var sizePerComponent = new Array(componentsCount);\r\n    for (var c = 0; c < componentsCount; c++) {\r\n      var component = tile.components[c];\r\n      var decompositionLevelsCount =\r\n        component.codingStyleParameters.decompositionLevelsCount;\r\n      var sizePerResolution = new Array(decompositionLevelsCount + 1);\r\n      var minWidthCurrentComponent = Number.MAX_VALUE;\r\n      var minHeightCurrentComponent = Number.MAX_VALUE;\r\n      var maxNumWideCurrentComponent = 0;\r\n      var maxNumHighCurrentComponent = 0;\r\n      var scale = 1;\r\n      for (var r = decompositionLevelsCount; r >= 0; --r) {\r\n        var resolution = component.resolutions[r];\r\n        var widthCurrentResolution =\r\n          scale * resolution.precinctParameters.precinctWidth;\r\n        var heightCurrentResolution =\r\n          scale * resolution.precinctParameters.precinctHeight;\r\n        minWidthCurrentComponent = Math.min(\r\n          minWidthCurrentComponent,\r\n          widthCurrentResolution);\r\n        minHeightCurrentComponent = Math.min(\r\n          minHeightCurrentComponent,\r\n          heightCurrentResolution);\r\n        maxNumWideCurrentComponent = Math.max(maxNumWideCurrentComponent,\r\n          resolution.precinctParameters.numprecinctswide);\r\n        maxNumHighCurrentComponent = Math.max(maxNumHighCurrentComponent,\r\n          resolution.precinctParameters.numprecinctshigh);\r\n        sizePerResolution[r] = {\r\n          width: widthCurrentResolution,\r\n          height: heightCurrentResolution\r\n        };\r\n        scale <<= 1;\r\n      }\r\n      minWidth = Math.min(minWidth, minWidthCurrentComponent);\r\n      minHeight = Math.min(minHeight, minHeightCurrentComponent);\r\n      maxNumWide = Math.max(maxNumWide, maxNumWideCurrentComponent);\r\n      maxNumHigh = Math.max(maxNumHigh, maxNumHighCurrentComponent);\r\n      sizePerComponent[c] = {\r\n        resolutions: sizePerResolution,\r\n        minWidth: minWidthCurrentComponent,\r\n        minHeight: minHeightCurrentComponent,\r\n        maxNumWide: maxNumWideCurrentComponent,\r\n        maxNumHigh: maxNumHighCurrentComponent\r\n      };\r\n    }\r\n    return {\r\n      components: sizePerComponent,\r\n      minWidth: minWidth,\r\n      minHeight: minHeight,\r\n      maxNumWide: maxNumWide,\r\n      maxNumHigh: maxNumHigh\r\n    };\r\n  }\r\n  function buildPackets(context) {\r\n    var siz = context.SIZ;\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var componentsCount = siz.Csiz;\r\n    // Creating resolutions and sub-bands for each component\r\n    for (var c = 0; c < componentsCount; c++) {\r\n      var component = tile.components[c];\r\n      var decompositionLevelsCount =\r\n        component.codingStyleParameters.decompositionLevelsCount;\r\n      // Section B.5 Resolution levels and sub-bands\r\n      var resolutions = [];\r\n      var subbands = [];\r\n      for (var r = 0; r <= decompositionLevelsCount; r++) {\r\n        var blocksDimensions = getBlocksDimensions(context, component, r);\r\n        var resolution = {};\r\n        var scale = 1 << (decompositionLevelsCount - r);\r\n        resolution.trx0 = Math.ceil(component.tcx0 / scale);\r\n        resolution.try0 = Math.ceil(component.tcy0 / scale);\r\n        resolution.trx1 = Math.ceil(component.tcx1 / scale);\r\n        resolution.try1 = Math.ceil(component.tcy1 / scale);\r\n        resolution.resLevel = r;\r\n        buildPrecincts(context, resolution, blocksDimensions);\r\n        resolutions.push(resolution);\r\n\r\n        var subband;\r\n        if (r === 0) {\r\n          // one sub-band (LL) with last decomposition\r\n          subband = {};\r\n          subband.type = 'LL';\r\n          subband.tbx0 = Math.ceil(component.tcx0 / scale);\r\n          subband.tby0 = Math.ceil(component.tcy0 / scale);\r\n          subband.tbx1 = Math.ceil(component.tcx1 / scale);\r\n          subband.tby1 = Math.ceil(component.tcy1 / scale);\r\n          subband.resolution = resolution;\r\n          buildCodeblocks(context, subband, blocksDimensions);\r\n          subbands.push(subband);\r\n          resolution.subbands = [subband];\r\n        } else {\r\n          var bscale = 1 << (decompositionLevelsCount - r + 1);\r\n          var resolutionSubbands = [];\r\n          // three sub-bands (HL, LH and HH) with rest of decompositions\r\n          subband = {};\r\n          subband.type = 'HL';\r\n          subband.tbx0 = Math.ceil(component.tcx0 / bscale - 0.5);\r\n          subband.tby0 = Math.ceil(component.tcy0 / bscale);\r\n          subband.tbx1 = Math.ceil(component.tcx1 / bscale - 0.5);\r\n          subband.tby1 = Math.ceil(component.tcy1 / bscale);\r\n          subband.resolution = resolution;\r\n          buildCodeblocks(context, subband, blocksDimensions);\r\n          subbands.push(subband);\r\n          resolutionSubbands.push(subband);\r\n\r\n          subband = {};\r\n          subband.type = 'LH';\r\n          subband.tbx0 = Math.ceil(component.tcx0 / bscale);\r\n          subband.tby0 = Math.ceil(component.tcy0 / bscale - 0.5);\r\n          subband.tbx1 = Math.ceil(component.tcx1 / bscale);\r\n          subband.tby1 = Math.ceil(component.tcy1 / bscale - 0.5);\r\n          subband.resolution = resolution;\r\n          buildCodeblocks(context, subband, blocksDimensions);\r\n          subbands.push(subband);\r\n          resolutionSubbands.push(subband);\r\n\r\n          subband = {};\r\n          subband.type = 'HH';\r\n          subband.tbx0 = Math.ceil(component.tcx0 / bscale - 0.5);\r\n          subband.tby0 = Math.ceil(component.tcy0 / bscale - 0.5);\r\n          subband.tbx1 = Math.ceil(component.tcx1 / bscale - 0.5);\r\n          subband.tby1 = Math.ceil(component.tcy1 / bscale - 0.5);\r\n          subband.resolution = resolution;\r\n          buildCodeblocks(context, subband, blocksDimensions);\r\n          subbands.push(subband);\r\n          resolutionSubbands.push(subband);\r\n\r\n          resolution.subbands = resolutionSubbands;\r\n        }\r\n      }\r\n      component.resolutions = resolutions;\r\n      component.subbands = subbands;\r\n    }\r\n    // Generate the packets sequence\r\n    var progressionOrder = tile.codingStyleDefaultParameters.progressionOrder;\r\n    switch (progressionOrder) {\r\n      case 0:\r\n        tile.packetsIterator =\r\n          new LayerResolutionComponentPositionIterator(context);\r\n        break;\r\n      case 1:\r\n        tile.packetsIterator =\r\n          new ResolutionLayerComponentPositionIterator(context);\r\n        break;\r\n      case 2:\r\n        tile.packetsIterator =\r\n          new ResolutionPositionComponentLayerIterator(context);\r\n        break;\r\n      case 3:\r\n        tile.packetsIterator =\r\n          new PositionComponentResolutionLayerIterator(context);\r\n        break;\r\n      case 4:\r\n        tile.packetsIterator =\r\n          new ComponentPositionResolutionLayerIterator(context);\r\n        break;\r\n      default:\r\n        throw new Error('JPX Error: Unsupported progression order ' +\r\n                        progressionOrder);\r\n    }\r\n  }\r\n  function parseTilePackets(context, data, offset, dataLength) {\r\n    var position = 0;\r\n    var buffer, bufferSize = 0, skipNextBit = false;\r\n    function readBits(count) {\r\n      while (bufferSize < count) {\r\n        if(offset + position  >= data.length){\r\n          throw new Error(\"Unexpected EOF\");\r\n        }\r\n        var b = data[offset + position];\r\n        position++;\r\n        if (skipNextBit) {\r\n          buffer = (buffer << 7) | b;\r\n          bufferSize += 7;\r\n          skipNextBit = false;\r\n        } else {\r\n          buffer = (buffer << 8) | b;\r\n          bufferSize += 8;\r\n        }\r\n        if (b === 0xFF) {\r\n          skipNextBit = true;\r\n        }\r\n      }\r\n      bufferSize -= count;\r\n      return (buffer >>> bufferSize) & ((1 << count) - 1);\r\n    }\r\n    function skipMarkerIfEqual(value) {\r\n      if (data[offset + position - 1] === 0xFF &&\r\n          data[offset + position] === value) {\r\n        skipBytes(1);\r\n        return true;\r\n      } else if (data[offset + position] === 0xFF &&\r\n                 data[offset + position + 1] === value) {\r\n        skipBytes(2);\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    function skipBytes(count) {\r\n      position += count;\r\n    }\r\n    function alignToByte() {\r\n      bufferSize = 0;\r\n      if (skipNextBit) {\r\n        position++;\r\n        skipNextBit = false;\r\n      }\r\n    }\r\n    function readCodingpasses() {\r\n      if (readBits(1) === 0) {\r\n        return 1;\r\n      }\r\n      if (readBits(1) === 0) {\r\n        return 2;\r\n      }\r\n      var value = readBits(2);\r\n      if (value < 3) {\r\n        return value + 3;\r\n      }\r\n      value = readBits(5);\r\n      if (value < 31) {\r\n        return value + 6;\r\n      }\r\n      value = readBits(7);\r\n      return value + 37;\r\n    }\r\n    var tileIndex = context.currentTile.index;\r\n    var tile = context.tiles[tileIndex];\r\n    var sopMarkerUsed = context.COD.sopMarkerUsed;\r\n    var ephMarkerUsed = context.COD.ephMarkerUsed;\r\n    var packetsIterator = tile.packetsIterator;\r\n    while (position < dataLength) {\r\n      try{\r\n        alignToByte();\r\n        if (sopMarkerUsed && skipMarkerIfEqual(0x91)) {\r\n          // Skip also marker segment length and packet sequence ID\r\n          skipBytes(4);\r\n        }\r\n        var packet = packetsIterator.nextPacket();\r\n        if (packet === undefined) {\r\n          //No more packets. Stream is probably truncated.\r\n          return;\r\n        }\r\n        if (!readBits(1)) {\r\n          continue;\r\n        }\r\n        var layerNumber = packet.layerNumber;\r\n        var queue = [], codeblock;\r\n        for (var i = 0, ii = packet.codeblocks.length; i < ii; i++) {\r\n          codeblock = packet.codeblocks[i];\r\n          var precinct = codeblock.precinct;\r\n          var codeblockColumn = codeblock.cbx - precinct.cbxMin;\r\n          var codeblockRow = codeblock.cby - precinct.cbyMin;\r\n          var codeblockIncluded = false;\r\n          var firstTimeInclusion = false;\r\n          var valueReady;\r\n          if (codeblock['included'] !== undefined) {\r\n            codeblockIncluded = !!readBits(1);\r\n          } else {\r\n            // reading inclusion tree\r\n            precinct = codeblock.precinct;\r\n            var inclusionTree, zeroBitPlanesTree;\r\n            if (precinct['inclusionTree'] !== undefined) {\r\n              inclusionTree = precinct.inclusionTree;\r\n            } else {\r\n              // building inclusion and zero bit-planes trees\r\n              var width = precinct.cbxMax - precinct.cbxMin + 1;\r\n              var height = precinct.cbyMax - precinct.cbyMin + 1;\r\n              inclusionTree = new InclusionTree(width, height);\r\n              zeroBitPlanesTree = new TagTree(width, height);\r\n              precinct.inclusionTree = inclusionTree;\r\n              precinct.zeroBitPlanesTree = zeroBitPlanesTree;\r\n            }\r\n\r\n            inclusionTree.reset(codeblockColumn, codeblockRow, layerNumber);\r\n            while (true) {\r\n              if (position >= data.length) {\r\n                return;\r\n              }\r\n              if (inclusionTree.isAboveThreshold()){\r\n                break;\r\n              }\r\n              if (inclusionTree.isKnown()) {\r\n                inclusionTree.nextLevel();\r\n                continue;\r\n              }\r\n              if (readBits(1)) {\r\n                inclusionTree.setKnown();\r\n                if (inclusionTree.isLeaf()) {\r\n                  codeblock.included = true;\r\n                  codeblockIncluded = firstTimeInclusion = true;\r\n                  break;\r\n                } else {\r\n                  inclusionTree.nextLevel();\r\n                }\r\n              } else {\r\n                inclusionTree.incrementValue();\r\n              }\r\n            }\r\n          }\r\n          if (!codeblockIncluded) {\r\n            continue;\r\n          }\r\n          if (firstTimeInclusion) {\r\n            zeroBitPlanesTree = precinct.zeroBitPlanesTree;\r\n            zeroBitPlanesTree.reset(codeblockColumn, codeblockRow);\r\n            while (true) {\r\n              if (position >= data.length) {\r\n                return;\r\n              }\r\n              if (readBits(1)) {\r\n                valueReady = !zeroBitPlanesTree.nextLevel();\r\n                if (valueReady) {\r\n                  break;\r\n                }\r\n              } else {\r\n                zeroBitPlanesTree.incrementValue();\r\n              }\r\n            }\r\n            codeblock.zeroBitPlanes = zeroBitPlanesTree.value;\r\n          }\r\n          var codingpasses = readCodingpasses();\r\n          while (readBits(1)) {\r\n            codeblock.Lblock++;\r\n          }\r\n          var codingpassesLog2 = log2(codingpasses);\r\n          // rounding down log2\r\n          var bits = ((codingpasses < (1 << codingpassesLog2)) ?\r\n                      codingpassesLog2 - 1 : codingpassesLog2) + codeblock.Lblock;\r\n          var codedDataLength = readBits(bits);\r\n          queue.push({\r\n            codeblock: codeblock,\r\n            codingpasses: codingpasses,\r\n            dataLength: codedDataLength\r\n          });\r\n        }\r\n        alignToByte();\r\n        if (ephMarkerUsed) {\r\n          skipMarkerIfEqual(0x92);\r\n        }\r\n        while (queue.length > 0) {\r\n          var packetItem = queue.shift();\r\n          codeblock = packetItem.codeblock;\r\n          if (codeblock['data'] === undefined) {\r\n            codeblock.data = [];\r\n          }\r\n          codeblock.data.push({\r\n            data: data,\r\n            start: offset + position,\r\n            end: offset + position + packetItem.dataLength,\r\n            codingpasses: packetItem.codingpasses\r\n          });\r\n          position += packetItem.dataLength;\r\n        }\r\n      } catch (e) {\r\n        return;\r\n      }\r\n    }\r\n    return position;\r\n  }\r\n  function copyCoefficients(coefficients, levelWidth, levelHeight, subband,\r\n                            delta, mb, reversible, segmentationSymbolUsed) {\r\n    var x0 = subband.tbx0;\r\n    var y0 = subband.tby0;\r\n    var width = subband.tbx1 - subband.tbx0;\r\n    var codeblocks = subband.codeblocks;\r\n    var right = subband.type.charAt(0) === 'H' ? 1 : 0;\r\n    var bottom = subband.type.charAt(1) === 'H' ? levelWidth : 0;\r\n\r\n    for (var i = 0, ii = codeblocks.length; i < ii; ++i) {\r\n      var codeblock = codeblocks[i];\r\n      var blockWidth = codeblock.tbx1_ - codeblock.tbx0_;\r\n      var blockHeight = codeblock.tby1_ - codeblock.tby0_;\r\n      if (blockWidth === 0 || blockHeight === 0) {\r\n        continue;\r\n      }\r\n      if (codeblock['data'] === undefined) {\r\n        continue;\r\n      }\r\n\r\n      var bitModel, currentCodingpassType;\r\n      bitModel = new BitModel(blockWidth, blockHeight, codeblock.subbandType,\r\n                              codeblock.zeroBitPlanes, mb);\r\n      currentCodingpassType = 2; // first bit plane starts from cleanup\r\n\r\n      // collect data\r\n      var data = codeblock.data, totalLength = 0, codingpasses = 0;\r\n      var j, jj, dataItem;\r\n      for (j = 0, jj = data.length; j < jj; j++) {\r\n        dataItem = data[j];\r\n        totalLength += dataItem.end - dataItem.start;\r\n        codingpasses += dataItem.codingpasses;\r\n      }\r\n      var encodedData = new Int16Array(totalLength);\r\n      var position = 0;\r\n      for (j = 0, jj = data.length; j < jj; j++) {\r\n        dataItem = data[j];\r\n        var chunk = dataItem.data.subarray(dataItem.start, dataItem.end);\r\n        encodedData.set(chunk, position);\r\n        position += chunk.length;\r\n      }\r\n      // decoding the item\r\n      var decoder = new ArithmeticDecoder(encodedData, 0, totalLength);\r\n      bitModel.setDecoder(decoder);\r\n\r\n      for (j = 0; j < codingpasses; j++) {\r\n        switch (currentCodingpassType) {\r\n          case 0:\r\n            bitModel.runSignificancePropogationPass();\r\n            break;\r\n          case 1:\r\n            bitModel.runMagnitudeRefinementPass();\r\n            break;\r\n          case 2:\r\n            bitModel.runCleanupPass();\r\n            if (segmentationSymbolUsed) {\r\n              bitModel.checkSegmentationSymbol();\r\n            }\r\n            break;\r\n        }\r\n        currentCodingpassType = (currentCodingpassType + 1) % 3;\r\n      }\r\n\r\n      var offset = (codeblock.tbx0_ - x0) + (codeblock.tby0_ - y0) * width;\r\n      var sign = bitModel.coefficentsSign;\r\n      var magnitude = bitModel.coefficentsMagnitude;\r\n      var bitsDecoded = bitModel.bitsDecoded;\r\n      var magnitudeCorrection = reversible ? 0 : 0.5;\r\n      var k, n, nb;\r\n      position = 0;\r\n      // Do the interleaving of Section F.3.3 here, so we do not need\r\n      // to copy later. LL level is not interleaved, just copied.\r\n      var interleave = (subband.type !== 'LL');\r\n      for (j = 0; j < blockHeight; j++) {\r\n        var row = (offset / width) | 0; // row in the non-interleaved subband\r\n        var levelOffset = 2 * row * (levelWidth - width) + right + bottom;\r\n        for (k = 0; k < blockWidth; k++) {\r\n          n = magnitude[position];\r\n          if (n !== 0) {\r\n            n = (n + magnitudeCorrection) * delta;\r\n            if (sign[position] !== 0) {\r\n              n = -n;\r\n            }\r\n            nb = bitsDecoded[position];\r\n            var pos = interleave ? (levelOffset + (offset << 1)) : offset;\r\n            if (reversible && (nb >= mb)) {\r\n              coefficients[pos] = n;\r\n            } else {\r\n              coefficients[pos] = n * (1 << (mb - nb));\r\n            }\r\n          }\r\n          offset++;\r\n          position++;\r\n        }\r\n        offset += width - blockWidth;\r\n      }\r\n    }\r\n  }\r\n  function transformTile(context, tile, c) {\r\n    var component = tile.components[c];\r\n    var codingStyleParameters = component.codingStyleParameters;\r\n    var quantizationParameters = component.quantizationParameters;\r\n    var decompositionLevelsCount =\r\n      codingStyleParameters.decompositionLevelsCount;\r\n    var spqcds = quantizationParameters.SPqcds;\r\n    var scalarExpounded = quantizationParameters.scalarExpounded;\r\n    var guardBits = quantizationParameters.guardBits;\r\n    var segmentationSymbolUsed = codingStyleParameters.segmentationSymbolUsed;\r\n    var precision = context.components[c].precision;\r\n\r\n    var reversible = codingStyleParameters.reversibleTransformation;\r\n    var transform = (reversible ? new ReversibleTransform() :\r\n                                  new IrreversibleTransform());\r\n\r\n    var subbandCoefficients = [];\r\n    var b = 0;\r\n    for (var i = 0; i <= decompositionLevelsCount; i++) {\r\n      var resolution = component.resolutions[i];\r\n\r\n      var width = resolution.trx1 - resolution.trx0;\r\n      var height = resolution.try1 - resolution.try0;\r\n      // Allocate space for the whole sublevel.\r\n      var coefficients = new Float32Array(width * height);\r\n\r\n      for (var j = 0, jj = resolution.subbands.length; j < jj; j++) {\r\n        var mu, epsilon;\r\n        if (!scalarExpounded) {\r\n          // formula E-5\r\n          mu = spqcds[0].mu;\r\n          epsilon = spqcds[0].epsilon + (i > 0 ? 1 - i : 0);\r\n        } else {\r\n          mu = spqcds[b].mu;\r\n          epsilon = spqcds[b].epsilon;\r\n          b++;\r\n        }\r\n\r\n        var subband = resolution.subbands[j];\r\n        var gainLog2 = SubbandsGainLog2[subband.type];\r\n\r\n        // calulate quantization coefficient (Section E.1.1.1)\r\n        var delta = (reversible ? 1 :\r\n          Math.pow(2, precision + gainLog2 - epsilon) * (1 + mu / 2048));\r\n        var mb = (guardBits + epsilon - 1);\r\n\r\n        // In the first resolution level, copyCoefficients will fill the\r\n        // whole array with coefficients. In the succeding passes,\r\n        // copyCoefficients will consecutively fill in the values that belong\r\n        // to the interleaved positions of the HL, LH, and HH coefficients.\r\n        // The LL coefficients will then be interleaved in Transform.iterate().\r\n        copyCoefficients(coefficients, width, height, subband, delta, mb,\r\n                         reversible, segmentationSymbolUsed);\r\n      }\r\n      subbandCoefficients.push({\r\n        width: width,\r\n        height: height,\r\n        items: coefficients\r\n      });\r\n    }\r\n\r\n    var result = transform.calculate(subbandCoefficients,\r\n                                     component.tcx0, component.tcy0);\r\n    return {\r\n      left: component.tcx0,\r\n      top: component.tcy0,\r\n      width: result.width,\r\n      height: result.height,\r\n      items: result.items\r\n    };\r\n  }\r\n  function transformComponents(context) {\r\n    var siz = context.SIZ;\r\n    var components = context.components;\r\n    var componentsCount = siz.Csiz;\r\n    var resultImages = [];\r\n    for (var i = 0, ii = context.tiles.length; i < ii; i++) {\r\n      var tile = context.tiles[i];\r\n      var transformedTiles = [];\r\n      var c;\r\n      for (c = 0; c < componentsCount; c++) {\r\n        transformedTiles[c] = transformTile(context, tile, c);\r\n      }\r\n      var tile0 = transformedTiles[0];\r\n      var isSigned = components[0].isSigned;\r\n      if (isSigned) {\r\n        var out = new Int16Array(tile0.items.length * componentsCount);\r\n      } else {\r\n        var out = new Uint16Array(tile0.items.length * componentsCount);\r\n      }\r\n      var result = {\r\n        left: tile0.left,\r\n        top: tile0.top,\r\n        width: tile0.width,\r\n        height: tile0.height,\r\n        items: out\r\n      };\r\n\r\n      // Section G.2.2 Inverse multi component transform\r\n      var shift, offset, max, min, maxK;\r\n      var pos = 0, j, jj, y0, y1, y2, r, g, b, k, val;\r\n      if (tile.codingStyleDefaultParameters.multipleComponentTransform) {\r\n        var fourComponents = componentsCount === 4;\r\n        var y0items = transformedTiles[0].items;\r\n        var y1items = transformedTiles[1].items;\r\n        var y2items = transformedTiles[2].items;\r\n        var y3items = fourComponents ? transformedTiles[3].items : null;\r\n\r\n        // HACK: The multiple component transform formulas below assume that\r\n        // all components have the same precision. With this in mind, we\r\n        // compute shift and offset only once.\r\n        shift = components[0].precision - 8;\r\n        offset = (128 << shift) + 0.5;\r\n        max = 255 * (1 << shift);\r\n        maxK = max * 0.5;\r\n        min = -maxK;\r\n\r\n        var component0 = tile.components[0];\r\n        var alpha01 = componentsCount - 3;\r\n        jj = y0items.length;\r\n        if (!component0.codingStyleParameters.reversibleTransformation) {\r\n          // inverse irreversible multiple component transform\r\n          for (j = 0; j < jj; j++, pos += alpha01) {\r\n            y0 = y0items[j] + offset;\r\n            y1 = y1items[j];\r\n            y2 = y2items[j];\r\n            r = y0 + 1.402 * y2;\r\n            g = y0 - 0.34413 * y1 - 0.71414 * y2;\r\n            b = y0 + 1.772 * y1;\r\n            out[pos++] = r <= 0 ? 0 : r >= max ? 255 : r >> shift;\r\n            out[pos++] = g <= 0 ? 0 : g >= max ? 255 : g >> shift;\r\n            out[pos++] = b <= 0 ? 0 : b >= max ? 255 : b >> shift;\r\n          }\r\n        } else {\r\n          // inverse reversible multiple component transform\r\n          for (j = 0; j < jj; j++, pos += alpha01) {\r\n            y0 = y0items[j] + offset;\r\n            y1 = y1items[j];\r\n            y2 = y2items[j];\r\n            g = y0 - ((y2 + y1) >> 2);\r\n            r = g + y2;\r\n            b = g + y1;\r\n            out[pos++] = r <= 0 ? 0 : r >= max ? 255 : r >> shift;\r\n            out[pos++] = g <= 0 ? 0 : g >= max ? 255 : g >> shift;\r\n            out[pos++] = b <= 0 ? 0 : b >= max ? 255 : b >> shift;\r\n          }\r\n        }\r\n        if (fourComponents) {\r\n          for (j = 0, pos = 3; j < jj; j++, pos += 4) {\r\n            k = y3items[j];\r\n            out[pos] = k <= min ? 0 : k >= maxK ? 255 : (k + offset) >> shift;\r\n          }\r\n        }\r\n      } else { // no multi-component transform\r\n        for (c = 0; c < componentsCount; c++) {\r\n          if (components[c].precision === 8){\r\n            var items = transformedTiles[c].items;\r\n            shift = components[c].precision - 8;\r\n            offset = (128 << shift) + 0.5;\r\n            max = (127.5 * (1 << shift));\r\n            min = -max;\r\n            for (pos = c, j = 0, jj = items.length; j < jj; j++) {\r\n              val = items[j];\r\n              out[pos] = val <= min ? 0 :\r\n                         val >= max ? 255 : (val + offset) >> shift;\r\n              pos += componentsCount;\r\n            }\r\n          }else{\r\n            var isSigned = components[c].isSigned;\r\n            var items = transformedTiles[c].items;\r\n\r\n            if(isSigned){\r\n              for (pos = c, j = 0, jj = items.length; j < jj; j++) {\r\n                out[pos] = items[j];\r\n                pos += componentsCount;\r\n              }\r\n            }else{\r\n              shift = components[c].precision - 8;\r\n              offset = (128 << shift) + 0.5;\r\n              var precisionMax = Math.pow(2,components[c].precision)-1;\r\n              for (pos = c, j = 0, jj = items.length; j < jj; j++) {\r\n                val = items[j];\r\n                out[pos] = Math.max(Math.min((val + offset),precisionMax),0);\r\n                pos += componentsCount;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      resultImages.push(result);\r\n    }\r\n    return resultImages;\r\n  }\r\n  function initializeTile(context, tileIndex) {\r\n    var siz = context.SIZ;\r\n    var componentsCount = siz.Csiz;\r\n    var tile = context.tiles[tileIndex];\r\n    for (var c = 0; c < componentsCount; c++) {\r\n      var component = tile.components[c];\r\n      var qcdOrQcc = (context.currentTile.QCC[c] !== undefined ?\r\n        context.currentTile.QCC[c] : context.currentTile.QCD);\r\n      component.quantizationParameters = qcdOrQcc;\r\n      var codOrCoc = (context.currentTile.COC[c] !== undefined  ?\r\n        context.currentTile.COC[c] : context.currentTile.COD);\r\n      component.codingStyleParameters = codOrCoc;\r\n    }\r\n    tile.codingStyleDefaultParameters = context.currentTile.COD;\r\n  }\r\n\r\n  // Section B.10.2 Tag trees\r\n  var TagTree = (function TagTreeClosure() {\r\n    function TagTree(width, height) {\r\n      var levelsLength = log2(Math.max(width, height)) + 1;\r\n      this.levels = [];\r\n      for (var i = 0; i < levelsLength; i++) {\r\n        var level = {\r\n          width: width,\r\n          height: height,\r\n          items: []\r\n        };\r\n        this.levels.push(level);\r\n        width = Math.ceil(width / 2);\r\n        height = Math.ceil(height / 2);\r\n      }\r\n    }\r\n    TagTree.prototype = {\r\n      reset: function TagTree_reset(i, j) {\r\n        var currentLevel = 0, value = 0, level;\r\n        while (currentLevel < this.levels.length) {\r\n          level = this.levels[currentLevel];\r\n          var index = i + j * level.width;\r\n          if (level.items[index] !== undefined) {\r\n            value = level.items[index];\r\n            break;\r\n          }\r\n          level.index = index;\r\n          i >>= 1;\r\n          j >>= 1;\r\n          currentLevel++;\r\n        }\r\n        currentLevel--;\r\n        level = this.levels[currentLevel];\r\n        level.items[level.index] = value;\r\n        this.currentLevel = currentLevel;\r\n        delete this.value;\r\n      },\r\n      incrementValue: function TagTree_incrementValue() {\r\n        var level = this.levels[this.currentLevel];\r\n        level.items[level.index]++;\r\n      },\r\n      nextLevel: function TagTree_nextLevel() {\r\n        var currentLevel = this.currentLevel;\r\n        var level = this.levels[currentLevel];\r\n        var value = level.items[level.index];\r\n        currentLevel--;\r\n        if (currentLevel < 0) {\r\n          this.value = value;\r\n          return false;\r\n        }\r\n\r\n        this.currentLevel = currentLevel;\r\n        level = this.levels[currentLevel];\r\n        level.items[level.index] = value;\r\n        return true;\r\n      }\r\n    };\r\n    return TagTree;\r\n  })();\r\n\r\n  var InclusionTree = (function InclusionTreeClosure() {\r\n    function InclusionTree(width, height) {\r\n      var levelsLength = log2(Math.max(width, height)) + 1;\r\n      this.levels = [];\r\n      for (var i = 0; i < levelsLength; i++) {\r\n        var items = new Uint8Array(width * height);\r\n        var status = new Uint8Array(width * height);\r\n        for (var j = 0, jj = items.length; j < jj; j++) {\r\n          items[j] = 0;\r\n          status[j] = 0;\r\n        }\r\n\r\n        var level = {\r\n          width: width,\r\n          height: height,\r\n          items: items,\r\n          status: status\r\n        };\r\n        this.levels.push(level);\r\n\r\n        width = Math.ceil(width / 2);\r\n        height = Math.ceil(height / 2);\r\n      }\r\n    }\r\n    InclusionTree.prototype = {\r\n      reset: function InclusionTree_reset(i, j, stopValue) {\r\n        this.currentStopValue = stopValue;\r\n        var currentLevel = 0;\r\n        while (currentLevel < this.levels.length) {\r\n          var level = this.levels[currentLevel];\r\n          var index = i + j * level.width;\r\n          level.index = index;\r\n\r\n          i >>= 1;\r\n          j >>= 1;\r\n          currentLevel++;\r\n        }\r\n\r\n        this.currentLevel = this.levels.length - 1;\r\n        this.minValue =this.levels[this.currentLevel].items[0];\r\n        return;\r\n      },\r\n      incrementValue: function InclusionTree_incrementValue() {\r\n        var level = this.levels[this.currentLevel];\r\n        level.items[level.index] = level.items[level.index] + 1;\r\n        if(level.items[level.index] > this.minValue) {\r\n          this.minValue = level.items[level.index];\r\n        }\r\n      },\r\n      nextLevel: function InclusionTree_nextLevel() {\r\n        var currentLevel = this.currentLevel;\r\n        currentLevel--;\r\n        if (currentLevel < 0) {\r\n          return false;\r\n        } else {\r\n          this.currentLevel = currentLevel;\r\n          var level = this.levels[currentLevel];\r\n          if(level.items[level.index] < this.minValue) {\r\n            level.items[level.index] = this.minValue;\r\n          }else if (level.items[level.index] > this.minValue) {\r\n            this.minValue = level.items[level.index];\r\n          }\r\n          return true;\r\n        }\r\n      },\r\n    isLeaf: function InclusionTree_isLeaf(){\r\n      return (this.currentLevel === 0);\r\n    },\r\n    isAboveThreshold: function InclusionTree_isAboveThreshold(){\r\n      var levelindex = this.currentLevel;\r\n      var level = this.levels[levelindex];\r\n      return (level.items[level.index] > this.currentStopValue);\r\n    },\r\n    isKnown: function InclusionTree_isKnown(){\r\n      var levelindex = this.currentLevel;\r\n      var level = this.levels[levelindex];\r\n      return (level.status[level.index] > 0);\r\n    },\r\n    setKnown: function InclusionTree_setKnown(){\r\n      var levelindex = this.currentLevel;\r\n      var level = this.levels[levelindex];\r\n      level.status[level.index] = 1;\r\n      return;\r\n    }\r\n\r\n    };\r\n    return InclusionTree;\r\n  })();\r\n\r\n  // Section D. Coefficient bit modeling\r\n  var BitModel = (function BitModelClosure() {\r\n    var UNIFORM_CONTEXT = 17;\r\n    var RUNLENGTH_CONTEXT = 18;\r\n    // Table D-1\r\n    // The index is binary presentation: 0dddvvhh, ddd - sum of Di (0..4),\r\n    // vv - sum of Vi (0..2), and hh - sum of Hi (0..2)\r\n    var LLAndLHContextsLabel = new Uint8Array([\r\n      0, 5, 8, 0, 3, 7, 8, 0, 4, 7, 8, 0, 0, 0, 0, 0, 1, 6, 8, 0, 3, 7, 8, 0, 4,\r\n      7, 8, 0, 0, 0, 0, 0, 2, 6, 8, 0, 3, 7, 8, 0, 4, 7, 8, 0, 0, 0, 0, 0, 2, 6,\r\n      8, 0, 3, 7, 8, 0, 4, 7, 8, 0, 0, 0, 0, 0, 2, 6, 8, 0, 3, 7, 8, 0, 4, 7, 8\r\n    ]);\r\n    var HLContextLabel = new Uint8Array([\r\n      0, 3, 4, 0, 5, 7, 7, 0, 8, 8, 8, 0, 0, 0, 0, 0, 1, 3, 4, 0, 6, 7, 7, 0, 8,\r\n      8, 8, 0, 0, 0, 0, 0, 2, 3, 4, 0, 6, 7, 7, 0, 8, 8, 8, 0, 0, 0, 0, 0, 2, 3,\r\n      4, 0, 6, 7, 7, 0, 8, 8, 8, 0, 0, 0, 0, 0, 2, 3, 4, 0, 6, 7, 7, 0, 8, 8, 8\r\n    ]);\r\n    var HHContextLabel = new Uint8Array([\r\n      0, 1, 2, 0, 1, 2, 2, 0, 2, 2, 2, 0, 0, 0, 0, 0, 3, 4, 5, 0, 4, 5, 5, 0, 5,\r\n      5, 5, 0, 0, 0, 0, 0, 6, 7, 7, 0, 7, 7, 7, 0, 7, 7, 7, 0, 0, 0, 0, 0, 8, 8,\r\n      8, 0, 8, 8, 8, 0, 8, 8, 8, 0, 0, 0, 0, 0, 8, 8, 8, 0, 8, 8, 8, 0, 8, 8, 8\r\n    ]);\r\n\r\n    function BitModel(width, height, subband, zeroBitPlanes, mb) {\r\n      this.width = width;\r\n      this.height = height;\r\n\r\n      this.contextLabelTable = (subband === 'HH' ? HHContextLabel :\r\n        (subband === 'HL' ? HLContextLabel : LLAndLHContextsLabel));\r\n\r\n      var coefficientCount = width * height;\r\n\r\n      // coefficients outside the encoding region treated as insignificant\r\n      // add border state cells for significanceState\r\n      this.neighborsSignificance = new Uint8Array(coefficientCount);\r\n      this.coefficentsSign = new Uint8Array(coefficientCount);\r\n      this.coefficentsMagnitude = mb > 14 ? new Uint32Array(coefficientCount) :\r\n                                  mb > 6 ? new Uint16Array(coefficientCount) :\r\n                                  new Uint8Array(coefficientCount);\r\n      this.processingFlags = new Uint8Array(coefficientCount);\r\n\r\n      var bitsDecoded = new Uint8Array(coefficientCount);\r\n      if (zeroBitPlanes !== 0) {\r\n        for (var i = 0; i < coefficientCount; i++) {\r\n          bitsDecoded[i] = zeroBitPlanes;\r\n        }\r\n      }\r\n      this.bitsDecoded = bitsDecoded;\r\n\r\n      this.reset();\r\n    }\r\n\r\n    BitModel.prototype = {\r\n      setDecoder: function BitModel_setDecoder(decoder) {\r\n        this.decoder = decoder;\r\n      },\r\n      reset: function BitModel_reset() {\r\n        // We have 17 contexts that are accessed via context labels,\r\n        // plus the uniform and runlength context.\r\n        this.contexts = new Int8Array(19);\r\n\r\n        // Contexts are packed into 1 byte:\r\n        // highest 7 bits carry the index, lowest bit carries mps\r\n        this.contexts[0] = (4 << 1) | 0;\r\n        this.contexts[UNIFORM_CONTEXT] = (46 << 1) | 0;\r\n        this.contexts[RUNLENGTH_CONTEXT] = (3 << 1) | 0;\r\n      },\r\n      setNeighborsSignificance:\r\n        function BitModel_setNeighborsSignificance(row, column, index) {\r\n        var neighborsSignificance = this.neighborsSignificance;\r\n        var width = this.width, height = this.height;\r\n        var left = (column > 0);\r\n        var right = (column + 1 < width);\r\n        var i;\r\n\r\n        if (row > 0) {\r\n          i = index - width;\r\n          if (left) {\r\n            neighborsSignificance[i - 1] += 0x10;\r\n          }\r\n          if (right) {\r\n            neighborsSignificance[i + 1] += 0x10;\r\n          }\r\n          neighborsSignificance[i] += 0x04;\r\n        }\r\n\r\n        if (row + 1 < height) {\r\n          i = index + width;\r\n          if (left) {\r\n            neighborsSignificance[i - 1] += 0x10;\r\n          }\r\n          if (right) {\r\n            neighborsSignificance[i + 1] += 0x10;\r\n          }\r\n          neighborsSignificance[i] += 0x04;\r\n        }\r\n\r\n        if (left) {\r\n          neighborsSignificance[index - 1] += 0x01;\r\n        }\r\n        if (right) {\r\n          neighborsSignificance[index + 1] += 0x01;\r\n        }\r\n        neighborsSignificance[index] |= 0x80;\r\n      },\r\n      runSignificancePropogationPass:\r\n        function BitModel_runSignificancePropogationPass() {\r\n        var decoder = this.decoder;\r\n        var width = this.width, height = this.height;\r\n        var coefficentsMagnitude = this.coefficentsMagnitude;\r\n        var coefficentsSign = this.coefficentsSign;\r\n        var neighborsSignificance = this.neighborsSignificance;\r\n        var processingFlags = this.processingFlags;\r\n        var contexts = this.contexts;\r\n        var labels = this.contextLabelTable;\r\n        var bitsDecoded = this.bitsDecoded;\r\n        var processedInverseMask = ~1;\r\n        var processedMask = 1;\r\n        var firstMagnitudeBitMask = 2;\r\n\r\n        for (var i0 = 0; i0 < height; i0 += 4) {\r\n          for (var j = 0; j < width; j++) {\r\n            var index = i0 * width + j;\r\n            for (var i1 = 0; i1 < 4; i1++, index += width) {\r\n              var i = i0 + i1;\r\n              if (i >= height) {\r\n                break;\r\n              }\r\n              // clear processed flag first\r\n              processingFlags[index] &= processedInverseMask;\r\n\r\n              if (coefficentsMagnitude[index] ||\r\n                  !neighborsSignificance[index]) {\r\n                continue;\r\n              }\r\n\r\n              var contextLabel = labels[neighborsSignificance[index]];\r\n              var decision = decoder.readBit(contexts, contextLabel);\r\n              if (decision) {\r\n                var sign = this.decodeSignBit(i, j, index);\r\n                coefficentsSign[index] = sign;\r\n                coefficentsMagnitude[index] = 1;\r\n                this.setNeighborsSignificance(i, j, index);\r\n                processingFlags[index] |= firstMagnitudeBitMask;\r\n              }\r\n              bitsDecoded[index]++;\r\n              processingFlags[index] |= processedMask;\r\n            }\r\n          }\r\n        }\r\n      },\r\n      decodeSignBit: function BitModel_decodeSignBit(row, column, index) {\r\n        var width = this.width, height = this.height;\r\n        var coefficentsMagnitude = this.coefficentsMagnitude;\r\n        var coefficentsSign = this.coefficentsSign;\r\n        var contribution, sign0, sign1, significance1;\r\n        var contextLabel, decoded;\r\n\r\n        // calculate horizontal contribution\r\n        significance1 = (column > 0 && coefficentsMagnitude[index - 1] !== 0);\r\n        if (column + 1 < width && coefficentsMagnitude[index + 1] !== 0) {\r\n          sign1 = coefficentsSign[index + 1];\r\n          if (significance1) {\r\n            sign0 = coefficentsSign[index - 1];\r\n            contribution = 1 - sign1 - sign0;\r\n          } else {\r\n            contribution = 1 - sign1 - sign1;\r\n          }\r\n        } else if (significance1) {\r\n          sign0 = coefficentsSign[index - 1];\r\n          contribution = 1 - sign0 - sign0;\r\n        } else {\r\n          contribution = 0;\r\n        }\r\n        var horizontalContribution = 3 * contribution;\r\n\r\n        // calculate vertical contribution and combine with the horizontal\r\n        significance1 = (row > 0 && coefficentsMagnitude[index - width] !== 0);\r\n        if (row + 1 < height && coefficentsMagnitude[index + width] !== 0) {\r\n          sign1 = coefficentsSign[index + width];\r\n          if (significance1) {\r\n            sign0 = coefficentsSign[index - width];\r\n            contribution = 1 - sign1 - sign0 + horizontalContribution;\r\n          } else {\r\n            contribution = 1 - sign1 - sign1 + horizontalContribution;\r\n          }\r\n        } else if (significance1) {\r\n          sign0 = coefficentsSign[index - width];\r\n          contribution = 1 - sign0 - sign0 + horizontalContribution;\r\n        } else {\r\n          contribution = horizontalContribution;\r\n        }\r\n\r\n        if (contribution >= 0) {\r\n          contextLabel = 9 + contribution;\r\n          decoded = this.decoder.readBit(this.contexts, contextLabel);\r\n        } else {\r\n          contextLabel = 9 - contribution;\r\n          decoded = this.decoder.readBit(this.contexts, contextLabel) ^ 1;\r\n        }\r\n        return decoded;\r\n      },\r\n      runMagnitudeRefinementPass:\r\n        function BitModel_runMagnitudeRefinementPass() {\r\n        var decoder = this.decoder;\r\n        var width = this.width, height = this.height;\r\n        var coefficentsMagnitude = this.coefficentsMagnitude;\r\n        var neighborsSignificance = this.neighborsSignificance;\r\n        var contexts = this.contexts;\r\n        var bitsDecoded = this.bitsDecoded;\r\n        var processingFlags = this.processingFlags;\r\n        var processedMask = 1;\r\n        var firstMagnitudeBitMask = 2;\r\n        var length = width * height;\r\n        var width4 = width * 4;\r\n\r\n        for (var index0 = 0, indexNext; index0 < length; index0 = indexNext) {\r\n          indexNext = Math.min(length, index0 + width4);\r\n          for (var j = 0; j < width; j++) {\r\n            for (var index = index0 + j; index < indexNext; index += width) {\r\n\r\n              // significant but not those that have just become\r\n              if (!coefficentsMagnitude[index] ||\r\n                (processingFlags[index] & processedMask) !== 0) {\r\n                continue;\r\n              }\r\n\r\n              var contextLabel = 16;\r\n              if ((processingFlags[index] & firstMagnitudeBitMask) !== 0) {\r\n                processingFlags[index] ^= firstMagnitudeBitMask;\r\n                // first refinement\r\n               var significance = neighborsSignificance[index] & 127;\r\n               contextLabel = significance === 0 ? 15 : 14;\r\n              }\r\n\r\n              var bit = decoder.readBit(contexts, contextLabel);\r\n              coefficentsMagnitude[index] =\r\n                (coefficentsMagnitude[index] << 1) | bit;\r\n              bitsDecoded[index]++;\r\n              processingFlags[index] |= processedMask;\r\n            }\r\n          }\r\n        }\r\n      },\r\n      runCleanupPass: function BitModel_runCleanupPass() {\r\n        var decoder = this.decoder;\r\n        var width = this.width, height = this.height;\r\n        var neighborsSignificance = this.neighborsSignificance;\r\n        var coefficentsMagnitude = this.coefficentsMagnitude;\r\n        var coefficentsSign = this.coefficentsSign;\r\n        var contexts = this.contexts;\r\n        var labels = this.contextLabelTable;\r\n        var bitsDecoded = this.bitsDecoded;\r\n        var processingFlags = this.processingFlags;\r\n        var processedMask = 1;\r\n        var firstMagnitudeBitMask = 2;\r\n        var oneRowDown = width;\r\n        var twoRowsDown = width * 2;\r\n        var threeRowsDown = width * 3;\r\n        var iNext;\r\n        for (var i0 = 0; i0 < height; i0 = iNext) {\r\n          iNext = Math.min(i0 + 4, height);\r\n          var indexBase = i0 * width;\r\n          var checkAllEmpty = i0 + 3 < height;\r\n          for (var j = 0; j < width; j++) {\r\n            var index0 = indexBase + j;\r\n            // using the property: labels[neighborsSignificance[index]] === 0\r\n            // when neighborsSignificance[index] === 0\r\n            var allEmpty = (checkAllEmpty &&\r\n              processingFlags[index0] === 0 &&\r\n              processingFlags[index0 + oneRowDown] === 0 &&\r\n              processingFlags[index0 + twoRowsDown] === 0 &&\r\n              processingFlags[index0 + threeRowsDown] === 0 &&\r\n              neighborsSignificance[index0] === 0 &&\r\n              neighborsSignificance[index0 + oneRowDown] === 0 &&\r\n              neighborsSignificance[index0 + twoRowsDown] === 0 &&\r\n              neighborsSignificance[index0 + threeRowsDown] === 0);\r\n            var i1 = 0, index = index0;\r\n            var i = i0, sign;\r\n            if (allEmpty) {\r\n              var hasSignificantCoefficent =\r\n                decoder.readBit(contexts, RUNLENGTH_CONTEXT);\r\n              if (!hasSignificantCoefficent) {\r\n                bitsDecoded[index0]++;\r\n                bitsDecoded[index0 + oneRowDown]++;\r\n                bitsDecoded[index0 + twoRowsDown]++;\r\n                bitsDecoded[index0 + threeRowsDown]++;\r\n                continue; // next column\r\n              }\r\n              i1 = (decoder.readBit(contexts, UNIFORM_CONTEXT) << 1) |\r\n                    decoder.readBit(contexts, UNIFORM_CONTEXT);\r\n              if (i1 !== 0) {\r\n                i = i0 + i1;\r\n                index += i1 * width;\r\n              }\r\n\r\n              sign = this.decodeSignBit(i, j, index);\r\n              coefficentsSign[index] = sign;\r\n              coefficentsMagnitude[index] = 1;\r\n              this.setNeighborsSignificance(i, j, index);\r\n              processingFlags[index] |= firstMagnitudeBitMask;\r\n\r\n              index = index0;\r\n              for (var i2 = i0; i2 <= i; i2++, index += width) {\r\n                bitsDecoded[index]++;\r\n              }\r\n\r\n              i1++;\r\n            }\r\n            for (i = i0 + i1; i < iNext; i++, index += width) {\r\n              if (coefficentsMagnitude[index] ||\r\n                (processingFlags[index] & processedMask) !== 0) {\r\n                continue;\r\n              }\r\n\r\n              var contextLabel = labels[neighborsSignificance[index]];\r\n              var decision = decoder.readBit(contexts, contextLabel);\r\n              if (decision === 1) {\r\n                sign = this.decodeSignBit(i, j, index);\r\n                coefficentsSign[index] = sign;\r\n                coefficentsMagnitude[index] = 1;\r\n                this.setNeighborsSignificance(i, j, index);\r\n                processingFlags[index] |= firstMagnitudeBitMask;\r\n              }\r\n              bitsDecoded[index]++;\r\n            }\r\n          }\r\n        }\r\n      },\r\n      checkSegmentationSymbol: function BitModel_checkSegmentationSymbol() {\r\n        var decoder = this.decoder;\r\n        var contexts = this.contexts;\r\n        var symbol = (decoder.readBit(contexts, UNIFORM_CONTEXT) << 3) |\r\n                     (decoder.readBit(contexts, UNIFORM_CONTEXT) << 2) |\r\n                     (decoder.readBit(contexts, UNIFORM_CONTEXT) << 1) |\r\n                      decoder.readBit(contexts, UNIFORM_CONTEXT);\r\n        if (symbol !== 0xA) {\r\n          throw new Error('JPX Error: Invalid segmentation symbol');\r\n        }\r\n      }\r\n    };\r\n\r\n    return BitModel;\r\n  })();\r\n\r\n  // Section F, Discrete wavelet transformation\r\n  var Transform = (function TransformClosure() {\r\n    function Transform() {}\r\n\r\n    Transform.prototype.calculate =\r\n      function transformCalculate(subbands, u0, v0) {\r\n      var ll = subbands[0];\r\n      for (var i = 1, ii = subbands.length; i < ii; i++) {\r\n        ll = this.iterate(ll, subbands[i], u0, v0);\r\n      }\r\n      return ll;\r\n    };\r\n    Transform.prototype.extend = function extend(buffer, offset, size) {\r\n      // Section F.3.7 extending... using max extension of 4\r\n      var i1 = offset - 1, j1 = offset + 1;\r\n      var i2 = offset + size - 2, j2 = offset + size;\r\n      buffer[i1--] = buffer[j1++];\r\n      buffer[j2++] = buffer[i2--];\r\n      buffer[i1--] = buffer[j1++];\r\n      buffer[j2++] = buffer[i2--];\r\n      buffer[i1--] = buffer[j1++];\r\n      buffer[j2++] = buffer[i2--];\r\n      buffer[i1] = buffer[j1];\r\n      buffer[j2] = buffer[i2];\r\n    };\r\n    Transform.prototype.iterate = function Transform_iterate(ll, hl_lh_hh,\r\n                                                             u0, v0) {\r\n      var llWidth = ll.width, llHeight = ll.height, llItems = ll.items;\r\n      var width = hl_lh_hh.width;\r\n      var height = hl_lh_hh.height;\r\n      var items = hl_lh_hh.items;\r\n      var i, j, k, l, u, v;\r\n\r\n      // Interleave LL according to Section F.3.3\r\n      for (k = 0, i = 0; i < llHeight; i++) {\r\n        l = i * 2 * width;\r\n        for (j = 0; j < llWidth; j++, k++, l += 2) {\r\n          items[l] = llItems[k];\r\n        }\r\n      }\r\n      // The LL band is not needed anymore.\r\n      llItems = ll.items = null;\r\n\r\n      var bufferPadding = 4;\r\n      var rowBuffer = new Float32Array(width + 2 * bufferPadding);\r\n\r\n      // Section F.3.4 HOR_SR\r\n      if (width === 1) {\r\n        // if width = 1, when u0 even keep items as is, when odd divide by 2\r\n        if ((u0 & 1) !== 0) {\r\n          for (v = 0, k = 0; v < height; v++, k += width) {\r\n            items[k] *= 0.5;\r\n          }\r\n        }\r\n      } else {\r\n        for (v = 0, k = 0; v < height; v++, k += width) {\r\n          rowBuffer.set(items.subarray(k, k + width), bufferPadding);\r\n\r\n          this.extend(rowBuffer, bufferPadding, width);\r\n          this.filter(rowBuffer, bufferPadding, width);\r\n\r\n          items.set(\r\n            rowBuffer.subarray(bufferPadding, bufferPadding + width),\r\n            k);\r\n        }\r\n      }\r\n\r\n      // Accesses to the items array can take long, because it may not fit into\r\n      // CPU cache and has to be fetched from main memory. Since subsequent\r\n      // accesses to the items array are not local when reading columns, we\r\n      // have a cache miss every time. To reduce cache misses, get up to\r\n      // 'numBuffers' items at a time and store them into the individual\r\n      // buffers. The colBuffers should be small enough to fit into CPU cache.\r\n      var numBuffers = 16;\r\n      var colBuffers = [];\r\n      for (i = 0; i < numBuffers; i++) {\r\n        colBuffers.push(new Float32Array(height + 2 * bufferPadding));\r\n      }\r\n      var b, currentBuffer = 0;\r\n      ll = bufferPadding + height;\r\n\r\n      // Section F.3.5 VER_SR\r\n      if (height === 1) {\r\n          // if height = 1, when v0 even keep items as is, when odd divide by 2\r\n        if ((v0 & 1) !== 0) {\r\n          for (u = 0; u < width; u++) {\r\n            items[u] *= 0.5;\r\n          }\r\n        }\r\n      } else {\r\n        for (u = 0; u < width; u++) {\r\n          // if we ran out of buffers, copy several image columns at once\r\n          if (currentBuffer === 0) {\r\n            numBuffers = Math.min(width - u, numBuffers);\r\n            for (k = u, l = bufferPadding; l < ll; k += width, l++) {\r\n              for (b = 0; b < numBuffers; b++) {\r\n                colBuffers[b][l] = items[k + b];\r\n              }\r\n            }\r\n            currentBuffer = numBuffers;\r\n          }\r\n\r\n          currentBuffer--;\r\n          var buffer = colBuffers[currentBuffer];\r\n          this.extend(buffer, bufferPadding, height);\r\n          this.filter(buffer, bufferPadding, height);\r\n\r\n          // If this is last buffer in this group of buffers, flush all buffers.\r\n          if (currentBuffer === 0) {\r\n            k = u - numBuffers + 1;\r\n            for (l = bufferPadding; l < ll; k += width, l++) {\r\n              for (b = 0; b < numBuffers; b++) {\r\n                items[k + b] = colBuffers[b][l];\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return {\r\n        width: width,\r\n        height: height,\r\n        items: items\r\n      };\r\n    };\r\n    return Transform;\r\n  })();\r\n\r\n  // Section 3.8.2 Irreversible 9-7 filter\r\n  var IrreversibleTransform = (function IrreversibleTransformClosure() {\r\n    function IrreversibleTransform() {\r\n      Transform.call(this);\r\n    }\r\n\r\n    IrreversibleTransform.prototype = Object.create(Transform.prototype);\r\n    IrreversibleTransform.prototype.filter =\r\n      function irreversibleTransformFilter(x, offset, length) {\r\n      var len = length >> 1;\r\n      offset = offset | 0;\r\n      var j, n, current, next;\r\n\r\n      var alpha = -1.586134342059924;\r\n      var beta = -0.052980118572961;\r\n      var gamma = 0.882911075530934;\r\n      var delta = 0.443506852043971;\r\n      var K = 1.230174104914001;\r\n      var K_ = 1 / K;\r\n\r\n      // step 1 is combined with step 3\r\n\r\n      // step 2\r\n      j = offset - 3;\r\n      for (n = len + 4; n--; j += 2) {\r\n        x[j] *= K_;\r\n      }\r\n\r\n      // step 1 & 3\r\n      j = offset - 2;\r\n      current = delta * x[j -1];\r\n      for (n = len + 3; n--; j += 2) {\r\n        next = delta * x[j + 1];\r\n        x[j] = K * x[j] - current - next;\r\n        if (n--) {\r\n          j += 2;\r\n          current = delta * x[j + 1];\r\n          x[j] = K * x[j] - current - next;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // step 4\r\n      j = offset - 1;\r\n      current = gamma * x[j - 1];\r\n      for (n = len + 2; n--; j += 2) {\r\n        next = gamma * x[j + 1];\r\n        x[j] -= current + next;\r\n        if (n--) {\r\n          j += 2;\r\n          current = gamma * x[j + 1];\r\n          x[j] -= current + next;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // step 5\r\n      j = offset;\r\n      current = beta * x[j - 1];\r\n      for (n = len + 1; n--; j += 2) {\r\n        next = beta * x[j + 1];\r\n        x[j] -= current + next;\r\n        if (n--) {\r\n          j += 2;\r\n          current = beta * x[j + 1];\r\n          x[j] -= current + next;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // step 6\r\n      if (len !== 0) {\r\n        j = offset + 1;\r\n        current = alpha * x[j - 1];\r\n        for (n = len; n--; j += 2) {\r\n          next = alpha * x[j + 1];\r\n          x[j] -= current + next;\r\n          if (n--) {\r\n            j += 2;\r\n            current = alpha * x[j + 1];\r\n            x[j] -= current + next;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    return IrreversibleTransform;\r\n  })();\r\n\r\n  // Section 3.8.1 Reversible 5-3 filter\r\n  var ReversibleTransform = (function ReversibleTransformClosure() {\r\n    function ReversibleTransform() {\r\n      Transform.call(this);\r\n    }\r\n\r\n    ReversibleTransform.prototype = Object.create(Transform.prototype);\r\n    ReversibleTransform.prototype.filter =\r\n      function reversibleTransformFilter(x, offset, length) {\r\n      var len = length >> 1;\r\n      offset = offset | 0;\r\n      var j, n;\r\n\r\n      for (j = offset, n = len + 1; n--; j += 2) {\r\n        x[j] -= (x[j - 1] + x[j + 1] + 2) >> 2;\r\n      }\r\n\r\n      for (j = offset + 1, n = len; n--; j += 2) {\r\n        x[j] += (x[j - 1] + x[j + 1]) >> 1;\r\n      }\r\n    };\r\n\r\n    return ReversibleTransform;\r\n  })();\r\n\r\n  return JpxImage;\r\n})();\r\n\r\n\r\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\r\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\r\n/* Copyright 2012 Mozilla Foundation\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n'use strict';\r\n\r\n/* This class implements the QM Coder decoding as defined in\r\n *   JPEG 2000 Part I Final Committee Draft Version 1.0\r\n *   Annex C.3 Arithmetic decoding procedure \r\n * available at http://www.jpeg.org/public/fcd15444-1.pdf\r\n * \r\n * The arithmetic decoder is used in conjunction with context models to decode\r\n * JPEG2000 and JBIG2 streams.\r\n */\r\nvar ArithmeticDecoder = (function ArithmeticDecoderClosure() {\r\n  // Table C-2\r\n  var QeTable = [\r\n    {qe: 0x5601, nmps: 1, nlps: 1, switchFlag: 1},\r\n    {qe: 0x3401, nmps: 2, nlps: 6, switchFlag: 0},\r\n    {qe: 0x1801, nmps: 3, nlps: 9, switchFlag: 0},\r\n    {qe: 0x0AC1, nmps: 4, nlps: 12, switchFlag: 0},\r\n    {qe: 0x0521, nmps: 5, nlps: 29, switchFlag: 0},\r\n    {qe: 0x0221, nmps: 38, nlps: 33, switchFlag: 0},\r\n    {qe: 0x5601, nmps: 7, nlps: 6, switchFlag: 1},\r\n    {qe: 0x5401, nmps: 8, nlps: 14, switchFlag: 0},\r\n    {qe: 0x4801, nmps: 9, nlps: 14, switchFlag: 0},\r\n    {qe: 0x3801, nmps: 10, nlps: 14, switchFlag: 0},\r\n    {qe: 0x3001, nmps: 11, nlps: 17, switchFlag: 0},\r\n    {qe: 0x2401, nmps: 12, nlps: 18, switchFlag: 0},\r\n    {qe: 0x1C01, nmps: 13, nlps: 20, switchFlag: 0},\r\n    {qe: 0x1601, nmps: 29, nlps: 21, switchFlag: 0},\r\n    {qe: 0x5601, nmps: 15, nlps: 14, switchFlag: 1},\r\n    {qe: 0x5401, nmps: 16, nlps: 14, switchFlag: 0},\r\n    {qe: 0x5101, nmps: 17, nlps: 15, switchFlag: 0},\r\n    {qe: 0x4801, nmps: 18, nlps: 16, switchFlag: 0},\r\n    {qe: 0x3801, nmps: 19, nlps: 17, switchFlag: 0},\r\n    {qe: 0x3401, nmps: 20, nlps: 18, switchFlag: 0},\r\n    {qe: 0x3001, nmps: 21, nlps: 19, switchFlag: 0},\r\n    {qe: 0x2801, nmps: 22, nlps: 19, switchFlag: 0},\r\n    {qe: 0x2401, nmps: 23, nlps: 20, switchFlag: 0},\r\n    {qe: 0x2201, nmps: 24, nlps: 21, switchFlag: 0},\r\n    {qe: 0x1C01, nmps: 25, nlps: 22, switchFlag: 0},\r\n    {qe: 0x1801, nmps: 26, nlps: 23, switchFlag: 0},\r\n    {qe: 0x1601, nmps: 27, nlps: 24, switchFlag: 0},\r\n    {qe: 0x1401, nmps: 28, nlps: 25, switchFlag: 0},\r\n    {qe: 0x1201, nmps: 29, nlps: 26, switchFlag: 0},\r\n    {qe: 0x1101, nmps: 30, nlps: 27, switchFlag: 0},\r\n    {qe: 0x0AC1, nmps: 31, nlps: 28, switchFlag: 0},\r\n    {qe: 0x09C1, nmps: 32, nlps: 29, switchFlag: 0},\r\n    {qe: 0x08A1, nmps: 33, nlps: 30, switchFlag: 0},\r\n    {qe: 0x0521, nmps: 34, nlps: 31, switchFlag: 0},\r\n    {qe: 0x0441, nmps: 35, nlps: 32, switchFlag: 0},\r\n    {qe: 0x02A1, nmps: 36, nlps: 33, switchFlag: 0},\r\n    {qe: 0x0221, nmps: 37, nlps: 34, switchFlag: 0},\r\n    {qe: 0x0141, nmps: 38, nlps: 35, switchFlag: 0},\r\n    {qe: 0x0111, nmps: 39, nlps: 36, switchFlag: 0},\r\n    {qe: 0x0085, nmps: 40, nlps: 37, switchFlag: 0},\r\n    {qe: 0x0049, nmps: 41, nlps: 38, switchFlag: 0},\r\n    {qe: 0x0025, nmps: 42, nlps: 39, switchFlag: 0},\r\n    {qe: 0x0015, nmps: 43, nlps: 40, switchFlag: 0},\r\n    {qe: 0x0009, nmps: 44, nlps: 41, switchFlag: 0},\r\n    {qe: 0x0005, nmps: 45, nlps: 42, switchFlag: 0},\r\n    {qe: 0x0001, nmps: 45, nlps: 43, switchFlag: 0},\r\n    {qe: 0x5601, nmps: 46, nlps: 46, switchFlag: 0}\r\n  ];\r\n\r\n  // C.3.5 Initialisation of the decoder (INITDEC)\r\n  function ArithmeticDecoder(data, start, end) {\r\n    this.data = data;\r\n    this.bp = start;\r\n    this.dataEnd = end;\r\n\r\n    this.chigh = data[start];\r\n    this.clow = 0;\r\n\r\n    this.byteIn();\r\n\r\n    this.chigh = ((this.chigh << 7) & 0xFFFF) | ((this.clow >> 9) & 0x7F);\r\n    this.clow = (this.clow << 7) & 0xFFFF;\r\n    this.ct -= 7;\r\n    this.a = 0x8000;\r\n  }\r\n\r\n  ArithmeticDecoder.prototype = {\r\n    // C.3.4 Compressed data input (BYTEIN)\r\n    byteIn: function ArithmeticDecoder_byteIn() {\r\n      var data = this.data;\r\n      var bp = this.bp;\r\n      if (data[bp] === 0xFF) {\r\n        var b1 = data[bp + 1];\r\n        if (b1 > 0x8F) {\r\n          this.clow += 0xFF00;\r\n          this.ct = 8;\r\n        } else {\r\n          bp++;\r\n          this.clow += (data[bp] << 9);\r\n          this.ct = 7;\r\n          this.bp = bp;\r\n        }\r\n      } else {\r\n        bp++;\r\n        this.clow += bp < this.dataEnd ? (data[bp] << 8) : 0xFF00;\r\n        this.ct = 8;\r\n        this.bp = bp;\r\n      }\r\n      if (this.clow > 0xFFFF) {\r\n        this.chigh += (this.clow >> 16);\r\n        this.clow &= 0xFFFF;\r\n      }\r\n    },\r\n    // C.3.2 Decoding a decision (DECODE)\r\n    readBit: function ArithmeticDecoder_readBit(contexts, pos) {\r\n      // contexts are packed into 1 byte:\r\n      // highest 7 bits carry cx.index, lowest bit carries cx.mps\r\n      var cx_index = contexts[pos] >> 1, cx_mps = contexts[pos] & 1;\r\n      var qeTableIcx = QeTable[cx_index];\r\n      var qeIcx = qeTableIcx.qe;\r\n      var d;\r\n      var a = this.a - qeIcx;\r\n\r\n      if (this.chigh < qeIcx) {\r\n        // exchangeLps\r\n        if (a < qeIcx) {\r\n          a = qeIcx;\r\n          d = cx_mps;\r\n          cx_index = qeTableIcx.nmps;\r\n        } else {\r\n          a = qeIcx;\r\n          d = 1 ^ cx_mps;\r\n          if (qeTableIcx.switchFlag === 1) {\r\n            cx_mps = d;\r\n          }\r\n          cx_index = qeTableIcx.nlps;\r\n        }\r\n      } else {\r\n        this.chigh -= qeIcx;\r\n        if ((a & 0x8000) !== 0) {\r\n          this.a = a;\r\n          return cx_mps;\r\n        }\r\n        // exchangeMps\r\n        if (a < qeIcx) {\r\n          d = 1 ^ cx_mps;\r\n          if (qeTableIcx.switchFlag === 1) {\r\n            cx_mps = d;\r\n          }\r\n          cx_index = qeTableIcx.nlps;\r\n        } else {\r\n          d = cx_mps;\r\n          cx_index = qeTableIcx.nmps;\r\n        }\r\n      }\r\n      // C.3.3 renormD;\r\n      do {\r\n        if (this.ct === 0) {\r\n          this.byteIn();\r\n        }\r\n\r\n        a <<= 1;\r\n        this.chigh = ((this.chigh << 1) & 0xFFFF) | ((this.clow >> 15) & 1);\r\n        this.clow = (this.clow << 1) & 0xFFFF;\r\n        this.ct--;\r\n      } while ((a & 0x8000) === 0);\r\n      this.a = a;\r\n\r\n      contexts[pos] = cx_index << 1 | cx_mps;\r\n      return d;\r\n    }\r\n  };\r\n\r\n  return ArithmeticDecoder;\r\n})();\r\n\r\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\r\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\r\n/* Copyright 2012 Mozilla Foundation\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/* globals Cmd, ColorSpace, Dict, MozBlobBuilder, Name, PDFJS, Ref, URL,\r\n           Promise */\r\n\r\n'use strict';\r\n\r\nvar globalScope = (typeof window === 'undefined') ? this : window;\r\n\r\nvar isWorker = (typeof window === 'undefined');\r\n\r\nvar FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];\r\n\r\nvar TextRenderingMode = {\r\n  FILL: 0,\r\n  STROKE: 1,\r\n  FILL_STROKE: 2,\r\n  INVISIBLE: 3,\r\n  FILL_ADD_TO_PATH: 4,\r\n  STROKE_ADD_TO_PATH: 5,\r\n  FILL_STROKE_ADD_TO_PATH: 6,\r\n  ADD_TO_PATH: 7,\r\n  FILL_STROKE_MASK: 3,\r\n  ADD_TO_PATH_FLAG: 4\r\n};\r\n\r\nvar ImageKind = {\r\n  GRAYSCALE_1BPP: 1,\r\n  RGB_24BPP: 2,\r\n  RGBA_32BPP: 3\r\n};\r\n\r\nvar AnnotationType = {\r\n  WIDGET: 1,\r\n  TEXT: 2,\r\n  LINK: 3\r\n};\r\n\r\nvar StreamType = {\r\n  UNKNOWN: 0,\r\n  FLATE: 1,\r\n  LZW: 2,\r\n  DCT: 3,\r\n  JPX: 4,\r\n  JBIG: 5,\r\n  A85: 6,\r\n  AHX: 7,\r\n  CCF: 8,\r\n  RL: 9\r\n};\r\n\r\nvar FontType = {\r\n  UNKNOWN: 0,\r\n  TYPE1: 1,\r\n  TYPE1C: 2,\r\n  CIDFONTTYPE0: 3,\r\n  CIDFONTTYPE0C: 4,\r\n  TRUETYPE: 5,\r\n  CIDFONTTYPE2: 6,\r\n  TYPE3: 7,\r\n  OPENTYPE: 8,\r\n  TYPE0: 9,\r\n  MMTYPE1: 10\r\n};\r\n\r\n// The global PDFJS object exposes the API\r\n// In production, it will be declared outside a global wrapper\r\n// In development, it will be declared here\r\nif (!globalScope.PDFJS) {\r\n  globalScope.PDFJS = {};\r\n}\r\n\r\nglobalScope.PDFJS.pdfBug = false;\r\n\r\nPDFJS.VERBOSITY_LEVELS = {\r\n  errors: 0,\r\n  warnings: 1,\r\n  infos: 5\r\n};\r\n\r\n// All the possible operations for an operator list.\r\nvar OPS = PDFJS.OPS = {\r\n  // Intentionally start from 1 so it is easy to spot bad operators that will be\r\n  // 0's.\r\n  dependency: 1,\r\n  setLineWidth: 2,\r\n  setLineCap: 3,\r\n  setLineJoin: 4,\r\n  setMiterLimit: 5,\r\n  setDash: 6,\r\n  setRenderingIntent: 7,\r\n  setFlatness: 8,\r\n  setGState: 9,\r\n  save: 10,\r\n  restore: 11,\r\n  transform: 12,\r\n  moveTo: 13,\r\n  lineTo: 14,\r\n  curveTo: 15,\r\n  curveTo2: 16,\r\n  curveTo3: 17,\r\n  closePath: 18,\r\n  rectangle: 19,\r\n  stroke: 20,\r\n  closeStroke: 21,\r\n  fill: 22,\r\n  eoFill: 23,\r\n  fillStroke: 24,\r\n  eoFillStroke: 25,\r\n  closeFillStroke: 26,\r\n  closeEOFillStroke: 27,\r\n  endPath: 28,\r\n  clip: 29,\r\n  eoClip: 30,\r\n  beginText: 31,\r\n  endText: 32,\r\n  setCharSpacing: 33,\r\n  setWordSpacing: 34,\r\n  setHScale: 35,\r\n  setLeading: 36,\r\n  setFont: 37,\r\n  setTextRenderingMode: 38,\r\n  setTextRise: 39,\r\n  moveText: 40,\r\n  setLeadingMoveText: 41,\r\n  setTextMatrix: 42,\r\n  nextLine: 43,\r\n  showText: 44,\r\n  showSpacedText: 45,\r\n  nextLineShowText: 46,\r\n  nextLineSetSpacingShowText: 47,\r\n  setCharWidth: 48,\r\n  setCharWidthAndBounds: 49,\r\n  setStrokeColorSpace: 50,\r\n  setFillColorSpace: 51,\r\n  setStrokeColor: 52,\r\n  setStrokeColorN: 53,\r\n  setFillColor: 54,\r\n  setFillColorN: 55,\r\n  setStrokeGray: 56,\r\n  setFillGray: 57,\r\n  setStrokeRGBColor: 58,\r\n  setFillRGBColor: 59,\r\n  setStrokeCMYKColor: 60,\r\n  setFillCMYKColor: 61,\r\n  shadingFill: 62,\r\n  beginInlineImage: 63,\r\n  beginImageData: 64,\r\n  endInlineImage: 65,\r\n  paintXObject: 66,\r\n  markPoint: 67,\r\n  markPointProps: 68,\r\n  beginMarkedContent: 69,\r\n  beginMarkedContentProps: 70,\r\n  endMarkedContent: 71,\r\n  beginCompat: 72,\r\n  endCompat: 73,\r\n  paintFormXObjectBegin: 74,\r\n  paintFormXObjectEnd: 75,\r\n  beginGroup: 76,\r\n  endGroup: 77,\r\n  beginAnnotations: 78,\r\n  endAnnotations: 79,\r\n  beginAnnotation: 80,\r\n  endAnnotation: 81,\r\n  paintJpegXObject: 82,\r\n  paintImageMaskXObject: 83,\r\n  paintImageMaskXObjectGroup: 84,\r\n  paintImageXObject: 85,\r\n  paintInlineImageXObject: 86,\r\n  paintInlineImageXObjectGroup: 87,\r\n  paintImageXObjectRepeat: 88,\r\n  paintImageMaskXObjectRepeat: 89,\r\n  paintSolidColorImageMask: 90,\r\n  constructPath: 91\r\n};\r\n\r\n// A notice for devs. These are good for things that are helpful to devs, such\r\n// as warning that Workers were disabled, which is important to devs but not\r\n// end users.\r\nfunction info(msg) {\r\n  if (PDFJS.verbosity >= PDFJS.VERBOSITY_LEVELS.infos) {\r\n    console.log('Info: ' + msg);\r\n  }\r\n}\r\n\r\n// Non-fatal warnings.\r\nfunction warn(msg) {\r\n  if (PDFJS.verbosity >= PDFJS.VERBOSITY_LEVELS.warnings) {\r\n    console.log('Warning: ' + msg);\r\n  }\r\n}\r\n\r\n// Fatal errors that should trigger the fallback UI and halt execution by\r\n// throwing an exception.\r\nfunction error(msg) {\r\n  // If multiple arguments were passed, pass them all to the log function.\r\n  if (arguments.length > 1) {\r\n    var logArguments = ['Error:'];\r\n    logArguments.push.apply(logArguments, arguments);\r\n    console.log.apply(console, logArguments);\r\n    // Join the arguments into a single string for the lines below.\r\n    msg = [].join.call(arguments, ' ');\r\n  } else {\r\n    console.log('Error: ' + msg);\r\n  }\r\n  console.log(backtrace());\r\n  UnsupportedManager.notify(UNSUPPORTED_FEATURES.unknown);\r\n  throw new Error(msg);\r\n}\r\n\r\nfunction backtrace() {\r\n  try {\r\n    throw new Error();\r\n  } catch (e) {\r\n    return e.stack ? e.stack.split('\\n').slice(2).join('\\n') : '';\r\n  }\r\n}\r\n\r\nfunction assert(cond, msg) {\r\n  if (!cond) {\r\n    error(msg);\r\n  }\r\n}\r\n\r\nvar UNSUPPORTED_FEATURES = PDFJS.UNSUPPORTED_FEATURES = {\r\n  unknown: 'unknown',\r\n  forms: 'forms',\r\n  javaScript: 'javaScript',\r\n  smask: 'smask',\r\n  shadingPattern: 'shadingPattern',\r\n  font: 'font'\r\n};\r\n\r\nvar UnsupportedManager = PDFJS.UnsupportedManager =\r\n  (function UnsupportedManagerClosure() {\r\n  var listeners = [];\r\n  return {\r\n    listen: function (cb) {\r\n      listeners.push(cb);\r\n    },\r\n    notify: function (featureId) {\r\n      warn('Unsupported feature \"' + featureId + '\"');\r\n      for (var i = 0, ii = listeners.length; i < ii; i++) {\r\n        listeners[i](featureId);\r\n      }\r\n    }\r\n  };\r\n})();\r\n\r\n// Combines two URLs. The baseUrl shall be absolute URL. If the url is an\r\n// absolute URL, it will be returned as is.\r\nfunction combineUrl(baseUrl, url) {\r\n  if (!url) {\r\n    return baseUrl;\r\n  }\r\n  if (/^[a-z][a-z0-9+\\-.]*:/i.test(url)) {\r\n    return url;\r\n  }\r\n  var i;\r\n  if (url.charAt(0) === '/') {\r\n    // absolute path\r\n    i = baseUrl.indexOf('://');\r\n    if (url.charAt(1) === '/') {\r\n      ++i;\r\n    } else {\r\n      i = baseUrl.indexOf('/', i + 3);\r\n    }\r\n    return baseUrl.substring(0, i) + url;\r\n  } else {\r\n    // relative path\r\n    var pathLength = baseUrl.length;\r\n    i = baseUrl.lastIndexOf('#');\r\n    pathLength = i >= 0 ? i : pathLength;\r\n    i = baseUrl.lastIndexOf('?', pathLength);\r\n    pathLength = i >= 0 ? i : pathLength;\r\n    var prefixLength = baseUrl.lastIndexOf('/', pathLength);\r\n    return baseUrl.substring(0, prefixLength + 1) + url;\r\n  }\r\n}\r\n\r\n// Validates if URL is safe and allowed, e.g. to avoid XSS.\r\nfunction isValidUrl(url, allowRelative) {\r\n  if (!url) {\r\n    return false;\r\n  }\r\n  // RFC 3986 (http://tools.ietf.org/html/rfc3986#section-3.1)\r\n  // scheme = ALPHA *( ALPHA / DIGIT / \"+\" / \"-\" / \".\" )\r\n  var protocol = /^[a-z][a-z0-9+\\-.]*(?=:)/i.exec(url);\r\n  if (!protocol) {\r\n    return allowRelative;\r\n  }\r\n  protocol = protocol[0].toLowerCase();\r\n  switch (protocol) {\r\n    case 'http':\r\n    case 'https':\r\n    case 'ftp':\r\n    case 'mailto':\r\n    case 'tel':\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\nPDFJS.isValidUrl = isValidUrl;\r\n\r\nfunction shadow(obj, prop, value) {\r\n  Object.defineProperty(obj, prop, { value: value,\r\n                                     enumerable: true,\r\n                                     configurable: true,\r\n                                     writable: false });\r\n  return value;\r\n}\r\nPDFJS.shadow = shadow;\r\n\r\nvar PasswordResponses = PDFJS.PasswordResponses = {\r\n  NEED_PASSWORD: 1,\r\n  INCORRECT_PASSWORD: 2\r\n};\r\n\r\nvar PasswordException = (function PasswordExceptionClosure() {\r\n  function PasswordException(msg, code) {\r\n    this.name = 'PasswordException';\r\n    this.message = msg;\r\n    this.code = code;\r\n  }\r\n\r\n  PasswordException.prototype = new Error();\r\n  PasswordException.constructor = PasswordException;\r\n\r\n  return PasswordException;\r\n})();\r\nPDFJS.PasswordException = PasswordException;\r\n\r\nvar UnknownErrorException = (function UnknownErrorExceptionClosure() {\r\n  function UnknownErrorException(msg, details) {\r\n    this.name = 'UnknownErrorException';\r\n    this.message = msg;\r\n    this.details = details;\r\n  }\r\n\r\n  UnknownErrorException.prototype = new Error();\r\n  UnknownErrorException.constructor = UnknownErrorException;\r\n\r\n  return UnknownErrorException;\r\n})();\r\nPDFJS.UnknownErrorException = UnknownErrorException;\r\n\r\nvar InvalidPDFException = (function InvalidPDFExceptionClosure() {\r\n  function InvalidPDFException(msg) {\r\n    this.name = 'InvalidPDFException';\r\n    this.message = msg;\r\n  }\r\n\r\n  InvalidPDFException.prototype = new Error();\r\n  InvalidPDFException.constructor = InvalidPDFException;\r\n\r\n  return InvalidPDFException;\r\n})();\r\nPDFJS.InvalidPDFException = InvalidPDFException;\r\n\r\nvar MissingPDFException = (function MissingPDFExceptionClosure() {\r\n  function MissingPDFException(msg) {\r\n    this.name = 'MissingPDFException';\r\n    this.message = msg;\r\n  }\r\n\r\n  MissingPDFException.prototype = new Error();\r\n  MissingPDFException.constructor = MissingPDFException;\r\n\r\n  return MissingPDFException;\r\n})();\r\nPDFJS.MissingPDFException = MissingPDFException;\r\n\r\nvar UnexpectedResponseException =\r\n    (function UnexpectedResponseExceptionClosure() {\r\n  function UnexpectedResponseException(msg, status) {\r\n    this.name = 'UnexpectedResponseException';\r\n    this.message = msg;\r\n    this.status = status;\r\n  }\r\n\r\n  UnexpectedResponseException.prototype = new Error();\r\n  UnexpectedResponseException.constructor = UnexpectedResponseException;\r\n\r\n  return UnexpectedResponseException;\r\n})();\r\nPDFJS.UnexpectedResponseException = UnexpectedResponseException;\r\n\r\nvar NotImplementedException = (function NotImplementedExceptionClosure() {\r\n  function NotImplementedException(msg) {\r\n    this.message = msg;\r\n  }\r\n\r\n  NotImplementedException.prototype = new Error();\r\n  NotImplementedException.prototype.name = 'NotImplementedException';\r\n  NotImplementedException.constructor = NotImplementedException;\r\n\r\n  return NotImplementedException;\r\n})();\r\n\r\nvar MissingDataException = (function MissingDataExceptionClosure() {\r\n  function MissingDataException(begin, end) {\r\n    this.begin = begin;\r\n    this.end = end;\r\n    this.message = 'Missing data [' + begin + ', ' + end + ')';\r\n  }\r\n\r\n  MissingDataException.prototype = new Error();\r\n  MissingDataException.prototype.name = 'MissingDataException';\r\n  MissingDataException.constructor = MissingDataException;\r\n\r\n  return MissingDataException;\r\n})();\r\n\r\nvar XRefParseException = (function XRefParseExceptionClosure() {\r\n  function XRefParseException(msg) {\r\n    this.message = msg;\r\n  }\r\n\r\n  XRefParseException.prototype = new Error();\r\n  XRefParseException.prototype.name = 'XRefParseException';\r\n  XRefParseException.constructor = XRefParseException;\r\n\r\n  return XRefParseException;\r\n})();\r\n\r\n\r\nfunction bytesToString(bytes) {\r\n  assert(bytes !== null && typeof bytes === 'object' &&\r\n         bytes.length !== undefined, 'Invalid argument for bytesToString');\r\n  var length = bytes.length;\r\n  var MAX_ARGUMENT_COUNT = 8192;\r\n  if (length < MAX_ARGUMENT_COUNT) {\r\n    return String.fromCharCode.apply(null, bytes);\r\n  }\r\n  var strBuf = [];\r\n  for (var i = 0; i < length; i += MAX_ARGUMENT_COUNT) {\r\n    var chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);\r\n    var chunk = bytes.subarray(i, chunkEnd);\r\n    strBuf.push(String.fromCharCode.apply(null, chunk));\r\n  }\r\n  return strBuf.join('');\r\n}\r\n\r\nfunction stringToBytes(str) {\r\n  assert(typeof str === 'string', 'Invalid argument for stringToBytes');\r\n  var length = str.length;\r\n  var bytes = new Uint8Array(length);\r\n  for (var i = 0; i < length; ++i) {\r\n    bytes[i] = str.charCodeAt(i) & 0xFF;\r\n  }\r\n  return bytes;\r\n}\r\n\r\nfunction string32(value) {\r\n  return String.fromCharCode((value >> 24) & 0xff, (value >> 16) & 0xff,\r\n                             (value >> 8) & 0xff, value & 0xff);\r\n}\r\n\r\nfunction log2(x) {\r\n  var n = 1, i = 0;\r\n  while (x > n) {\r\n    n <<= 1;\r\n    i++;\r\n  }\r\n  return i;\r\n}\r\n\r\nfunction readInt8(data, start) {\r\n  return (data[start] << 24) >> 24;\r\n}\r\n\r\nfunction readUint16(data, offset) {\r\n  return (data[offset] << 8) | data[offset + 1];\r\n}\r\n\r\nfunction readUint32(data, offset) {\r\n  return ((data[offset] << 24) | (data[offset + 1] << 16) |\r\n         (data[offset + 2] << 8) | data[offset + 3]) >>> 0;\r\n}\r\n\r\n// Lazy test the endianness of the platform\r\n// NOTE: This will be 'true' for simulated TypedArrays\r\nfunction isLittleEndian() {\r\n  var buffer8 = new Uint8Array(2);\r\n  buffer8[0] = 1;\r\n  var buffer16 = new Uint16Array(buffer8.buffer);\r\n  return (buffer16[0] === 1);\r\n}\r\n\r\nObject.defineProperty(PDFJS, 'isLittleEndian', {\r\n  configurable: true,\r\n  get: function PDFJS_isLittleEndian() {\r\n    return shadow(PDFJS, 'isLittleEndian', isLittleEndian());\r\n  }\r\n});\r\n\r\n//#if !(FIREFOX || MOZCENTRAL || B2G || CHROME)\r\n//// Lazy test if the userAgant support CanvasTypedArrays\r\nfunction hasCanvasTypedArrays() {\r\n  var canvas = document.createElement('canvas');\r\n  canvas.width = canvas.height = 1;\r\n  var ctx = canvas.getContext('2d');\r\n  var imageData = ctx.createImageData(1, 1);\r\n  return (typeof imageData.data.buffer !== 'undefined');\r\n}\r\n\r\nObject.defineProperty(PDFJS, 'hasCanvasTypedArrays', {\r\n  configurable: true,\r\n  get: function PDFJS_hasCanvasTypedArrays() {\r\n    return shadow(PDFJS, 'hasCanvasTypedArrays', hasCanvasTypedArrays());\r\n  }\r\n});\r\n\r\nvar Uint32ArrayView = (function Uint32ArrayViewClosure() {\r\n\r\n  function Uint32ArrayView(buffer, length) {\r\n    this.buffer = buffer;\r\n    this.byteLength = buffer.length;\r\n    this.length = length === undefined ? (this.byteLength >> 2) : length;\r\n    ensureUint32ArrayViewProps(this.length);\r\n  }\r\n  Uint32ArrayView.prototype = Object.create(null);\r\n\r\n  var uint32ArrayViewSetters = 0;\r\n  function createUint32ArrayProp(index) {\r\n    return {\r\n      get: function () {\r\n        var buffer = this.buffer, offset = index << 2;\r\n        return (buffer[offset] | (buffer[offset + 1] << 8) |\r\n          (buffer[offset + 2] << 16) | (buffer[offset + 3] << 24)) >>> 0;\r\n      },\r\n      set: function (value) {\r\n        var buffer = this.buffer, offset = index << 2;\r\n        buffer[offset] = value & 255;\r\n        buffer[offset + 1] = (value >> 8) & 255;\r\n        buffer[offset + 2] = (value >> 16) & 255;\r\n        buffer[offset + 3] = (value >>> 24) & 255;\r\n      }\r\n    };\r\n  }\r\n\r\n  function ensureUint32ArrayViewProps(length) {\r\n    while (uint32ArrayViewSetters < length) {\r\n      Object.defineProperty(Uint32ArrayView.prototype,\r\n        uint32ArrayViewSetters,\r\n        createUint32ArrayProp(uint32ArrayViewSetters));\r\n      uint32ArrayViewSetters++;\r\n    }\r\n  }\r\n\r\n  return Uint32ArrayView;\r\n})();\r\n//#else\r\n//PDFJS.hasCanvasTypedArrays = true;\r\n//#endif\r\n\r\nvar IDENTITY_MATRIX = [1, 0, 0, 1, 0, 0];\r\n\r\nvar Util = PDFJS.Util = (function UtilClosure() {\r\n  function Util() {}\r\n\r\n  var rgbBuf = ['rgb(', 0, ',', 0, ',', 0, ')'];\r\n\r\n  // makeCssRgb() can be called thousands of times. Using |rgbBuf| avoids\r\n  // creating many intermediate strings.\r\n  Util.makeCssRgb = function Util_makeCssRgb(r, g, b) {\r\n    rgbBuf[1] = r;\r\n    rgbBuf[3] = g;\r\n    rgbBuf[5] = b;\r\n    return rgbBuf.join('');\r\n  };\r\n\r\n  // Concatenates two transformation matrices together and returns the result.\r\n  Util.transform = function Util_transform(m1, m2) {\r\n    return [\r\n      m1[0] * m2[0] + m1[2] * m2[1],\r\n      m1[1] * m2[0] + m1[3] * m2[1],\r\n      m1[0] * m2[2] + m1[2] * m2[3],\r\n      m1[1] * m2[2] + m1[3] * m2[3],\r\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\r\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\r\n    ];\r\n  };\r\n\r\n  // For 2d affine transforms\r\n  Util.applyTransform = function Util_applyTransform(p, m) {\r\n    var xt = p[0] * m[0] + p[1] * m[2] + m[4];\r\n    var yt = p[0] * m[1] + p[1] * m[3] + m[5];\r\n    return [xt, yt];\r\n  };\r\n\r\n  Util.applyInverseTransform = function Util_applyInverseTransform(p, m) {\r\n    var d = m[0] * m[3] - m[1] * m[2];\r\n    var xt = (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\r\n    var yt = (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\r\n    return [xt, yt];\r\n  };\r\n\r\n  // Applies the transform to the rectangle and finds the minimum axially\r\n  // aligned bounding box.\r\n  Util.getAxialAlignedBoundingBox =\r\n    function Util_getAxialAlignedBoundingBox(r, m) {\r\n\r\n    var p1 = Util.applyTransform(r, m);\r\n    var p2 = Util.applyTransform(r.slice(2, 4), m);\r\n    var p3 = Util.applyTransform([r[0], r[3]], m);\r\n    var p4 = Util.applyTransform([r[2], r[1]], m);\r\n    return [\r\n      Math.min(p1[0], p2[0], p3[0], p4[0]),\r\n      Math.min(p1[1], p2[1], p3[1], p4[1]),\r\n      Math.max(p1[0], p2[0], p3[0], p4[0]),\r\n      Math.max(p1[1], p2[1], p3[1], p4[1])\r\n    ];\r\n  };\r\n\r\n  Util.inverseTransform = function Util_inverseTransform(m) {\r\n    var d = m[0] * m[3] - m[1] * m[2];\r\n    return [m[3] / d, -m[1] / d, -m[2] / d, m[0] / d,\r\n      (m[2] * m[5] - m[4] * m[3]) / d, (m[4] * m[1] - m[5] * m[0]) / d];\r\n  };\r\n\r\n  // Apply a generic 3d matrix M on a 3-vector v:\r\n  //   | a b c |   | X |\r\n  //   | d e f | x | Y |\r\n  //   | g h i |   | Z |\r\n  // M is assumed to be serialized as [a,b,c,d,e,f,g,h,i],\r\n  // with v as [X,Y,Z]\r\n  Util.apply3dTransform = function Util_apply3dTransform(m, v) {\r\n    return [\r\n      m[0] * v[0] + m[1] * v[1] + m[2] * v[2],\r\n      m[3] * v[0] + m[4] * v[1] + m[5] * v[2],\r\n      m[6] * v[0] + m[7] * v[1] + m[8] * v[2]\r\n    ];\r\n  };\r\n\r\n  // This calculation uses Singular Value Decomposition.\r\n  // The SVD can be represented with formula A = USV. We are interested in the\r\n  // matrix S here because it represents the scale values.\r\n  Util.singularValueDecompose2dScale =\r\n    function Util_singularValueDecompose2dScale(m) {\r\n\r\n    var transpose = [m[0], m[2], m[1], m[3]];\r\n\r\n    // Multiply matrix m with its transpose.\r\n    var a = m[0] * transpose[0] + m[1] * transpose[2];\r\n    var b = m[0] * transpose[1] + m[1] * transpose[3];\r\n    var c = m[2] * transpose[0] + m[3] * transpose[2];\r\n    var d = m[2] * transpose[1] + m[3] * transpose[3];\r\n\r\n    // Solve the second degree polynomial to get roots.\r\n    var first = (a + d) / 2;\r\n    var second = Math.sqrt((a + d) * (a + d) - 4 * (a * d - c * b)) / 2;\r\n    var sx = first + second || 1;\r\n    var sy = first - second || 1;\r\n\r\n    // Scale values are the square roots of the eigenvalues.\r\n    return [Math.sqrt(sx), Math.sqrt(sy)];\r\n  };\r\n\r\n  // Normalize rectangle rect=[x1, y1, x2, y2] so that (x1,y1) < (x2,y2)\r\n  // For coordinate systems whose origin lies in the bottom-left, this\r\n  // means normalization to (BL,TR) ordering. For systems with origin in the\r\n  // top-left, this means (TL,BR) ordering.\r\n  Util.normalizeRect = function Util_normalizeRect(rect) {\r\n    var r = rect.slice(0); // clone rect\r\n    if (rect[0] > rect[2]) {\r\n      r[0] = rect[2];\r\n      r[2] = rect[0];\r\n    }\r\n    if (rect[1] > rect[3]) {\r\n      r[1] = rect[3];\r\n      r[3] = rect[1];\r\n    }\r\n    return r;\r\n  };\r\n\r\n  // Returns a rectangle [x1, y1, x2, y2] corresponding to the\r\n  // intersection of rect1 and rect2. If no intersection, returns 'false'\r\n  // The rectangle coordinates of rect1, rect2 should be [x1, y1, x2, y2]\r\n  Util.intersect = function Util_intersect(rect1, rect2) {\r\n    function compare(a, b) {\r\n      return a - b;\r\n    }\r\n\r\n    // Order points along the axes\r\n    var orderedX = [rect1[0], rect1[2], rect2[0], rect2[2]].sort(compare),\r\n        orderedY = [rect1[1], rect1[3], rect2[1], rect2[3]].sort(compare),\r\n        result = [];\r\n\r\n    rect1 = Util.normalizeRect(rect1);\r\n    rect2 = Util.normalizeRect(rect2);\r\n\r\n    // X: first and second points belong to different rectangles?\r\n    if ((orderedX[0] === rect1[0] && orderedX[1] === rect2[0]) ||\r\n        (orderedX[0] === rect2[0] && orderedX[1] === rect1[0])) {\r\n      // Intersection must be between second and third points\r\n      result[0] = orderedX[1];\r\n      result[2] = orderedX[2];\r\n    } else {\r\n      return false;\r\n    }\r\n\r\n    // Y: first and second points belong to different rectangles?\r\n    if ((orderedY[0] === rect1[1] && orderedY[1] === rect2[1]) ||\r\n        (orderedY[0] === rect2[1] && orderedY[1] === rect1[1])) {\r\n      // Intersection must be between second and third points\r\n      result[1] = orderedY[1];\r\n      result[3] = orderedY[2];\r\n    } else {\r\n      return false;\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  Util.sign = function Util_sign(num) {\r\n    return num < 0 ? -1 : 1;\r\n  };\r\n\r\n  Util.appendToArray = function Util_appendToArray(arr1, arr2) {\r\n    Array.prototype.push.apply(arr1, arr2);\r\n  };\r\n\r\n  Util.prependToArray = function Util_prependToArray(arr1, arr2) {\r\n    Array.prototype.unshift.apply(arr1, arr2);\r\n  };\r\n\r\n  Util.extendObj = function extendObj(obj1, obj2) {\r\n    for (var key in obj2) {\r\n      obj1[key] = obj2[key];\r\n    }\r\n  };\r\n\r\n  Util.getInheritableProperty = function Util_getInheritableProperty(dict,\r\n                                                                     name) {\r\n    while (dict && !dict.has(name)) {\r\n      dict = dict.get('Parent');\r\n    }\r\n    if (!dict) {\r\n      return null;\r\n    }\r\n    return dict.get(name);\r\n  };\r\n\r\n  Util.inherit = function Util_inherit(sub, base, prototype) {\r\n    sub.prototype = Object.create(base.prototype);\r\n    sub.prototype.constructor = sub;\r\n    for (var prop in prototype) {\r\n      sub.prototype[prop] = prototype[prop];\r\n    }\r\n  };\r\n\r\n  Util.loadScript = function Util_loadScript(src, callback) {\r\n    var script = document.createElement('script');\r\n    var loaded = false;\r\n    script.setAttribute('src', src);\r\n    if (callback) {\r\n      script.onload = function() {\r\n        if (!loaded) {\r\n          callback();\r\n        }\r\n        loaded = true;\r\n      };\r\n    }\r\n    document.getElementsByTagName('head')[0].appendChild(script);\r\n  };\r\n\r\n  return Util;\r\n})();\r\n\r\n/**\r\n * PDF page viewport created based on scale, rotation and offset.\r\n * @class\r\n * @alias PDFJS.PageViewport\r\n */\r\nvar PageViewport = PDFJS.PageViewport = (function PageViewportClosure() {\r\n  /**\r\n   * @constructor\r\n   * @private\r\n   * @param viewBox {Array} xMin, yMin, xMax and yMax coordinates.\r\n   * @param scale {number} scale of the viewport.\r\n   * @param rotation {number} rotations of the viewport in degrees.\r\n   * @param offsetX {number} offset X\r\n   * @param offsetY {number} offset Y\r\n   * @param dontFlip {boolean} if true, axis Y will not be flipped.\r\n   */\r\n  function PageViewport(viewBox, scale, rotation, offsetX, offsetY, dontFlip) {\r\n    this.viewBox = viewBox;\r\n    this.scale = scale;\r\n    this.rotation = rotation;\r\n    this.offsetX = offsetX;\r\n    this.offsetY = offsetY;\r\n\r\n    // creating transform to convert pdf coordinate system to the normal\r\n    // canvas like coordinates taking in account scale and rotation\r\n    var centerX = (viewBox[2] + viewBox[0]) / 2;\r\n    var centerY = (viewBox[3] + viewBox[1]) / 2;\r\n    var rotateA, rotateB, rotateC, rotateD;\r\n    rotation = rotation % 360;\r\n    rotation = rotation < 0 ? rotation + 360 : rotation;\r\n    switch (rotation) {\r\n      case 180:\r\n        rotateA = -1; rotateB = 0; rotateC = 0; rotateD = 1;\r\n        break;\r\n      case 90:\r\n        rotateA = 0; rotateB = 1; rotateC = 1; rotateD = 0;\r\n        break;\r\n      case 270:\r\n        rotateA = 0; rotateB = -1; rotateC = -1; rotateD = 0;\r\n        break;\r\n      //case 0:\r\n      default:\r\n        rotateA = 1; rotateB = 0; rotateC = 0; rotateD = -1;\r\n        break;\r\n    }\r\n\r\n    if (dontFlip) {\r\n      rotateC = -rotateC; rotateD = -rotateD;\r\n    }\r\n\r\n    var offsetCanvasX, offsetCanvasY;\r\n    var width, height;\r\n    if (rotateA === 0) {\r\n      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;\r\n      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;\r\n      width = Math.abs(viewBox[3] - viewBox[1]) * scale;\r\n      height = Math.abs(viewBox[2] - viewBox[0]) * scale;\r\n    } else {\r\n      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;\r\n      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;\r\n      width = Math.abs(viewBox[2] - viewBox[0]) * scale;\r\n      height = Math.abs(viewBox[3] - viewBox[1]) * scale;\r\n    }\r\n    // creating transform for the following operations:\r\n    // translate(-centerX, -centerY), rotate and flip vertically,\r\n    // scale, and translate(offsetCanvasX, offsetCanvasY)\r\n    this.transform = [\r\n      rotateA * scale,\r\n      rotateB * scale,\r\n      rotateC * scale,\r\n      rotateD * scale,\r\n      offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,\r\n      offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY\r\n    ];\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n    this.fontScale = scale;\r\n  }\r\n  PageViewport.prototype = /** @lends PDFJS.PageViewport.prototype */ {\r\n    /**\r\n     * Clones viewport with additional properties.\r\n     * @param args {Object} (optional) If specified, may contain the 'scale' or\r\n     * 'rotation' properties to override the corresponding properties in\r\n     * the cloned viewport.\r\n     * @returns {PDFJS.PageViewport} Cloned viewport.\r\n     */\r\n    clone: function PageViewPort_clone(args) {\r\n      args = args || {};\r\n      var scale = 'scale' in args ? args.scale : this.scale;\r\n      var rotation = 'rotation' in args ? args.rotation : this.rotation;\r\n      return new PageViewport(this.viewBox.slice(), scale, rotation,\r\n                              this.offsetX, this.offsetY, args.dontFlip);\r\n    },\r\n    /**\r\n     * Converts PDF point to the viewport coordinates. For examples, useful for\r\n     * converting PDF location into canvas pixel coordinates.\r\n     * @param x {number} X coordinate.\r\n     * @param y {number} Y coordinate.\r\n     * @returns {Object} Object that contains 'x' and 'y' properties of the\r\n     * point in the viewport coordinate space.\r\n     * @see {@link convertToPdfPoint}\r\n     * @see {@link convertToViewportRectangle}\r\n     */\r\n    convertToViewportPoint: function PageViewport_convertToViewportPoint(x, y) {\r\n      return Util.applyTransform([x, y], this.transform);\r\n    },\r\n    /**\r\n     * Converts PDF rectangle to the viewport coordinates.\r\n     * @param rect {Array} xMin, yMin, xMax and yMax coordinates.\r\n     * @returns {Array} Contains corresponding coordinates of the rectangle\r\n     * in the viewport coordinate space.\r\n     * @see {@link convertToViewportPoint}\r\n     */\r\n    convertToViewportRectangle:\r\n      function PageViewport_convertToViewportRectangle(rect) {\r\n      var tl = Util.applyTransform([rect[0], rect[1]], this.transform);\r\n      var br = Util.applyTransform([rect[2], rect[3]], this.transform);\r\n      return [tl[0], tl[1], br[0], br[1]];\r\n    },\r\n    /**\r\n     * Converts viewport coordinates to the PDF location. For examples, useful\r\n     * for converting canvas pixel location into PDF one.\r\n     * @param x {number} X coordinate.\r\n     * @param y {number} Y coordinate.\r\n     * @returns {Object} Object that contains 'x' and 'y' properties of the\r\n     * point in the PDF coordinate space.\r\n     * @see {@link convertToViewportPoint}\r\n     */\r\n    convertToPdfPoint: function PageViewport_convertToPdfPoint(x, y) {\r\n      return Util.applyInverseTransform([x, y], this.transform);\r\n    }\r\n  };\r\n  return PageViewport;\r\n})();\r\n\r\nvar PDFStringTranslateTable = [\r\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n  0x2D8, 0x2C7, 0x2C6, 0x2D9, 0x2DD, 0x2DB, 0x2DA, 0x2DC, 0, 0, 0, 0, 0, 0, 0,\r\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014,\r\n  0x2013, 0x192, 0x2044, 0x2039, 0x203A, 0x2212, 0x2030, 0x201E, 0x201C,\r\n  0x201D, 0x2018, 0x2019, 0x201A, 0x2122, 0xFB01, 0xFB02, 0x141, 0x152, 0x160,\r\n  0x178, 0x17D, 0x131, 0x142, 0x153, 0x161, 0x17E, 0, 0x20AC\r\n];\r\n\r\nfunction stringToPDFString(str) {\r\n  var i, n = str.length, strBuf = [];\r\n  if (str[0] === '\\xFE' && str[1] === '\\xFF') {\r\n    // UTF16BE BOM\r\n    for (i = 2; i < n; i += 2) {\r\n      strBuf.push(String.fromCharCode(\r\n        (str.charCodeAt(i) << 8) | str.charCodeAt(i + 1)));\r\n    }\r\n  } else {\r\n    for (i = 0; i < n; ++i) {\r\n      var code = PDFStringTranslateTable[str.charCodeAt(i)];\r\n      strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));\r\n    }\r\n  }\r\n  return strBuf.join('');\r\n}\r\n\r\nfunction stringToUTF8String(str) {\r\n  return decodeURIComponent(escape(str));\r\n}\r\n\r\nfunction isEmptyObj(obj) {\r\n  for (var key in obj) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction isBool(v) {\r\n  return typeof v === 'boolean';\r\n}\r\n\r\nfunction isInt(v) {\r\n  return typeof v === 'number' && ((v | 0) === v);\r\n}\r\n\r\nfunction isNum(v) {\r\n  return typeof v === 'number';\r\n}\r\n\r\nfunction isString(v) {\r\n  return typeof v === 'string';\r\n}\r\n\r\nfunction isNull(v) {\r\n  return v === null;\r\n}\r\n\r\nfunction isName(v) {\r\n  return v instanceof Name;\r\n}\r\n\r\nfunction isCmd(v, cmd) {\r\n  return v instanceof Cmd && (cmd === undefined || v.cmd === cmd);\r\n}\r\n\r\nfunction isDict(v, type) {\r\n  if (!(v instanceof Dict)) {\r\n    return false;\r\n  }\r\n  if (!type) {\r\n    return true;\r\n  }\r\n  var dictType = v.get('Type');\r\n  return isName(dictType) && dictType.name === type;\r\n}\r\n\r\nfunction isArray(v) {\r\n  return v instanceof Array;\r\n}\r\n\r\nfunction isStream(v) {\r\n  return typeof v === 'object' && v !== null && v.getBytes !== undefined;\r\n}\r\n\r\nfunction isArrayBuffer(v) {\r\n  return typeof v === 'object' && v !== null && v.byteLength !== undefined;\r\n}\r\n\r\nfunction isRef(v) {\r\n  return v instanceof Ref;\r\n}\r\n\r\n/**\r\n * Promise Capability object.\r\n *\r\n * @typedef {Object} PromiseCapability\r\n * @property {Promise} promise - A promise object.\r\n * @property {function} resolve - Fullfills the promise.\r\n * @property {function} reject - Rejects the promise.\r\n */\r\n\r\n/**\r\n * Creates a promise capability object.\r\n * @alias PDFJS.createPromiseCapability\r\n *\r\n * @return {PromiseCapability} A capability object contains:\r\n * - a Promise, resolve and reject methods.\r\n */\r\nfunction createPromiseCapability() {\r\n  var capability = {};\r\n  capability.promise = new Promise(function (resolve, reject) {\r\n    capability.resolve = resolve;\r\n    capability.reject = reject;\r\n  });\r\n  return capability;\r\n}\r\n\r\nPDFJS.createPromiseCapability = createPromiseCapability;\r\n\r\n/**\r\n * Polyfill for Promises:\r\n * The following promise implementation tries to generally implement the\r\n * Promise/A+ spec. Some notable differences from other promise libaries are:\r\n * - There currently isn't a seperate deferred and promise object.\r\n * - Unhandled rejections eventually show an error if they aren't handled.\r\n *\r\n * Based off of the work in:\r\n * https://bugzilla.mozilla.org/show_bug.cgi?id=810490\r\n */\r\n(function PromiseClosure() {\r\n  if (globalScope.Promise) {\r\n    // Promises existing in the DOM/Worker, checking presence of all/resolve\r\n    if (typeof globalScope.Promise.all !== 'function') {\r\n      globalScope.Promise.all = function (iterable) {\r\n        var count = 0, results = [], resolve, reject;\r\n        var promise = new globalScope.Promise(function (resolve_, reject_) {\r\n          resolve = resolve_;\r\n          reject = reject_;\r\n        });\r\n        iterable.forEach(function (p, i) {\r\n          count++;\r\n          p.then(function (result) {\r\n            results[i] = result;\r\n            count--;\r\n            if (count === 0) {\r\n              resolve(results);\r\n            }\r\n          }, reject);\r\n        });\r\n        if (count === 0) {\r\n          resolve(results);\r\n        }\r\n        return promise;\r\n      };\r\n    }\r\n    if (typeof globalScope.Promise.resolve !== 'function') {\r\n      globalScope.Promise.resolve = function (value) {\r\n        return new globalScope.Promise(function (resolve) { resolve(value); });\r\n      };\r\n    }\r\n    if (typeof globalScope.Promise.reject !== 'function') {\r\n      globalScope.Promise.reject = function (reason) {\r\n        return new globalScope.Promise(function (resolve, reject) {\r\n          reject(reason);\r\n        });\r\n      };\r\n    }\r\n    if (typeof globalScope.Promise.prototype.catch !== 'function') {\r\n      globalScope.Promise.prototype.catch = function (onReject) {\r\n        return globalScope.Promise.prototype.then(undefined, onReject);\r\n      };\r\n    }\r\n    return;\r\n  }\r\n//#if !MOZCENTRAL\r\n  var STATUS_PENDING = 0;\r\n  var STATUS_RESOLVED = 1;\r\n  var STATUS_REJECTED = 2;\r\n\r\n  // In an attempt to avoid silent exceptions, unhandled rejections are\r\n  // tracked and if they aren't handled in a certain amount of time an\r\n  // error is logged.\r\n  var REJECTION_TIMEOUT = 500;\r\n\r\n  var HandlerManager = {\r\n    handlers: [],\r\n    running: false,\r\n    unhandledRejections: [],\r\n    pendingRejectionCheck: false,\r\n\r\n    scheduleHandlers: function scheduleHandlers(promise) {\r\n      if (promise._status === STATUS_PENDING) {\r\n        return;\r\n      }\r\n\r\n      this.handlers = this.handlers.concat(promise._handlers);\r\n      promise._handlers = [];\r\n\r\n      if (this.running) {\r\n        return;\r\n      }\r\n      this.running = true;\r\n\r\n      setTimeout(this.runHandlers.bind(this), 0);\r\n    },\r\n\r\n    runHandlers: function runHandlers() {\r\n      var RUN_TIMEOUT = 1; // ms\r\n      var timeoutAt = Date.now() + RUN_TIMEOUT;\r\n      while (this.handlers.length > 0) {\r\n        var handler = this.handlers.shift();\r\n\r\n        var nextStatus = handler.thisPromise._status;\r\n        var nextValue = handler.thisPromise._value;\r\n\r\n        try {\r\n          if (nextStatus === STATUS_RESOLVED) {\r\n            if (typeof handler.onResolve === 'function') {\r\n              nextValue = handler.onResolve(nextValue);\r\n            }\r\n          } else if (typeof handler.onReject === 'function') {\r\n              nextValue = handler.onReject(nextValue);\r\n              nextStatus = STATUS_RESOLVED;\r\n\r\n              if (handler.thisPromise._unhandledRejection) {\r\n                this.removeUnhandeledRejection(handler.thisPromise);\r\n              }\r\n          }\r\n        } catch (ex) {\r\n          nextStatus = STATUS_REJECTED;\r\n          nextValue = ex;\r\n        }\r\n\r\n        handler.nextPromise._updateStatus(nextStatus, nextValue);\r\n        if (Date.now() >= timeoutAt) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (this.handlers.length > 0) {\r\n        setTimeout(this.runHandlers.bind(this), 0);\r\n        return;\r\n      }\r\n\r\n      this.running = false;\r\n    },\r\n\r\n    addUnhandledRejection: function addUnhandledRejection(promise) {\r\n      this.unhandledRejections.push({\r\n        promise: promise,\r\n        time: Date.now()\r\n      });\r\n      this.scheduleRejectionCheck();\r\n    },\r\n\r\n    removeUnhandeledRejection: function removeUnhandeledRejection(promise) {\r\n      promise._unhandledRejection = false;\r\n      for (var i = 0; i < this.unhandledRejections.length; i++) {\r\n        if (this.unhandledRejections[i].promise === promise) {\r\n          this.unhandledRejections.splice(i);\r\n          i--;\r\n        }\r\n      }\r\n    },\r\n\r\n    scheduleRejectionCheck: function scheduleRejectionCheck() {\r\n      if (this.pendingRejectionCheck) {\r\n        return;\r\n      }\r\n      this.pendingRejectionCheck = true;\r\n      setTimeout(function rejectionCheck() {\r\n        this.pendingRejectionCheck = false;\r\n        var now = Date.now();\r\n        for (var i = 0; i < this.unhandledRejections.length; i++) {\r\n          if (now - this.unhandledRejections[i].time > REJECTION_TIMEOUT) {\r\n            var unhandled = this.unhandledRejections[i].promise._value;\r\n            var msg = 'Unhandled rejection: ' + unhandled;\r\n            if (unhandled.stack) {\r\n              msg += '\\n' + unhandled.stack;\r\n            }\r\n            warn(msg);\r\n            this.unhandledRejections.splice(i);\r\n            i--;\r\n          }\r\n        }\r\n        if (this.unhandledRejections.length) {\r\n          this.scheduleRejectionCheck();\r\n        }\r\n      }.bind(this), REJECTION_TIMEOUT);\r\n    }\r\n  };\r\n\r\n  function Promise(resolver) {\r\n    this._status = STATUS_PENDING;\r\n    this._handlers = [];\r\n    try {\r\n      resolver.call(this, this._resolve.bind(this), this._reject.bind(this));\r\n    } catch (e) {\r\n      this._reject(e);\r\n    }\r\n  }\r\n  /**\r\n   * Builds a promise that is resolved when all the passed in promises are\r\n   * resolved.\r\n   * @param {array} array of data and/or promises to wait for.\r\n   * @return {Promise} New dependant promise.\r\n   */\r\n  Promise.all = function Promise_all(promises) {\r\n    var resolveAll, rejectAll;\r\n    var deferred = new Promise(function (resolve, reject) {\r\n      resolveAll = resolve;\r\n      rejectAll = reject;\r\n    });\r\n    var unresolved = promises.length;\r\n    var results = [];\r\n    if (unresolved === 0) {\r\n      resolveAll(results);\r\n      return deferred;\r\n    }\r\n    function reject(reason) {\r\n      if (deferred._status === STATUS_REJECTED) {\r\n        return;\r\n      }\r\n      results = [];\r\n      rejectAll(reason);\r\n    }\r\n    for (var i = 0, ii = promises.length; i < ii; ++i) {\r\n      var promise = promises[i];\r\n      var resolve = (function(i) {\r\n        return function(value) {\r\n          if (deferred._status === STATUS_REJECTED) {\r\n            return;\r\n          }\r\n          results[i] = value;\r\n          unresolved--;\r\n          if (unresolved === 0) {\r\n            resolveAll(results);\r\n          }\r\n        };\r\n      })(i);\r\n      if (Promise.isPromise(promise)) {\r\n        promise.then(resolve, reject);\r\n      } else {\r\n        resolve(promise);\r\n      }\r\n    }\r\n    return deferred;\r\n  };\r\n\r\n  /**\r\n   * Checks if the value is likely a promise (has a 'then' function).\r\n   * @return {boolean} true if value is thenable\r\n   */\r\n  Promise.isPromise = function Promise_isPromise(value) {\r\n    return value && typeof value.then === 'function';\r\n  };\r\n\r\n  /**\r\n   * Creates resolved promise\r\n   * @param value resolve value\r\n   * @returns {Promise}\r\n   */\r\n  Promise.resolve = function Promise_resolve(value) {\r\n    return new Promise(function (resolve) { resolve(value); });\r\n  };\r\n\r\n  /**\r\n   * Creates rejected promise\r\n   * @param reason rejection value\r\n   * @returns {Promise}\r\n   */\r\n  Promise.reject = function Promise_reject(reason) {\r\n    return new Promise(function (resolve, reject) { reject(reason); });\r\n  };\r\n\r\n  Promise.prototype = {\r\n    _status: null,\r\n    _value: null,\r\n    _handlers: null,\r\n    _unhandledRejection: null,\r\n\r\n    _updateStatus: function Promise__updateStatus(status, value) {\r\n      if (this._status === STATUS_RESOLVED ||\r\n          this._status === STATUS_REJECTED) {\r\n        return;\r\n      }\r\n\r\n      if (status === STATUS_RESOLVED &&\r\n          Promise.isPromise(value)) {\r\n        value.then(this._updateStatus.bind(this, STATUS_RESOLVED),\r\n                   this._updateStatus.bind(this, STATUS_REJECTED));\r\n        return;\r\n      }\r\n\r\n      this._status = status;\r\n      this._value = value;\r\n\r\n      if (status === STATUS_REJECTED && this._handlers.length === 0) {\r\n        this._unhandledRejection = true;\r\n        HandlerManager.addUnhandledRejection(this);\r\n      }\r\n\r\n      HandlerManager.scheduleHandlers(this);\r\n    },\r\n\r\n    _resolve: function Promise_resolve(value) {\r\n      this._updateStatus(STATUS_RESOLVED, value);\r\n    },\r\n\r\n    _reject: function Promise_reject(reason) {\r\n      this._updateStatus(STATUS_REJECTED, reason);\r\n    },\r\n\r\n    then: function Promise_then(onResolve, onReject) {\r\n      var nextPromise = new Promise(function (resolve, reject) {\r\n        this.resolve = resolve;\r\n        this.reject = reject;\r\n      });\r\n      this._handlers.push({\r\n        thisPromise: this,\r\n        onResolve: onResolve,\r\n        onReject: onReject,\r\n        nextPromise: nextPromise\r\n      });\r\n      HandlerManager.scheduleHandlers(this);\r\n      return nextPromise;\r\n    },\r\n\r\n    catch: function Promise_catch(onReject) {\r\n      return this.then(undefined, onReject);\r\n    }\r\n  };\r\n\r\n  globalScope.Promise = Promise;\r\n//#else\r\n//throw new Error('DOM Promise is not present');\r\n//#endif\r\n})();\r\n\r\nvar StatTimer = (function StatTimerClosure() {\r\n  function rpad(str, pad, length) {\r\n    while (str.length < length) {\r\n      str += pad;\r\n    }\r\n    return str;\r\n  }\r\n  function StatTimer() {\r\n    this.started = {};\r\n    this.times = [];\r\n    this.enabled = true;\r\n  }\r\n  StatTimer.prototype = {\r\n    time: function StatTimer_time(name) {\r\n      if (!this.enabled) {\r\n        return;\r\n      }\r\n      if (name in this.started) {\r\n        warn('Timer is already running for ' + name);\r\n      }\r\n      this.started[name] = Date.now();\r\n    },\r\n    timeEnd: function StatTimer_timeEnd(name) {\r\n      if (!this.enabled) {\r\n        return;\r\n      }\r\n      if (!(name in this.started)) {\r\n        warn('Timer has not been started for ' + name);\r\n      }\r\n      this.times.push({\r\n        'name': name,\r\n        'start': this.started[name],\r\n        'end': Date.now()\r\n      });\r\n      // Remove timer from started so it can be called again.\r\n      delete this.started[name];\r\n    },\r\n    toString: function StatTimer_toString() {\r\n      var i, ii;\r\n      var times = this.times;\r\n      var out = '';\r\n      // Find the longest name for padding purposes.\r\n      var longest = 0;\r\n      for (i = 0, ii = times.length; i < ii; ++i) {\r\n        var name = times[i]['name'];\r\n        if (name.length > longest) {\r\n          longest = name.length;\r\n        }\r\n      }\r\n      for (i = 0, ii = times.length; i < ii; ++i) {\r\n        var span = times[i];\r\n        var duration = span.end - span.start;\r\n        out += rpad(span['name'], ' ', longest) + ' ' + duration + 'ms\\n';\r\n      }\r\n      return out;\r\n    }\r\n  };\r\n  return StatTimer;\r\n})();\r\n\r\nPDFJS.createBlob = function createBlob(data, contentType) {\r\n  if (typeof Blob !== 'undefined') {\r\n    return new Blob([data], { type: contentType });\r\n  }\r\n  // Blob builder is deprecated in FF14 and removed in FF18.\r\n  var bb = new MozBlobBuilder();\r\n  bb.append(data);\r\n  return bb.getBlob(contentType);\r\n};\r\n\r\nPDFJS.createObjectURL = (function createObjectURLClosure() {\r\n  // Blob/createObjectURL is not available, falling back to data schema.\r\n  var digits =\r\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n\r\n  return function createObjectURL(data, contentType) {\r\n    if (!PDFJS.disableCreateObjectURL &&\r\n        typeof URL !== 'undefined' && URL.createObjectURL) {\r\n      var blob = PDFJS.createBlob(data, contentType);\r\n      return URL.createObjectURL(blob);\r\n    }\r\n\r\n    var buffer = 'data:' + contentType + ';base64,';\r\n    for (var i = 0, ii = data.length; i < ii; i += 3) {\r\n      var b1 = data[i] & 0xFF;\r\n      var b2 = data[i + 1] & 0xFF;\r\n      var b3 = data[i + 2] & 0xFF;\r\n      var d1 = b1 >> 2, d2 = ((b1 & 3) << 4) | (b2 >> 4);\r\n      var d3 = i + 1 < ii ? ((b2 & 0xF) << 2) | (b3 >> 6) : 64;\r\n      var d4 = i + 2 < ii ? (b3 & 0x3F) : 64;\r\n      buffer += digits[d1] + digits[d2] + digits[d3] + digits[d4];\r\n    }\r\n    return buffer;\r\n  };\r\n})();\r\n\r\nfunction MessageHandler(name, comObj) {\r\n  this.name = name;\r\n  this.comObj = comObj;\r\n  this.callbackIndex = 1;\r\n  this.postMessageTransfers = true;\r\n  var callbacksCapabilities = this.callbacksCapabilities = {};\r\n  var ah = this.actionHandler = {};\r\n\r\n  ah['console_log'] = [function ahConsoleLog(data) {\r\n    console.log.apply(console, data);\r\n  }];\r\n  ah['console_error'] = [function ahConsoleError(data) {\r\n    console.error.apply(console, data);\r\n  }];\r\n  ah['_unsupported_feature'] = [function ah_unsupportedFeature(data) {\r\n    UnsupportedManager.notify(data);\r\n  }];\r\n\r\n  comObj.onmessage = function messageHandlerComObjOnMessage(event) {\r\n    var data = event.data;\r\n    if (data.isReply) {\r\n      var callbackId = data.callbackId;\r\n      if (data.callbackId in callbacksCapabilities) {\r\n        var callback = callbacksCapabilities[callbackId];\r\n        delete callbacksCapabilities[callbackId];\r\n        if ('error' in data) {\r\n          callback.reject(data.error);\r\n        } else {\r\n          callback.resolve(data.data);\r\n        }\r\n      } else {\r\n        error('Cannot resolve callback ' + callbackId);\r\n      }\r\n    } else if (data.action in ah) {\r\n      var action = ah[data.action];\r\n      if (data.callbackId) {\r\n        Promise.resolve().then(function () {\r\n          return action[0].call(action[1], data.data);\r\n        }).then(function (result) {\r\n          comObj.postMessage({\r\n            isReply: true,\r\n            callbackId: data.callbackId,\r\n            data: result\r\n          });\r\n        }, function (reason) {\r\n          comObj.postMessage({\r\n            isReply: true,\r\n            callbackId: data.callbackId,\r\n            error: reason\r\n          });\r\n        });\r\n      } else {\r\n        action[0].call(action[1], data.data);\r\n      }\r\n    } else {\r\n      error('Unknown action from worker: ' + data.action);\r\n    }\r\n  };\r\n}\r\n\r\nMessageHandler.prototype = {\r\n  on: function messageHandlerOn(actionName, handler, scope) {\r\n    var ah = this.actionHandler;\r\n    if (ah[actionName]) {\r\n      error('There is already an actionName called \"' + actionName + '\"');\r\n    }\r\n    ah[actionName] = [handler, scope];\r\n  },\r\n  /**\r\n   * Sends a message to the comObj to invoke the action with the supplied data.\r\n   * @param {String} actionName Action to call.\r\n   * @param {JSON} data JSON data to send.\r\n   * @param {Array} [transfers] Optional list of transfers/ArrayBuffers\r\n   */\r\n  send: function messageHandlerSend(actionName, data, transfers) {\r\n    var message = {\r\n      action: actionName,\r\n      data: data\r\n    };\r\n    this.postMessage(message, transfers);\r\n  },\r\n  /**\r\n   * Sends a message to the comObj to invoke the action with the supplied data.\r\n   * Expects that other side will callback with the response.\r\n   * @param {String} actionName Action to call.\r\n   * @param {JSON} data JSON data to send.\r\n   * @param {Array} [transfers] Optional list of transfers/ArrayBuffers.\r\n   * @returns {Promise} Promise to be resolved with response data.\r\n   */\r\n  sendWithPromise:\r\n    function messageHandlerSendWithPromise(actionName, data, transfers) {\r\n    var callbackId = this.callbackIndex++;\r\n    var message = {\r\n      action: actionName,\r\n      data: data,\r\n      callbackId: callbackId\r\n    };\r\n    var capability = createPromiseCapability();\r\n    this.callbacksCapabilities[callbackId] = capability;\r\n    try {\r\n      this.postMessage(message, transfers);\r\n    } catch (e) {\r\n      capability.reject(e);\r\n    }\r\n    return capability.promise;\r\n  },\r\n  /**\r\n   * Sends raw message to the comObj.\r\n   * @private\r\n   * @param message {Object} Raw message.\r\n   * @param transfers List of transfers/ArrayBuffers, or undefined.\r\n   */\r\n  postMessage: function (message, transfers) {\r\n    if (transfers && this.postMessageTransfers) {\r\n      this.comObj.postMessage(message, transfers);\r\n    } else {\r\n      this.comObj.postMessage(message);\r\n    }\r\n  }\r\n};\r\n\r\nfunction loadJpegStream(id, imageUrl, objs) {\r\n  var img = new Image();\r\n  img.onload = (function loadJpegStream_onloadClosure() {\r\n    objs.resolve(id, img);\r\n  });\r\n  img.onerror = (function loadJpegStream_onerrorClosure() {\r\n    objs.resolve(id, null);\r\n    warn('Error during JPEG image loading');\r\n  });\r\n  img.src = imageUrl;\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/jpx.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 79,
    "kind": "variable",
    "name": "JpxImage",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~JpxImage",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 23,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 80,
    "kind": "variable",
    "name": "ArithmeticDecoder",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~ArithmeticDecoder",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2299,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 81,
    "kind": "variable",
    "name": "globalScope",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~globalScope",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2479,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 82,
    "kind": "variable",
    "name": "isWorker",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~isWorker",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2481,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 83,
    "kind": "variable",
    "name": "FONT_IDENTITY_MATRIX",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~FONT_IDENTITY_MATRIX",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2483,
    "undocument": true,
    "type": {
      "types": [
        "number[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 84,
    "kind": "variable",
    "name": "TextRenderingMode",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~TextRenderingMode",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2485,
    "undocument": true,
    "type": {
      "types": [
        "{\"FILL\": *, \"STROKE\": number, \"FILL_STROKE\": number, \"INVISIBLE\": number, \"FILL_ADD_TO_PATH\": number, \"STROKE_ADD_TO_PATH\": number, \"FILL_STROKE_ADD_TO_PATH\": number, \"ADD_TO_PATH\": number, \"FILL_STROKE_MASK\": number, \"ADD_TO_PATH_FLAG\": number}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 85,
    "kind": "variable",
    "name": "ImageKind",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~ImageKind",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2498,
    "undocument": true,
    "type": {
      "types": [
        "{\"GRAYSCALE_1BPP\": number, \"RGB_24BPP\": number, \"RGBA_32BPP\": number}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 86,
    "kind": "variable",
    "name": "AnnotationType",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~AnnotationType",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2504,
    "undocument": true,
    "type": {
      "types": [
        "{\"WIDGET\": number, \"TEXT\": number, \"LINK\": number}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 87,
    "kind": "variable",
    "name": "StreamType",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~StreamType",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2510,
    "undocument": true,
    "type": {
      "types": [
        "{\"UNKNOWN\": *, \"FLATE\": number, \"LZW\": number, \"DCT\": number, \"JPX\": number, \"JBIG\": number, \"A85\": number, \"AHX\": number, \"CCF\": number, \"RL\": number}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 88,
    "kind": "variable",
    "name": "FontType",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~FontType",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2523,
    "undocument": true,
    "type": {
      "types": [
        "{\"UNKNOWN\": *, \"TYPE1\": number, \"TYPE1C\": number, \"CIDFONTTYPE0\": number, \"CIDFONTTYPE0C\": number, \"TRUETYPE\": number, \"CIDFONTTYPE2\": number, \"TYPE3\": number, \"OPENTYPE\": number, \"TYPE0\": number, \"MMTYPE1\": number}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 89,
    "kind": "variable",
    "name": "OPS",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~OPS",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2553,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 90,
    "kind": "function",
    "name": "info",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~info",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2652,
    "undocument": true,
    "params": [
      {
        "name": "msg",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 91,
    "kind": "function",
    "name": "warn",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~warn",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2659,
    "undocument": true,
    "params": [
      {
        "name": "msg",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 92,
    "kind": "function",
    "name": "error",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~error",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2667,
    "undocument": true,
    "params": [
      {
        "name": "msg",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 93,
    "kind": "function",
    "name": "backtrace",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~backtrace",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2683,
    "undocument": true,
    "params": [],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 94,
    "kind": "function",
    "name": "assert",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~assert",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2691,
    "undocument": true,
    "params": [
      {
        "name": "cond",
        "types": [
          "*"
        ]
      },
      {
        "name": "msg",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 95,
    "kind": "variable",
    "name": "UNSUPPORTED_FEATURES",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~UNSUPPORTED_FEATURES",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2697,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 96,
    "kind": "variable",
    "name": "UnsupportedManager",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~UnsupportedManager",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2706,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 97,
    "kind": "function",
    "name": "combineUrl",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~combineUrl",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2724,
    "undocument": true,
    "params": [
      {
        "name": "baseUrl",
        "types": [
          "*"
        ]
      },
      {
        "name": "url",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 98,
    "kind": "function",
    "name": "isValidUrl",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isValidUrl",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2754,
    "undocument": true,
    "params": [
      {
        "name": "url",
        "types": [
          "*"
        ]
      },
      {
        "name": "allowRelative",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "boolean"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 99,
    "kind": "function",
    "name": "shadow",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~shadow",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2778,
    "undocument": true,
    "params": [
      {
        "name": "obj",
        "types": [
          "*"
        ]
      },
      {
        "name": "prop",
        "types": [
          "*"
        ]
      },
      {
        "name": "value",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 100,
    "kind": "variable",
    "name": "PasswordResponses",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~PasswordResponses",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2787,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 101,
    "kind": "variable",
    "name": "PasswordException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~PasswordException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2792,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 102,
    "kind": "variable",
    "name": "UnknownErrorException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~UnknownErrorException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2806,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 103,
    "kind": "variable",
    "name": "InvalidPDFException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~InvalidPDFException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2820,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 104,
    "kind": "variable",
    "name": "MissingPDFException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~MissingPDFException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2833,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 105,
    "kind": "variable",
    "name": "UnexpectedResponseException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~UnexpectedResponseException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2846,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 106,
    "kind": "variable",
    "name": "NotImplementedException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~NotImplementedException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2861,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 107,
    "kind": "variable",
    "name": "MissingDataException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~MissingDataException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2873,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 108,
    "kind": "variable",
    "name": "XRefParseException",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~XRefParseException",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2887,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 109,
    "kind": "function",
    "name": "bytesToString",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~bytesToString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2900,
    "undocument": true,
    "params": [
      {
        "name": "bytes",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 110,
    "kind": "function",
    "name": "stringToBytes",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~stringToBytes",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2917,
    "undocument": true,
    "params": [
      {
        "name": "str",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 111,
    "kind": "function",
    "name": "string32",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~string32",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2927,
    "undocument": true,
    "params": [
      {
        "name": "value",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 112,
    "kind": "function",
    "name": "log2",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~log2",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2932,
    "undocument": true,
    "params": [
      {
        "name": "x",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 113,
    "kind": "function",
    "name": "readInt8",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~readInt8",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2941,
    "undocument": true,
    "params": [
      {
        "name": "data",
        "types": [
          "*"
        ]
      },
      {
        "name": "start",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 114,
    "kind": "function",
    "name": "readUint16",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~readUint16",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2945,
    "undocument": true,
    "params": [
      {
        "name": "data",
        "types": [
          "*"
        ]
      },
      {
        "name": "offset",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 115,
    "kind": "function",
    "name": "readUint32",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~readUint32",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2949,
    "undocument": true,
    "params": [
      {
        "name": "data",
        "types": [
          "*"
        ]
      },
      {
        "name": "offset",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 116,
    "kind": "function",
    "name": "isLittleEndian",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isLittleEndian",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2956,
    "undocument": true,
    "params": [],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 117,
    "kind": "function",
    "name": "hasCanvasTypedArrays",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~hasCanvasTypedArrays",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2972,
    "undocument": true,
    "params": [],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 118,
    "kind": "variable",
    "name": "Uint32ArrayView",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~Uint32ArrayView",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2987,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 119,
    "kind": "variable",
    "name": "IDENTITY_MATRIX",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~IDENTITY_MATRIX",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3030,
    "undocument": true,
    "type": {
      "types": [
        "number[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 120,
    "kind": "variable",
    "name": "Util",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~Util",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3032,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 121,
    "kind": "variable",
    "name": "PageViewport",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~PageViewport",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": "PDF page viewport created based on scale, rotation and offset.",
    "lineNumber": 3249,
    "unknown": [
      {
        "tagName": "@class",
        "tagValue": ""
      },
      {
        "tagName": "@alias",
        "tagValue": "PDFJS.PageViewport"
      }
    ],
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 122,
    "kind": "variable",
    "name": "PDFStringTranslateTable",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~PDFStringTranslateTable",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3380,
    "undocument": true,
    "type": {
      "types": [
        "number[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 123,
    "kind": "function",
    "name": "stringToPDFString",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~stringToPDFString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3392,
    "undocument": true,
    "params": [
      {
        "name": "str",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 124,
    "kind": "function",
    "name": "stringToUTF8String",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~stringToUTF8String",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3409,
    "undocument": true,
    "params": [
      {
        "name": "str",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 125,
    "kind": "function",
    "name": "isEmptyObj",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isEmptyObj",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3413,
    "undocument": true,
    "params": [
      {
        "name": "obj",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "boolean"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 126,
    "kind": "function",
    "name": "isBool",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isBool",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3420,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 127,
    "kind": "function",
    "name": "isInt",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isInt",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3424,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 128,
    "kind": "function",
    "name": "isNum",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isNum",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3428,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 129,
    "kind": "function",
    "name": "isString",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3432,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 130,
    "kind": "function",
    "name": "isNull",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isNull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3436,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 131,
    "kind": "function",
    "name": "isName",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3440,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 132,
    "kind": "function",
    "name": "isCmd",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isCmd",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3444,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      },
      {
        "name": "cmd",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 133,
    "kind": "function",
    "name": "isDict",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isDict",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3448,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      },
      {
        "name": "type",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 134,
    "kind": "function",
    "name": "isArray",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isArray",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3459,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 135,
    "kind": "function",
    "name": "isStream",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isStream",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3463,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 136,
    "kind": "function",
    "name": "isArrayBuffer",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isArrayBuffer",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3467,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 137,
    "kind": "function",
    "name": "isRef",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~isRef",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3471,
    "undocument": true,
    "params": [
      {
        "name": "v",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 138,
    "kind": "typedef",
    "name": "PromiseCapability",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~PromiseCapability",
    "access": "public",
    "description": "Promise Capability object.",
    "properties": [
      {
        "nullable": null,
        "types": [
          "Promise"
        ],
        "spread": false,
        "optional": false,
        "name": "promise",
        "description": "A promise object."
      },
      {
        "nullable": null,
        "types": [
          "function"
        ],
        "spread": false,
        "optional": false,
        "name": "resolve",
        "description": "Fullfills the promise."
      },
      {
        "nullable": null,
        "types": [
          "function"
        ],
        "spread": false,
        "optional": false,
        "name": "reject",
        "description": "Rejects the promise."
      }
    ],
    "type": {
      "types": [
        "Object"
      ],
      "optional": false,
      "name": "PromiseCapability"
    }
  },
  {
    "__docId__": 139,
    "kind": "function",
    "name": "createPromiseCapability",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~createPromiseCapability",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": "Creates a promise capability object.",
    "lineNumber": 3491,
    "unknown": [
      {
        "tagName": "@alias",
        "tagValue": "PDFJS.createPromiseCapability"
      }
    ],
    "return": {
      "nullable": null,
      "types": [
        "PromiseCapability"
      ],
      "spread": false,
      "description": "A capability object contains:\n- a Promise, resolve and reject methods."
    },
    "params": [],
    "ignore": true
  },
  {
    "__docId__": 140,
    "kind": "variable",
    "name": "StatTimer",
    "memberof": "src/client/lib/jpx.js",
    "static": true,
    "longname": "src/client/lib/jpx.js~StatTimer",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3822,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 141,
    "kind": "function",
    "name": "createBlob",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~createBlob",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3882,
    "undocument": true,
    "params": [
      {
        "name": "data",
        "types": [
          "*"
        ]
      },
      {
        "name": "contentType",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 142,
    "kind": "function",
    "name": "MessageHandler",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~MessageHandler",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3918,
    "undocument": true,
    "params": [
      {
        "name": "name",
        "types": [
          "*"
        ]
      },
      {
        "name": "comObj",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 143,
    "kind": "function",
    "name": "loadJpegStream",
    "memberof": "src/client/lib/jpx.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/lib/jpx.js~loadJpegStream",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/lib/jpx.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4039,
    "undocument": true,
    "params": [
      {
        "name": "id",
        "types": [
          "*"
        ]
      },
      {
        "name": "imageUrl",
        "types": [
          "*"
        ]
      },
      {
        "name": "objs",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 144,
    "kind": "file",
    "name": "src/client/lib/jquery-ui.min.js",
    "content": "/*! jQuery UI - v1.11.4 - 2015-06-26\r\n* http://jqueryui.com\r\n* Includes: core.js, widget.js, mouse.js, draggable.js, droppable.js\r\n* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */\r\n\r\n(function(e){\"function\"==typeof define&&define.amd?define([\"jquery\"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return\"area\"===r?(n=t.parentNode,a=n.name,t.href&&a&&\"map\"===n.nodeName.toLowerCase()?(o=e(\"img[usemap='#\"+a+\"']\")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:\"a\"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return\"hidden\"===e.css(this,\"visibility\")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:\"1.11.4\",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css(\"position\"),s=\"absolute\"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&\"static\"===t.css(\"position\")?!1:n.test(t.css(\"overflow\")+t.css(\"overflow-y\")+t.css(\"overflow-x\"))}).eq(0);return\"fixed\"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id=\"ui-id-\"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\\d+$/.test(this.id)&&e(this).removeAttr(\"id\")})}}),e.extend(e.expr[\":\"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,\"tabindex\")))},tabbable:function(i){var s=e.attr(i,\"tabindex\"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e(\"<a>\").outerWidth(1).jquery||e.each([\"Width\",\"Height\"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,\"padding\"+this))||0,s&&(i-=parseFloat(e.css(t,\"border\"+this+\"Width\"))||0),a&&(i-=parseFloat(e.css(t,\"margin\"+this))||0)}),i}var n=\"Width\"===i?[\"Left\",\"Right\"]:[\"Top\",\"Bottom\"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn[\"inner\"+i]=function(t){return void 0===t?o[\"inner\"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+\"px\")})},e.fn[\"outer\"+i]=function(t,n){return\"number\"!=typeof t?o[\"outer\"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+\"px\")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e(\"<a>\").data(\"a-b\",\"a\").removeData(\"a-b\").data(\"a-b\")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return\"number\"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e=\"onselectstart\"in document.createElement(\"div\")?\"selectstart\":\"mousedown\";return function(){return this.bind(e+\".ui-disableSelection\",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(\".ui-disableSelection\")},zIndex:function(t){if(void 0!==t)return this.css(\"zIndex\",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css(\"position\"),(\"absolute\"===i||\"relative\"===i||\"fixed\"===i)&&(s=parseInt(n.css(\"zIndex\"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,\"events\"),s&&s.remove&&e(n).triggerHandler(\"remove\")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(\".\")[0];return t=t.split(\".\")[1],n=l+\"-\"+t,s||(s=i,i=e.Widget),e.expr[\":\"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+\".\"+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o=\"string\"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return\"instance\"===a?(h=n,!1):n?e.isFunction(n[a])&&\"_\"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error(\"no such method '\"+a+\"' for \"+t+\" widget instance\"):e.error(\"cannot call methods on \"+t+\" prior to initialization; \"+\"attempted to call method '\"+a+\"'\")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:\"widget\",widgetEventPrefix:\"\",defaultElement:\"<div>\",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace=\".\"+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger(\"create\",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr(\"aria-disabled\").removeClass(this.widgetFullName+\"-disabled \"+\"ui-state-disabled\"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass(\"ui-state-hover\"),this.focusable.removeClass(\"ui-state-focus\")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if(\"string\"==typeof t)if(o={},s=t.split(\".\"),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,\"disabled\"===e&&(this.widget().toggleClass(this.widgetFullName+\"-disabled\",!!t),t&&(this.hoverable.removeClass(\"ui-state-hover\"),this.focusable.removeClass(\"ui-state-focus\"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;\"boolean\"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass(\"ui-state-disabled\")?(\"string\"==typeof o?a[o]:o).apply(a,arguments):void 0}\"string\"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\\w:-]*)\\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||\"\").split(\" \").join(this.eventNamespace+\" \")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return(\"string\"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass(\"ui-state-hover\")},mouseleave:function(t){e(t.currentTarget).removeClass(\"ui-state-hover\")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass(\"ui-state-focus\")},focusout:function(t){e(t.currentTarget).removeClass(\"ui-state-focus\")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:\"fadeIn\",hide:\"fadeOut\"},function(t,i){e.Widget.prototype[\"_\"+t]=function(s,n,a){\"string\"==typeof n&&(n={effect:n});var o,r=n?n===!0||\"number\"==typeof n?i:n.effect||i:t;n=n||{},\"number\"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget(\"ui.mouse\",{version:\"1.11.4\",options:{cancel:\"input,textarea,button,select,option\",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind(\"mousedown.\"+this.widgetName,function(e){return t._mouseDown(e)}).bind(\"click.\"+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+\".preventClickEvent\")?(e.removeData(i.target,t.widgetName+\".preventClickEvent\"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind(\".\"+this.widgetName),this._mouseMoveDelegate&&this.document.unbind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).unbind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n=\"string\"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+\".preventClickEvent\")&&e.removeData(t.target,this.widgetName+\".preventClickEvent\"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).bind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).unbind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+\".preventClickEvent\",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.widget(\"ui.draggable\",e.ui.mouse,{version:\"1.11.4\",widgetEventPrefix:\"drag\",options:{addClasses:!0,appendTo:\"parent\",axis:!1,connectToSortable:!1,containment:!1,cursor:\"auto\",cursorAt:!1,grid:!1,handle:!1,helper:\"original\",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:\"default\",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:\"both\",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){\"original\"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass(\"ui-draggable\"),this.options.disabled&&this.element.addClass(\"ui-draggable-disabled\"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),\"handle\"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(\".ui-draggable-dragging\")?(this.destroyOnClear=!0,void 0):(this.element.removeClass(\"ui-draggable ui-draggable-dragging ui-draggable-disabled\"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(\".ui-resizable-handle\").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?\"iframe\":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e(\"<div>\").css(\"position\",\"absolute\").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&\"body\"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass(\"ui-draggable-dragging\"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css(\"position\"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return\"fixed\"===e(this).css(\"position\")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger(\"start\",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo(\"absolute\"),!i){var s=this._uiHash();if(this._trigger(\"drag\",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+\"px\",this.helper[0].style.top=this.position.top+\"px\",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),\"invalid\"===this.options.revert&&!s||\"valid\"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger(\"stop\",t)!==!1&&i._clear()}):this._trigger(\"stop\",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(\".ui-draggable-dragging\")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass(\"ui-draggable-handle\")},_removeHandleClassName:function(){this.handleElement.removeClass(\"ui-draggable-handle\")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):\"clone\"===i.helper?this.element.clone().removeAttr(\"id\"):this.element;return n.parents(\"body\").length||n.appendTo(\"parent\"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css(\"position\"))||n.css(\"position\",\"absolute\"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css(\"position\"))||(this.element[0].style.position=\"relative\")},_adjustOffsetFromHelper:function(t){\"string\"==typeof t&&(t=t.split(\" \")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),\"left\"in t&&(this.offset.click.left=t.left+this.margins.left),\"right\"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),\"top\"in t&&(this.offset.click.top=t.top+this.margins.top),\"bottom\"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return\"absolute\"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css(\"borderTopWidth\"),10)||0),left:t.left+(parseInt(this.offsetParent.css(\"borderLeftWidth\"),10)||0)}},_getRelativeOffset:function(){if(\"relative\"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css(\"top\"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css(\"left\"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css(\"marginLeft\"),10)||0,top:parseInt(this.element.css(\"marginTop\"),10)||0,right:parseInt(this.element.css(\"marginRight\"),10)||0,bottom:parseInt(this.element.css(\"marginBottom\"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?\"window\"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):\"document\"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):(\"parent\"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css(\"overflow\")),this.containment=[(parseInt(i.css(\"borderLeftWidth\"),10)||0)+(parseInt(i.css(\"paddingLeft\"),10)||0),(parseInt(i.css(\"borderTopWidth\"),10)||0)+(parseInt(i.css(\"paddingTop\"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css(\"borderRightWidth\"),10)||0)-(parseInt(i.css(\"paddingRight\"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css(\"borderBottomWidth\"),10)||0)-(parseInt(i.css(\"paddingBottom\"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i=\"absolute\"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(\"fixed\"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(\"fixed\"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),\"y\"===o.axis&&(h=this.originalPageX),\"x\"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(\"fixed\"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(\"fixed\"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass(\"ui-draggable-dragging\"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){\"y\"!==this.options.axis&&\"auto\"!==this.helper.css(\"right\")&&(this.helper.width(this.helper.width()),this.helper.css(\"right\",\"auto\")),\"x\"!==this.options.axis&&\"auto\"!==this.helper.css(\"bottom\")&&(this.helper.height(this.helper.height()),this.helper.css(\"bottom\",\"auto\"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo(\"absolute\"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add(\"draggable\",\"connectToSortable\",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable(\"instance\");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger(\"activate\",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css(\"position\"),top:e.placeholder.css(\"top\"),left:e.placeholder.css(\"left\")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger(\"deactivate\",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data(\"ui-sortable-item\",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger(\"toSortable\",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger(\"out\",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger(\"fromSortable\",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add(\"draggable\",\"cursor\",{start:function(t,i,s){var n=e(\"body\"),a=s.options;n.css(\"cursor\")&&(a._cursor=n.css(\"cursor\")),n.css(\"cursor\",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e(\"body\").css(\"cursor\",n._cursor)}}),e.ui.plugin.add(\"draggable\",\"opacity\",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css(\"opacity\")&&(a._opacity=n.css(\"opacity\")),n.css(\"opacity\",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css(\"opacity\",n._opacity)}}),e.ui.plugin.add(\"draggable\",\"scroll\",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&\"HTML\"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&\"HTML\"!==o.tagName?(n.axis&&\"x\"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&\"y\"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&\"x\"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&\"y\"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add(\"draggable\",\"snap\",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||\":data(ui-draggable)\":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):(\"inner\"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo(\"relative\",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo(\"relative\",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:l}).left)),p=n||a||o||r,\"outer\"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo(\"relative\",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo(\"relative\",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo(\"relative\",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add(\"draggable\",\"stack\",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css(\"zIndex\"),10)||0)-(parseInt(e(i).css(\"zIndex\"),10)||0)});o.length&&(n=parseInt(e(o[0]).css(\"zIndex\"),10)||0,e(o).each(function(t){e(this).css(\"zIndex\",n+t)}),this.css(\"zIndex\",n+o.length))}}),e.ui.plugin.add(\"draggable\",\"zIndex\",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css(\"zIndex\")&&(a._zIndex=n.css(\"zIndex\")),n.css(\"zIndex\",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css(\"zIndex\",n._zIndex)}}),e.ui.draggable,e.widget(\"ui.droppable\",{version:\"1.11.4\",widgetEventPrefix:\"drop\",options:{accept:\"*\",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:\"default\",tolerance:\"intersect\",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;\r\nthis.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass(\"ui-droppable\")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass(\"ui-droppable ui-droppable-disabled\")},_setOption:function(t,i){if(\"accept\"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if(\"scope\"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger(\"activate\",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger(\"deactivate\",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger(\"over\",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger(\"out\",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(\":data(ui-droppable)\").not(\".ui-draggable-dragging\").each(function(){var i=e(this).droppable(\"instance\");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger(\"drop\",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case\"fit\":return a>=l&&d>=r&&o>=u&&c>=h;case\"intersect\":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case\"pointer\":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case\"touch\":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{\"default\":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(\":data(ui-droppable)\").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible=\"none\"!==a[s].element.css(\"display\"),a[s].visible&&(\"mousedown\"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil(\"body\").bind(\"scroll.droppable\",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?\"isout\":o&&!this.isover?\"isover\":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(\":data(ui-droppable)\").filter(function(){return e(this).droppable(\"instance\").options.scope===n}),a.length&&(s=e(a[0]).droppable(\"instance\"),s.greedyChild=\"isover\"===r)),s&&\"isover\"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this[\"isout\"===r?\"isover\":\"isout\"]=!1,this[\"isover\"===r?\"_over\":\"_out\"].call(this,i),s&&\"isout\"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil(\"body\").unbind(\"scroll.droppable\"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable});",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/jquery-ui.min.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 145,
    "kind": "file",
    "name": "src/client/lib/jquery.js",
    "content": "/*!\r\n * jQuery JavaScript Library v2.1.4\r\n * http://jquery.com/\r\n *\r\n * Includes Sizzle.js\r\n * http://sizzlejs.com/\r\n *\r\n * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors\r\n * Released under the MIT license\r\n * http://jquery.org/license\r\n *\r\n * Date: 2015-04-28T16:01Z\r\n */\r\n\r\n(function( global, factory ) {\r\n\r\n\tif ( typeof module === \"object\" && typeof module.exports === \"object\" ) {\r\n\t\t// For CommonJS and CommonJS-like environments where a proper `window`\r\n\t\t// is present, execute the factory and get jQuery.\r\n\t\t// For environments that do not have a `window` with a `document`\r\n\t\t// (such as Node.js), expose a factory as module.exports.\r\n\t\t// This accentuates the need for the creation of a real `window`.\r\n\t\t// e.g. var jQuery = require(\"jquery\")(window);\r\n\t\t// See ticket #14549 for more info.\r\n\t\tmodule.exports = global.document ?\r\n\t\t\tfactory( global, true ) :\r\n\t\t\tfunction( w ) {\r\n\t\t\t\tif ( !w.document ) {\r\n\t\t\t\t\tthrow new Error( \"jQuery requires a window with a document\" );\r\n\t\t\t\t}\r\n\t\t\t\treturn factory( w );\r\n\t\t\t};\r\n\t} else {\r\n\t\tfactory( global );\r\n\t}\r\n\r\n// Pass this if window is not defined yet\r\n}(typeof window !== \"undefined\" ? window : this, function( window, noGlobal ) {\r\n\r\n// Support: Firefox 18+\r\n// Can't be in strict mode, several libs including ASP.NET trace\r\n// the stack via arguments.caller.callee and Firefox dies if\r\n// you try to trace through \"use strict\" call chains. (#13335)\r\n//\r\n\r\nvar arr = [];\r\n\r\nvar slice = arr.slice;\r\n\r\nvar concat = arr.concat;\r\n\r\nvar push = arr.push;\r\n\r\nvar indexOf = arr.indexOf;\r\n\r\nvar class2type = {};\r\n\r\nvar toString = class2type.toString;\r\n\r\nvar hasOwn = class2type.hasOwnProperty;\r\n\r\nvar support = {};\r\n\r\n\r\n\r\nvar\r\n\t// Use the correct document accordingly with window argument (sandbox)\r\n\tdocument = window.document,\r\n\r\n\tversion = \"2.1.4\",\r\n\r\n\t// Define a local copy of jQuery\r\n\tjQuery = function( selector, context ) {\r\n\t\t// The jQuery object is actually just the init constructor 'enhanced'\r\n\t\t// Need init if jQuery is called (just allow error to be thrown if not included)\r\n\t\treturn new jQuery.fn.init( selector, context );\r\n\t},\r\n\r\n\t// Support: Android<4.1\r\n\t// Make sure we trim BOM and NBSP\r\n\trtrim = /^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,\r\n\r\n\t// Matches dashed string for camelizing\r\n\trmsPrefix = /^-ms-/,\r\n\trdashAlpha = /-([\\da-z])/gi,\r\n\r\n\t// Used by jQuery.camelCase as callback to replace()\r\n\tfcamelCase = function( all, letter ) {\r\n\t\treturn letter.toUpperCase();\r\n\t};\r\n\r\njQuery.fn = jQuery.prototype = {\r\n\t// The current version of jQuery being used\r\n\tjquery: version,\r\n\r\n\tconstructor: jQuery,\r\n\r\n\t// Start with an empty selector\r\n\tselector: \"\",\r\n\r\n\t// The default length of a jQuery object is 0\r\n\tlength: 0,\r\n\r\n\ttoArray: function() {\r\n\t\treturn slice.call( this );\r\n\t},\r\n\r\n\t// Get the Nth element in the matched element set OR\r\n\t// Get the whole matched element set as a clean array\r\n\tget: function( num ) {\r\n\t\treturn num != null ?\r\n\r\n\t\t\t// Return just the one element from the set\r\n\t\t\t( num < 0 ? this[ num + this.length ] : this[ num ] ) :\r\n\r\n\t\t\t// Return all the elements in a clean array\r\n\t\t\tslice.call( this );\r\n\t},\r\n\r\n\t// Take an array of elements and push it onto the stack\r\n\t// (returning the new matched element set)\r\n\tpushStack: function( elems ) {\r\n\r\n\t\t// Build a new jQuery matched element set\r\n\t\tvar ret = jQuery.merge( this.constructor(), elems );\r\n\r\n\t\t// Add the old object onto the stack (as a reference)\r\n\t\tret.prevObject = this;\r\n\t\tret.context = this.context;\r\n\r\n\t\t// Return the newly-formed element set\r\n\t\treturn ret;\r\n\t},\r\n\r\n\t// Execute a callback for every element in the matched set.\r\n\t// (You can seed the arguments with an array of args, but this is\r\n\t// only used internally.)\r\n\teach: function( callback, args ) {\r\n\t\treturn jQuery.each( this, callback, args );\r\n\t},\r\n\r\n\tmap: function( callback ) {\r\n\t\treturn this.pushStack( jQuery.map(this, function( elem, i ) {\r\n\t\t\treturn callback.call( elem, i, elem );\r\n\t\t}));\r\n\t},\r\n\r\n\tslice: function() {\r\n\t\treturn this.pushStack( slice.apply( this, arguments ) );\r\n\t},\r\n\r\n\tfirst: function() {\r\n\t\treturn this.eq( 0 );\r\n\t},\r\n\r\n\tlast: function() {\r\n\t\treturn this.eq( -1 );\r\n\t},\r\n\r\n\teq: function( i ) {\r\n\t\tvar len = this.length,\r\n\t\t\tj = +i + ( i < 0 ? len : 0 );\r\n\t\treturn this.pushStack( j >= 0 && j < len ? [ this[j] ] : [] );\r\n\t},\r\n\r\n\tend: function() {\r\n\t\treturn this.prevObject || this.constructor(null);\r\n\t},\r\n\r\n\t// For internal use only.\r\n\t// Behaves like an Array's method, not like a jQuery method.\r\n\tpush: push,\r\n\tsort: arr.sort,\r\n\tsplice: arr.splice\r\n};\r\n\r\njQuery.extend = jQuery.fn.extend = function() {\r\n\tvar options, name, src, copy, copyIsArray, clone,\r\n\t\ttarget = arguments[0] || {},\r\n\t\ti = 1,\r\n\t\tlength = arguments.length,\r\n\t\tdeep = false;\r\n\r\n\t// Handle a deep copy situation\r\n\tif ( typeof target === \"boolean\" ) {\r\n\t\tdeep = target;\r\n\r\n\t\t// Skip the boolean and the target\r\n\t\ttarget = arguments[ i ] || {};\r\n\t\ti++;\r\n\t}\r\n\r\n\t// Handle case when target is a string or something (possible in deep copy)\r\n\tif ( typeof target !== \"object\" && !jQuery.isFunction(target) ) {\r\n\t\ttarget = {};\r\n\t}\r\n\r\n\t// Extend jQuery itself if only one argument is passed\r\n\tif ( i === length ) {\r\n\t\ttarget = this;\r\n\t\ti--;\r\n\t}\r\n\r\n\tfor ( ; i < length; i++ ) {\r\n\t\t// Only deal with non-null/undefined values\r\n\t\tif ( (options = arguments[ i ]) != null ) {\r\n\t\t\t// Extend the base object\r\n\t\t\tfor ( name in options ) {\r\n\t\t\t\tsrc = target[ name ];\r\n\t\t\t\tcopy = options[ name ];\r\n\r\n\t\t\t\t// Prevent never-ending loop\r\n\t\t\t\tif ( target === copy ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Recurse if we're merging plain objects or arrays\r\n\t\t\t\tif ( deep && copy && ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) {\r\n\t\t\t\t\tif ( copyIsArray ) {\r\n\t\t\t\t\t\tcopyIsArray = false;\r\n\t\t\t\t\t\tclone = src && jQuery.isArray(src) ? src : [];\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tclone = src && jQuery.isPlainObject(src) ? src : {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Never move original objects, clone them\r\n\t\t\t\t\ttarget[ name ] = jQuery.extend( deep, clone, copy );\r\n\r\n\t\t\t\t// Don't bring in undefined values\r\n\t\t\t\t} else if ( copy !== undefined ) {\r\n\t\t\t\t\ttarget[ name ] = copy;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Return the modified object\r\n\treturn target;\r\n};\r\n\r\njQuery.extend({\r\n\t// Unique for each copy of jQuery on the page\r\n\texpando: \"jQuery\" + ( version + Math.random() ).replace( /\\D/g, \"\" ),\r\n\r\n\t// Assume jQuery is ready without the ready module\r\n\tisReady: true,\r\n\r\n\terror: function( msg ) {\r\n\t\tthrow new Error( msg );\r\n\t},\r\n\r\n\tnoop: function() {},\r\n\r\n\tisFunction: function( obj ) {\r\n\t\treturn jQuery.type(obj) === \"function\";\r\n\t},\r\n\r\n\tisArray: Array.isArray,\r\n\r\n\tisWindow: function( obj ) {\r\n\t\treturn obj != null && obj === obj.window;\r\n\t},\r\n\r\n\tisNumeric: function( obj ) {\r\n\t\t// parseFloat NaNs numeric-cast false positives (null|true|false|\"\")\r\n\t\t// ...but misinterprets leading-number strings, particularly hex literals (\"0x...\")\r\n\t\t// subtraction forces infinities to NaN\r\n\t\t// adding 1 corrects loss of precision from parseFloat (#15100)\r\n\t\treturn !jQuery.isArray( obj ) && (obj - parseFloat( obj ) + 1) >= 0;\r\n\t},\r\n\r\n\tisPlainObject: function( obj ) {\r\n\t\t// Not plain objects:\r\n\t\t// - Any object or value whose internal [[Class]] property is not \"[object Object]\"\r\n\t\t// - DOM nodes\r\n\t\t// - window\r\n\t\tif ( jQuery.type( obj ) !== \"object\" || obj.nodeType || jQuery.isWindow( obj ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( obj.constructor &&\r\n\t\t\t\t!hasOwn.call( obj.constructor.prototype, \"isPrototypeOf\" ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If the function hasn't returned already, we're confident that\r\n\t\t// |obj| is a plain object, created by {} or constructed with new Object\r\n\t\treturn true;\r\n\t},\r\n\r\n\tisEmptyObject: function( obj ) {\r\n\t\tvar name;\r\n\t\tfor ( name in obj ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\ttype: function( obj ) {\r\n\t\tif ( obj == null ) {\r\n\t\t\treturn obj + \"\";\r\n\t\t}\r\n\t\t// Support: Android<4.0, iOS<6 (functionish RegExp)\r\n\t\treturn typeof obj === \"object\" || typeof obj === \"function\" ?\r\n\t\t\tclass2type[ toString.call(obj) ] || \"object\" :\r\n\t\t\ttypeof obj;\r\n\t},\r\n\r\n\t// Evaluates a script in a global context\r\n\tglobalEval: function( code ) {\r\n\t\tvar script,\r\n\t\t\tindirect = eval;\r\n\r\n\t\tcode = jQuery.trim( code );\r\n\r\n\t\tif ( code ) {\r\n\t\t\t// If the code includes a valid, prologue position\r\n\t\t\t// strict mode pragma, execute code by injecting a\r\n\t\t\t// script tag into the document.\r\n\t\t\tif ( code.indexOf(\"use strict\") === 1 ) {\r\n\t\t\t\tscript = document.createElement(\"script\");\r\n\t\t\t\tscript.text = code;\r\n\t\t\t\tdocument.head.appendChild( script ).parentNode.removeChild( script );\r\n\t\t\t} else {\r\n\t\t\t// Otherwise, avoid the DOM node creation, insertion\r\n\t\t\t// and removal by using an indirect global eval\r\n\t\t\t\tindirect( code );\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// Convert dashed to camelCase; used by the css and data modules\r\n\t// Support: IE9-11+\r\n\t// Microsoft forgot to hump their vendor prefix (#9572)\r\n\tcamelCase: function( string ) {\r\n\t\treturn string.replace( rmsPrefix, \"ms-\" ).replace( rdashAlpha, fcamelCase );\r\n\t},\r\n\r\n\tnodeName: function( elem, name ) {\r\n\t\treturn elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();\r\n\t},\r\n\r\n\t// args is for internal usage only\r\n\teach: function( obj, callback, args ) {\r\n\t\tvar value,\r\n\t\t\ti = 0,\r\n\t\t\tlength = obj.length,\r\n\t\t\tisArray = isArraylike( obj );\r\n\r\n\t\tif ( args ) {\r\n\t\t\tif ( isArray ) {\r\n\t\t\t\tfor ( ; i < length; i++ ) {\r\n\t\t\t\t\tvalue = callback.apply( obj[ i ], args );\r\n\r\n\t\t\t\t\tif ( value === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( i in obj ) {\r\n\t\t\t\t\tvalue = callback.apply( obj[ i ], args );\r\n\r\n\t\t\t\t\tif ( value === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t// A special, fast, case for the most common use of each\r\n\t\t} else {\r\n\t\t\tif ( isArray ) {\r\n\t\t\t\tfor ( ; i < length; i++ ) {\r\n\t\t\t\t\tvalue = callback.call( obj[ i ], i, obj[ i ] );\r\n\r\n\t\t\t\t\tif ( value === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( i in obj ) {\r\n\t\t\t\t\tvalue = callback.call( obj[ i ], i, obj[ i ] );\r\n\r\n\t\t\t\t\tif ( value === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t},\r\n\r\n\t// Support: Android<4.1\r\n\ttrim: function( text ) {\r\n\t\treturn text == null ?\r\n\t\t\t\"\" :\r\n\t\t\t( text + \"\" ).replace( rtrim, \"\" );\r\n\t},\r\n\r\n\t// results is for internal usage only\r\n\tmakeArray: function( arr, results ) {\r\n\t\tvar ret = results || [];\r\n\r\n\t\tif ( arr != null ) {\r\n\t\t\tif ( isArraylike( Object(arr) ) ) {\r\n\t\t\t\tjQuery.merge( ret,\r\n\t\t\t\t\ttypeof arr === \"string\" ?\r\n\t\t\t\t\t[ arr ] : arr\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tpush.call( ret, arr );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t},\r\n\r\n\tinArray: function( elem, arr, i ) {\r\n\t\treturn arr == null ? -1 : indexOf.call( arr, elem, i );\r\n\t},\r\n\r\n\tmerge: function( first, second ) {\r\n\t\tvar len = +second.length,\r\n\t\t\tj = 0,\r\n\t\t\ti = first.length;\r\n\r\n\t\tfor ( ; j < len; j++ ) {\r\n\t\t\tfirst[ i++ ] = second[ j ];\r\n\t\t}\r\n\r\n\t\tfirst.length = i;\r\n\r\n\t\treturn first;\r\n\t},\r\n\r\n\tgrep: function( elems, callback, invert ) {\r\n\t\tvar callbackInverse,\r\n\t\t\tmatches = [],\r\n\t\t\ti = 0,\r\n\t\t\tlength = elems.length,\r\n\t\t\tcallbackExpect = !invert;\r\n\r\n\t\t// Go through the array, only saving the items\r\n\t\t// that pass the validator function\r\n\t\tfor ( ; i < length; i++ ) {\r\n\t\t\tcallbackInverse = !callback( elems[ i ], i );\r\n\t\t\tif ( callbackInverse !== callbackExpect ) {\r\n\t\t\t\tmatches.push( elems[ i ] );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn matches;\r\n\t},\r\n\r\n\t// arg is for internal usage only\r\n\tmap: function( elems, callback, arg ) {\r\n\t\tvar value,\r\n\t\t\ti = 0,\r\n\t\t\tlength = elems.length,\r\n\t\t\tisArray = isArraylike( elems ),\r\n\t\t\tret = [];\r\n\r\n\t\t// Go through the array, translating each of the items to their new values\r\n\t\tif ( isArray ) {\r\n\t\t\tfor ( ; i < length; i++ ) {\r\n\t\t\t\tvalue = callback( elems[ i ], i, arg );\r\n\r\n\t\t\t\tif ( value != null ) {\r\n\t\t\t\t\tret.push( value );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t// Go through every key on the object,\r\n\t\t} else {\r\n\t\t\tfor ( i in elems ) {\r\n\t\t\t\tvalue = callback( elems[ i ], i, arg );\r\n\r\n\t\t\t\tif ( value != null ) {\r\n\t\t\t\t\tret.push( value );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Flatten any nested arrays\r\n\t\treturn concat.apply( [], ret );\r\n\t},\r\n\r\n\t// A global GUID counter for objects\r\n\tguid: 1,\r\n\r\n\t// Bind a function to a context, optionally partially applying any\r\n\t// arguments.\r\n\tproxy: function( fn, context ) {\r\n\t\tvar tmp, args, proxy;\r\n\r\n\t\tif ( typeof context === \"string\" ) {\r\n\t\t\ttmp = fn[ context ];\r\n\t\t\tcontext = fn;\r\n\t\t\tfn = tmp;\r\n\t\t}\r\n\r\n\t\t// Quick check to determine if target is callable, in the spec\r\n\t\t// this throws a TypeError, but we will just return undefined.\r\n\t\tif ( !jQuery.isFunction( fn ) ) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\t// Simulated bind\r\n\t\targs = slice.call( arguments, 2 );\r\n\t\tproxy = function() {\r\n\t\t\treturn fn.apply( context || this, args.concat( slice.call( arguments ) ) );\r\n\t\t};\r\n\r\n\t\t// Set the guid of unique handler to the same of original handler, so it can be removed\r\n\t\tproxy.guid = fn.guid = fn.guid || jQuery.guid++;\r\n\r\n\t\treturn proxy;\r\n\t},\r\n\r\n\tnow: Date.now,\r\n\r\n\t// jQuery.support is not used in Core but other projects attach their\r\n\t// properties to it so it needs to exist.\r\n\tsupport: support\r\n});\r\n\r\n// Populate the class2type map\r\njQuery.each(\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \"), function(i, name) {\r\n\tclass2type[ \"[object \" + name + \"]\" ] = name.toLowerCase();\r\n});\r\n\r\nfunction isArraylike( obj ) {\r\n\r\n\t// Support: iOS 8.2 (not reproducible in simulator)\r\n\t// `in` check used to prevent JIT error (gh-2145)\r\n\t// hasOwn isn't used here due to false negatives\r\n\t// regarding Nodelist length in IE\r\n\tvar length = \"length\" in obj && obj.length,\r\n\t\ttype = jQuery.type( obj );\r\n\r\n\tif ( type === \"function\" || jQuery.isWindow( obj ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif ( obj.nodeType === 1 && length ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn type === \"array\" || length === 0 ||\r\n\t\ttypeof length === \"number\" && length > 0 && ( length - 1 ) in obj;\r\n}\r\nvar Sizzle =\r\n/*!\r\n * Sizzle CSS Selector Engine v2.2.0-pre\r\n * http://sizzlejs.com/\r\n *\r\n * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors\r\n * Released under the MIT license\r\n * http://jquery.org/license\r\n *\r\n * Date: 2014-12-16\r\n */\r\n(function( window ) {\r\n\r\nvar i,\r\n\tsupport,\r\n\tExpr,\r\n\tgetText,\r\n\tisXML,\r\n\ttokenize,\r\n\tcompile,\r\n\tselect,\r\n\toutermostContext,\r\n\tsortInput,\r\n\thasDuplicate,\r\n\r\n\t// Local document vars\r\n\tsetDocument,\r\n\tdocument,\r\n\tdocElem,\r\n\tdocumentIsHTML,\r\n\trbuggyQSA,\r\n\trbuggyMatches,\r\n\tmatches,\r\n\tcontains,\r\n\r\n\t// Instance-specific data\r\n\texpando = \"sizzle\" + 1 * new Date(),\r\n\tpreferredDoc = window.document,\r\n\tdirruns = 0,\r\n\tdone = 0,\r\n\tclassCache = createCache(),\r\n\ttokenCache = createCache(),\r\n\tcompilerCache = createCache(),\r\n\tsortOrder = function( a, b ) {\r\n\t\tif ( a === b ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\r\n\t// General-purpose constants\r\n\tMAX_NEGATIVE = 1 << 31,\r\n\r\n\t// Instance methods\r\n\thasOwn = ({}).hasOwnProperty,\r\n\tarr = [],\r\n\tpop = arr.pop,\r\n\tpush_native = arr.push,\r\n\tpush = arr.push,\r\n\tslice = arr.slice,\r\n\t// Use a stripped-down indexOf as it's faster than native\r\n\t// http://jsperf.com/thor-indexof-vs-for/5\r\n\tindexOf = function( list, elem ) {\r\n\t\tvar i = 0,\r\n\t\t\tlen = list.length;\r\n\t\tfor ( ; i < len; i++ ) {\r\n\t\t\tif ( list[i] === elem ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t},\r\n\r\n\tbooleans = \"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",\r\n\r\n\t// Regular expressions\r\n\r\n\t// Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace\r\n\twhitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\r\n\t// http://www.w3.org/TR/css3-syntax/#characters\r\n\tcharacterEncoding = \"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",\r\n\r\n\t// Loosely modeled on CSS identifier characters\r\n\t// An unquoted value should be a CSS identifier http://www.w3.org/TR/css3-selectors/#attribute-selectors\r\n\t// Proper syntax: http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier\r\n\tidentifier = characterEncoding.replace( \"w\", \"w#\" ),\r\n\r\n\t// Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors\r\n\tattributes = \"\\\\[\" + whitespace + \"*(\" + characterEncoding + \")(?:\" + whitespace +\r\n\t\t// Operator (capture 2)\r\n\t\t\"*([*^$|!~]?=)\" + whitespace +\r\n\t\t// \"Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]\"\r\n\t\t\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\" + identifier + \"))|)\" + whitespace +\r\n\t\t\"*\\\\]\",\r\n\r\n\tpseudos = \":(\" + characterEncoding + \")(?:\\\\((\" +\r\n\t\t// To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:\r\n\t\t// 1. quoted (capture 3; capture 4 or capture 5)\r\n\t\t\"('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|\" +\r\n\t\t// 2. simple (capture 6)\r\n\t\t\"((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes + \")*)|\" +\r\n\t\t// 3. anything else (capture 2)\r\n\t\t\".*\" +\r\n\t\t\")\\\\)|)\",\r\n\r\n\t// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\r\n\trwhitespace = new RegExp( whitespace + \"+\", \"g\" ),\r\n\trtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" + whitespace + \"+$\", \"g\" ),\r\n\r\n\trcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\r\n\trcombinators = new RegExp( \"^\" + whitespace + \"*([>+~]|\" + whitespace + \")\" + whitespace + \"*\" ),\r\n\r\n\trattributeQuotes = new RegExp( \"=\" + whitespace + \"*([^\\\\]'\\\"]*?)\" + whitespace + \"*\\\\]\", \"g\" ),\r\n\r\n\trpseudo = new RegExp( pseudos ),\r\n\tridentifier = new RegExp( \"^\" + identifier + \"$\" ),\r\n\r\n\tmatchExpr = {\r\n\t\t\"ID\": new RegExp( \"^#(\" + characterEncoding + \")\" ),\r\n\t\t\"CLASS\": new RegExp( \"^\\\\.(\" + characterEncoding + \")\" ),\r\n\t\t\"TAG\": new RegExp( \"^(\" + characterEncoding.replace( \"w\", \"w*\" ) + \")\" ),\r\n\t\t\"ATTR\": new RegExp( \"^\" + attributes ),\r\n\t\t\"PSEUDO\": new RegExp( \"^\" + pseudos ),\r\n\t\t\"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" + whitespace +\r\n\t\t\t\"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" + whitespace +\r\n\t\t\t\"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\r\n\t\t\"bool\": new RegExp( \"^(?:\" + booleans + \")$\", \"i\" ),\r\n\t\t// For use in libraries implementing .is()\r\n\t\t// We use this for POS matching in `select`\r\n\t\t\"needsContext\": new RegExp( \"^\" + whitespace + \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" +\r\n\t\t\twhitespace + \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\r\n\t},\r\n\r\n\trinputs = /^(?:input|select|textarea|button)$/i,\r\n\trheader = /^h\\d$/i,\r\n\r\n\trnative = /^[^{]+\\{\\s*\\[native \\w/,\r\n\r\n\t// Easily-parseable/retrievable ID or TAG or CLASS selectors\r\n\trquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\r\n\r\n\trsibling = /[+~]/,\r\n\trescape = /'|\\\\/g,\r\n\r\n\t// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\r\n\trunescape = new RegExp( \"\\\\\\\\([\\\\da-f]{1,6}\" + whitespace + \"?|(\" + whitespace + \")|.)\", \"ig\" ),\r\n\tfunescape = function( _, escaped, escapedWhitespace ) {\r\n\t\tvar high = \"0x\" + escaped - 0x10000;\r\n\t\t// NaN means non-codepoint\r\n\t\t// Support: Firefox<24\r\n\t\t// Workaround erroneous numeric interpretation of +\"0x\"\r\n\t\treturn high !== high || escapedWhitespace ?\r\n\t\t\tescaped :\r\n\t\t\thigh < 0 ?\r\n\t\t\t\t// BMP codepoint\r\n\t\t\t\tString.fromCharCode( high + 0x10000 ) :\r\n\t\t\t\t// Supplemental Plane codepoint (surrogate pair)\r\n\t\t\t\tString.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\r\n\t},\r\n\r\n\t// Used for iframes\r\n\t// See setDocument()\r\n\t// Removing the function wrapper causes a \"Permission Denied\"\r\n\t// error in IE\r\n\tunloadHandler = function() {\r\n\t\tsetDocument();\r\n\t};\r\n\r\n// Optimize for push.apply( _, NodeList )\r\ntry {\r\n\tpush.apply(\r\n\t\t(arr = slice.call( preferredDoc.childNodes )),\r\n\t\tpreferredDoc.childNodes\r\n\t);\r\n\t// Support: Android<4.0\r\n\t// Detect silently failing push.apply\r\n\tarr[ preferredDoc.childNodes.length ].nodeType;\r\n} catch ( e ) {\r\n\tpush = { apply: arr.length ?\r\n\r\n\t\t// Leverage slice if possible\r\n\t\tfunction( target, els ) {\r\n\t\t\tpush_native.apply( target, slice.call(els) );\r\n\t\t} :\r\n\r\n\t\t// Support: IE<9\r\n\t\t// Otherwise append directly\r\n\t\tfunction( target, els ) {\r\n\t\t\tvar j = target.length,\r\n\t\t\t\ti = 0;\r\n\t\t\t// Can't trust NodeList.length\r\n\t\t\twhile ( (target[j++] = els[i++]) ) {}\r\n\t\t\ttarget.length = j - 1;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction Sizzle( selector, context, results, seed ) {\r\n\tvar match, elem, m, nodeType,\r\n\t\t// QSA vars\r\n\t\ti, groups, old, nid, newContext, newSelector;\r\n\r\n\tif ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {\r\n\t\tsetDocument( context );\r\n\t}\r\n\r\n\tcontext = context || document;\r\n\tresults = results || [];\r\n\tnodeType = context.nodeType;\r\n\r\n\tif ( typeof selector !== \"string\" || !selector ||\r\n\t\tnodeType !== 1 && nodeType !== 9 && nodeType !== 11 ) {\r\n\r\n\t\treturn results;\r\n\t}\r\n\r\n\tif ( !seed && documentIsHTML ) {\r\n\r\n\t\t// Try to shortcut find operations when possible (e.g., not under DocumentFragment)\r\n\t\tif ( nodeType !== 11 && (match = rquickExpr.exec( selector )) ) {\r\n\t\t\t// Speed-up: Sizzle(\"#ID\")\r\n\t\t\tif ( (m = match[1]) ) {\r\n\t\t\t\tif ( nodeType === 9 ) {\r\n\t\t\t\t\telem = context.getElementById( m );\r\n\t\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\r\n\t\t\t\t\t// nodes that are no longer in the document (jQuery #6963)\r\n\t\t\t\t\tif ( elem && elem.parentNode ) {\r\n\t\t\t\t\t\t// Handle the case where IE, Opera, and Webkit return items\r\n\t\t\t\t\t\t// by name instead of ID\r\n\t\t\t\t\t\tif ( elem.id === m ) {\r\n\t\t\t\t\t\t\tresults.push( elem );\r\n\t\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Context is not a document\r\n\t\t\t\t\tif ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&\r\n\t\t\t\t\t\tcontains( context, elem ) && elem.id === m ) {\r\n\t\t\t\t\t\tresults.push( elem );\r\n\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t// Speed-up: Sizzle(\"TAG\")\r\n\t\t\t} else if ( match[2] ) {\r\n\t\t\t\tpush.apply( results, context.getElementsByTagName( selector ) );\r\n\t\t\t\treturn results;\r\n\r\n\t\t\t// Speed-up: Sizzle(\".CLASS\")\r\n\t\t\t} else if ( (m = match[3]) && support.getElementsByClassName ) {\r\n\t\t\t\tpush.apply( results, context.getElementsByClassName( m ) );\r\n\t\t\t\treturn results;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// QSA path\r\n\t\tif ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {\r\n\t\t\tnid = old = expando;\r\n\t\t\tnewContext = context;\r\n\t\t\tnewSelector = nodeType !== 1 && selector;\r\n\r\n\t\t\t// qSA works strangely on Element-rooted queries\r\n\t\t\t// We can work around this by specifying an extra ID on the root\r\n\t\t\t// and working up from there (Thanks to Andrew Dupont for the technique)\r\n\t\t\t// IE 8 doesn't work on object elements\r\n\t\t\tif ( nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\r\n\t\t\t\tgroups = tokenize( selector );\r\n\r\n\t\t\t\tif ( (old = context.getAttribute(\"id\")) ) {\r\n\t\t\t\t\tnid = old.replace( rescape, \"\\\\$&\" );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontext.setAttribute( \"id\", nid );\r\n\t\t\t\t}\r\n\t\t\t\tnid = \"[id='\" + nid + \"'] \";\r\n\r\n\t\t\t\ti = groups.length;\r\n\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\tgroups[i] = nid + toSelector( groups[i] );\r\n\t\t\t\t}\r\n\t\t\t\tnewContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;\r\n\t\t\t\tnewSelector = groups.join(\",\");\r\n\t\t\t}\r\n\r\n\t\t\tif ( newSelector ) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tpush.apply( results,\r\n\t\t\t\t\t\tnewContext.querySelectorAll( newSelector )\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn results;\r\n\t\t\t\t} catch(qsaError) {\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tif ( !old ) {\r\n\t\t\t\t\t\tcontext.removeAttribute(\"id\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// All others\r\n\treturn select( selector.replace( rtrim, \"$1\" ), context, results, seed );\r\n}\r\n\r\n/**\r\n * Create key-value caches of limited size\r\n * @returns {Function(string, Object)} Returns the Object data after storing it on itself with\r\n *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\r\n *\tdeleting the oldest entry\r\n */\r\nfunction createCache() {\r\n\tvar keys = [];\r\n\r\n\tfunction cache( key, value ) {\r\n\t\t// Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\r\n\t\tif ( keys.push( key + \" \" ) > Expr.cacheLength ) {\r\n\t\t\t// Only keep the most recent entries\r\n\t\t\tdelete cache[ keys.shift() ];\r\n\t\t}\r\n\t\treturn (cache[ key + \" \" ] = value);\r\n\t}\r\n\treturn cache;\r\n}\r\n\r\n/**\r\n * Mark a function for special use by Sizzle\r\n * @param {Function} fn The function to mark\r\n */\r\nfunction markFunction( fn ) {\r\n\tfn[ expando ] = true;\r\n\treturn fn;\r\n}\r\n\r\n/**\r\n * Support testing using an element\r\n * @param {Function} fn Passed the created div and expects a boolean result\r\n */\r\nfunction assert( fn ) {\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\ttry {\r\n\t\treturn !!fn( div );\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t} finally {\r\n\t\t// Remove from its parent by default\r\n\t\tif ( div.parentNode ) {\r\n\t\t\tdiv.parentNode.removeChild( div );\r\n\t\t}\r\n\t\t// release memory in IE\r\n\t\tdiv = null;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adds the same handler for all of the specified attrs\r\n * @param {String} attrs Pipe-separated list of attributes\r\n * @param {Function} handler The method that will be applied\r\n */\r\nfunction addHandle( attrs, handler ) {\r\n\tvar arr = attrs.split(\"|\"),\r\n\t\ti = attrs.length;\r\n\r\n\twhile ( i-- ) {\r\n\t\tExpr.attrHandle[ arr[i] ] = handler;\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks document order of two siblings\r\n * @param {Element} a\r\n * @param {Element} b\r\n * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b\r\n */\r\nfunction siblingCheck( a, b ) {\r\n\tvar cur = b && a,\r\n\t\tdiff = cur && a.nodeType === 1 && b.nodeType === 1 &&\r\n\t\t\t( ~b.sourceIndex || MAX_NEGATIVE ) -\r\n\t\t\t( ~a.sourceIndex || MAX_NEGATIVE );\r\n\r\n\t// Use IE sourceIndex if available on both nodes\r\n\tif ( diff ) {\r\n\t\treturn diff;\r\n\t}\r\n\r\n\t// Check if b follows a\r\n\tif ( cur ) {\r\n\t\twhile ( (cur = cur.nextSibling) ) {\r\n\t\t\tif ( cur === b ) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn a ? 1 : -1;\r\n}\r\n\r\n/**\r\n * Returns a function to use in pseudos for input types\r\n * @param {String} type\r\n */\r\nfunction createInputPseudo( type ) {\r\n\treturn function( elem ) {\r\n\t\tvar name = elem.nodeName.toLowerCase();\r\n\t\treturn name === \"input\" && elem.type === type;\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns a function to use in pseudos for buttons\r\n * @param {String} type\r\n */\r\nfunction createButtonPseudo( type ) {\r\n\treturn function( elem ) {\r\n\t\tvar name = elem.nodeName.toLowerCase();\r\n\t\treturn (name === \"input\" || name === \"button\") && elem.type === type;\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns a function to use in pseudos for positionals\r\n * @param {Function} fn\r\n */\r\nfunction createPositionalPseudo( fn ) {\r\n\treturn markFunction(function( argument ) {\r\n\t\targument = +argument;\r\n\t\treturn markFunction(function( seed, matches ) {\r\n\t\t\tvar j,\r\n\t\t\t\tmatchIndexes = fn( [], seed.length, argument ),\r\n\t\t\t\ti = matchIndexes.length;\r\n\r\n\t\t\t// Match elements found at the specified indexes\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tif ( seed[ (j = matchIndexes[i]) ] ) {\r\n\t\t\t\t\tseed[j] = !(matches[j] = seed[j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * Checks a node for validity as a Sizzle context\r\n * @param {Element|Object=} context\r\n * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value\r\n */\r\nfunction testContext( context ) {\r\n\treturn context && typeof context.getElementsByTagName !== \"undefined\" && context;\r\n}\r\n\r\n// Expose support vars for convenience\r\nsupport = Sizzle.support = {};\r\n\r\n/**\r\n * Detects XML nodes\r\n * @param {Element|Object} elem An element or a document\r\n * @returns {Boolean} True iff elem is a non-HTML XML node\r\n */\r\nisXML = Sizzle.isXML = function( elem ) {\r\n\t// documentElement is verified for cases where it doesn't yet exist\r\n\t// (such as loading iframes in IE - #4833)\r\n\tvar documentElement = elem && (elem.ownerDocument || elem).documentElement;\r\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n};\r\n\r\n/**\r\n * Sets document-related variables once based on the current document\r\n * @param {Element|Object} [doc] An element or document object to use to set the document\r\n * @returns {Object} Returns the current document\r\n */\r\nsetDocument = Sizzle.setDocument = function( node ) {\r\n\tvar hasCompare, parent,\r\n\t\tdoc = node ? node.ownerDocument || node : preferredDoc;\r\n\r\n\t// If no document and documentElement is available, return\r\n\tif ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {\r\n\t\treturn document;\r\n\t}\r\n\r\n\t// Set our document\r\n\tdocument = doc;\r\n\tdocElem = doc.documentElement;\r\n\tparent = doc.defaultView;\r\n\r\n\t// Support: IE>8\r\n\t// If iframe document is assigned to \"document\" variable and if iframe has been reloaded,\r\n\t// IE will throw \"permission denied\" error when accessing \"document\" variable, see jQuery #13936\r\n\t// IE6-8 do not support the defaultView property so parent will be undefined\r\n\tif ( parent && parent !== parent.top ) {\r\n\t\t// IE11 does not have attachEvent, so all must suffer\r\n\t\tif ( parent.addEventListener ) {\r\n\t\t\tparent.addEventListener( \"unload\", unloadHandler, false );\r\n\t\t} else if ( parent.attachEvent ) {\r\n\t\t\tparent.attachEvent( \"onunload\", unloadHandler );\r\n\t\t}\r\n\t}\r\n\r\n\t/* Support tests\r\n\t---------------------------------------------------------------------- */\r\n\tdocumentIsHTML = !isXML( doc );\r\n\r\n\t/* Attributes\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// Support: IE<8\r\n\t// Verify that getAttribute really returns attributes and not properties\r\n\t// (excepting IE8 booleans)\r\n\tsupport.attributes = assert(function( div ) {\r\n\t\tdiv.className = \"i\";\r\n\t\treturn !div.getAttribute(\"className\");\r\n\t});\r\n\r\n\t/* getElement(s)By*\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// Check if getElementsByTagName(\"*\") returns only elements\r\n\tsupport.getElementsByTagName = assert(function( div ) {\r\n\t\tdiv.appendChild( doc.createComment(\"\") );\r\n\t\treturn !div.getElementsByTagName(\"*\").length;\r\n\t});\r\n\r\n\t// Support: IE<9\r\n\tsupport.getElementsByClassName = rnative.test( doc.getElementsByClassName );\r\n\r\n\t// Support: IE<10\r\n\t// Check if getElementById returns elements by name\r\n\t// The broken getElementById methods don't pick up programatically-set names,\r\n\t// so use a roundabout getElementsByName test\r\n\tsupport.getById = assert(function( div ) {\r\n\t\tdocElem.appendChild( div ).id = expando;\r\n\t\treturn !doc.getElementsByName || !doc.getElementsByName( expando ).length;\r\n\t});\r\n\r\n\t// ID find and filter\r\n\tif ( support.getById ) {\r\n\t\tExpr.find[\"ID\"] = function( id, context ) {\r\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && documentIsHTML ) {\r\n\t\t\t\tvar m = context.getElementById( id );\r\n\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\r\n\t\t\t\t// nodes that are no longer in the document #6963\r\n\t\t\t\treturn m && m.parentNode ? [ m ] : [];\r\n\t\t\t}\r\n\t\t};\r\n\t\tExpr.filter[\"ID\"] = function( id ) {\r\n\t\t\tvar attrId = id.replace( runescape, funescape );\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\treturn elem.getAttribute(\"id\") === attrId;\r\n\t\t\t};\r\n\t\t};\r\n\t} else {\r\n\t\t// Support: IE6/7\r\n\t\t// getElementById is not reliable as a find shortcut\r\n\t\tdelete Expr.find[\"ID\"];\r\n\r\n\t\tExpr.filter[\"ID\"] =  function( id ) {\r\n\t\t\tvar attrId = id.replace( runescape, funescape );\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\tvar node = typeof elem.getAttributeNode !== \"undefined\" && elem.getAttributeNode(\"id\");\r\n\t\t\t\treturn node && node.value === attrId;\r\n\t\t\t};\r\n\t\t};\r\n\t}\r\n\r\n\t// Tag\r\n\tExpr.find[\"TAG\"] = support.getElementsByTagName ?\r\n\t\tfunction( tag, context ) {\r\n\t\t\tif ( typeof context.getElementsByTagName !== \"undefined\" ) {\r\n\t\t\t\treturn context.getElementsByTagName( tag );\r\n\r\n\t\t\t// DocumentFragment nodes don't have gEBTN\r\n\t\t\t} else if ( support.qsa ) {\r\n\t\t\t\treturn context.querySelectorAll( tag );\r\n\t\t\t}\r\n\t\t} :\r\n\r\n\t\tfunction( tag, context ) {\r\n\t\t\tvar elem,\r\n\t\t\t\ttmp = [],\r\n\t\t\t\ti = 0,\r\n\t\t\t\t// By happy coincidence, a (broken) gEBTN appears on DocumentFragment nodes too\r\n\t\t\t\tresults = context.getElementsByTagName( tag );\r\n\r\n\t\t\t// Filter out possible comments\r\n\t\t\tif ( tag === \"*\" ) {\r\n\t\t\t\twhile ( (elem = results[i++]) ) {\r\n\t\t\t\t\tif ( elem.nodeType === 1 ) {\r\n\t\t\t\t\t\ttmp.push( elem );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn tmp;\r\n\t\t\t}\r\n\t\t\treturn results;\r\n\t\t};\r\n\r\n\t// Class\r\n\tExpr.find[\"CLASS\"] = support.getElementsByClassName && function( className, context ) {\r\n\t\tif ( documentIsHTML ) {\r\n\t\t\treturn context.getElementsByClassName( className );\r\n\t\t}\r\n\t};\r\n\r\n\t/* QSA/matchesSelector\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// QSA and matchesSelector support\r\n\r\n\t// matchesSelector(:active) reports false when true (IE9/Opera 11.5)\r\n\trbuggyMatches = [];\r\n\r\n\t// qSa(:focus) reports false when true (Chrome 21)\r\n\t// We allow this because of a bug in IE8/9 that throws an error\r\n\t// whenever `document.activeElement` is accessed on an iframe\r\n\t// So, we allow :focus to pass through QSA all the time to avoid the IE error\r\n\t// See http://bugs.jquery.com/ticket/13378\r\n\trbuggyQSA = [];\r\n\r\n\tif ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {\r\n\t\t// Build QSA regex\r\n\t\t// Regex strategy adopted from Diego Perini\r\n\t\tassert(function( div ) {\r\n\t\t\t// Select is set to empty string on purpose\r\n\t\t\t// This is to test IE's treatment of not explicitly\r\n\t\t\t// setting a boolean content attribute,\r\n\t\t\t// since its presence should be enough\r\n\t\t\t// http://bugs.jquery.com/ticket/12359\r\n\t\t\tdocElem.appendChild( div ).innerHTML = \"<a id='\" + expando + \"'></a>\" +\r\n\t\t\t\t\"<select id='\" + expando + \"-\\f]' msallowcapture=''>\" +\r\n\t\t\t\t\"<option selected=''></option></select>\";\r\n\r\n\t\t\t// Support: IE8, Opera 11-12.16\r\n\t\t\t// Nothing should be selected when empty strings follow ^= or $= or *=\r\n\t\t\t// The test attribute must be unknown in Opera but \"safe\" for WinRT\r\n\t\t\t// http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section\r\n\t\t\tif ( div.querySelectorAll(\"[msallowcapture^='']\").length ) {\r\n\t\t\t\trbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:''|\\\"\\\")\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Support: IE8\r\n\t\t\t// Boolean attributes and \"value\" are not treated correctly\r\n\t\t\tif ( !div.querySelectorAll(\"[selected]\").length ) {\r\n\t\t\t\trbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:value|\" + booleans + \")\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Support: Chrome<29, Android<4.2+, Safari<7.0+, iOS<7.0+, PhantomJS<1.9.7+\r\n\t\t\tif ( !div.querySelectorAll( \"[id~=\" + expando + \"-]\" ).length ) {\r\n\t\t\t\trbuggyQSA.push(\"~=\");\r\n\t\t\t}\r\n\r\n\t\t\t// Webkit/Opera - :checked should return selected option elements\r\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\r\n\t\t\t// IE8 throws error here and will not see later tests\r\n\t\t\tif ( !div.querySelectorAll(\":checked\").length ) {\r\n\t\t\t\trbuggyQSA.push(\":checked\");\r\n\t\t\t}\r\n\r\n\t\t\t// Support: Safari 8+, iOS 8+\r\n\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=136851\r\n\t\t\t// In-page `selector#id sibing-combinator selector` fails\r\n\t\t\tif ( !div.querySelectorAll( \"a#\" + expando + \"+*\" ).length ) {\r\n\t\t\t\trbuggyQSA.push(\".#.+[+~]\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassert(function( div ) {\r\n\t\t\t// Support: Windows 8 Native Apps\r\n\t\t\t// The type and name attributes are restricted during .innerHTML assignment\r\n\t\t\tvar input = doc.createElement(\"input\");\r\n\t\t\tinput.setAttribute( \"type\", \"hidden\" );\r\n\t\t\tdiv.appendChild( input ).setAttribute( \"name\", \"D\" );\r\n\r\n\t\t\t// Support: IE8\r\n\t\t\t// Enforce case-sensitivity of name attribute\r\n\t\t\tif ( div.querySelectorAll(\"[name=d]\").length ) {\r\n\t\t\t\trbuggyQSA.push( \"name\" + whitespace + \"*[*^$|!~]?=\" );\r\n\t\t\t}\r\n\r\n\t\t\t// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\r\n\t\t\t// IE8 throws error here and will not see later tests\r\n\t\t\tif ( !div.querySelectorAll(\":enabled\").length ) {\r\n\t\t\t\trbuggyQSA.push( \":enabled\", \":disabled\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Opera 10-11 does not throw on post-comma invalid pseudos\r\n\t\t\tdiv.querySelectorAll(\"*,:x\");\r\n\t\t\trbuggyQSA.push(\",.*:\");\r\n\t\t});\r\n\t}\r\n\r\n\tif ( (support.matchesSelector = rnative.test( (matches = docElem.matches ||\r\n\t\tdocElem.webkitMatchesSelector ||\r\n\t\tdocElem.mozMatchesSelector ||\r\n\t\tdocElem.oMatchesSelector ||\r\n\t\tdocElem.msMatchesSelector) )) ) {\r\n\r\n\t\tassert(function( div ) {\r\n\t\t\t// Check to see if it's possible to do matchesSelector\r\n\t\t\t// on a disconnected node (IE 9)\r\n\t\t\tsupport.disconnectedMatch = matches.call( div, \"div\" );\r\n\r\n\t\t\t// This should fail with an exception\r\n\t\t\t// Gecko does not error, returns false instead\r\n\t\t\tmatches.call( div, \"[s!='']:x\" );\r\n\t\t\trbuggyMatches.push( \"!=\", pseudos );\r\n\t\t});\r\n\t}\r\n\r\n\trbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join(\"|\") );\r\n\trbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join(\"|\") );\r\n\r\n\t/* Contains\r\n\t---------------------------------------------------------------------- */\r\n\thasCompare = rnative.test( docElem.compareDocumentPosition );\r\n\r\n\t// Element contains another\r\n\t// Purposefully does not implement inclusive descendent\r\n\t// As in, an element does not contain itself\r\n\tcontains = hasCompare || rnative.test( docElem.contains ) ?\r\n\t\tfunction( a, b ) {\r\n\t\t\tvar adown = a.nodeType === 9 ? a.documentElement : a,\r\n\t\t\t\tbup = b && b.parentNode;\r\n\t\t\treturn a === bup || !!( bup && bup.nodeType === 1 && (\r\n\t\t\t\tadown.contains ?\r\n\t\t\t\t\tadown.contains( bup ) :\r\n\t\t\t\t\ta.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\r\n\t\t\t));\r\n\t\t} :\r\n\t\tfunction( a, b ) {\r\n\t\t\tif ( b ) {\r\n\t\t\t\twhile ( (b = b.parentNode) ) {\r\n\t\t\t\t\tif ( b === a ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t/* Sorting\r\n\t---------------------------------------------------------------------- */\r\n\r\n\t// Document order sorting\r\n\tsortOrder = hasCompare ?\r\n\tfunction( a, b ) {\r\n\r\n\t\t// Flag for duplicate removal\r\n\t\tif ( a === b ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\t// Sort on method existence if only one input has compareDocumentPosition\r\n\t\tvar compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\r\n\t\tif ( compare ) {\r\n\t\t\treturn compare;\r\n\t\t}\r\n\r\n\t\t// Calculate position if both inputs belong to the same document\r\n\t\tcompare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?\r\n\t\t\ta.compareDocumentPosition( b ) :\r\n\r\n\t\t\t// Otherwise we know they are disconnected\r\n\t\t\t1;\r\n\r\n\t\t// Disconnected nodes\r\n\t\tif ( compare & 1 ||\r\n\t\t\t(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {\r\n\r\n\t\t\t// Choose the first element that is related to our preferred document\r\n\t\t\tif ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tif ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Maintain original order\r\n\t\t\treturn sortInput ?\r\n\t\t\t\t( indexOf( sortInput, a ) - indexOf( sortInput, b ) ) :\r\n\t\t\t\t0;\r\n\t\t}\r\n\r\n\t\treturn compare & 4 ? -1 : 1;\r\n\t} :\r\n\tfunction( a, b ) {\r\n\t\t// Exit early if the nodes are identical\r\n\t\tif ( a === b ) {\r\n\t\t\thasDuplicate = true;\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tvar cur,\r\n\t\t\ti = 0,\r\n\t\t\taup = a.parentNode,\r\n\t\t\tbup = b.parentNode,\r\n\t\t\tap = [ a ],\r\n\t\t\tbp = [ b ];\r\n\r\n\t\t// Parentless nodes are either documents or disconnected\r\n\t\tif ( !aup || !bup ) {\r\n\t\t\treturn a === doc ? -1 :\r\n\t\t\t\tb === doc ? 1 :\r\n\t\t\t\taup ? -1 :\r\n\t\t\t\tbup ? 1 :\r\n\t\t\t\tsortInput ?\r\n\t\t\t\t( indexOf( sortInput, a ) - indexOf( sortInput, b ) ) :\r\n\t\t\t\t0;\r\n\r\n\t\t// If the nodes are siblings, we can do a quick check\r\n\t\t} else if ( aup === bup ) {\r\n\t\t\treturn siblingCheck( a, b );\r\n\t\t}\r\n\r\n\t\t// Otherwise we need full lists of their ancestors for comparison\r\n\t\tcur = a;\r\n\t\twhile ( (cur = cur.parentNode) ) {\r\n\t\t\tap.unshift( cur );\r\n\t\t}\r\n\t\tcur = b;\r\n\t\twhile ( (cur = cur.parentNode) ) {\r\n\t\t\tbp.unshift( cur );\r\n\t\t}\r\n\r\n\t\t// Walk down the tree looking for a discrepancy\r\n\t\twhile ( ap[i] === bp[i] ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\treturn i ?\r\n\t\t\t// Do a sibling check if the nodes have a common ancestor\r\n\t\t\tsiblingCheck( ap[i], bp[i] ) :\r\n\r\n\t\t\t// Otherwise nodes in our document sort first\r\n\t\t\tap[i] === preferredDoc ? -1 :\r\n\t\t\tbp[i] === preferredDoc ? 1 :\r\n\t\t\t0;\r\n\t};\r\n\r\n\treturn doc;\r\n};\r\n\r\nSizzle.matches = function( expr, elements ) {\r\n\treturn Sizzle( expr, null, null, elements );\r\n};\r\n\r\nSizzle.matchesSelector = function( elem, expr ) {\r\n\t// Set document vars if needed\r\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\r\n\t\tsetDocument( elem );\r\n\t}\r\n\r\n\t// Make sure that attribute selectors are quoted\r\n\texpr = expr.replace( rattributeQuotes, \"='$1']\" );\r\n\r\n\tif ( support.matchesSelector && documentIsHTML &&\r\n\t\t( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&\r\n\t\t( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {\r\n\r\n\t\ttry {\r\n\t\t\tvar ret = matches.call( elem, expr );\r\n\r\n\t\t\t// IE 9's matchesSelector returns false on disconnected nodes\r\n\t\t\tif ( ret || support.disconnectedMatch ||\r\n\t\t\t\t\t// As well, disconnected nodes are said to be in a document\r\n\t\t\t\t\t// fragment in IE 9\r\n\t\t\t\t\telem.document && elem.document.nodeType !== 11 ) {\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t}\r\n\r\n\treturn Sizzle( expr, document, null, [ elem ] ).length > 0;\r\n};\r\n\r\nSizzle.contains = function( context, elem ) {\r\n\t// Set document vars if needed\r\n\tif ( ( context.ownerDocument || context ) !== document ) {\r\n\t\tsetDocument( context );\r\n\t}\r\n\treturn contains( context, elem );\r\n};\r\n\r\nSizzle.attr = function( elem, name ) {\r\n\t// Set document vars if needed\r\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\r\n\t\tsetDocument( elem );\r\n\t}\r\n\r\n\tvar fn = Expr.attrHandle[ name.toLowerCase() ],\r\n\t\t// Don't get fooled by Object.prototype properties (jQuery #13807)\r\n\t\tval = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?\r\n\t\t\tfn( elem, name, !documentIsHTML ) :\r\n\t\t\tundefined;\r\n\r\n\treturn val !== undefined ?\r\n\t\tval :\r\n\t\tsupport.attributes || !documentIsHTML ?\r\n\t\t\telem.getAttribute( name ) :\r\n\t\t\t(val = elem.getAttributeNode(name)) && val.specified ?\r\n\t\t\t\tval.value :\r\n\t\t\t\tnull;\r\n};\r\n\r\nSizzle.error = function( msg ) {\r\n\tthrow new Error( \"Syntax error, unrecognized expression: \" + msg );\r\n};\r\n\r\n/**\r\n * Document sorting and removing duplicates\r\n * @param {ArrayLike} results\r\n */\r\nSizzle.uniqueSort = function( results ) {\r\n\tvar elem,\r\n\t\tduplicates = [],\r\n\t\tj = 0,\r\n\t\ti = 0;\r\n\r\n\t// Unless we *know* we can detect duplicates, assume their presence\r\n\thasDuplicate = !support.detectDuplicates;\r\n\tsortInput = !support.sortStable && results.slice( 0 );\r\n\tresults.sort( sortOrder );\r\n\r\n\tif ( hasDuplicate ) {\r\n\t\twhile ( (elem = results[i++]) ) {\r\n\t\t\tif ( elem === results[ i ] ) {\r\n\t\t\t\tj = duplicates.push( i );\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile ( j-- ) {\r\n\t\t\tresults.splice( duplicates[ j ], 1 );\r\n\t\t}\r\n\t}\r\n\r\n\t// Clear input after sorting to release objects\r\n\t// See https://github.com/jquery/sizzle/pull/225\r\n\tsortInput = null;\r\n\r\n\treturn results;\r\n};\r\n\r\n/**\r\n * Utility function for retrieving the text value of an array of DOM nodes\r\n * @param {Array|Element} elem\r\n */\r\ngetText = Sizzle.getText = function( elem ) {\r\n\tvar node,\r\n\t\tret = \"\",\r\n\t\ti = 0,\r\n\t\tnodeType = elem.nodeType;\r\n\r\n\tif ( !nodeType ) {\r\n\t\t// If no nodeType, this is expected to be an array\r\n\t\twhile ( (node = elem[i++]) ) {\r\n\t\t\t// Do not traverse comment nodes\r\n\t\t\tret += getText( node );\r\n\t\t}\r\n\t} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\r\n\t\t// Use textContent for elements\r\n\t\t// innerText usage removed for consistency of new lines (jQuery #11153)\r\n\t\tif ( typeof elem.textContent === \"string\" ) {\r\n\t\t\treturn elem.textContent;\r\n\t\t} else {\r\n\t\t\t// Traverse its children\r\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\r\n\t\t\t\tret += getText( elem );\r\n\t\t\t}\r\n\t\t}\r\n\t} else if ( nodeType === 3 || nodeType === 4 ) {\r\n\t\treturn elem.nodeValue;\r\n\t}\r\n\t// Do not include comment or processing instruction nodes\r\n\r\n\treturn ret;\r\n};\r\n\r\nExpr = Sizzle.selectors = {\r\n\r\n\t// Can be adjusted by the user\r\n\tcacheLength: 50,\r\n\r\n\tcreatePseudo: markFunction,\r\n\r\n\tmatch: matchExpr,\r\n\r\n\tattrHandle: {},\r\n\r\n\tfind: {},\r\n\r\n\trelative: {\r\n\t\t\">\": { dir: \"parentNode\", first: true },\r\n\t\t\" \": { dir: \"parentNode\" },\r\n\t\t\"+\": { dir: \"previousSibling\", first: true },\r\n\t\t\"~\": { dir: \"previousSibling\" }\r\n\t},\r\n\r\n\tpreFilter: {\r\n\t\t\"ATTR\": function( match ) {\r\n\t\t\tmatch[1] = match[1].replace( runescape, funescape );\r\n\r\n\t\t\t// Move the given value to match[3] whether quoted or unquoted\r\n\t\t\tmatch[3] = ( match[3] || match[4] || match[5] || \"\" ).replace( runescape, funescape );\r\n\r\n\t\t\tif ( match[2] === \"~=\" ) {\r\n\t\t\t\tmatch[3] = \" \" + match[3] + \" \";\r\n\t\t\t}\r\n\r\n\t\t\treturn match.slice( 0, 4 );\r\n\t\t},\r\n\r\n\t\t\"CHILD\": function( match ) {\r\n\t\t\t/* matches from matchExpr[\"CHILD\"]\r\n\t\t\t\t1 type (only|nth|...)\r\n\t\t\t\t2 what (child|of-type)\r\n\t\t\t\t3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\r\n\t\t\t\t4 xn-component of xn+y argument ([+-]?\\d*n|)\r\n\t\t\t\t5 sign of xn-component\r\n\t\t\t\t6 x of xn-component\r\n\t\t\t\t7 sign of y-component\r\n\t\t\t\t8 y of y-component\r\n\t\t\t*/\r\n\t\t\tmatch[1] = match[1].toLowerCase();\r\n\r\n\t\t\tif ( match[1].slice( 0, 3 ) === \"nth\" ) {\r\n\t\t\t\t// nth-* requires argument\r\n\t\t\t\tif ( !match[3] ) {\r\n\t\t\t\t\tSizzle.error( match[0] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// numeric x and y parameters for Expr.filter.CHILD\r\n\t\t\t\t// remember that false/true cast respectively to 0/1\r\n\t\t\t\tmatch[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === \"even\" || match[3] === \"odd\" ) );\r\n\t\t\t\tmatch[5] = +( ( match[7] + match[8] ) || match[3] === \"odd\" );\r\n\r\n\t\t\t// other types prohibit arguments\r\n\t\t\t} else if ( match[3] ) {\r\n\t\t\t\tSizzle.error( match[0] );\r\n\t\t\t}\r\n\r\n\t\t\treturn match;\r\n\t\t},\r\n\r\n\t\t\"PSEUDO\": function( match ) {\r\n\t\t\tvar excess,\r\n\t\t\t\tunquoted = !match[6] && match[2];\r\n\r\n\t\t\tif ( matchExpr[\"CHILD\"].test( match[0] ) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\t// Accept quoted arguments as-is\r\n\t\t\tif ( match[3] ) {\r\n\t\t\t\tmatch[2] = match[4] || match[5] || \"\";\r\n\r\n\t\t\t// Strip excess characters from unquoted arguments\r\n\t\t\t} else if ( unquoted && rpseudo.test( unquoted ) &&\r\n\t\t\t\t// Get excess from tokenize (recursively)\r\n\t\t\t\t(excess = tokenize( unquoted, true )) &&\r\n\t\t\t\t// advance to the next closing parenthesis\r\n\t\t\t\t(excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length) ) {\r\n\r\n\t\t\t\t// excess is a negative index\r\n\t\t\t\tmatch[0] = match[0].slice( 0, excess );\r\n\t\t\t\tmatch[2] = unquoted.slice( 0, excess );\r\n\t\t\t}\r\n\r\n\t\t\t// Return only captures needed by the pseudo filter method (type and argument)\r\n\t\t\treturn match.slice( 0, 3 );\r\n\t\t}\r\n\t},\r\n\r\n\tfilter: {\r\n\r\n\t\t\"TAG\": function( nodeNameSelector ) {\r\n\t\t\tvar nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();\r\n\t\t\treturn nodeNameSelector === \"*\" ?\r\n\t\t\t\tfunction() { return true; } :\r\n\t\t\t\tfunction( elem ) {\r\n\t\t\t\t\treturn elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\r\n\t\t\t\t};\r\n\t\t},\r\n\r\n\t\t\"CLASS\": function( className ) {\r\n\t\t\tvar pattern = classCache[ className + \" \" ];\r\n\r\n\t\t\treturn pattern ||\r\n\t\t\t\t(pattern = new RegExp( \"(^|\" + whitespace + \")\" + className + \"(\" + whitespace + \"|$)\" )) &&\r\n\t\t\t\tclassCache( className, function( elem ) {\r\n\t\t\t\t\treturn pattern.test( typeof elem.className === \"string\" && elem.className || typeof elem.getAttribute !== \"undefined\" && elem.getAttribute(\"class\") || \"\" );\r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\t\"ATTR\": function( name, operator, check ) {\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\tvar result = Sizzle.attr( elem, name );\r\n\r\n\t\t\t\tif ( result == null ) {\r\n\t\t\t\t\treturn operator === \"!=\";\r\n\t\t\t\t}\r\n\t\t\t\tif ( !operator ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresult += \"\";\r\n\r\n\t\t\t\treturn operator === \"=\" ? result === check :\r\n\t\t\t\t\toperator === \"!=\" ? result !== check :\r\n\t\t\t\t\toperator === \"^=\" ? check && result.indexOf( check ) === 0 :\r\n\t\t\t\t\toperator === \"*=\" ? check && result.indexOf( check ) > -1 :\r\n\t\t\t\t\toperator === \"$=\" ? check && result.slice( -check.length ) === check :\r\n\t\t\t\t\toperator === \"~=\" ? ( \" \" + result.replace( rwhitespace, \" \" ) + \" \" ).indexOf( check ) > -1 :\r\n\t\t\t\t\toperator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\r\n\t\t\t\t\tfalse;\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t\"CHILD\": function( type, what, argument, first, last ) {\r\n\t\t\tvar simple = type.slice( 0, 3 ) !== \"nth\",\r\n\t\t\t\tforward = type.slice( -4 ) !== \"last\",\r\n\t\t\t\tofType = what === \"of-type\";\r\n\r\n\t\t\treturn first === 1 && last === 0 ?\r\n\r\n\t\t\t\t// Shortcut for :nth-*(n)\r\n\t\t\t\tfunction( elem ) {\r\n\t\t\t\t\treturn !!elem.parentNode;\r\n\t\t\t\t} :\r\n\r\n\t\t\t\tfunction( elem, context, xml ) {\r\n\t\t\t\t\tvar cache, outerCache, node, diff, nodeIndex, start,\r\n\t\t\t\t\t\tdir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\r\n\t\t\t\t\t\tparent = elem.parentNode,\r\n\t\t\t\t\t\tname = ofType && elem.nodeName.toLowerCase(),\r\n\t\t\t\t\t\tuseCache = !xml && !ofType;\r\n\r\n\t\t\t\t\tif ( parent ) {\r\n\r\n\t\t\t\t\t\t// :(first|last|only)-(child|of-type)\r\n\t\t\t\t\t\tif ( simple ) {\r\n\t\t\t\t\t\t\twhile ( dir ) {\r\n\t\t\t\t\t\t\t\tnode = elem;\r\n\t\t\t\t\t\t\t\twhile ( (node = node[ dir ]) ) {\r\n\t\t\t\t\t\t\t\t\tif ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// Reverse direction for :only-* (if we haven't yet done so)\r\n\t\t\t\t\t\t\t\tstart = dir = type === \"only\" && !start && \"nextSibling\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstart = [ forward ? parent.firstChild : parent.lastChild ];\r\n\r\n\t\t\t\t\t\t// non-xml :nth-child(...) stores cache data on `parent`\r\n\t\t\t\t\t\tif ( forward && useCache ) {\r\n\t\t\t\t\t\t\t// Seek `elem` from a previously-cached index\r\n\t\t\t\t\t\t\touterCache = parent[ expando ] || (parent[ expando ] = {});\r\n\t\t\t\t\t\t\tcache = outerCache[ type ] || [];\r\n\t\t\t\t\t\t\tnodeIndex = cache[0] === dirruns && cache[1];\r\n\t\t\t\t\t\t\tdiff = cache[0] === dirruns && cache[2];\r\n\t\t\t\t\t\t\tnode = nodeIndex && parent.childNodes[ nodeIndex ];\r\n\r\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\r\n\r\n\t\t\t\t\t\t\t\t// Fallback to seeking `elem` from the start\r\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\r\n\r\n\t\t\t\t\t\t\t\t// When found, cache indexes on `parent` and break\r\n\t\t\t\t\t\t\t\tif ( node.nodeType === 1 && ++diff && node === elem ) {\r\n\t\t\t\t\t\t\t\t\touterCache[ type ] = [ dirruns, nodeIndex, diff ];\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Use previously-cached element index if available\r\n\t\t\t\t\t\t} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {\r\n\t\t\t\t\t\t\tdiff = cache[1];\r\n\r\n\t\t\t\t\t\t// xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Use the same loop as above to seek `elem` from the start\r\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\r\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {\r\n\t\t\t\t\t\t\t\t\t// Cache the index of each encountered element\r\n\t\t\t\t\t\t\t\t\tif ( useCache ) {\r\n\t\t\t\t\t\t\t\t\t\t(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif ( node === elem ) {\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Incorporate the offset, then check against cycle size\r\n\t\t\t\t\t\tdiff -= last;\r\n\t\t\t\t\t\treturn diff === first || ( diff % first === 0 && diff / first >= 0 );\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t},\r\n\r\n\t\t\"PSEUDO\": function( pseudo, argument ) {\r\n\t\t\t// pseudo-class names are case-insensitive\r\n\t\t\t// http://www.w3.org/TR/selectors/#pseudo-classes\r\n\t\t\t// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\r\n\t\t\t// Remember that setFilters inherits from pseudos\r\n\t\t\tvar args,\r\n\t\t\t\tfn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\r\n\t\t\t\t\tSizzle.error( \"unsupported pseudo: \" + pseudo );\r\n\r\n\t\t\t// The user may use createPseudo to indicate that\r\n\t\t\t// arguments are needed to create the filter function\r\n\t\t\t// just as Sizzle does\r\n\t\t\tif ( fn[ expando ] ) {\r\n\t\t\t\treturn fn( argument );\r\n\t\t\t}\r\n\r\n\t\t\t// But maintain support for old signatures\r\n\t\t\tif ( fn.length > 1 ) {\r\n\t\t\t\targs = [ pseudo, pseudo, \"\", argument ];\r\n\t\t\t\treturn Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\r\n\t\t\t\t\tmarkFunction(function( seed, matches ) {\r\n\t\t\t\t\t\tvar idx,\r\n\t\t\t\t\t\t\tmatched = fn( seed, argument ),\r\n\t\t\t\t\t\t\ti = matched.length;\r\n\t\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\t\tidx = indexOf( seed, matched[i] );\r\n\t\t\t\t\t\t\tseed[ idx ] = !( matches[ idx ] = matched[i] );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}) :\r\n\t\t\t\t\tfunction( elem ) {\r\n\t\t\t\t\t\treturn fn( elem, 0, args );\r\n\t\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn fn;\r\n\t\t}\r\n\t},\r\n\r\n\tpseudos: {\r\n\t\t// Potentially complex pseudos\r\n\t\t\"not\": markFunction(function( selector ) {\r\n\t\t\t// Trim the selector passed to compile\r\n\t\t\t// to avoid treating leading and trailing\r\n\t\t\t// spaces as combinators\r\n\t\t\tvar input = [],\r\n\t\t\t\tresults = [],\r\n\t\t\t\tmatcher = compile( selector.replace( rtrim, \"$1\" ) );\r\n\r\n\t\t\treturn matcher[ expando ] ?\r\n\t\t\t\tmarkFunction(function( seed, matches, context, xml ) {\r\n\t\t\t\t\tvar elem,\r\n\t\t\t\t\t\tunmatched = matcher( seed, null, xml, [] ),\r\n\t\t\t\t\t\ti = seed.length;\r\n\r\n\t\t\t\t\t// Match elements unmatched by `matcher`\r\n\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\tif ( (elem = unmatched[i]) ) {\r\n\t\t\t\t\t\t\tseed[i] = !(matches[i] = elem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}) :\r\n\t\t\t\tfunction( elem, context, xml ) {\r\n\t\t\t\t\tinput[0] = elem;\r\n\t\t\t\t\tmatcher( input, null, xml, results );\r\n\t\t\t\t\t// Don't keep the element (issue #299)\r\n\t\t\t\t\tinput[0] = null;\r\n\t\t\t\t\treturn !results.pop();\r\n\t\t\t\t};\r\n\t\t}),\r\n\r\n\t\t\"has\": markFunction(function( selector ) {\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\treturn Sizzle( selector, elem ).length > 0;\r\n\t\t\t};\r\n\t\t}),\r\n\r\n\t\t\"contains\": markFunction(function( text ) {\r\n\t\t\ttext = text.replace( runescape, funescape );\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\treturn ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;\r\n\t\t\t};\r\n\t\t}),\r\n\r\n\t\t// \"Whether an element is represented by a :lang() selector\r\n\t\t// is based solely on the element's language value\r\n\t\t// being equal to the identifier C,\r\n\t\t// or beginning with the identifier C immediately followed by \"-\".\r\n\t\t// The matching of C against the element's language value is performed case-insensitively.\r\n\t\t// The identifier C does not have to be a valid language name.\"\r\n\t\t// http://www.w3.org/TR/selectors/#lang-pseudo\r\n\t\t\"lang\": markFunction( function( lang ) {\r\n\t\t\t// lang value must be a valid identifier\r\n\t\t\tif ( !ridentifier.test(lang || \"\") ) {\r\n\t\t\t\tSizzle.error( \"unsupported lang: \" + lang );\r\n\t\t\t}\r\n\t\t\tlang = lang.replace( runescape, funescape ).toLowerCase();\r\n\t\t\treturn function( elem ) {\r\n\t\t\t\tvar elemLang;\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif ( (elemLang = documentIsHTML ?\r\n\t\t\t\t\t\telem.lang :\r\n\t\t\t\t\t\telem.getAttribute(\"xml:lang\") || elem.getAttribute(\"lang\")) ) {\r\n\r\n\t\t\t\t\t\telemLang = elemLang.toLowerCase();\r\n\t\t\t\t\t\treturn elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} while ( (elem = elem.parentNode) && elem.nodeType === 1 );\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t}),\r\n\r\n\t\t// Miscellaneous\r\n\t\t\"target\": function( elem ) {\r\n\t\t\tvar hash = window.location && window.location.hash;\r\n\t\t\treturn hash && hash.slice( 1 ) === elem.id;\r\n\t\t},\r\n\r\n\t\t\"root\": function( elem ) {\r\n\t\t\treturn elem === docElem;\r\n\t\t},\r\n\r\n\t\t\"focus\": function( elem ) {\r\n\t\t\treturn elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\r\n\t\t},\r\n\r\n\t\t// Boolean properties\r\n\t\t\"enabled\": function( elem ) {\r\n\t\t\treturn elem.disabled === false;\r\n\t\t},\r\n\r\n\t\t\"disabled\": function( elem ) {\r\n\t\t\treturn elem.disabled === true;\r\n\t\t},\r\n\r\n\t\t\"checked\": function( elem ) {\r\n\t\t\t// In CSS3, :checked should return both checked and selected elements\r\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\r\n\t\t\tvar nodeName = elem.nodeName.toLowerCase();\r\n\t\t\treturn (nodeName === \"input\" && !!elem.checked) || (nodeName === \"option\" && !!elem.selected);\r\n\t\t},\r\n\r\n\t\t\"selected\": function( elem ) {\r\n\t\t\t// Accessing this property makes selected-by-default\r\n\t\t\t// options in Safari work properly\r\n\t\t\tif ( elem.parentNode ) {\r\n\t\t\t\telem.parentNode.selectedIndex;\r\n\t\t\t}\r\n\r\n\t\t\treturn elem.selected === true;\r\n\t\t},\r\n\r\n\t\t// Contents\r\n\t\t\"empty\": function( elem ) {\r\n\t\t\t// http://www.w3.org/TR/selectors/#empty-pseudo\r\n\t\t\t// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),\r\n\t\t\t//   but not by others (comment: 8; processing instruction: 7; etc.)\r\n\t\t\t// nodeType < 6 works because attributes (2) do not appear as children\r\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\r\n\t\t\t\tif ( elem.nodeType < 6 ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t\"parent\": function( elem ) {\r\n\t\t\treturn !Expr.pseudos[\"empty\"]( elem );\r\n\t\t},\r\n\r\n\t\t// Element/input types\r\n\t\t\"header\": function( elem ) {\r\n\t\t\treturn rheader.test( elem.nodeName );\r\n\t\t},\r\n\r\n\t\t\"input\": function( elem ) {\r\n\t\t\treturn rinputs.test( elem.nodeName );\r\n\t\t},\r\n\r\n\t\t\"button\": function( elem ) {\r\n\t\t\tvar name = elem.nodeName.toLowerCase();\r\n\t\t\treturn name === \"input\" && elem.type === \"button\" || name === \"button\";\r\n\t\t},\r\n\r\n\t\t\"text\": function( elem ) {\r\n\t\t\tvar attr;\r\n\t\t\treturn elem.nodeName.toLowerCase() === \"input\" &&\r\n\t\t\t\telem.type === \"text\" &&\r\n\r\n\t\t\t\t// Support: IE<8\r\n\t\t\t\t// New HTML5 attribute values (e.g., \"search\") appear with elem.type === \"text\"\r\n\t\t\t\t( (attr = elem.getAttribute(\"type\")) == null || attr.toLowerCase() === \"text\" );\r\n\t\t},\r\n\r\n\t\t// Position-in-collection\r\n\t\t\"first\": createPositionalPseudo(function() {\r\n\t\t\treturn [ 0 ];\r\n\t\t}),\r\n\r\n\t\t\"last\": createPositionalPseudo(function( matchIndexes, length ) {\r\n\t\t\treturn [ length - 1 ];\r\n\t\t}),\r\n\r\n\t\t\"eq\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n\t\t\treturn [ argument < 0 ? argument + length : argument ];\r\n\t\t}),\r\n\r\n\t\t\"even\": createPositionalPseudo(function( matchIndexes, length ) {\r\n\t\t\tvar i = 0;\r\n\t\t\tfor ( ; i < length; i += 2 ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t}),\r\n\r\n\t\t\"odd\": createPositionalPseudo(function( matchIndexes, length ) {\r\n\t\t\tvar i = 1;\r\n\t\t\tfor ( ; i < length; i += 2 ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t}),\r\n\r\n\t\t\"lt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n\t\t\tvar i = argument < 0 ? argument + length : argument;\r\n\t\t\tfor ( ; --i >= 0; ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t}),\r\n\r\n\t\t\"gt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\r\n\t\t\tvar i = argument < 0 ? argument + length : argument;\r\n\t\t\tfor ( ; ++i < length; ) {\r\n\t\t\t\tmatchIndexes.push( i );\r\n\t\t\t}\r\n\t\t\treturn matchIndexes;\r\n\t\t})\r\n\t}\r\n};\r\n\r\nExpr.pseudos[\"nth\"] = Expr.pseudos[\"eq\"];\r\n\r\n// Add button/input type pseudos\r\nfor ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\r\n\tExpr.pseudos[ i ] = createInputPseudo( i );\r\n}\r\nfor ( i in { submit: true, reset: true } ) {\r\n\tExpr.pseudos[ i ] = createButtonPseudo( i );\r\n}\r\n\r\n// Easy API for creating new setFilters\r\nfunction setFilters() {}\r\nsetFilters.prototype = Expr.filters = Expr.pseudos;\r\nExpr.setFilters = new setFilters();\r\n\r\ntokenize = Sizzle.tokenize = function( selector, parseOnly ) {\r\n\tvar matched, match, tokens, type,\r\n\t\tsoFar, groups, preFilters,\r\n\t\tcached = tokenCache[ selector + \" \" ];\r\n\r\n\tif ( cached ) {\r\n\t\treturn parseOnly ? 0 : cached.slice( 0 );\r\n\t}\r\n\r\n\tsoFar = selector;\r\n\tgroups = [];\r\n\tpreFilters = Expr.preFilter;\r\n\r\n\twhile ( soFar ) {\r\n\r\n\t\t// Comma and first run\r\n\t\tif ( !matched || (match = rcomma.exec( soFar )) ) {\r\n\t\t\tif ( match ) {\r\n\t\t\t\t// Don't consume trailing commas as valid\r\n\t\t\t\tsoFar = soFar.slice( match[0].length ) || soFar;\r\n\t\t\t}\r\n\t\t\tgroups.push( (tokens = []) );\r\n\t\t}\r\n\r\n\t\tmatched = false;\r\n\r\n\t\t// Combinators\r\n\t\tif ( (match = rcombinators.exec( soFar )) ) {\r\n\t\t\tmatched = match.shift();\r\n\t\t\ttokens.push({\r\n\t\t\t\tvalue: matched,\r\n\t\t\t\t// Cast descendant combinators to space\r\n\t\t\t\ttype: match[0].replace( rtrim, \" \" )\r\n\t\t\t});\r\n\t\t\tsoFar = soFar.slice( matched.length );\r\n\t\t}\r\n\r\n\t\t// Filters\r\n\t\tfor ( type in Expr.filter ) {\r\n\t\t\tif ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||\r\n\t\t\t\t(match = preFilters[ type ]( match ))) ) {\r\n\t\t\t\tmatched = match.shift();\r\n\t\t\t\ttokens.push({\r\n\t\t\t\t\tvalue: matched,\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tmatches: match\r\n\t\t\t\t});\r\n\t\t\t\tsoFar = soFar.slice( matched.length );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( !matched ) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t// Return the length of the invalid excess\r\n\t// if we're just parsing\r\n\t// Otherwise, throw an error or return tokens\r\n\treturn parseOnly ?\r\n\t\tsoFar.length :\r\n\t\tsoFar ?\r\n\t\t\tSizzle.error( selector ) :\r\n\t\t\t// Cache the tokens\r\n\t\t\ttokenCache( selector, groups ).slice( 0 );\r\n};\r\n\r\nfunction toSelector( tokens ) {\r\n\tvar i = 0,\r\n\t\tlen = tokens.length,\r\n\t\tselector = \"\";\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tselector += tokens[i].value;\r\n\t}\r\n\treturn selector;\r\n}\r\n\r\nfunction addCombinator( matcher, combinator, base ) {\r\n\tvar dir = combinator.dir,\r\n\t\tcheckNonElements = base && dir === \"parentNode\",\r\n\t\tdoneName = done++;\r\n\r\n\treturn combinator.first ?\r\n\t\t// Check against closest ancestor/preceding element\r\n\t\tfunction( elem, context, xml ) {\r\n\t\t\twhile ( (elem = elem[ dir ]) ) {\r\n\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\r\n\t\t\t\t\treturn matcher( elem, context, xml );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} :\r\n\r\n\t\t// Check against all ancestor/preceding elements\r\n\t\tfunction( elem, context, xml ) {\r\n\t\t\tvar oldCache, outerCache,\r\n\t\t\t\tnewCache = [ dirruns, doneName ];\r\n\r\n\t\t\t// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching\r\n\t\t\tif ( xml ) {\r\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\r\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\r\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\r\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\r\n\t\t\t\t\t\touterCache = elem[ expando ] || (elem[ expando ] = {});\r\n\t\t\t\t\t\tif ( (oldCache = outerCache[ dir ]) &&\r\n\t\t\t\t\t\t\toldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {\r\n\r\n\t\t\t\t\t\t\t// Assign to newCache so results back-propagate to previous elements\r\n\t\t\t\t\t\t\treturn (newCache[ 2 ] = oldCache[ 2 ]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Reuse newcache so results back-propagate to previous elements\r\n\t\t\t\t\t\t\touterCache[ dir ] = newCache;\r\n\r\n\t\t\t\t\t\t\t// A match means we're done; a fail means we have to keep checking\r\n\t\t\t\t\t\t\tif ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n}\r\n\r\nfunction elementMatcher( matchers ) {\r\n\treturn matchers.length > 1 ?\r\n\t\tfunction( elem, context, xml ) {\r\n\t\t\tvar i = matchers.length;\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tif ( !matchers[i]( elem, context, xml ) ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} :\r\n\t\tmatchers[0];\r\n}\r\n\r\nfunction multipleContexts( selector, contexts, results ) {\r\n\tvar i = 0,\r\n\t\tlen = contexts.length;\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tSizzle( selector, contexts[i], results );\r\n\t}\r\n\treturn results;\r\n}\r\n\r\nfunction condense( unmatched, map, filter, context, xml ) {\r\n\tvar elem,\r\n\t\tnewUnmatched = [],\r\n\t\ti = 0,\r\n\t\tlen = unmatched.length,\r\n\t\tmapped = map != null;\r\n\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tif ( (elem = unmatched[i]) ) {\r\n\t\t\tif ( !filter || filter( elem, context, xml ) ) {\r\n\t\t\t\tnewUnmatched.push( elem );\r\n\t\t\t\tif ( mapped ) {\r\n\t\t\t\t\tmap.push( i );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn newUnmatched;\r\n}\r\n\r\nfunction setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\r\n\tif ( postFilter && !postFilter[ expando ] ) {\r\n\t\tpostFilter = setMatcher( postFilter );\r\n\t}\r\n\tif ( postFinder && !postFinder[ expando ] ) {\r\n\t\tpostFinder = setMatcher( postFinder, postSelector );\r\n\t}\r\n\treturn markFunction(function( seed, results, context, xml ) {\r\n\t\tvar temp, i, elem,\r\n\t\t\tpreMap = [],\r\n\t\t\tpostMap = [],\r\n\t\t\tpreexisting = results.length,\r\n\r\n\t\t\t// Get initial elements from seed or context\r\n\t\t\telems = seed || multipleContexts( selector || \"*\", context.nodeType ? [ context ] : context, [] ),\r\n\r\n\t\t\t// Prefilter to get matcher input, preserving a map for seed-results synchronization\r\n\t\t\tmatcherIn = preFilter && ( seed || !selector ) ?\r\n\t\t\t\tcondense( elems, preMap, preFilter, context, xml ) :\r\n\t\t\t\telems,\r\n\r\n\t\t\tmatcherOut = matcher ?\r\n\t\t\t\t// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\r\n\t\t\t\tpostFinder || ( seed ? preFilter : preexisting || postFilter ) ?\r\n\r\n\t\t\t\t\t// ...intermediate processing is necessary\r\n\t\t\t\t\t[] :\r\n\r\n\t\t\t\t\t// ...otherwise use results directly\r\n\t\t\t\t\tresults :\r\n\t\t\t\tmatcherIn;\r\n\r\n\t\t// Find primary matches\r\n\t\tif ( matcher ) {\r\n\t\t\tmatcher( matcherIn, matcherOut, context, xml );\r\n\t\t}\r\n\r\n\t\t// Apply postFilter\r\n\t\tif ( postFilter ) {\r\n\t\t\ttemp = condense( matcherOut, postMap );\r\n\t\t\tpostFilter( temp, [], context, xml );\r\n\r\n\t\t\t// Un-match failing elements by moving them back to matcherIn\r\n\t\t\ti = temp.length;\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tif ( (elem = temp[i]) ) {\r\n\t\t\t\t\tmatcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( seed ) {\r\n\t\t\tif ( postFinder || preFilter ) {\r\n\t\t\t\tif ( postFinder ) {\r\n\t\t\t\t\t// Get the final matcherOut by condensing this intermediate into postFinder contexts\r\n\t\t\t\t\ttemp = [];\r\n\t\t\t\t\ti = matcherOut.length;\r\n\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\tif ( (elem = matcherOut[i]) ) {\r\n\t\t\t\t\t\t\t// Restore matcherIn since elem is not yet a final match\r\n\t\t\t\t\t\t\ttemp.push( (matcherIn[i] = elem) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpostFinder( null, (matcherOut = []), temp, xml );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move matched elements from seed to results to keep them synchronized\r\n\t\t\t\ti = matcherOut.length;\r\n\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\tif ( (elem = matcherOut[i]) &&\r\n\t\t\t\t\t\t(temp = postFinder ? indexOf( seed, elem ) : preMap[i]) > -1 ) {\r\n\r\n\t\t\t\t\t\tseed[temp] = !(results[temp] = elem);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t// Add elements to results, through postFinder if defined\r\n\t\t} else {\r\n\t\t\tmatcherOut = condense(\r\n\t\t\t\tmatcherOut === results ?\r\n\t\t\t\t\tmatcherOut.splice( preexisting, matcherOut.length ) :\r\n\t\t\t\t\tmatcherOut\r\n\t\t\t);\r\n\t\t\tif ( postFinder ) {\r\n\t\t\t\tpostFinder( null, results, matcherOut, xml );\r\n\t\t\t} else {\r\n\t\t\t\tpush.apply( results, matcherOut );\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction matcherFromTokens( tokens ) {\r\n\tvar checkContext, matcher, j,\r\n\t\tlen = tokens.length,\r\n\t\tleadingRelative = Expr.relative[ tokens[0].type ],\r\n\t\timplicitRelative = leadingRelative || Expr.relative[\" \"],\r\n\t\ti = leadingRelative ? 1 : 0,\r\n\r\n\t\t// The foundational matcher ensures that elements are reachable from top-level context(s)\r\n\t\tmatchContext = addCombinator( function( elem ) {\r\n\t\t\treturn elem === checkContext;\r\n\t\t}, implicitRelative, true ),\r\n\t\tmatchAnyContext = addCombinator( function( elem ) {\r\n\t\t\treturn indexOf( checkContext, elem ) > -1;\r\n\t\t}, implicitRelative, true ),\r\n\t\tmatchers = [ function( elem, context, xml ) {\r\n\t\t\tvar ret = ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\r\n\t\t\t\t(checkContext = context).nodeType ?\r\n\t\t\t\t\tmatchContext( elem, context, xml ) :\r\n\t\t\t\t\tmatchAnyContext( elem, context, xml ) );\r\n\t\t\t// Avoid hanging onto element (issue #299)\r\n\t\t\tcheckContext = null;\r\n\t\t\treturn ret;\r\n\t\t} ];\r\n\r\n\tfor ( ; i < len; i++ ) {\r\n\t\tif ( (matcher = Expr.relative[ tokens[i].type ]) ) {\r\n\t\t\tmatchers = [ addCombinator(elementMatcher( matchers ), matcher) ];\r\n\t\t} else {\r\n\t\t\tmatcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );\r\n\r\n\t\t\t// Return special upon seeing a positional matcher\r\n\t\t\tif ( matcher[ expando ] ) {\r\n\t\t\t\t// Find the next relative operator (if any) for proper handling\r\n\t\t\t\tj = ++i;\r\n\t\t\t\tfor ( ; j < len; j++ ) {\r\n\t\t\t\t\tif ( Expr.relative[ tokens[j].type ] ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn setMatcher(\r\n\t\t\t\t\ti > 1 && elementMatcher( matchers ),\r\n\t\t\t\t\ti > 1 && toSelector(\r\n\t\t\t\t\t\t// If the preceding token was a descendant combinator, insert an implicit any-element `*`\r\n\t\t\t\t\t\ttokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === \" \" ? \"*\" : \"\" })\r\n\t\t\t\t\t).replace( rtrim, \"$1\" ),\r\n\t\t\t\t\tmatcher,\r\n\t\t\t\t\ti < j && matcherFromTokens( tokens.slice( i, j ) ),\r\n\t\t\t\t\tj < len && matcherFromTokens( (tokens = tokens.slice( j )) ),\r\n\t\t\t\t\tj < len && toSelector( tokens )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tmatchers.push( matcher );\r\n\t\t}\r\n\t}\r\n\r\n\treturn elementMatcher( matchers );\r\n}\r\n\r\nfunction matcherFromGroupMatchers( elementMatchers, setMatchers ) {\r\n\tvar bySet = setMatchers.length > 0,\r\n\t\tbyElement = elementMatchers.length > 0,\r\n\t\tsuperMatcher = function( seed, context, xml, results, outermost ) {\r\n\t\t\tvar elem, j, matcher,\r\n\t\t\t\tmatchedCount = 0,\r\n\t\t\t\ti = \"0\",\r\n\t\t\t\tunmatched = seed && [],\r\n\t\t\t\tsetMatched = [],\r\n\t\t\t\tcontextBackup = outermostContext,\r\n\t\t\t\t// We must always have either seed elements or outermost context\r\n\t\t\t\telems = seed || byElement && Expr.find[\"TAG\"]( \"*\", outermost ),\r\n\t\t\t\t// Use integer dirruns iff this is the outermost matcher\r\n\t\t\t\tdirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),\r\n\t\t\t\tlen = elems.length;\r\n\r\n\t\t\tif ( outermost ) {\r\n\t\t\t\toutermostContext = context !== document && context;\r\n\t\t\t}\r\n\r\n\t\t\t// Add elements passing elementMatchers directly to results\r\n\t\t\t// Keep `i` a string if there are no elements so `matchedCount` will be \"00\" below\r\n\t\t\t// Support: IE<9, Safari\r\n\t\t\t// Tolerate NodeList properties (IE: \"length\"; Safari: <number>) matching elements by id\r\n\t\t\tfor ( ; i !== len && (elem = elems[i]) != null; i++ ) {\r\n\t\t\t\tif ( byElement && elem ) {\r\n\t\t\t\t\tj = 0;\r\n\t\t\t\t\twhile ( (matcher = elementMatchers[j++]) ) {\r\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\r\n\t\t\t\t\t\t\tresults.push( elem );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( outermost ) {\r\n\t\t\t\t\t\tdirruns = dirrunsUnique;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Track unmatched elements for set filters\r\n\t\t\t\tif ( bySet ) {\r\n\t\t\t\t\t// They will have gone through all possible matchers\r\n\t\t\t\t\tif ( (elem = !matcher && elem) ) {\r\n\t\t\t\t\t\tmatchedCount--;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Lengthen the array for every element, matched or not\r\n\t\t\t\t\tif ( seed ) {\r\n\t\t\t\t\t\tunmatched.push( elem );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Apply set filters to unmatched elements\r\n\t\t\tmatchedCount += i;\r\n\t\t\tif ( bySet && i !== matchedCount ) {\r\n\t\t\t\tj = 0;\r\n\t\t\t\twhile ( (matcher = setMatchers[j++]) ) {\r\n\t\t\t\t\tmatcher( unmatched, setMatched, context, xml );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( seed ) {\r\n\t\t\t\t\t// Reintegrate element matches to eliminate the need for sorting\r\n\t\t\t\t\tif ( matchedCount > 0 ) {\r\n\t\t\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\t\t\tif ( !(unmatched[i] || setMatched[i]) ) {\r\n\t\t\t\t\t\t\t\tsetMatched[i] = pop.call( results );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Discard index placeholder values to get only actual matches\r\n\t\t\t\t\tsetMatched = condense( setMatched );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add matches to results\r\n\t\t\t\tpush.apply( results, setMatched );\r\n\r\n\t\t\t\t// Seedless set matches succeeding multiple successful matchers stipulate sorting\r\n\t\t\t\tif ( outermost && !seed && setMatched.length > 0 &&\r\n\t\t\t\t\t( matchedCount + setMatchers.length ) > 1 ) {\r\n\r\n\t\t\t\t\tSizzle.uniqueSort( results );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Override manipulation of globals by nested matchers\r\n\t\t\tif ( outermost ) {\r\n\t\t\t\tdirruns = dirrunsUnique;\r\n\t\t\t\toutermostContext = contextBackup;\r\n\t\t\t}\r\n\r\n\t\t\treturn unmatched;\r\n\t\t};\r\n\r\n\treturn bySet ?\r\n\t\tmarkFunction( superMatcher ) :\r\n\t\tsuperMatcher;\r\n}\r\n\r\ncompile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {\r\n\tvar i,\r\n\t\tsetMatchers = [],\r\n\t\telementMatchers = [],\r\n\t\tcached = compilerCache[ selector + \" \" ];\r\n\r\n\tif ( !cached ) {\r\n\t\t// Generate a function of recursive functions that can be used to check each element\r\n\t\tif ( !match ) {\r\n\t\t\tmatch = tokenize( selector );\r\n\t\t}\r\n\t\ti = match.length;\r\n\t\twhile ( i-- ) {\r\n\t\t\tcached = matcherFromTokens( match[i] );\r\n\t\t\tif ( cached[ expando ] ) {\r\n\t\t\t\tsetMatchers.push( cached );\r\n\t\t\t} else {\r\n\t\t\t\telementMatchers.push( cached );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Cache the compiled function\r\n\t\tcached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );\r\n\r\n\t\t// Save selector and tokenization\r\n\t\tcached.selector = selector;\r\n\t}\r\n\treturn cached;\r\n};\r\n\r\n/**\r\n * A low-level selection function that works with Sizzle's compiled\r\n *  selector functions\r\n * @param {String|Function} selector A selector or a pre-compiled\r\n *  selector function built with Sizzle.compile\r\n * @param {Element} context\r\n * @param {Array} [results]\r\n * @param {Array} [seed] A set of elements to match against\r\n */\r\nselect = Sizzle.select = function( selector, context, results, seed ) {\r\n\tvar i, tokens, token, type, find,\r\n\t\tcompiled = typeof selector === \"function\" && selector,\r\n\t\tmatch = !seed && tokenize( (selector = compiled.selector || selector) );\r\n\r\n\tresults = results || [];\r\n\r\n\t// Try to minimize operations if there is no seed and only one group\r\n\tif ( match.length === 1 ) {\r\n\r\n\t\t// Take a shortcut and set the context if the root selector is an ID\r\n\t\ttokens = match[0] = match[0].slice( 0 );\r\n\t\tif ( tokens.length > 2 && (token = tokens[0]).type === \"ID\" &&\r\n\t\t\t\tsupport.getById && context.nodeType === 9 && documentIsHTML &&\r\n\t\t\t\tExpr.relative[ tokens[1].type ] ) {\r\n\r\n\t\t\tcontext = ( Expr.find[\"ID\"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];\r\n\t\t\tif ( !context ) {\r\n\t\t\t\treturn results;\r\n\r\n\t\t\t// Precompiled matchers will still verify ancestry, so step up a level\r\n\t\t\t} else if ( compiled ) {\r\n\t\t\t\tcontext = context.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tselector = selector.slice( tokens.shift().value.length );\r\n\t\t}\r\n\r\n\t\t// Fetch a seed set for right-to-left matching\r\n\t\ti = matchExpr[\"needsContext\"].test( selector ) ? 0 : tokens.length;\r\n\t\twhile ( i-- ) {\r\n\t\t\ttoken = tokens[i];\r\n\r\n\t\t\t// Abort if we hit a combinator\r\n\t\t\tif ( Expr.relative[ (type = token.type) ] ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ( (find = Expr.find[ type ]) ) {\r\n\t\t\t\t// Search, expanding context for leading sibling combinators\r\n\t\t\t\tif ( (seed = find(\r\n\t\t\t\t\ttoken.matches[0].replace( runescape, funescape ),\r\n\t\t\t\t\trsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context\r\n\t\t\t\t)) ) {\r\n\r\n\t\t\t\t\t// If seed is empty or no tokens remain, we can return early\r\n\t\t\t\t\ttokens.splice( i, 1 );\r\n\t\t\t\t\tselector = seed.length && toSelector( tokens );\r\n\t\t\t\t\tif ( !selector ) {\r\n\t\t\t\t\t\tpush.apply( results, seed );\r\n\t\t\t\t\t\treturn results;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Compile and execute a filtering function if one is not provided\r\n\t// Provide `match` to avoid retokenization if we modified the selector above\r\n\t( compiled || compile( selector, match ) )(\r\n\t\tseed,\r\n\t\tcontext,\r\n\t\t!documentIsHTML,\r\n\t\tresults,\r\n\t\trsibling.test( selector ) && testContext( context.parentNode ) || context\r\n\t);\r\n\treturn results;\r\n};\r\n\r\n// One-time assignments\r\n\r\n// Sort stability\r\nsupport.sortStable = expando.split(\"\").sort( sortOrder ).join(\"\") === expando;\r\n\r\n// Support: Chrome 14-35+\r\n// Always assume duplicates if they aren't passed to the comparison function\r\nsupport.detectDuplicates = !!hasDuplicate;\r\n\r\n// Initialize against the default document\r\nsetDocument();\r\n\r\n// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)\r\n// Detached nodes confoundingly follow *each other*\r\nsupport.sortDetached = assert(function( div1 ) {\r\n\t// Should return 1, but returns 4 (following)\r\n\treturn div1.compareDocumentPosition( document.createElement(\"div\") ) & 1;\r\n});\r\n\r\n// Support: IE<8\r\n// Prevent attribute/property \"interpolation\"\r\n// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\r\nif ( !assert(function( div ) {\r\n\tdiv.innerHTML = \"<a href='#'></a>\";\r\n\treturn div.firstChild.getAttribute(\"href\") === \"#\" ;\r\n}) ) {\r\n\taddHandle( \"type|href|height|width\", function( elem, name, isXML ) {\r\n\t\tif ( !isXML ) {\r\n\t\t\treturn elem.getAttribute( name, name.toLowerCase() === \"type\" ? 1 : 2 );\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Support: IE<9\r\n// Use defaultValue in place of getAttribute(\"value\")\r\nif ( !support.attributes || !assert(function( div ) {\r\n\tdiv.innerHTML = \"<input/>\";\r\n\tdiv.firstChild.setAttribute( \"value\", \"\" );\r\n\treturn div.firstChild.getAttribute( \"value\" ) === \"\";\r\n}) ) {\r\n\taddHandle( \"value\", function( elem, name, isXML ) {\r\n\t\tif ( !isXML && elem.nodeName.toLowerCase() === \"input\" ) {\r\n\t\t\treturn elem.defaultValue;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Support: IE<9\r\n// Use getAttributeNode to fetch booleans when getAttribute lies\r\nif ( !assert(function( div ) {\r\n\treturn div.getAttribute(\"disabled\") == null;\r\n}) ) {\r\n\taddHandle( booleans, function( elem, name, isXML ) {\r\n\t\tvar val;\r\n\t\tif ( !isXML ) {\r\n\t\t\treturn elem[ name ] === true ? name.toLowerCase() :\r\n\t\t\t\t\t(val = elem.getAttributeNode( name )) && val.specified ?\r\n\t\t\t\t\tval.value :\r\n\t\t\t\tnull;\r\n\t\t}\r\n\t});\r\n}\r\n\r\nreturn Sizzle;\r\n\r\n})( window );\r\n\r\n\r\n\r\njQuery.find = Sizzle;\r\njQuery.expr = Sizzle.selectors;\r\njQuery.expr[\":\"] = jQuery.expr.pseudos;\r\njQuery.unique = Sizzle.uniqueSort;\r\njQuery.text = Sizzle.getText;\r\njQuery.isXMLDoc = Sizzle.isXML;\r\njQuery.contains = Sizzle.contains;\r\n\r\n\r\n\r\nvar rneedsContext = jQuery.expr.match.needsContext;\r\n\r\nvar rsingleTag = (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/);\r\n\r\n\r\n\r\nvar risSimple = /^.[^:#\\[\\.,]*$/;\r\n\r\n// Implement the identical functionality for filter and not\r\nfunction winnow( elements, qualifier, not ) {\r\n\tif ( jQuery.isFunction( qualifier ) ) {\r\n\t\treturn jQuery.grep( elements, function( elem, i ) {\r\n\t\t\t/* jshint -W018 */\r\n\t\t\treturn !!qualifier.call( elem, i, elem ) !== not;\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tif ( qualifier.nodeType ) {\r\n\t\treturn jQuery.grep( elements, function( elem ) {\r\n\t\t\treturn ( elem === qualifier ) !== not;\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tif ( typeof qualifier === \"string\" ) {\r\n\t\tif ( risSimple.test( qualifier ) ) {\r\n\t\t\treturn jQuery.filter( qualifier, elements, not );\r\n\t\t}\r\n\r\n\t\tqualifier = jQuery.filter( qualifier, elements );\r\n\t}\r\n\r\n\treturn jQuery.grep( elements, function( elem ) {\r\n\t\treturn ( indexOf.call( qualifier, elem ) >= 0 ) !== not;\r\n\t});\r\n}\r\n\r\njQuery.filter = function( expr, elems, not ) {\r\n\tvar elem = elems[ 0 ];\r\n\r\n\tif ( not ) {\r\n\t\texpr = \":not(\" + expr + \")\";\r\n\t}\r\n\r\n\treturn elems.length === 1 && elem.nodeType === 1 ?\r\n\t\tjQuery.find.matchesSelector( elem, expr ) ? [ elem ] : [] :\r\n\t\tjQuery.find.matches( expr, jQuery.grep( elems, function( elem ) {\r\n\t\t\treturn elem.nodeType === 1;\r\n\t\t}));\r\n};\r\n\r\njQuery.fn.extend({\r\n\tfind: function( selector ) {\r\n\t\tvar i,\r\n\t\t\tlen = this.length,\r\n\t\t\tret = [],\r\n\t\t\tself = this;\r\n\r\n\t\tif ( typeof selector !== \"string\" ) {\r\n\t\t\treturn this.pushStack( jQuery( selector ).filter(function() {\r\n\t\t\t\tfor ( i = 0; i < len; i++ ) {\r\n\t\t\t\t\tif ( jQuery.contains( self[ i ], this ) ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}) );\r\n\t\t}\r\n\r\n\t\tfor ( i = 0; i < len; i++ ) {\r\n\t\t\tjQuery.find( selector, self[ i ], ret );\r\n\t\t}\r\n\r\n\t\t// Needed because $( selector, context ) becomes $( context ).find( selector )\r\n\t\tret = this.pushStack( len > 1 ? jQuery.unique( ret ) : ret );\r\n\t\tret.selector = this.selector ? this.selector + \" \" + selector : selector;\r\n\t\treturn ret;\r\n\t},\r\n\tfilter: function( selector ) {\r\n\t\treturn this.pushStack( winnow(this, selector || [], false) );\r\n\t},\r\n\tnot: function( selector ) {\r\n\t\treturn this.pushStack( winnow(this, selector || [], true) );\r\n\t},\r\n\tis: function( selector ) {\r\n\t\treturn !!winnow(\r\n\t\t\tthis,\r\n\r\n\t\t\t// If this is a positional/relative selector, check membership in the returned set\r\n\t\t\t// so $(\"p:first\").is(\"p:last\") won't return true for a doc with two \"p\".\r\n\t\t\ttypeof selector === \"string\" && rneedsContext.test( selector ) ?\r\n\t\t\t\tjQuery( selector ) :\r\n\t\t\t\tselector || [],\r\n\t\t\tfalse\r\n\t\t).length;\r\n\t}\r\n});\r\n\r\n\r\n// Initialize a jQuery object\r\n\r\n\r\n// A central reference to the root jQuery(document)\r\nvar rootjQuery,\r\n\r\n\t// A simple way to check for HTML strings\r\n\t// Prioritize #id over <tag> to avoid XSS via location.hash (#9521)\r\n\t// Strict HTML recognition (#11290: must start with <)\r\n\trquickExpr = /^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]*))$/,\r\n\r\n\tinit = jQuery.fn.init = function( selector, context ) {\r\n\t\tvar match, elem;\r\n\r\n\t\t// HANDLE: $(\"\"), $(null), $(undefined), $(false)\r\n\t\tif ( !selector ) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t// Handle HTML strings\r\n\t\tif ( typeof selector === \"string\" ) {\r\n\t\t\tif ( selector[0] === \"<\" && selector[ selector.length - 1 ] === \">\" && selector.length >= 3 ) {\r\n\t\t\t\t// Assume that strings that start and end with <> are HTML and skip the regex check\r\n\t\t\t\tmatch = [ null, selector, null ];\r\n\r\n\t\t\t} else {\r\n\t\t\t\tmatch = rquickExpr.exec( selector );\r\n\t\t\t}\r\n\r\n\t\t\t// Match html or make sure no context is specified for #id\r\n\t\t\tif ( match && (match[1] || !context) ) {\r\n\r\n\t\t\t\t// HANDLE: $(html) -> $(array)\r\n\t\t\t\tif ( match[1] ) {\r\n\t\t\t\t\tcontext = context instanceof jQuery ? context[0] : context;\r\n\r\n\t\t\t\t\t// Option to run scripts is true for back-compat\r\n\t\t\t\t\t// Intentionally let the error be thrown if parseHTML is not present\r\n\t\t\t\t\tjQuery.merge( this, jQuery.parseHTML(\r\n\t\t\t\t\t\tmatch[1],\r\n\t\t\t\t\t\tcontext && context.nodeType ? context.ownerDocument || context : document,\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t) );\r\n\r\n\t\t\t\t\t// HANDLE: $(html, props)\r\n\t\t\t\t\tif ( rsingleTag.test( match[1] ) && jQuery.isPlainObject( context ) ) {\r\n\t\t\t\t\t\tfor ( match in context ) {\r\n\t\t\t\t\t\t\t// Properties of context are called as methods if possible\r\n\t\t\t\t\t\t\tif ( jQuery.isFunction( this[ match ] ) ) {\r\n\t\t\t\t\t\t\t\tthis[ match ]( context[ match ] );\r\n\r\n\t\t\t\t\t\t\t// ...and otherwise set as attributes\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.attr( match, context[ match ] );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t// HANDLE: $(#id)\r\n\t\t\t\t} else {\r\n\t\t\t\t\telem = document.getElementById( match[2] );\r\n\r\n\t\t\t\t\t// Support: Blackberry 4.6\r\n\t\t\t\t\t// gEBID returns nodes no longer in the document (#6963)\r\n\t\t\t\t\tif ( elem && elem.parentNode ) {\r\n\t\t\t\t\t\t// Inject the element directly into the jQuery object\r\n\t\t\t\t\t\tthis.length = 1;\r\n\t\t\t\t\t\tthis[0] = elem;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.context = document;\r\n\t\t\t\t\tthis.selector = selector;\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\r\n\t\t\t// HANDLE: $(expr, $(...))\r\n\t\t\t} else if ( !context || context.jquery ) {\r\n\t\t\t\treturn ( context || rootjQuery ).find( selector );\r\n\r\n\t\t\t// HANDLE: $(expr, context)\r\n\t\t\t// (which is just equivalent to: $(context).find(expr)\r\n\t\t\t} else {\r\n\t\t\t\treturn this.constructor( context ).find( selector );\r\n\t\t\t}\r\n\r\n\t\t// HANDLE: $(DOMElement)\r\n\t\t} else if ( selector.nodeType ) {\r\n\t\t\tthis.context = this[0] = selector;\r\n\t\t\tthis.length = 1;\r\n\t\t\treturn this;\r\n\r\n\t\t// HANDLE: $(function)\r\n\t\t// Shortcut for document ready\r\n\t\t} else if ( jQuery.isFunction( selector ) ) {\r\n\t\t\treturn typeof rootjQuery.ready !== \"undefined\" ?\r\n\t\t\t\trootjQuery.ready( selector ) :\r\n\t\t\t\t// Execute immediately if ready is not present\r\n\t\t\t\tselector( jQuery );\r\n\t\t}\r\n\r\n\t\tif ( selector.selector !== undefined ) {\r\n\t\t\tthis.selector = selector.selector;\r\n\t\t\tthis.context = selector.context;\r\n\t\t}\r\n\r\n\t\treturn jQuery.makeArray( selector, this );\r\n\t};\r\n\r\n// Give the init function the jQuery prototype for later instantiation\r\ninit.prototype = jQuery.fn;\r\n\r\n// Initialize central reference\r\nrootjQuery = jQuery( document );\r\n\r\n\r\nvar rparentsprev = /^(?:parents|prev(?:Until|All))/,\r\n\t// Methods guaranteed to produce a unique set when starting from a unique set\r\n\tguaranteedUnique = {\r\n\t\tchildren: true,\r\n\t\tcontents: true,\r\n\t\tnext: true,\r\n\t\tprev: true\r\n\t};\r\n\r\njQuery.extend({\r\n\tdir: function( elem, dir, until ) {\r\n\t\tvar matched = [],\r\n\t\t\ttruncate = until !== undefined;\r\n\r\n\t\twhile ( (elem = elem[ dir ]) && elem.nodeType !== 9 ) {\r\n\t\t\tif ( elem.nodeType === 1 ) {\r\n\t\t\t\tif ( truncate && jQuery( elem ).is( until ) ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tmatched.push( elem );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn matched;\r\n\t},\r\n\r\n\tsibling: function( n, elem ) {\r\n\t\tvar matched = [];\r\n\r\n\t\tfor ( ; n; n = n.nextSibling ) {\r\n\t\t\tif ( n.nodeType === 1 && n !== elem ) {\r\n\t\t\t\tmatched.push( n );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn matched;\r\n\t}\r\n});\r\n\r\njQuery.fn.extend({\r\n\thas: function( target ) {\r\n\t\tvar targets = jQuery( target, this ),\r\n\t\t\tl = targets.length;\r\n\r\n\t\treturn this.filter(function() {\r\n\t\t\tvar i = 0;\r\n\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\tif ( jQuery.contains( this, targets[i] ) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tclosest: function( selectors, context ) {\r\n\t\tvar cur,\r\n\t\t\ti = 0,\r\n\t\t\tl = this.length,\r\n\t\t\tmatched = [],\r\n\t\t\tpos = rneedsContext.test( selectors ) || typeof selectors !== \"string\" ?\r\n\t\t\t\tjQuery( selectors, context || this.context ) :\r\n\t\t\t\t0;\r\n\r\n\t\tfor ( ; i < l; i++ ) {\r\n\t\t\tfor ( cur = this[i]; cur && cur !== context; cur = cur.parentNode ) {\r\n\t\t\t\t// Always skip document fragments\r\n\t\t\t\tif ( cur.nodeType < 11 && (pos ?\r\n\t\t\t\t\tpos.index(cur) > -1 :\r\n\r\n\t\t\t\t\t// Don't pass non-elements to Sizzle\r\n\t\t\t\t\tcur.nodeType === 1 &&\r\n\t\t\t\t\t\tjQuery.find.matchesSelector(cur, selectors)) ) {\r\n\r\n\t\t\t\t\tmatched.push( cur );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.pushStack( matched.length > 1 ? jQuery.unique( matched ) : matched );\r\n\t},\r\n\r\n\t// Determine the position of an element within the set\r\n\tindex: function( elem ) {\r\n\r\n\t\t// No argument, return index in parent\r\n\t\tif ( !elem ) {\r\n\t\t\treturn ( this[ 0 ] && this[ 0 ].parentNode ) ? this.first().prevAll().length : -1;\r\n\t\t}\r\n\r\n\t\t// Index in selector\r\n\t\tif ( typeof elem === \"string\" ) {\r\n\t\t\treturn indexOf.call( jQuery( elem ), this[ 0 ] );\r\n\t\t}\r\n\r\n\t\t// Locate the position of the desired element\r\n\t\treturn indexOf.call( this,\r\n\r\n\t\t\t// If it receives a jQuery object, the first element is used\r\n\t\t\telem.jquery ? elem[ 0 ] : elem\r\n\t\t);\r\n\t},\r\n\r\n\tadd: function( selector, context ) {\r\n\t\treturn this.pushStack(\r\n\t\t\tjQuery.unique(\r\n\t\t\t\tjQuery.merge( this.get(), jQuery( selector, context ) )\r\n\t\t\t)\r\n\t\t);\r\n\t},\r\n\r\n\taddBack: function( selector ) {\r\n\t\treturn this.add( selector == null ?\r\n\t\t\tthis.prevObject : this.prevObject.filter(selector)\r\n\t\t);\r\n\t}\r\n});\r\n\r\nfunction sibling( cur, dir ) {\r\n\twhile ( (cur = cur[dir]) && cur.nodeType !== 1 ) {}\r\n\treturn cur;\r\n}\r\n\r\njQuery.each({\r\n\tparent: function( elem ) {\r\n\t\tvar parent = elem.parentNode;\r\n\t\treturn parent && parent.nodeType !== 11 ? parent : null;\r\n\t},\r\n\tparents: function( elem ) {\r\n\t\treturn jQuery.dir( elem, \"parentNode\" );\r\n\t},\r\n\tparentsUntil: function( elem, i, until ) {\r\n\t\treturn jQuery.dir( elem, \"parentNode\", until );\r\n\t},\r\n\tnext: function( elem ) {\r\n\t\treturn sibling( elem, \"nextSibling\" );\r\n\t},\r\n\tprev: function( elem ) {\r\n\t\treturn sibling( elem, \"previousSibling\" );\r\n\t},\r\n\tnextAll: function( elem ) {\r\n\t\treturn jQuery.dir( elem, \"nextSibling\" );\r\n\t},\r\n\tprevAll: function( elem ) {\r\n\t\treturn jQuery.dir( elem, \"previousSibling\" );\r\n\t},\r\n\tnextUntil: function( elem, i, until ) {\r\n\t\treturn jQuery.dir( elem, \"nextSibling\", until );\r\n\t},\r\n\tprevUntil: function( elem, i, until ) {\r\n\t\treturn jQuery.dir( elem, \"previousSibling\", until );\r\n\t},\r\n\tsiblings: function( elem ) {\r\n\t\treturn jQuery.sibling( ( elem.parentNode || {} ).firstChild, elem );\r\n\t},\r\n\tchildren: function( elem ) {\r\n\t\treturn jQuery.sibling( elem.firstChild );\r\n\t},\r\n\tcontents: function( elem ) {\r\n\t\treturn elem.contentDocument || jQuery.merge( [], elem.childNodes );\r\n\t}\r\n}, function( name, fn ) {\r\n\tjQuery.fn[ name ] = function( until, selector ) {\r\n\t\tvar matched = jQuery.map( this, fn, until );\r\n\r\n\t\tif ( name.slice( -5 ) !== \"Until\" ) {\r\n\t\t\tselector = until;\r\n\t\t}\r\n\r\n\t\tif ( selector && typeof selector === \"string\" ) {\r\n\t\t\tmatched = jQuery.filter( selector, matched );\r\n\t\t}\r\n\r\n\t\tif ( this.length > 1 ) {\r\n\t\t\t// Remove duplicates\r\n\t\t\tif ( !guaranteedUnique[ name ] ) {\r\n\t\t\t\tjQuery.unique( matched );\r\n\t\t\t}\r\n\r\n\t\t\t// Reverse order for parents* and prev-derivatives\r\n\t\t\tif ( rparentsprev.test( name ) ) {\r\n\t\t\t\tmatched.reverse();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.pushStack( matched );\r\n\t};\r\n});\r\nvar rnotwhite = (/\\S+/g);\r\n\r\n\r\n\r\n// String to Object options format cache\r\nvar optionsCache = {};\r\n\r\n// Convert String-formatted options into Object-formatted ones and store in cache\r\nfunction createOptions( options ) {\r\n\tvar object = optionsCache[ options ] = {};\r\n\tjQuery.each( options.match( rnotwhite ) || [], function( _, flag ) {\r\n\t\tobject[ flag ] = true;\r\n\t});\r\n\treturn object;\r\n}\r\n\r\n/*\r\n * Create a callback list using the following parameters:\r\n *\r\n *\toptions: an optional list of space-separated options that will change how\r\n *\t\t\tthe callback list behaves or a more traditional option object\r\n *\r\n * By default a callback list will act like an event callback list and can be\r\n * \"fired\" multiple times.\r\n *\r\n * Possible options:\r\n *\r\n *\tonce:\t\t\twill ensure the callback list can only be fired once (like a Deferred)\r\n *\r\n *\tmemory:\t\t\twill keep track of previous values and will call any callback added\r\n *\t\t\t\t\tafter the list has been fired right away with the latest \"memorized\"\r\n *\t\t\t\t\tvalues (like a Deferred)\r\n *\r\n *\tunique:\t\t\twill ensure a callback can only be added once (no duplicate in the list)\r\n *\r\n *\tstopOnFalse:\tinterrupt callings when a callback returns false\r\n *\r\n */\r\njQuery.Callbacks = function( options ) {\r\n\r\n\t// Convert options from String-formatted to Object-formatted if needed\r\n\t// (we check in cache first)\r\n\toptions = typeof options === \"string\" ?\r\n\t\t( optionsCache[ options ] || createOptions( options ) ) :\r\n\t\tjQuery.extend( {}, options );\r\n\r\n\tvar // Last fire value (for non-forgettable lists)\r\n\t\tmemory,\r\n\t\t// Flag to know if list was already fired\r\n\t\tfired,\r\n\t\t// Flag to know if list is currently firing\r\n\t\tfiring,\r\n\t\t// First callback to fire (used internally by add and fireWith)\r\n\t\tfiringStart,\r\n\t\t// End of the loop when firing\r\n\t\tfiringLength,\r\n\t\t// Index of currently firing callback (modified by remove if needed)\r\n\t\tfiringIndex,\r\n\t\t// Actual callback list\r\n\t\tlist = [],\r\n\t\t// Stack of fire calls for repeatable lists\r\n\t\tstack = !options.once && [],\r\n\t\t// Fire callbacks\r\n\t\tfire = function( data ) {\r\n\t\t\tmemory = options.memory && data;\r\n\t\t\tfired = true;\r\n\t\t\tfiringIndex = firingStart || 0;\r\n\t\t\tfiringStart = 0;\r\n\t\t\tfiringLength = list.length;\r\n\t\t\tfiring = true;\r\n\t\t\tfor ( ; list && firingIndex < firingLength; firingIndex++ ) {\r\n\t\t\t\tif ( list[ firingIndex ].apply( data[ 0 ], data[ 1 ] ) === false && options.stopOnFalse ) {\r\n\t\t\t\t\tmemory = false; // To prevent further calls using add\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfiring = false;\r\n\t\t\tif ( list ) {\r\n\t\t\t\tif ( stack ) {\r\n\t\t\t\t\tif ( stack.length ) {\r\n\t\t\t\t\t\tfire( stack.shift() );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if ( memory ) {\r\n\t\t\t\t\tlist = [];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.disable();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// Actual Callbacks object\r\n\t\tself = {\r\n\t\t\t// Add a callback or a collection of callbacks to the list\r\n\t\t\tadd: function() {\r\n\t\t\t\tif ( list ) {\r\n\t\t\t\t\t// First, we save the current length\r\n\t\t\t\t\tvar start = list.length;\r\n\t\t\t\t\t(function add( args ) {\r\n\t\t\t\t\t\tjQuery.each( args, function( _, arg ) {\r\n\t\t\t\t\t\t\tvar type = jQuery.type( arg );\r\n\t\t\t\t\t\t\tif ( type === \"function\" ) {\r\n\t\t\t\t\t\t\t\tif ( !options.unique || !self.has( arg ) ) {\r\n\t\t\t\t\t\t\t\t\tlist.push( arg );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if ( arg && arg.length && type !== \"string\" ) {\r\n\t\t\t\t\t\t\t\t// Inspect recursively\r\n\t\t\t\t\t\t\t\tadd( arg );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})( arguments );\r\n\t\t\t\t\t// Do we need to add the callbacks to the\r\n\t\t\t\t\t// current firing batch?\r\n\t\t\t\t\tif ( firing ) {\r\n\t\t\t\t\t\tfiringLength = list.length;\r\n\t\t\t\t\t// With memory, if we're not firing then\r\n\t\t\t\t\t// we should call right away\r\n\t\t\t\t\t} else if ( memory ) {\r\n\t\t\t\t\t\tfiringStart = start;\r\n\t\t\t\t\t\tfire( memory );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// Remove a callback from the list\r\n\t\t\tremove: function() {\r\n\t\t\t\tif ( list ) {\r\n\t\t\t\t\tjQuery.each( arguments, function( _, arg ) {\r\n\t\t\t\t\t\tvar index;\r\n\t\t\t\t\t\twhile ( ( index = jQuery.inArray( arg, list, index ) ) > -1 ) {\r\n\t\t\t\t\t\t\tlist.splice( index, 1 );\r\n\t\t\t\t\t\t\t// Handle firing indexes\r\n\t\t\t\t\t\t\tif ( firing ) {\r\n\t\t\t\t\t\t\t\tif ( index <= firingLength ) {\r\n\t\t\t\t\t\t\t\t\tfiringLength--;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif ( index <= firingIndex ) {\r\n\t\t\t\t\t\t\t\t\tfiringIndex--;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// Check if a given callback is in the list.\r\n\t\t\t// If no argument is given, return whether or not list has callbacks attached.\r\n\t\t\thas: function( fn ) {\r\n\t\t\t\treturn fn ? jQuery.inArray( fn, list ) > -1 : !!( list && list.length );\r\n\t\t\t},\r\n\t\t\t// Remove all callbacks from the list\r\n\t\t\tempty: function() {\r\n\t\t\t\tlist = [];\r\n\t\t\t\tfiringLength = 0;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// Have the list do nothing anymore\r\n\t\t\tdisable: function() {\r\n\t\t\t\tlist = stack = memory = undefined;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// Is it disabled?\r\n\t\t\tdisabled: function() {\r\n\t\t\t\treturn !list;\r\n\t\t\t},\r\n\t\t\t// Lock the list in its current state\r\n\t\t\tlock: function() {\r\n\t\t\t\tstack = undefined;\r\n\t\t\t\tif ( !memory ) {\r\n\t\t\t\t\tself.disable();\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// Is it locked?\r\n\t\t\tlocked: function() {\r\n\t\t\t\treturn !stack;\r\n\t\t\t},\r\n\t\t\t// Call all callbacks with the given context and arguments\r\n\t\t\tfireWith: function( context, args ) {\r\n\t\t\t\tif ( list && ( !fired || stack ) ) {\r\n\t\t\t\t\targs = args || [];\r\n\t\t\t\t\targs = [ context, args.slice ? args.slice() : args ];\r\n\t\t\t\t\tif ( firing ) {\r\n\t\t\t\t\t\tstack.push( args );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfire( args );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// Call all the callbacks with the given arguments\r\n\t\t\tfire: function() {\r\n\t\t\t\tself.fireWith( this, arguments );\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t// To know if the callbacks have already been called at least once\r\n\t\t\tfired: function() {\r\n\t\t\t\treturn !!fired;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\njQuery.extend({\r\n\r\n\tDeferred: function( func ) {\r\n\t\tvar tuples = [\r\n\t\t\t\t// action, add listener, listener list, final state\r\n\t\t\t\t[ \"resolve\", \"done\", jQuery.Callbacks(\"once memory\"), \"resolved\" ],\r\n\t\t\t\t[ \"reject\", \"fail\", jQuery.Callbacks(\"once memory\"), \"rejected\" ],\r\n\t\t\t\t[ \"notify\", \"progress\", jQuery.Callbacks(\"memory\") ]\r\n\t\t\t],\r\n\t\t\tstate = \"pending\",\r\n\t\t\tpromise = {\r\n\t\t\t\tstate: function() {\r\n\t\t\t\t\treturn state;\r\n\t\t\t\t},\r\n\t\t\t\talways: function() {\r\n\t\t\t\t\tdeferred.done( arguments ).fail( arguments );\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\tthen: function( /* fnDone, fnFail, fnProgress */ ) {\r\n\t\t\t\t\tvar fns = arguments;\r\n\t\t\t\t\treturn jQuery.Deferred(function( newDefer ) {\r\n\t\t\t\t\t\tjQuery.each( tuples, function( i, tuple ) {\r\n\t\t\t\t\t\t\tvar fn = jQuery.isFunction( fns[ i ] ) && fns[ i ];\r\n\t\t\t\t\t\t\t// deferred[ done | fail | progress ] for forwarding actions to newDefer\r\n\t\t\t\t\t\t\tdeferred[ tuple[1] ](function() {\r\n\t\t\t\t\t\t\t\tvar returned = fn && fn.apply( this, arguments );\r\n\t\t\t\t\t\t\t\tif ( returned && jQuery.isFunction( returned.promise ) ) {\r\n\t\t\t\t\t\t\t\t\treturned.promise()\r\n\t\t\t\t\t\t\t\t\t\t.done( newDefer.resolve )\r\n\t\t\t\t\t\t\t\t\t\t.fail( newDefer.reject )\r\n\t\t\t\t\t\t\t\t\t\t.progress( newDefer.notify );\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnewDefer[ tuple[ 0 ] + \"With\" ]( this === promise ? newDefer.promise() : this, fn ? [ returned ] : arguments );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tfns = null;\r\n\t\t\t\t\t}).promise();\r\n\t\t\t\t},\r\n\t\t\t\t// Get a promise for this deferred\r\n\t\t\t\t// If obj is provided, the promise aspect is added to the object\r\n\t\t\t\tpromise: function( obj ) {\r\n\t\t\t\t\treturn obj != null ? jQuery.extend( obj, promise ) : promise;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeferred = {};\r\n\r\n\t\t// Keep pipe for back-compat\r\n\t\tpromise.pipe = promise.then;\r\n\r\n\t\t// Add list-specific methods\r\n\t\tjQuery.each( tuples, function( i, tuple ) {\r\n\t\t\tvar list = tuple[ 2 ],\r\n\t\t\t\tstateString = tuple[ 3 ];\r\n\r\n\t\t\t// promise[ done | fail | progress ] = list.add\r\n\t\t\tpromise[ tuple[1] ] = list.add;\r\n\r\n\t\t\t// Handle state\r\n\t\t\tif ( stateString ) {\r\n\t\t\t\tlist.add(function() {\r\n\t\t\t\t\t// state = [ resolved | rejected ]\r\n\t\t\t\t\tstate = stateString;\r\n\r\n\t\t\t\t// [ reject_list | resolve_list ].disable; progress_list.lock\r\n\t\t\t\t}, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2 ].lock );\r\n\t\t\t}\r\n\r\n\t\t\t// deferred[ resolve | reject | notify ]\r\n\t\t\tdeferred[ tuple[0] ] = function() {\r\n\t\t\t\tdeferred[ tuple[0] + \"With\" ]( this === deferred ? promise : this, arguments );\r\n\t\t\t\treturn this;\r\n\t\t\t};\r\n\t\t\tdeferred[ tuple[0] + \"With\" ] = list.fireWith;\r\n\t\t});\r\n\r\n\t\t// Make the deferred a promise\r\n\t\tpromise.promise( deferred );\r\n\r\n\t\t// Call given func if any\r\n\t\tif ( func ) {\r\n\t\t\tfunc.call( deferred, deferred );\r\n\t\t}\r\n\r\n\t\t// All done!\r\n\t\treturn deferred;\r\n\t},\r\n\r\n\t// Deferred helper\r\n\twhen: function( subordinate /* , ..., subordinateN */ ) {\r\n\t\tvar i = 0,\r\n\t\t\tresolveValues = slice.call( arguments ),\r\n\t\t\tlength = resolveValues.length,\r\n\r\n\t\t\t// the count of uncompleted subordinates\r\n\t\t\tremaining = length !== 1 || ( subordinate && jQuery.isFunction( subordinate.promise ) ) ? length : 0,\r\n\r\n\t\t\t// the master Deferred. If resolveValues consist of only a single Deferred, just use that.\r\n\t\t\tdeferred = remaining === 1 ? subordinate : jQuery.Deferred(),\r\n\r\n\t\t\t// Update function for both resolve and progress values\r\n\t\t\tupdateFunc = function( i, contexts, values ) {\r\n\t\t\t\treturn function( value ) {\r\n\t\t\t\t\tcontexts[ i ] = this;\r\n\t\t\t\t\tvalues[ i ] = arguments.length > 1 ? slice.call( arguments ) : value;\r\n\t\t\t\t\tif ( values === progressValues ) {\r\n\t\t\t\t\t\tdeferred.notifyWith( contexts, values );\r\n\t\t\t\t\t} else if ( !( --remaining ) ) {\r\n\t\t\t\t\t\tdeferred.resolveWith( contexts, values );\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tprogressValues, progressContexts, resolveContexts;\r\n\r\n\t\t// Add listeners to Deferred subordinates; treat others as resolved\r\n\t\tif ( length > 1 ) {\r\n\t\t\tprogressValues = new Array( length );\r\n\t\t\tprogressContexts = new Array( length );\r\n\t\t\tresolveContexts = new Array( length );\r\n\t\t\tfor ( ; i < length; i++ ) {\r\n\t\t\t\tif ( resolveValues[ i ] && jQuery.isFunction( resolveValues[ i ].promise ) ) {\r\n\t\t\t\t\tresolveValues[ i ].promise()\r\n\t\t\t\t\t\t.done( updateFunc( i, resolveContexts, resolveValues ) )\r\n\t\t\t\t\t\t.fail( deferred.reject )\r\n\t\t\t\t\t\t.progress( updateFunc( i, progressContexts, progressValues ) );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t--remaining;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If we're not waiting on anything, resolve the master\r\n\t\tif ( !remaining ) {\r\n\t\t\tdeferred.resolveWith( resolveContexts, resolveValues );\r\n\t\t}\r\n\r\n\t\treturn deferred.promise();\r\n\t}\r\n});\r\n\r\n\r\n// The deferred used on DOM ready\r\nvar readyList;\r\n\r\njQuery.fn.ready = function( fn ) {\r\n\t// Add the callback\r\n\tjQuery.ready.promise().done( fn );\r\n\r\n\treturn this;\r\n};\r\n\r\njQuery.extend({\r\n\t// Is the DOM ready to be used? Set to true once it occurs.\r\n\tisReady: false,\r\n\r\n\t// A counter to track how many items to wait for before\r\n\t// the ready event fires. See #6781\r\n\treadyWait: 1,\r\n\r\n\t// Hold (or release) the ready event\r\n\tholdReady: function( hold ) {\r\n\t\tif ( hold ) {\r\n\t\t\tjQuery.readyWait++;\r\n\t\t} else {\r\n\t\t\tjQuery.ready( true );\r\n\t\t}\r\n\t},\r\n\r\n\t// Handle when the DOM is ready\r\n\tready: function( wait ) {\r\n\r\n\t\t// Abort if there are pending holds or we're already ready\r\n\t\tif ( wait === true ? --jQuery.readyWait : jQuery.isReady ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Remember that the DOM is ready\r\n\t\tjQuery.isReady = true;\r\n\r\n\t\t// If a normal DOM Ready event fired, decrement, and wait if need be\r\n\t\tif ( wait !== true && --jQuery.readyWait > 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If there are functions bound, to execute\r\n\t\treadyList.resolveWith( document, [ jQuery ] );\r\n\r\n\t\t// Trigger any bound ready events\r\n\t\tif ( jQuery.fn.triggerHandler ) {\r\n\t\t\tjQuery( document ).triggerHandler( \"ready\" );\r\n\t\t\tjQuery( document ).off( \"ready\" );\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * The ready event handler and self cleanup method\r\n */\r\nfunction completed() {\r\n\tdocument.removeEventListener( \"DOMContentLoaded\", completed, false );\r\n\twindow.removeEventListener( \"load\", completed, false );\r\n\tjQuery.ready();\r\n}\r\n\r\njQuery.ready.promise = function( obj ) {\r\n\tif ( !readyList ) {\r\n\r\n\t\treadyList = jQuery.Deferred();\r\n\r\n\t\t// Catch cases where $(document).ready() is called after the browser event has already occurred.\r\n\t\t// We once tried to use readyState \"interactive\" here, but it caused issues like the one\r\n\t\t// discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15\r\n\t\tif ( document.readyState === \"complete\" ) {\r\n\t\t\t// Handle it asynchronously to allow scripts the opportunity to delay ready\r\n\t\t\tsetTimeout( jQuery.ready );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Use the handy event callback\r\n\t\t\tdocument.addEventListener( \"DOMContentLoaded\", completed, false );\r\n\r\n\t\t\t// A fallback to window.onload, that will always work\r\n\t\t\twindow.addEventListener( \"load\", completed, false );\r\n\t\t}\r\n\t}\r\n\treturn readyList.promise( obj );\r\n};\r\n\r\n// Kick off the DOM ready check even if the user does not\r\njQuery.ready.promise();\r\n\r\n\r\n\r\n\r\n// Multifunctional method to get and set values of a collection\r\n// The value/s can optionally be executed if it's a function\r\nvar access = jQuery.access = function( elems, fn, key, value, chainable, emptyGet, raw ) {\r\n\tvar i = 0,\r\n\t\tlen = elems.length,\r\n\t\tbulk = key == null;\r\n\r\n\t// Sets many values\r\n\tif ( jQuery.type( key ) === \"object\" ) {\r\n\t\tchainable = true;\r\n\t\tfor ( i in key ) {\r\n\t\t\tjQuery.access( elems, fn, i, key[i], true, emptyGet, raw );\r\n\t\t}\r\n\r\n\t// Sets one value\r\n\t} else if ( value !== undefined ) {\r\n\t\tchainable = true;\r\n\r\n\t\tif ( !jQuery.isFunction( value ) ) {\r\n\t\t\traw = true;\r\n\t\t}\r\n\r\n\t\tif ( bulk ) {\r\n\t\t\t// Bulk operations run against the entire set\r\n\t\t\tif ( raw ) {\r\n\t\t\t\tfn.call( elems, value );\r\n\t\t\t\tfn = null;\r\n\r\n\t\t\t// ...except when executing function values\r\n\t\t\t} else {\r\n\t\t\t\tbulk = fn;\r\n\t\t\t\tfn = function( elem, key, value ) {\r\n\t\t\t\t\treturn bulk.call( jQuery( elem ), value );\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( fn ) {\r\n\t\t\tfor ( ; i < len; i++ ) {\r\n\t\t\t\tfn( elems[i], key, raw ? value : value.call( elems[i], i, fn( elems[i], key ) ) );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn chainable ?\r\n\t\telems :\r\n\r\n\t\t// Gets\r\n\t\tbulk ?\r\n\t\t\tfn.call( elems ) :\r\n\t\t\tlen ? fn( elems[0], key ) : emptyGet;\r\n};\r\n\r\n\r\n/**\r\n * Determines whether an object can have data\r\n */\r\njQuery.acceptData = function( owner ) {\r\n\t// Accepts only:\r\n\t//  - Node\r\n\t//    - Node.ELEMENT_NODE\r\n\t//    - Node.DOCUMENT_NODE\r\n\t//  - Object\r\n\t//    - Any\r\n\t/* jshint -W018 */\r\n\treturn owner.nodeType === 1 || owner.nodeType === 9 || !( +owner.nodeType );\r\n};\r\n\r\n\r\nfunction Data() {\r\n\t// Support: Android<4,\r\n\t// Old WebKit does not have Object.preventExtensions/freeze method,\r\n\t// return new empty object instead with no [[set]] accessor\r\n\tObject.defineProperty( this.cache = {}, 0, {\r\n\t\tget: function() {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t});\r\n\r\n\tthis.expando = jQuery.expando + Data.uid++;\r\n}\r\n\r\nData.uid = 1;\r\nData.accepts = jQuery.acceptData;\r\n\r\nData.prototype = {\r\n\tkey: function( owner ) {\r\n\t\t// We can accept data for non-element nodes in modern browsers,\r\n\t\t// but we should not, see #8335.\r\n\t\t// Always return the key for a frozen object.\r\n\t\tif ( !Data.accepts( owner ) ) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tvar descriptor = {},\r\n\t\t\t// Check if the owner object already has a cache key\r\n\t\t\tunlock = owner[ this.expando ];\r\n\r\n\t\t// If not, create one\r\n\t\tif ( !unlock ) {\r\n\t\t\tunlock = Data.uid++;\r\n\r\n\t\t\t// Secure it in a non-enumerable, non-writable property\r\n\t\t\ttry {\r\n\t\t\t\tdescriptor[ this.expando ] = { value: unlock };\r\n\t\t\t\tObject.defineProperties( owner, descriptor );\r\n\r\n\t\t\t// Support: Android<4\r\n\t\t\t// Fallback to a less secure definition\r\n\t\t\t} catch ( e ) {\r\n\t\t\t\tdescriptor[ this.expando ] = unlock;\r\n\t\t\t\tjQuery.extend( owner, descriptor );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ensure the cache object\r\n\t\tif ( !this.cache[ unlock ] ) {\r\n\t\t\tthis.cache[ unlock ] = {};\r\n\t\t}\r\n\r\n\t\treturn unlock;\r\n\t},\r\n\tset: function( owner, data, value ) {\r\n\t\tvar prop,\r\n\t\t\t// There may be an unlock assigned to this node,\r\n\t\t\t// if there is no entry for this \"owner\", create one inline\r\n\t\t\t// and set the unlock as though an owner entry had always existed\r\n\t\t\tunlock = this.key( owner ),\r\n\t\t\tcache = this.cache[ unlock ];\r\n\r\n\t\t// Handle: [ owner, key, value ] args\r\n\t\tif ( typeof data === \"string\" ) {\r\n\t\t\tcache[ data ] = value;\r\n\r\n\t\t// Handle: [ owner, { properties } ] args\r\n\t\t} else {\r\n\t\t\t// Fresh assignments by object are shallow copied\r\n\t\t\tif ( jQuery.isEmptyObject( cache ) ) {\r\n\t\t\t\tjQuery.extend( this.cache[ unlock ], data );\r\n\t\t\t// Otherwise, copy the properties one-by-one to the cache object\r\n\t\t\t} else {\r\n\t\t\t\tfor ( prop in data ) {\r\n\t\t\t\t\tcache[ prop ] = data[ prop ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn cache;\r\n\t},\r\n\tget: function( owner, key ) {\r\n\t\t// Either a valid cache is found, or will be created.\r\n\t\t// New caches will be created and the unlock returned,\r\n\t\t// allowing direct access to the newly created\r\n\t\t// empty data object. A valid owner object must be provided.\r\n\t\tvar cache = this.cache[ this.key( owner ) ];\r\n\r\n\t\treturn key === undefined ?\r\n\t\t\tcache : cache[ key ];\r\n\t},\r\n\taccess: function( owner, key, value ) {\r\n\t\tvar stored;\r\n\t\t// In cases where either:\r\n\t\t//\r\n\t\t//   1. No key was specified\r\n\t\t//   2. A string key was specified, but no value provided\r\n\t\t//\r\n\t\t// Take the \"read\" path and allow the get method to determine\r\n\t\t// which value to return, respectively either:\r\n\t\t//\r\n\t\t//   1. The entire cache object\r\n\t\t//   2. The data stored at the key\r\n\t\t//\r\n\t\tif ( key === undefined ||\r\n\t\t\t\t((key && typeof key === \"string\") && value === undefined) ) {\r\n\r\n\t\t\tstored = this.get( owner, key );\r\n\r\n\t\t\treturn stored !== undefined ?\r\n\t\t\t\tstored : this.get( owner, jQuery.camelCase(key) );\r\n\t\t}\r\n\r\n\t\t// [*]When the key is not a string, or both a key and value\r\n\t\t// are specified, set or extend (existing objects) with either:\r\n\t\t//\r\n\t\t//   1. An object of properties\r\n\t\t//   2. A key and value\r\n\t\t//\r\n\t\tthis.set( owner, key, value );\r\n\r\n\t\t// Since the \"set\" path can have two possible entry points\r\n\t\t// return the expected data based on which path was taken[*]\r\n\t\treturn value !== undefined ? value : key;\r\n\t},\r\n\tremove: function( owner, key ) {\r\n\t\tvar i, name, camel,\r\n\t\t\tunlock = this.key( owner ),\r\n\t\t\tcache = this.cache[ unlock ];\r\n\r\n\t\tif ( key === undefined ) {\r\n\t\t\tthis.cache[ unlock ] = {};\r\n\r\n\t\t} else {\r\n\t\t\t// Support array or space separated string of keys\r\n\t\t\tif ( jQuery.isArray( key ) ) {\r\n\t\t\t\t// If \"name\" is an array of keys...\r\n\t\t\t\t// When data is initially created, via (\"key\", \"val\") signature,\r\n\t\t\t\t// keys will be converted to camelCase.\r\n\t\t\t\t// Since there is no way to tell _how_ a key was added, remove\r\n\t\t\t\t// both plain key and camelCase key. #12786\r\n\t\t\t\t// This will only penalize the array argument path.\r\n\t\t\t\tname = key.concat( key.map( jQuery.camelCase ) );\r\n\t\t\t} else {\r\n\t\t\t\tcamel = jQuery.camelCase( key );\r\n\t\t\t\t// Try the string as a key before any manipulation\r\n\t\t\t\tif ( key in cache ) {\r\n\t\t\t\t\tname = [ key, camel ];\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If a key with the spaces exists, use it.\r\n\t\t\t\t\t// Otherwise, create an array by matching non-whitespace\r\n\t\t\t\t\tname = camel;\r\n\t\t\t\t\tname = name in cache ?\r\n\t\t\t\t\t\t[ name ] : ( name.match( rnotwhite ) || [] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ti = name.length;\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\tdelete cache[ name[ i ] ];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\thasData: function( owner ) {\r\n\t\treturn !jQuery.isEmptyObject(\r\n\t\t\tthis.cache[ owner[ this.expando ] ] || {}\r\n\t\t);\r\n\t},\r\n\tdiscard: function( owner ) {\r\n\t\tif ( owner[ this.expando ] ) {\r\n\t\t\tdelete this.cache[ owner[ this.expando ] ];\r\n\t\t}\r\n\t}\r\n};\r\nvar data_priv = new Data();\r\n\r\nvar data_user = new Data();\r\n\r\n\r\n\r\n//\tImplementation Summary\r\n//\r\n//\t1. Enforce API surface and semantic compatibility with 1.9.x branch\r\n//\t2. Improve the module's maintainability by reducing the storage\r\n//\t\tpaths to a single mechanism.\r\n//\t3. Use the same single mechanism to support \"private\" and \"user\" data.\r\n//\t4. _Never_ expose \"private\" data to user code (TODO: Drop _data, _removeData)\r\n//\t5. Avoid exposing implementation details on user objects (eg. expando properties)\r\n//\t6. Provide a clear path for implementation upgrade to WeakMap in 2014\r\n\r\nvar rbrace = /^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,\r\n\trmultiDash = /([A-Z])/g;\r\n\r\nfunction dataAttr( elem, key, data ) {\r\n\tvar name;\r\n\r\n\t// If nothing was found internally, try to fetch any\r\n\t// data from the HTML5 data-* attribute\r\n\tif ( data === undefined && elem.nodeType === 1 ) {\r\n\t\tname = \"data-\" + key.replace( rmultiDash, \"-$1\" ).toLowerCase();\r\n\t\tdata = elem.getAttribute( name );\r\n\r\n\t\tif ( typeof data === \"string\" ) {\r\n\t\t\ttry {\r\n\t\t\t\tdata = data === \"true\" ? true :\r\n\t\t\t\t\tdata === \"false\" ? false :\r\n\t\t\t\t\tdata === \"null\" ? null :\r\n\t\t\t\t\t// Only convert to a number if it doesn't change the string\r\n\t\t\t\t\t+data + \"\" === data ? +data :\r\n\t\t\t\t\trbrace.test( data ) ? jQuery.parseJSON( data ) :\r\n\t\t\t\t\tdata;\r\n\t\t\t} catch( e ) {}\r\n\r\n\t\t\t// Make sure we set the data so it isn't changed later\r\n\t\t\tdata_user.set( elem, key, data );\r\n\t\t} else {\r\n\t\t\tdata = undefined;\r\n\t\t}\r\n\t}\r\n\treturn data;\r\n}\r\n\r\njQuery.extend({\r\n\thasData: function( elem ) {\r\n\t\treturn data_user.hasData( elem ) || data_priv.hasData( elem );\r\n\t},\r\n\r\n\tdata: function( elem, name, data ) {\r\n\t\treturn data_user.access( elem, name, data );\r\n\t},\r\n\r\n\tremoveData: function( elem, name ) {\r\n\t\tdata_user.remove( elem, name );\r\n\t},\r\n\r\n\t// TODO: Now that all calls to _data and _removeData have been replaced\r\n\t// with direct calls to data_priv methods, these can be deprecated.\r\n\t_data: function( elem, name, data ) {\r\n\t\treturn data_priv.access( elem, name, data );\r\n\t},\r\n\r\n\t_removeData: function( elem, name ) {\r\n\t\tdata_priv.remove( elem, name );\r\n\t}\r\n});\r\n\r\njQuery.fn.extend({\r\n\tdata: function( key, value ) {\r\n\t\tvar i, name, data,\r\n\t\t\telem = this[ 0 ],\r\n\t\t\tattrs = elem && elem.attributes;\r\n\r\n\t\t// Gets all values\r\n\t\tif ( key === undefined ) {\r\n\t\t\tif ( this.length ) {\r\n\t\t\t\tdata = data_user.get( elem );\r\n\r\n\t\t\t\tif ( elem.nodeType === 1 && !data_priv.get( elem, \"hasDataAttrs\" ) ) {\r\n\t\t\t\t\ti = attrs.length;\r\n\t\t\t\t\twhile ( i-- ) {\r\n\r\n\t\t\t\t\t\t// Support: IE11+\r\n\t\t\t\t\t\t// The attrs elements can be null (#14894)\r\n\t\t\t\t\t\tif ( attrs[ i ] ) {\r\n\t\t\t\t\t\t\tname = attrs[ i ].name;\r\n\t\t\t\t\t\t\tif ( name.indexOf( \"data-\" ) === 0 ) {\r\n\t\t\t\t\t\t\t\tname = jQuery.camelCase( name.slice(5) );\r\n\t\t\t\t\t\t\t\tdataAttr( elem, name, data[ name ] );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata_priv.set( elem, \"hasDataAttrs\", true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\t// Sets multiple values\r\n\t\tif ( typeof key === \"object\" ) {\r\n\t\t\treturn this.each(function() {\r\n\t\t\t\tdata_user.set( this, key );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn access( this, function( value ) {\r\n\t\t\tvar data,\r\n\t\t\t\tcamelKey = jQuery.camelCase( key );\r\n\r\n\t\t\t// The calling jQuery object (element matches) is not empty\r\n\t\t\t// (and therefore has an element appears at this[ 0 ]) and the\r\n\t\t\t// `value` parameter was not undefined. An empty jQuery object\r\n\t\t\t// will result in `undefined` for elem = this[ 0 ] which will\r\n\t\t\t// throw an exception if an attempt to read a data cache is made.\r\n\t\t\tif ( elem && value === undefined ) {\r\n\t\t\t\t// Attempt to get data from the cache\r\n\t\t\t\t// with the key as-is\r\n\t\t\t\tdata = data_user.get( elem, key );\r\n\t\t\t\tif ( data !== undefined ) {\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Attempt to get data from the cache\r\n\t\t\t\t// with the key camelized\r\n\t\t\t\tdata = data_user.get( elem, camelKey );\r\n\t\t\t\tif ( data !== undefined ) {\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Attempt to \"discover\" the data in\r\n\t\t\t\t// HTML5 custom data-* attrs\r\n\t\t\t\tdata = dataAttr( elem, camelKey, undefined );\r\n\t\t\t\tif ( data !== undefined ) {\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// We tried really hard, but the data doesn't exist.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Set the data...\r\n\t\t\tthis.each(function() {\r\n\t\t\t\t// First, attempt to store a copy or reference of any\r\n\t\t\t\t// data that might've been store with a camelCased key.\r\n\t\t\t\tvar data = data_user.get( this, camelKey );\r\n\r\n\t\t\t\t// For HTML5 data-* attribute interop, we have to\r\n\t\t\t\t// store property names with dashes in a camelCase form.\r\n\t\t\t\t// This might not apply to all properties...*\r\n\t\t\t\tdata_user.set( this, camelKey, value );\r\n\r\n\t\t\t\t// *... In the case of properties that might _actually_\r\n\t\t\t\t// have dashes, we need to also store a copy of that\r\n\t\t\t\t// unchanged property.\r\n\t\t\t\tif ( key.indexOf(\"-\") !== -1 && data !== undefined ) {\r\n\t\t\t\t\tdata_user.set( this, key, value );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, null, value, arguments.length > 1, null, true );\r\n\t},\r\n\r\n\tremoveData: function( key ) {\r\n\t\treturn this.each(function() {\r\n\t\t\tdata_user.remove( this, key );\r\n\t\t});\r\n\t}\r\n});\r\n\r\n\r\njQuery.extend({\r\n\tqueue: function( elem, type, data ) {\r\n\t\tvar queue;\r\n\r\n\t\tif ( elem ) {\r\n\t\t\ttype = ( type || \"fx\" ) + \"queue\";\r\n\t\t\tqueue = data_priv.get( elem, type );\r\n\r\n\t\t\t// Speed up dequeue by getting out quickly if this is just a lookup\r\n\t\t\tif ( data ) {\r\n\t\t\t\tif ( !queue || jQuery.isArray( data ) ) {\r\n\t\t\t\t\tqueue = data_priv.access( elem, type, jQuery.makeArray(data) );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tqueue.push( data );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn queue || [];\r\n\t\t}\r\n\t},\r\n\r\n\tdequeue: function( elem, type ) {\r\n\t\ttype = type || \"fx\";\r\n\r\n\t\tvar queue = jQuery.queue( elem, type ),\r\n\t\t\tstartLength = queue.length,\r\n\t\t\tfn = queue.shift(),\r\n\t\t\thooks = jQuery._queueHooks( elem, type ),\r\n\t\t\tnext = function() {\r\n\t\t\t\tjQuery.dequeue( elem, type );\r\n\t\t\t};\r\n\r\n\t\t// If the fx queue is dequeued, always remove the progress sentinel\r\n\t\tif ( fn === \"inprogress\" ) {\r\n\t\t\tfn = queue.shift();\r\n\t\t\tstartLength--;\r\n\t\t}\r\n\r\n\t\tif ( fn ) {\r\n\r\n\t\t\t// Add a progress sentinel to prevent the fx queue from being\r\n\t\t\t// automatically dequeued\r\n\t\t\tif ( type === \"fx\" ) {\r\n\t\t\t\tqueue.unshift( \"inprogress\" );\r\n\t\t\t}\r\n\r\n\t\t\t// Clear up the last queue stop function\r\n\t\t\tdelete hooks.stop;\r\n\t\t\tfn.call( elem, next, hooks );\r\n\t\t}\r\n\r\n\t\tif ( !startLength && hooks ) {\r\n\t\t\thooks.empty.fire();\r\n\t\t}\r\n\t},\r\n\r\n\t// Not public - generate a queueHooks object, or return the current one\r\n\t_queueHooks: function( elem, type ) {\r\n\t\tvar key = type + \"queueHooks\";\r\n\t\treturn data_priv.get( elem, key ) || data_priv.access( elem, key, {\r\n\t\t\tempty: jQuery.Callbacks(\"once memory\").add(function() {\r\n\t\t\t\tdata_priv.remove( elem, [ type + \"queue\", key ] );\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n});\r\n\r\njQuery.fn.extend({\r\n\tqueue: function( type, data ) {\r\n\t\tvar setter = 2;\r\n\r\n\t\tif ( typeof type !== \"string\" ) {\r\n\t\t\tdata = type;\r\n\t\t\ttype = \"fx\";\r\n\t\t\tsetter--;\r\n\t\t}\r\n\r\n\t\tif ( arguments.length < setter ) {\r\n\t\t\treturn jQuery.queue( this[0], type );\r\n\t\t}\r\n\r\n\t\treturn data === undefined ?\r\n\t\t\tthis :\r\n\t\t\tthis.each(function() {\r\n\t\t\t\tvar queue = jQuery.queue( this, type, data );\r\n\r\n\t\t\t\t// Ensure a hooks for this queue\r\n\t\t\t\tjQuery._queueHooks( this, type );\r\n\r\n\t\t\t\tif ( type === \"fx\" && queue[0] !== \"inprogress\" ) {\r\n\t\t\t\t\tjQuery.dequeue( this, type );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t},\r\n\tdequeue: function( type ) {\r\n\t\treturn this.each(function() {\r\n\t\t\tjQuery.dequeue( this, type );\r\n\t\t});\r\n\t},\r\n\tclearQueue: function( type ) {\r\n\t\treturn this.queue( type || \"fx\", [] );\r\n\t},\r\n\t// Get a promise resolved when queues of a certain type\r\n\t// are emptied (fx is the type by default)\r\n\tpromise: function( type, obj ) {\r\n\t\tvar tmp,\r\n\t\t\tcount = 1,\r\n\t\t\tdefer = jQuery.Deferred(),\r\n\t\t\telements = this,\r\n\t\t\ti = this.length,\r\n\t\t\tresolve = function() {\r\n\t\t\t\tif ( !( --count ) ) {\r\n\t\t\t\t\tdefer.resolveWith( elements, [ elements ] );\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\tif ( typeof type !== \"string\" ) {\r\n\t\t\tobj = type;\r\n\t\t\ttype = undefined;\r\n\t\t}\r\n\t\ttype = type || \"fx\";\r\n\r\n\t\twhile ( i-- ) {\r\n\t\t\ttmp = data_priv.get( elements[ i ], type + \"queueHooks\" );\r\n\t\t\tif ( tmp && tmp.empty ) {\r\n\t\t\t\tcount++;\r\n\t\t\t\ttmp.empty.add( resolve );\r\n\t\t\t}\r\n\t\t}\r\n\t\tresolve();\r\n\t\treturn defer.promise( obj );\r\n\t}\r\n});\r\nvar pnum = (/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/).source;\r\n\r\nvar cssExpand = [ \"Top\", \"Right\", \"Bottom\", \"Left\" ];\r\n\r\nvar isHidden = function( elem, el ) {\r\n\t\t// isHidden might be called from jQuery#filter function;\r\n\t\t// in that case, element will be second argument\r\n\t\telem = el || elem;\r\n\t\treturn jQuery.css( elem, \"display\" ) === \"none\" || !jQuery.contains( elem.ownerDocument, elem );\r\n\t};\r\n\r\nvar rcheckableType = (/^(?:checkbox|radio)$/i);\r\n\r\n\r\n\r\n(function() {\r\n\tvar fragment = document.createDocumentFragment(),\r\n\t\tdiv = fragment.appendChild( document.createElement( \"div\" ) ),\r\n\t\tinput = document.createElement( \"input\" );\r\n\r\n\t// Support: Safari<=5.1\r\n\t// Check state lost if the name is set (#11217)\r\n\t// Support: Windows Web Apps (WWA)\r\n\t// `name` and `type` must use .setAttribute for WWA (#14901)\r\n\tinput.setAttribute( \"type\", \"radio\" );\r\n\tinput.setAttribute( \"checked\", \"checked\" );\r\n\tinput.setAttribute( \"name\", \"t\" );\r\n\r\n\tdiv.appendChild( input );\r\n\r\n\t// Support: Safari<=5.1, Android<4.2\r\n\t// Older WebKit doesn't clone checked state correctly in fragments\r\n\tsupport.checkClone = div.cloneNode( true ).cloneNode( true ).lastChild.checked;\r\n\r\n\t// Support: IE<=11+\r\n\t// Make sure textarea (and checkbox) defaultValue is properly cloned\r\n\tdiv.innerHTML = \"<textarea>x</textarea>\";\r\n\tsupport.noCloneChecked = !!div.cloneNode( true ).lastChild.defaultValue;\r\n})();\r\nvar strundefined = typeof undefined;\r\n\r\n\r\n\r\nsupport.focusinBubbles = \"onfocusin\" in window;\r\n\r\n\r\nvar\r\n\trkeyEvent = /^key/,\r\n\trmouseEvent = /^(?:mouse|pointer|contextmenu)|click/,\r\n\trfocusMorph = /^(?:focusinfocus|focusoutblur)$/,\r\n\trtypenamespace = /^([^.]*)(?:\\.(.+)|)$/;\r\n\r\nfunction returnTrue() {\r\n\treturn true;\r\n}\r\n\r\nfunction returnFalse() {\r\n\treturn false;\r\n}\r\n\r\nfunction safeActiveElement() {\r\n\ttry {\r\n\t\treturn document.activeElement;\r\n\t} catch ( err ) { }\r\n}\r\n\r\n/*\r\n * Helper functions for managing events -- not part of the public interface.\r\n * Props to Dean Edwards' addEvent library for many of the ideas.\r\n */\r\njQuery.event = {\r\n\r\n\tglobal: {},\r\n\r\n\tadd: function( elem, types, handler, data, selector ) {\r\n\r\n\t\tvar handleObjIn, eventHandle, tmp,\r\n\t\t\tevents, t, handleObj,\r\n\t\t\tspecial, handlers, type, namespaces, origType,\r\n\t\t\telemData = data_priv.get( elem );\r\n\r\n\t\t// Don't attach events to noData or text/comment nodes (but allow plain objects)\r\n\t\tif ( !elemData ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Caller can pass in an object of custom data in lieu of the handler\r\n\t\tif ( handler.handler ) {\r\n\t\t\thandleObjIn = handler;\r\n\t\t\thandler = handleObjIn.handler;\r\n\t\t\tselector = handleObjIn.selector;\r\n\t\t}\r\n\r\n\t\t// Make sure that the handler has a unique ID, used to find/remove it later\r\n\t\tif ( !handler.guid ) {\r\n\t\t\thandler.guid = jQuery.guid++;\r\n\t\t}\r\n\r\n\t\t// Init the element's event structure and main handler, if this is the first\r\n\t\tif ( !(events = elemData.events) ) {\r\n\t\t\tevents = elemData.events = {};\r\n\t\t}\r\n\t\tif ( !(eventHandle = elemData.handle) ) {\r\n\t\t\teventHandle = elemData.handle = function( e ) {\r\n\t\t\t\t// Discard the second event of a jQuery.event.trigger() and\r\n\t\t\t\t// when an event is called after a page has unloaded\r\n\t\t\t\treturn typeof jQuery !== strundefined && jQuery.event.triggered !== e.type ?\r\n\t\t\t\t\tjQuery.event.dispatch.apply( elem, arguments ) : undefined;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Handle multiple events separated by a space\r\n\t\ttypes = ( types || \"\" ).match( rnotwhite ) || [ \"\" ];\r\n\t\tt = types.length;\r\n\t\twhile ( t-- ) {\r\n\t\t\ttmp = rtypenamespace.exec( types[t] ) || [];\r\n\t\t\ttype = origType = tmp[1];\r\n\t\t\tnamespaces = ( tmp[2] || \"\" ).split( \".\" ).sort();\r\n\r\n\t\t\t// There *must* be a type, no attaching namespace-only handlers\r\n\t\t\tif ( !type ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// If event changes its type, use the special event handlers for the changed type\r\n\t\t\tspecial = jQuery.event.special[ type ] || {};\r\n\r\n\t\t\t// If selector defined, determine special event api type, otherwise given type\r\n\t\t\ttype = ( selector ? special.delegateType : special.bindType ) || type;\r\n\r\n\t\t\t// Update special based on newly reset type\r\n\t\t\tspecial = jQuery.event.special[ type ] || {};\r\n\r\n\t\t\t// handleObj is passed to all event handlers\r\n\t\t\thandleObj = jQuery.extend({\r\n\t\t\t\ttype: type,\r\n\t\t\t\torigType: origType,\r\n\t\t\t\tdata: data,\r\n\t\t\t\thandler: handler,\r\n\t\t\t\tguid: handler.guid,\r\n\t\t\t\tselector: selector,\r\n\t\t\t\tneedsContext: selector && jQuery.expr.match.needsContext.test( selector ),\r\n\t\t\t\tnamespace: namespaces.join(\".\")\r\n\t\t\t}, handleObjIn );\r\n\r\n\t\t\t// Init the event handler queue if we're the first\r\n\t\t\tif ( !(handlers = events[ type ]) ) {\r\n\t\t\t\thandlers = events[ type ] = [];\r\n\t\t\t\thandlers.delegateCount = 0;\r\n\r\n\t\t\t\t// Only use addEventListener if the special events handler returns false\r\n\t\t\t\tif ( !special.setup || special.setup.call( elem, data, namespaces, eventHandle ) === false ) {\r\n\t\t\t\t\tif ( elem.addEventListener ) {\r\n\t\t\t\t\t\telem.addEventListener( type, eventHandle, false );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( special.add ) {\r\n\t\t\t\tspecial.add.call( elem, handleObj );\r\n\r\n\t\t\t\tif ( !handleObj.handler.guid ) {\r\n\t\t\t\t\thandleObj.handler.guid = handler.guid;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add to the element's handler list, delegates in front\r\n\t\t\tif ( selector ) {\r\n\t\t\t\thandlers.splice( handlers.delegateCount++, 0, handleObj );\r\n\t\t\t} else {\r\n\t\t\t\thandlers.push( handleObj );\r\n\t\t\t}\r\n\r\n\t\t\t// Keep track of which events have ever been used, for event optimization\r\n\t\t\tjQuery.event.global[ type ] = true;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// Detach an event or set of events from an element\r\n\tremove: function( elem, types, handler, selector, mappedTypes ) {\r\n\r\n\t\tvar j, origCount, tmp,\r\n\t\t\tevents, t, handleObj,\r\n\t\t\tspecial, handlers, type, namespaces, origType,\r\n\t\t\telemData = data_priv.hasData( elem ) && data_priv.get( elem );\r\n\r\n\t\tif ( !elemData || !(events = elemData.events) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Once for each type.namespace in types; type may be omitted\r\n\t\ttypes = ( types || \"\" ).match( rnotwhite ) || [ \"\" ];\r\n\t\tt = types.length;\r\n\t\twhile ( t-- ) {\r\n\t\t\ttmp = rtypenamespace.exec( types[t] ) || [];\r\n\t\t\ttype = origType = tmp[1];\r\n\t\t\tnamespaces = ( tmp[2] || \"\" ).split( \".\" ).sort();\r\n\r\n\t\t\t// Unbind all events (on this namespace, if provided) for the element\r\n\t\t\tif ( !type ) {\r\n\t\t\t\tfor ( type in events ) {\r\n\t\t\t\t\tjQuery.event.remove( elem, type + types[ t ], handler, selector, true );\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tspecial = jQuery.event.special[ type ] || {};\r\n\t\t\ttype = ( selector ? special.delegateType : special.bindType ) || type;\r\n\t\t\thandlers = events[ type ] || [];\r\n\t\t\ttmp = tmp[2] && new RegExp( \"(^|\\\\.)\" + namespaces.join(\"\\\\.(?:.*\\\\.|)\") + \"(\\\\.|$)\" );\r\n\r\n\t\t\t// Remove matching events\r\n\t\t\torigCount = j = handlers.length;\r\n\t\t\twhile ( j-- ) {\r\n\t\t\t\thandleObj = handlers[ j ];\r\n\r\n\t\t\t\tif ( ( mappedTypes || origType === handleObj.origType ) &&\r\n\t\t\t\t\t( !handler || handler.guid === handleObj.guid ) &&\r\n\t\t\t\t\t( !tmp || tmp.test( handleObj.namespace ) ) &&\r\n\t\t\t\t\t( !selector || selector === handleObj.selector || selector === \"**\" && handleObj.selector ) ) {\r\n\t\t\t\t\thandlers.splice( j, 1 );\r\n\r\n\t\t\t\t\tif ( handleObj.selector ) {\r\n\t\t\t\t\t\thandlers.delegateCount--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( special.remove ) {\r\n\t\t\t\t\t\tspecial.remove.call( elem, handleObj );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove generic event handler if we removed something and no more handlers exist\r\n\t\t\t// (avoids potential for endless recursion during removal of special event handlers)\r\n\t\t\tif ( origCount && !handlers.length ) {\r\n\t\t\t\tif ( !special.teardown || special.teardown.call( elem, namespaces, elemData.handle ) === false ) {\r\n\t\t\t\t\tjQuery.removeEvent( elem, type, elemData.handle );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete events[ type ];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Remove the expando if it's no longer used\r\n\t\tif ( jQuery.isEmptyObject( events ) ) {\r\n\t\t\tdelete elemData.handle;\r\n\t\t\tdata_priv.remove( elem, \"events\" );\r\n\t\t}\r\n\t},\r\n\r\n\ttrigger: function( event, data, elem, onlyHandlers ) {\r\n\r\n\t\tvar i, cur, tmp, bubbleType, ontype, handle, special,\r\n\t\t\teventPath = [ elem || document ],\r\n\t\t\ttype = hasOwn.call( event, \"type\" ) ? event.type : event,\r\n\t\t\tnamespaces = hasOwn.call( event, \"namespace\" ) ? event.namespace.split(\".\") : [];\r\n\r\n\t\tcur = tmp = elem = elem || document;\r\n\r\n\t\t// Don't do events on text and comment nodes\r\n\t\tif ( elem.nodeType === 3 || elem.nodeType === 8 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// focus/blur morphs to focusin/out; ensure we're not firing them right now\r\n\t\tif ( rfocusMorph.test( type + jQuery.event.triggered ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( type.indexOf(\".\") >= 0 ) {\r\n\t\t\t// Namespaced trigger; create a regexp to match event type in handle()\r\n\t\t\tnamespaces = type.split(\".\");\r\n\t\t\ttype = namespaces.shift();\r\n\t\t\tnamespaces.sort();\r\n\t\t}\r\n\t\tontype = type.indexOf(\":\") < 0 && \"on\" + type;\r\n\r\n\t\t// Caller can pass in a jQuery.Event object, Object, or just an event type string\r\n\t\tevent = event[ jQuery.expando ] ?\r\n\t\t\tevent :\r\n\t\t\tnew jQuery.Event( type, typeof event === \"object\" && event );\r\n\r\n\t\t// Trigger bitmask: & 1 for native handlers; & 2 for jQuery (always true)\r\n\t\tevent.isTrigger = onlyHandlers ? 2 : 3;\r\n\t\tevent.namespace = namespaces.join(\".\");\r\n\t\tevent.namespace_re = event.namespace ?\r\n\t\t\tnew RegExp( \"(^|\\\\.)\" + namespaces.join(\"\\\\.(?:.*\\\\.|)\") + \"(\\\\.|$)\" ) :\r\n\t\t\tnull;\r\n\r\n\t\t// Clean up the event in case it is being reused\r\n\t\tevent.result = undefined;\r\n\t\tif ( !event.target ) {\r\n\t\t\tevent.target = elem;\r\n\t\t}\r\n\r\n\t\t// Clone any incoming data and prepend the event, creating the handler arg list\r\n\t\tdata = data == null ?\r\n\t\t\t[ event ] :\r\n\t\t\tjQuery.makeArray( data, [ event ] );\r\n\r\n\t\t// Allow special events to draw outside the lines\r\n\t\tspecial = jQuery.event.special[ type ] || {};\r\n\t\tif ( !onlyHandlers && special.trigger && special.trigger.apply( elem, data ) === false ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Determine event propagation path in advance, per W3C events spec (#9951)\r\n\t\t// Bubble up to document, then to window; watch for a global ownerDocument var (#9724)\r\n\t\tif ( !onlyHandlers && !special.noBubble && !jQuery.isWindow( elem ) ) {\r\n\r\n\t\t\tbubbleType = special.delegateType || type;\r\n\t\t\tif ( !rfocusMorph.test( bubbleType + type ) ) {\r\n\t\t\t\tcur = cur.parentNode;\r\n\t\t\t}\r\n\t\t\tfor ( ; cur; cur = cur.parentNode ) {\r\n\t\t\t\teventPath.push( cur );\r\n\t\t\t\ttmp = cur;\r\n\t\t\t}\r\n\r\n\t\t\t// Only add window if we got to document (e.g., not plain obj or detached DOM)\r\n\t\t\tif ( tmp === (elem.ownerDocument || document) ) {\r\n\t\t\t\teventPath.push( tmp.defaultView || tmp.parentWindow || window );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Fire handlers on the event path\r\n\t\ti = 0;\r\n\t\twhile ( (cur = eventPath[i++]) && !event.isPropagationStopped() ) {\r\n\r\n\t\t\tevent.type = i > 1 ?\r\n\t\t\t\tbubbleType :\r\n\t\t\t\tspecial.bindType || type;\r\n\r\n\t\t\t// jQuery handler\r\n\t\t\thandle = ( data_priv.get( cur, \"events\" ) || {} )[ event.type ] && data_priv.get( cur, \"handle\" );\r\n\t\t\tif ( handle ) {\r\n\t\t\t\thandle.apply( cur, data );\r\n\t\t\t}\r\n\r\n\t\t\t// Native handler\r\n\t\t\thandle = ontype && cur[ ontype ];\r\n\t\t\tif ( handle && handle.apply && jQuery.acceptData( cur ) ) {\r\n\t\t\t\tevent.result = handle.apply( cur, data );\r\n\t\t\t\tif ( event.result === false ) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tevent.type = type;\r\n\r\n\t\t// If nobody prevented the default action, do it now\r\n\t\tif ( !onlyHandlers && !event.isDefaultPrevented() ) {\r\n\r\n\t\t\tif ( (!special._default || special._default.apply( eventPath.pop(), data ) === false) &&\r\n\t\t\t\tjQuery.acceptData( elem ) ) {\r\n\r\n\t\t\t\t// Call a native DOM method on the target with the same name name as the event.\r\n\t\t\t\t// Don't do default actions on window, that's where global variables be (#6170)\r\n\t\t\t\tif ( ontype && jQuery.isFunction( elem[ type ] ) && !jQuery.isWindow( elem ) ) {\r\n\r\n\t\t\t\t\t// Don't re-trigger an onFOO event when we call its FOO() method\r\n\t\t\t\t\ttmp = elem[ ontype ];\r\n\r\n\t\t\t\t\tif ( tmp ) {\r\n\t\t\t\t\t\telem[ ontype ] = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Prevent re-triggering of the same event, since we already bubbled it above\r\n\t\t\t\t\tjQuery.event.triggered = type;\r\n\t\t\t\t\telem[ type ]();\r\n\t\t\t\t\tjQuery.event.triggered = undefined;\r\n\r\n\t\t\t\t\tif ( tmp ) {\r\n\t\t\t\t\t\telem[ ontype ] = tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn event.result;\r\n\t},\r\n\r\n\tdispatch: function( event ) {\r\n\r\n\t\t// Make a writable jQuery.Event from the native event object\r\n\t\tevent = jQuery.event.fix( event );\r\n\r\n\t\tvar i, j, ret, matched, handleObj,\r\n\t\t\thandlerQueue = [],\r\n\t\t\targs = slice.call( arguments ),\r\n\t\t\thandlers = ( data_priv.get( this, \"events\" ) || {} )[ event.type ] || [],\r\n\t\t\tspecial = jQuery.event.special[ event.type ] || {};\r\n\r\n\t\t// Use the fix-ed jQuery.Event rather than the (read-only) native event\r\n\t\targs[0] = event;\r\n\t\tevent.delegateTarget = this;\r\n\r\n\t\t// Call the preDispatch hook for the mapped type, and let it bail if desired\r\n\t\tif ( special.preDispatch && special.preDispatch.call( this, event ) === false ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Determine handlers\r\n\t\thandlerQueue = jQuery.event.handlers.call( this, event, handlers );\r\n\r\n\t\t// Run delegates first; they may want to stop propagation beneath us\r\n\t\ti = 0;\r\n\t\twhile ( (matched = handlerQueue[ i++ ]) && !event.isPropagationStopped() ) {\r\n\t\t\tevent.currentTarget = matched.elem;\r\n\r\n\t\t\tj = 0;\r\n\t\t\twhile ( (handleObj = matched.handlers[ j++ ]) && !event.isImmediatePropagationStopped() ) {\r\n\r\n\t\t\t\t// Triggered event must either 1) have no namespace, or 2) have namespace(s)\r\n\t\t\t\t// a subset or equal to those in the bound event (both can have no namespace).\r\n\t\t\t\tif ( !event.namespace_re || event.namespace_re.test( handleObj.namespace ) ) {\r\n\r\n\t\t\t\t\tevent.handleObj = handleObj;\r\n\t\t\t\t\tevent.data = handleObj.data;\r\n\r\n\t\t\t\t\tret = ( (jQuery.event.special[ handleObj.origType ] || {}).handle || handleObj.handler )\r\n\t\t\t\t\t\t\t.apply( matched.elem, args );\r\n\r\n\t\t\t\t\tif ( ret !== undefined ) {\r\n\t\t\t\t\t\tif ( (event.result = ret) === false ) {\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Call the postDispatch hook for the mapped type\r\n\t\tif ( special.postDispatch ) {\r\n\t\t\tspecial.postDispatch.call( this, event );\r\n\t\t}\r\n\r\n\t\treturn event.result;\r\n\t},\r\n\r\n\thandlers: function( event, handlers ) {\r\n\t\tvar i, matches, sel, handleObj,\r\n\t\t\thandlerQueue = [],\r\n\t\t\tdelegateCount = handlers.delegateCount,\r\n\t\t\tcur = event.target;\r\n\r\n\t\t// Find delegate handlers\r\n\t\t// Black-hole SVG <use> instance trees (#13180)\r\n\t\t// Avoid non-left-click bubbling in Firefox (#3861)\r\n\t\tif ( delegateCount && cur.nodeType && (!event.button || event.type !== \"click\") ) {\r\n\r\n\t\t\tfor ( ; cur !== this; cur = cur.parentNode || this ) {\r\n\r\n\t\t\t\t// Don't process clicks on disabled elements (#6911, #8165, #11382, #11764)\r\n\t\t\t\tif ( cur.disabled !== true || event.type !== \"click\" ) {\r\n\t\t\t\t\tmatches = [];\r\n\t\t\t\t\tfor ( i = 0; i < delegateCount; i++ ) {\r\n\t\t\t\t\t\thandleObj = handlers[ i ];\r\n\r\n\t\t\t\t\t\t// Don't conflict with Object.prototype properties (#13203)\r\n\t\t\t\t\t\tsel = handleObj.selector + \" \";\r\n\r\n\t\t\t\t\t\tif ( matches[ sel ] === undefined ) {\r\n\t\t\t\t\t\t\tmatches[ sel ] = handleObj.needsContext ?\r\n\t\t\t\t\t\t\t\tjQuery( sel, this ).index( cur ) >= 0 :\r\n\t\t\t\t\t\t\t\tjQuery.find( sel, this, null, [ cur ] ).length;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( matches[ sel ] ) {\r\n\t\t\t\t\t\t\tmatches.push( handleObj );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( matches.length ) {\r\n\t\t\t\t\t\thandlerQueue.push({ elem: cur, handlers: matches });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add the remaining (directly-bound) handlers\r\n\t\tif ( delegateCount < handlers.length ) {\r\n\t\t\thandlerQueue.push({ elem: this, handlers: handlers.slice( delegateCount ) });\r\n\t\t}\r\n\r\n\t\treturn handlerQueue;\r\n\t},\r\n\r\n\t// Includes some event props shared by KeyEvent and MouseEvent\r\n\tprops: \"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which\".split(\" \"),\r\n\r\n\tfixHooks: {},\r\n\r\n\tkeyHooks: {\r\n\t\tprops: \"char charCode key keyCode\".split(\" \"),\r\n\t\tfilter: function( event, original ) {\r\n\r\n\t\t\t// Add which for key events\r\n\t\t\tif ( event.which == null ) {\r\n\t\t\t\tevent.which = original.charCode != null ? original.charCode : original.keyCode;\r\n\t\t\t}\r\n\r\n\t\t\treturn event;\r\n\t\t}\r\n\t},\r\n\r\n\tmouseHooks: {\r\n\t\tprops: \"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement\".split(\" \"),\r\n\t\tfilter: function( event, original ) {\r\n\t\t\tvar eventDoc, doc, body,\r\n\t\t\t\tbutton = original.button;\r\n\r\n\t\t\t// Calculate pageX/Y if missing and clientX/Y available\r\n\t\t\tif ( event.pageX == null && original.clientX != null ) {\r\n\t\t\t\teventDoc = event.target.ownerDocument || document;\r\n\t\t\t\tdoc = eventDoc.documentElement;\r\n\t\t\t\tbody = eventDoc.body;\r\n\r\n\t\t\t\tevent.pageX = original.clientX + ( doc && doc.scrollLeft || body && body.scrollLeft || 0 ) - ( doc && doc.clientLeft || body && body.clientLeft || 0 );\r\n\t\t\t\tevent.pageY = original.clientY + ( doc && doc.scrollTop  || body && body.scrollTop  || 0 ) - ( doc && doc.clientTop  || body && body.clientTop  || 0 );\r\n\t\t\t}\r\n\r\n\t\t\t// Add which for click: 1 === left; 2 === middle; 3 === right\r\n\t\t\t// Note: button is not normalized, so don't use it\r\n\t\t\tif ( !event.which && button !== undefined ) {\r\n\t\t\t\tevent.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );\r\n\t\t\t}\r\n\r\n\t\t\treturn event;\r\n\t\t}\r\n\t},\r\n\r\n\tfix: function( event ) {\r\n\t\tif ( event[ jQuery.expando ] ) {\r\n\t\t\treturn event;\r\n\t\t}\r\n\r\n\t\t// Create a writable copy of the event object and normalize some properties\r\n\t\tvar i, prop, copy,\r\n\t\t\ttype = event.type,\r\n\t\t\toriginalEvent = event,\r\n\t\t\tfixHook = this.fixHooks[ type ];\r\n\r\n\t\tif ( !fixHook ) {\r\n\t\t\tthis.fixHooks[ type ] = fixHook =\r\n\t\t\t\trmouseEvent.test( type ) ? this.mouseHooks :\r\n\t\t\t\trkeyEvent.test( type ) ? this.keyHooks :\r\n\t\t\t\t{};\r\n\t\t}\r\n\t\tcopy = fixHook.props ? this.props.concat( fixHook.props ) : this.props;\r\n\r\n\t\tevent = new jQuery.Event( originalEvent );\r\n\r\n\t\ti = copy.length;\r\n\t\twhile ( i-- ) {\r\n\t\t\tprop = copy[ i ];\r\n\t\t\tevent[ prop ] = originalEvent[ prop ];\r\n\t\t}\r\n\r\n\t\t// Support: Cordova 2.5 (WebKit) (#13255)\r\n\t\t// All events should have a target; Cordova deviceready doesn't\r\n\t\tif ( !event.target ) {\r\n\t\t\tevent.target = document;\r\n\t\t}\r\n\r\n\t\t// Support: Safari 6.0+, Chrome<28\r\n\t\t// Target should not be a text node (#504, #13143)\r\n\t\tif ( event.target.nodeType === 3 ) {\r\n\t\t\tevent.target = event.target.parentNode;\r\n\t\t}\r\n\r\n\t\treturn fixHook.filter ? fixHook.filter( event, originalEvent ) : event;\r\n\t},\r\n\r\n\tspecial: {\r\n\t\tload: {\r\n\t\t\t// Prevent triggered image.load events from bubbling to window.load\r\n\t\t\tnoBubble: true\r\n\t\t},\r\n\t\tfocus: {\r\n\t\t\t// Fire native event if possible so blur/focus sequence is correct\r\n\t\t\ttrigger: function() {\r\n\t\t\t\tif ( this !== safeActiveElement() && this.focus ) {\r\n\t\t\t\t\tthis.focus();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelegateType: \"focusin\"\r\n\t\t},\r\n\t\tblur: {\r\n\t\t\ttrigger: function() {\r\n\t\t\t\tif ( this === safeActiveElement() && this.blur ) {\r\n\t\t\t\t\tthis.blur();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelegateType: \"focusout\"\r\n\t\t},\r\n\t\tclick: {\r\n\t\t\t// For checkbox, fire native event so checked state will be right\r\n\t\t\ttrigger: function() {\r\n\t\t\t\tif ( this.type === \"checkbox\" && this.click && jQuery.nodeName( this, \"input\" ) ) {\r\n\t\t\t\t\tthis.click();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// For cross-browser consistency, don't fire native .click() on links\r\n\t\t\t_default: function( event ) {\r\n\t\t\t\treturn jQuery.nodeName( event.target, \"a\" );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbeforeunload: {\r\n\t\t\tpostDispatch: function( event ) {\r\n\r\n\t\t\t\t// Support: Firefox 20+\r\n\t\t\t\t// Firefox doesn't alert if the returnValue field is not set.\r\n\t\t\t\tif ( event.result !== undefined && event.originalEvent ) {\r\n\t\t\t\t\tevent.originalEvent.returnValue = event.result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsimulate: function( type, elem, event, bubble ) {\r\n\t\t// Piggyback on a donor event to simulate a different one.\r\n\t\t// Fake originalEvent to avoid donor's stopPropagation, but if the\r\n\t\t// simulated event prevents default then we do the same on the donor.\r\n\t\tvar e = jQuery.extend(\r\n\t\t\tnew jQuery.Event(),\r\n\t\t\tevent,\r\n\t\t\t{\r\n\t\t\t\ttype: type,\r\n\t\t\t\tisSimulated: true,\r\n\t\t\t\toriginalEvent: {}\r\n\t\t\t}\r\n\t\t);\r\n\t\tif ( bubble ) {\r\n\t\t\tjQuery.event.trigger( e, null, elem );\r\n\t\t} else {\r\n\t\t\tjQuery.event.dispatch.call( elem, e );\r\n\t\t}\r\n\t\tif ( e.isDefaultPrevented() ) {\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t}\r\n};\r\n\r\njQuery.removeEvent = function( elem, type, handle ) {\r\n\tif ( elem.removeEventListener ) {\r\n\t\telem.removeEventListener( type, handle, false );\r\n\t}\r\n};\r\n\r\njQuery.Event = function( src, props ) {\r\n\t// Allow instantiation without the 'new' keyword\r\n\tif ( !(this instanceof jQuery.Event) ) {\r\n\t\treturn new jQuery.Event( src, props );\r\n\t}\r\n\r\n\t// Event object\r\n\tif ( src && src.type ) {\r\n\t\tthis.originalEvent = src;\r\n\t\tthis.type = src.type;\r\n\r\n\t\t// Events bubbling up the document may have been marked as prevented\r\n\t\t// by a handler lower down the tree; reflect the correct value.\r\n\t\tthis.isDefaultPrevented = src.defaultPrevented ||\r\n\t\t\t\tsrc.defaultPrevented === undefined &&\r\n\t\t\t\t// Support: Android<4.0\r\n\t\t\t\tsrc.returnValue === false ?\r\n\t\t\treturnTrue :\r\n\t\t\treturnFalse;\r\n\r\n\t// Event type\r\n\t} else {\r\n\t\tthis.type = src;\r\n\t}\r\n\r\n\t// Put explicitly provided properties onto the event object\r\n\tif ( props ) {\r\n\t\tjQuery.extend( this, props );\r\n\t}\r\n\r\n\t// Create a timestamp if incoming event doesn't have one\r\n\tthis.timeStamp = src && src.timeStamp || jQuery.now();\r\n\r\n\t// Mark it as fixed\r\n\tthis[ jQuery.expando ] = true;\r\n};\r\n\r\n// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding\r\n// http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html\r\njQuery.Event.prototype = {\r\n\tisDefaultPrevented: returnFalse,\r\n\tisPropagationStopped: returnFalse,\r\n\tisImmediatePropagationStopped: returnFalse,\r\n\r\n\tpreventDefault: function() {\r\n\t\tvar e = this.originalEvent;\r\n\r\n\t\tthis.isDefaultPrevented = returnTrue;\r\n\r\n\t\tif ( e && e.preventDefault ) {\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t},\r\n\tstopPropagation: function() {\r\n\t\tvar e = this.originalEvent;\r\n\r\n\t\tthis.isPropagationStopped = returnTrue;\r\n\r\n\t\tif ( e && e.stopPropagation ) {\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\t},\r\n\tstopImmediatePropagation: function() {\r\n\t\tvar e = this.originalEvent;\r\n\r\n\t\tthis.isImmediatePropagationStopped = returnTrue;\r\n\r\n\t\tif ( e && e.stopImmediatePropagation ) {\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\r\n\t\tthis.stopPropagation();\r\n\t}\r\n};\r\n\r\n// Create mouseenter/leave events using mouseover/out and event-time checks\r\n// Support: Chrome 15+\r\njQuery.each({\r\n\tmouseenter: \"mouseover\",\r\n\tmouseleave: \"mouseout\",\r\n\tpointerenter: \"pointerover\",\r\n\tpointerleave: \"pointerout\"\r\n}, function( orig, fix ) {\r\n\tjQuery.event.special[ orig ] = {\r\n\t\tdelegateType: fix,\r\n\t\tbindType: fix,\r\n\r\n\t\thandle: function( event ) {\r\n\t\t\tvar ret,\r\n\t\t\t\ttarget = this,\r\n\t\t\t\trelated = event.relatedTarget,\r\n\t\t\t\thandleObj = event.handleObj;\r\n\r\n\t\t\t// For mousenter/leave call the handler if related is outside the target.\r\n\t\t\t// NB: No relatedTarget if the mouse left/entered the browser window\r\n\t\t\tif ( !related || (related !== target && !jQuery.contains( target, related )) ) {\r\n\t\t\t\tevent.type = handleObj.origType;\r\n\t\t\t\tret = handleObj.handler.apply( this, arguments );\r\n\t\t\t\tevent.type = fix;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Support: Firefox, Chrome, Safari\r\n// Create \"bubbling\" focus and blur events\r\nif ( !support.focusinBubbles ) {\r\n\tjQuery.each({ focus: \"focusin\", blur: \"focusout\" }, function( orig, fix ) {\r\n\r\n\t\t// Attach a single capturing handler on the document while someone wants focusin/focusout\r\n\t\tvar handler = function( event ) {\r\n\t\t\t\tjQuery.event.simulate( fix, event.target, jQuery.event.fix( event ), true );\r\n\t\t\t};\r\n\r\n\t\tjQuery.event.special[ fix ] = {\r\n\t\t\tsetup: function() {\r\n\t\t\t\tvar doc = this.ownerDocument || this,\r\n\t\t\t\t\tattaches = data_priv.access( doc, fix );\r\n\r\n\t\t\t\tif ( !attaches ) {\r\n\t\t\t\t\tdoc.addEventListener( orig, handler, true );\r\n\t\t\t\t}\r\n\t\t\t\tdata_priv.access( doc, fix, ( attaches || 0 ) + 1 );\r\n\t\t\t},\r\n\t\t\tteardown: function() {\r\n\t\t\t\tvar doc = this.ownerDocument || this,\r\n\t\t\t\t\tattaches = data_priv.access( doc, fix ) - 1;\r\n\r\n\t\t\t\tif ( !attaches ) {\r\n\t\t\t\t\tdoc.removeEventListener( orig, handler, true );\r\n\t\t\t\t\tdata_priv.remove( doc, fix );\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata_priv.access( doc, fix, attaches );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n}\r\n\r\njQuery.fn.extend({\r\n\r\n\ton: function( types, selector, data, fn, /*INTERNAL*/ one ) {\r\n\t\tvar origFn, type;\r\n\r\n\t\t// Types can be a map of types/handlers\r\n\t\tif ( typeof types === \"object\" ) {\r\n\t\t\t// ( types-Object, selector, data )\r\n\t\t\tif ( typeof selector !== \"string\" ) {\r\n\t\t\t\t// ( types-Object, data )\r\n\t\t\t\tdata = data || selector;\r\n\t\t\t\tselector = undefined;\r\n\t\t\t}\r\n\t\t\tfor ( type in types ) {\r\n\t\t\t\tthis.on( type, selector, data, types[ type ], one );\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif ( data == null && fn == null ) {\r\n\t\t\t// ( types, fn )\r\n\t\t\tfn = selector;\r\n\t\t\tdata = selector = undefined;\r\n\t\t} else if ( fn == null ) {\r\n\t\t\tif ( typeof selector === \"string\" ) {\r\n\t\t\t\t// ( types, selector, fn )\r\n\t\t\t\tfn = data;\r\n\t\t\t\tdata = undefined;\r\n\t\t\t} else {\r\n\t\t\t\t// ( types, data, fn )\r\n\t\t\t\tfn = data;\r\n\t\t\t\tdata = selector;\r\n\t\t\t\tselector = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( fn === false ) {\r\n\t\t\tfn = returnFalse;\r\n\t\t} else if ( !fn ) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif ( one === 1 ) {\r\n\t\t\torigFn = fn;\r\n\t\t\tfn = function( event ) {\r\n\t\t\t\t// Can use an empty set, since event contains the info\r\n\t\t\t\tjQuery().off( event );\r\n\t\t\t\treturn origFn.apply( this, arguments );\r\n\t\t\t};\r\n\t\t\t// Use same guid so caller can remove using origFn\r\n\t\t\tfn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );\r\n\t\t}\r\n\t\treturn this.each( function() {\r\n\t\t\tjQuery.event.add( this, types, fn, data, selector );\r\n\t\t});\r\n\t},\r\n\tone: function( types, selector, data, fn ) {\r\n\t\treturn this.on( types, selector, data, fn, 1 );\r\n\t},\r\n\toff: function( types, selector, fn ) {\r\n\t\tvar handleObj, type;\r\n\t\tif ( types && types.preventDefault && types.handleObj ) {\r\n\t\t\t// ( event )  dispatched jQuery.Event\r\n\t\t\thandleObj = types.handleObj;\r\n\t\t\tjQuery( types.delegateTarget ).off(\r\n\t\t\t\thandleObj.namespace ? handleObj.origType + \".\" + handleObj.namespace : handleObj.origType,\r\n\t\t\t\thandleObj.selector,\r\n\t\t\t\thandleObj.handler\r\n\t\t\t);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif ( typeof types === \"object\" ) {\r\n\t\t\t// ( types-object [, selector] )\r\n\t\t\tfor ( type in types ) {\r\n\t\t\t\tthis.off( type, selector, types[ type ] );\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif ( selector === false || typeof selector === \"function\" ) {\r\n\t\t\t// ( types [, fn] )\r\n\t\t\tfn = selector;\r\n\t\t\tselector = undefined;\r\n\t\t}\r\n\t\tif ( fn === false ) {\r\n\t\t\tfn = returnFalse;\r\n\t\t}\r\n\t\treturn this.each(function() {\r\n\t\t\tjQuery.event.remove( this, types, fn, selector );\r\n\t\t});\r\n\t},\r\n\r\n\ttrigger: function( type, data ) {\r\n\t\treturn this.each(function() {\r\n\t\t\tjQuery.event.trigger( type, data, this );\r\n\t\t});\r\n\t},\r\n\ttriggerHandler: function( type, data ) {\r\n\t\tvar elem = this[0];\r\n\t\tif ( elem ) {\r\n\t\t\treturn jQuery.event.trigger( type, data, elem, true );\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nvar\r\n\trxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/gi,\r\n\trtagName = /<([\\w:]+)/,\r\n\trhtml = /<|&#?\\w+;/,\r\n\trnoInnerhtml = /<(?:script|style|link)/i,\r\n\t// checked=\"checked\" or checked\r\n\trchecked = /checked\\s*(?:[^=]|=\\s*.checked.)/i,\r\n\trscriptType = /^$|\\/(?:java|ecma)script/i,\r\n\trscriptTypeMasked = /^true\\/(.*)/,\r\n\trcleanScript = /^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g,\r\n\r\n\t// We have to close these tags to support XHTML (#13200)\r\n\twrapMap = {\r\n\r\n\t\t// Support: IE9\r\n\t\toption: [ 1, \"<select multiple='multiple'>\", \"</select>\" ],\r\n\r\n\t\tthead: [ 1, \"<table>\", \"</table>\" ],\r\n\t\tcol: [ 2, \"<table><colgroup>\", \"</colgroup></table>\" ],\r\n\t\ttr: [ 2, \"<table><tbody>\", \"</tbody></table>\" ],\r\n\t\ttd: [ 3, \"<table><tbody><tr>\", \"</tr></tbody></table>\" ],\r\n\r\n\t\t_default: [ 0, \"\", \"\" ]\r\n\t};\r\n\r\n// Support: IE9\r\nwrapMap.optgroup = wrapMap.option;\r\n\r\nwrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;\r\nwrapMap.th = wrapMap.td;\r\n\r\n// Support: 1.x compatibility\r\n// Manipulating tables requires a tbody\r\nfunction manipulationTarget( elem, content ) {\r\n\treturn jQuery.nodeName( elem, \"table\" ) &&\r\n\t\tjQuery.nodeName( content.nodeType !== 11 ? content : content.firstChild, \"tr\" ) ?\r\n\r\n\t\telem.getElementsByTagName(\"tbody\")[0] ||\r\n\t\t\telem.appendChild( elem.ownerDocument.createElement(\"tbody\") ) :\r\n\t\telem;\r\n}\r\n\r\n// Replace/restore the type attribute of script elements for safe DOM manipulation\r\nfunction disableScript( elem ) {\r\n\telem.type = (elem.getAttribute(\"type\") !== null) + \"/\" + elem.type;\r\n\treturn elem;\r\n}\r\nfunction restoreScript( elem ) {\r\n\tvar match = rscriptTypeMasked.exec( elem.type );\r\n\r\n\tif ( match ) {\r\n\t\telem.type = match[ 1 ];\r\n\t} else {\r\n\t\telem.removeAttribute(\"type\");\r\n\t}\r\n\r\n\treturn elem;\r\n}\r\n\r\n// Mark scripts as having already been evaluated\r\nfunction setGlobalEval( elems, refElements ) {\r\n\tvar i = 0,\r\n\t\tl = elems.length;\r\n\r\n\tfor ( ; i < l; i++ ) {\r\n\t\tdata_priv.set(\r\n\t\t\telems[ i ], \"globalEval\", !refElements || data_priv.get( refElements[ i ], \"globalEval\" )\r\n\t\t);\r\n\t}\r\n}\r\n\r\nfunction cloneCopyEvent( src, dest ) {\r\n\tvar i, l, type, pdataOld, pdataCur, udataOld, udataCur, events;\r\n\r\n\tif ( dest.nodeType !== 1 ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// 1. Copy private data: events, handlers, etc.\r\n\tif ( data_priv.hasData( src ) ) {\r\n\t\tpdataOld = data_priv.access( src );\r\n\t\tpdataCur = data_priv.set( dest, pdataOld );\r\n\t\tevents = pdataOld.events;\r\n\r\n\t\tif ( events ) {\r\n\t\t\tdelete pdataCur.handle;\r\n\t\t\tpdataCur.events = {};\r\n\r\n\t\t\tfor ( type in events ) {\r\n\t\t\t\tfor ( i = 0, l = events[ type ].length; i < l; i++ ) {\r\n\t\t\t\t\tjQuery.event.add( dest, type, events[ type ][ i ] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 2. Copy user data\r\n\tif ( data_user.hasData( src ) ) {\r\n\t\tudataOld = data_user.access( src );\r\n\t\tudataCur = jQuery.extend( {}, udataOld );\r\n\r\n\t\tdata_user.set( dest, udataCur );\r\n\t}\r\n}\r\n\r\nfunction getAll( context, tag ) {\r\n\tvar ret = context.getElementsByTagName ? context.getElementsByTagName( tag || \"*\" ) :\r\n\t\t\tcontext.querySelectorAll ? context.querySelectorAll( tag || \"*\" ) :\r\n\t\t\t[];\r\n\r\n\treturn tag === undefined || tag && jQuery.nodeName( context, tag ) ?\r\n\t\tjQuery.merge( [ context ], ret ) :\r\n\t\tret;\r\n}\r\n\r\n// Fix IE bugs, see support tests\r\nfunction fixInput( src, dest ) {\r\n\tvar nodeName = dest.nodeName.toLowerCase();\r\n\r\n\t// Fails to persist the checked state of a cloned checkbox or radio button.\r\n\tif ( nodeName === \"input\" && rcheckableType.test( src.type ) ) {\r\n\t\tdest.checked = src.checked;\r\n\r\n\t// Fails to return the selected option to the default selected state when cloning options\r\n\t} else if ( nodeName === \"input\" || nodeName === \"textarea\" ) {\r\n\t\tdest.defaultValue = src.defaultValue;\r\n\t}\r\n}\r\n\r\njQuery.extend({\r\n\tclone: function( elem, dataAndEvents, deepDataAndEvents ) {\r\n\t\tvar i, l, srcElements, destElements,\r\n\t\t\tclone = elem.cloneNode( true ),\r\n\t\t\tinPage = jQuery.contains( elem.ownerDocument, elem );\r\n\r\n\t\t// Fix IE cloning issues\r\n\t\tif ( !support.noCloneChecked && ( elem.nodeType === 1 || elem.nodeType === 11 ) &&\r\n\t\t\t\t!jQuery.isXMLDoc( elem ) ) {\r\n\r\n\t\t\t// We eschew Sizzle here for performance reasons: http://jsperf.com/getall-vs-sizzle/2\r\n\t\t\tdestElements = getAll( clone );\r\n\t\t\tsrcElements = getAll( elem );\r\n\r\n\t\t\tfor ( i = 0, l = srcElements.length; i < l; i++ ) {\r\n\t\t\t\tfixInput( srcElements[ i ], destElements[ i ] );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Copy the events from the original to the clone\r\n\t\tif ( dataAndEvents ) {\r\n\t\t\tif ( deepDataAndEvents ) {\r\n\t\t\t\tsrcElements = srcElements || getAll( elem );\r\n\t\t\t\tdestElements = destElements || getAll( clone );\r\n\r\n\t\t\t\tfor ( i = 0, l = srcElements.length; i < l; i++ ) {\r\n\t\t\t\t\tcloneCopyEvent( srcElements[ i ], destElements[ i ] );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcloneCopyEvent( elem, clone );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Preserve script evaluation history\r\n\t\tdestElements = getAll( clone, \"script\" );\r\n\t\tif ( destElements.length > 0 ) {\r\n\t\t\tsetGlobalEval( destElements, !inPage && getAll( elem, \"script\" ) );\r\n\t\t}\r\n\r\n\t\t// Return the cloned set\r\n\t\treturn clone;\r\n\t},\r\n\r\n\tbuildFragment: function( elems, context, scripts, selection ) {\r\n\t\tvar elem, tmp, tag, wrap, contains, j,\r\n\t\t\tfragment = context.createDocumentFragment(),\r\n\t\t\tnodes = [],\r\n\t\t\ti = 0,\r\n\t\t\tl = elems.length;\r\n\r\n\t\tfor ( ; i < l; i++ ) {\r\n\t\t\telem = elems[ i ];\r\n\r\n\t\t\tif ( elem || elem === 0 ) {\r\n\r\n\t\t\t\t// Add nodes directly\r\n\t\t\t\tif ( jQuery.type( elem ) === \"object\" ) {\r\n\t\t\t\t\t// Support: QtWebKit, PhantomJS\r\n\t\t\t\t\t// push.apply(_, arraylike) throws on ancient WebKit\r\n\t\t\t\t\tjQuery.merge( nodes, elem.nodeType ? [ elem ] : elem );\r\n\r\n\t\t\t\t// Convert non-html into a text node\r\n\t\t\t\t} else if ( !rhtml.test( elem ) ) {\r\n\t\t\t\t\tnodes.push( context.createTextNode( elem ) );\r\n\r\n\t\t\t\t// Convert html into DOM nodes\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttmp = tmp || fragment.appendChild( context.createElement(\"div\") );\r\n\r\n\t\t\t\t\t// Deserialize a standard representation\r\n\t\t\t\t\ttag = ( rtagName.exec( elem ) || [ \"\", \"\" ] )[ 1 ].toLowerCase();\r\n\t\t\t\t\twrap = wrapMap[ tag ] || wrapMap._default;\r\n\t\t\t\t\ttmp.innerHTML = wrap[ 1 ] + elem.replace( rxhtmlTag, \"<$1></$2>\" ) + wrap[ 2 ];\r\n\r\n\t\t\t\t\t// Descend through wrappers to the right content\r\n\t\t\t\t\tj = wrap[ 0 ];\r\n\t\t\t\t\twhile ( j-- ) {\r\n\t\t\t\t\t\ttmp = tmp.lastChild;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Support: QtWebKit, PhantomJS\r\n\t\t\t\t\t// push.apply(_, arraylike) throws on ancient WebKit\r\n\t\t\t\t\tjQuery.merge( nodes, tmp.childNodes );\r\n\r\n\t\t\t\t\t// Remember the top-level container\r\n\t\t\t\t\ttmp = fragment.firstChild;\r\n\r\n\t\t\t\t\t// Ensure the created nodes are orphaned (#12392)\r\n\t\t\t\t\ttmp.textContent = \"\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Remove wrapper from fragment\r\n\t\tfragment.textContent = \"\";\r\n\r\n\t\ti = 0;\r\n\t\twhile ( (elem = nodes[ i++ ]) ) {\r\n\r\n\t\t\t// #4087 - If origin and destination elements are the same, and this is\r\n\t\t\t// that element, do not do anything\r\n\t\t\tif ( selection && jQuery.inArray( elem, selection ) !== -1 ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tcontains = jQuery.contains( elem.ownerDocument, elem );\r\n\r\n\t\t\t// Append to fragment\r\n\t\t\ttmp = getAll( fragment.appendChild( elem ), \"script\" );\r\n\r\n\t\t\t// Preserve script evaluation history\r\n\t\t\tif ( contains ) {\r\n\t\t\t\tsetGlobalEval( tmp );\r\n\t\t\t}\r\n\r\n\t\t\t// Capture executables\r\n\t\t\tif ( scripts ) {\r\n\t\t\t\tj = 0;\r\n\t\t\t\twhile ( (elem = tmp[ j++ ]) ) {\r\n\t\t\t\t\tif ( rscriptType.test( elem.type || \"\" ) ) {\r\n\t\t\t\t\t\tscripts.push( elem );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn fragment;\r\n\t},\r\n\r\n\tcleanData: function( elems ) {\r\n\t\tvar data, elem, type, key,\r\n\t\t\tspecial = jQuery.event.special,\r\n\t\t\ti = 0;\r\n\r\n\t\tfor ( ; (elem = elems[ i ]) !== undefined; i++ ) {\r\n\t\t\tif ( jQuery.acceptData( elem ) ) {\r\n\t\t\t\tkey = elem[ data_priv.expando ];\r\n\r\n\t\t\t\tif ( key && (data = data_priv.cache[ key ]) ) {\r\n\t\t\t\t\tif ( data.events ) {\r\n\t\t\t\t\t\tfor ( type in data.events ) {\r\n\t\t\t\t\t\t\tif ( special[ type ] ) {\r\n\t\t\t\t\t\t\t\tjQuery.event.remove( elem, type );\r\n\r\n\t\t\t\t\t\t\t// This is a shortcut to avoid jQuery.event.remove's overhead\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tjQuery.removeEvent( elem, type, data.handle );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( data_priv.cache[ key ] ) {\r\n\t\t\t\t\t\t// Discard any remaining `private` data\r\n\t\t\t\t\t\tdelete data_priv.cache[ key ];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Discard any remaining `user` data\r\n\t\t\tdelete data_user.cache[ elem[ data_user.expando ] ];\r\n\t\t}\r\n\t}\r\n});\r\n\r\njQuery.fn.extend({\r\n\ttext: function( value ) {\r\n\t\treturn access( this, function( value ) {\r\n\t\t\treturn value === undefined ?\r\n\t\t\t\tjQuery.text( this ) :\r\n\t\t\t\tthis.empty().each(function() {\r\n\t\t\t\t\tif ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\r\n\t\t\t\t\t\tthis.textContent = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}, null, value, arguments.length );\r\n\t},\r\n\r\n\tappend: function() {\r\n\t\treturn this.domManip( arguments, function( elem ) {\r\n\t\t\tif ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\r\n\t\t\t\tvar target = manipulationTarget( this, elem );\r\n\t\t\t\ttarget.appendChild( elem );\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tprepend: function() {\r\n\t\treturn this.domManip( arguments, function( elem ) {\r\n\t\t\tif ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\r\n\t\t\t\tvar target = manipulationTarget( this, elem );\r\n\t\t\t\ttarget.insertBefore( elem, target.firstChild );\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tbefore: function() {\r\n\t\treturn this.domManip( arguments, function( elem ) {\r\n\t\t\tif ( this.parentNode ) {\r\n\t\t\t\tthis.parentNode.insertBefore( elem, this );\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tafter: function() {\r\n\t\treturn this.domManip( arguments, function( elem ) {\r\n\t\t\tif ( this.parentNode ) {\r\n\t\t\t\tthis.parentNode.insertBefore( elem, this.nextSibling );\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tremove: function( selector, keepData /* Internal Use Only */ ) {\r\n\t\tvar elem,\r\n\t\t\telems = selector ? jQuery.filter( selector, this ) : this,\r\n\t\t\ti = 0;\r\n\r\n\t\tfor ( ; (elem = elems[i]) != null; i++ ) {\r\n\t\t\tif ( !keepData && elem.nodeType === 1 ) {\r\n\t\t\t\tjQuery.cleanData( getAll( elem ) );\r\n\t\t\t}\r\n\r\n\t\t\tif ( elem.parentNode ) {\r\n\t\t\t\tif ( keepData && jQuery.contains( elem.ownerDocument, elem ) ) {\r\n\t\t\t\t\tsetGlobalEval( getAll( elem, \"script\" ) );\r\n\t\t\t\t}\r\n\t\t\t\telem.parentNode.removeChild( elem );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tempty: function() {\r\n\t\tvar elem,\r\n\t\t\ti = 0;\r\n\r\n\t\tfor ( ; (elem = this[i]) != null; i++ ) {\r\n\t\t\tif ( elem.nodeType === 1 ) {\r\n\r\n\t\t\t\t// Prevent memory leaks\r\n\t\t\t\tjQuery.cleanData( getAll( elem, false ) );\r\n\r\n\t\t\t\t// Remove any remaining nodes\r\n\t\t\t\telem.textContent = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclone: function( dataAndEvents, deepDataAndEvents ) {\r\n\t\tdataAndEvents = dataAndEvents == null ? false : dataAndEvents;\r\n\t\tdeepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;\r\n\r\n\t\treturn this.map(function() {\r\n\t\t\treturn jQuery.clone( this, dataAndEvents, deepDataAndEvents );\r\n\t\t});\r\n\t},\r\n\r\n\thtml: function( value ) {\r\n\t\treturn access( this, function( value ) {\r\n\t\t\tvar elem = this[ 0 ] || {},\r\n\t\t\t\ti = 0,\r\n\t\t\t\tl = this.length;\r\n\r\n\t\t\tif ( value === undefined && elem.nodeType === 1 ) {\r\n\t\t\t\treturn elem.innerHTML;\r\n\t\t\t}\r\n\r\n\t\t\t// See if we can take a shortcut and just use innerHTML\r\n\t\t\tif ( typeof value === \"string\" && !rnoInnerhtml.test( value ) &&\r\n\t\t\t\t!wrapMap[ ( rtagName.exec( value ) || [ \"\", \"\" ] )[ 1 ].toLowerCase() ] ) {\r\n\r\n\t\t\t\tvalue = value.replace( rxhtmlTag, \"<$1></$2>\" );\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\t\t\telem = this[ i ] || {};\r\n\r\n\t\t\t\t\t\t// Remove element nodes and prevent memory leaks\r\n\t\t\t\t\t\tif ( elem.nodeType === 1 ) {\r\n\t\t\t\t\t\t\tjQuery.cleanData( getAll( elem, false ) );\r\n\t\t\t\t\t\t\telem.innerHTML = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telem = 0;\r\n\r\n\t\t\t\t// If using innerHTML throws an exception, use the fallback method\r\n\t\t\t\t} catch( e ) {}\r\n\t\t\t}\r\n\r\n\t\t\tif ( elem ) {\r\n\t\t\t\tthis.empty().append( value );\r\n\t\t\t}\r\n\t\t}, null, value, arguments.length );\r\n\t},\r\n\r\n\treplaceWith: function() {\r\n\t\tvar arg = arguments[ 0 ];\r\n\r\n\t\t// Make the changes, replacing each context element with the new content\r\n\t\tthis.domManip( arguments, function( elem ) {\r\n\t\t\targ = this.parentNode;\r\n\r\n\t\t\tjQuery.cleanData( getAll( this ) );\r\n\r\n\t\t\tif ( arg ) {\r\n\t\t\t\targ.replaceChild( elem, this );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Force removal if there was no new content (e.g., from empty arguments)\r\n\t\treturn arg && (arg.length || arg.nodeType) ? this : this.remove();\r\n\t},\r\n\r\n\tdetach: function( selector ) {\r\n\t\treturn this.remove( selector, true );\r\n\t},\r\n\r\n\tdomManip: function( args, callback ) {\r\n\r\n\t\t// Flatten any nested arrays\r\n\t\targs = concat.apply( [], args );\r\n\r\n\t\tvar fragment, first, scripts, hasScripts, node, doc,\r\n\t\t\ti = 0,\r\n\t\t\tl = this.length,\r\n\t\t\tset = this,\r\n\t\t\tiNoClone = l - 1,\r\n\t\t\tvalue = args[ 0 ],\r\n\t\t\tisFunction = jQuery.isFunction( value );\r\n\r\n\t\t// We can't cloneNode fragments that contain checked, in WebKit\r\n\t\tif ( isFunction ||\r\n\t\t\t\t( l > 1 && typeof value === \"string\" &&\r\n\t\t\t\t\t!support.checkClone && rchecked.test( value ) ) ) {\r\n\t\t\treturn this.each(function( index ) {\r\n\t\t\t\tvar self = set.eq( index );\r\n\t\t\t\tif ( isFunction ) {\r\n\t\t\t\t\targs[ 0 ] = value.call( this, index, self.html() );\r\n\t\t\t\t}\r\n\t\t\t\tself.domManip( args, callback );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ( l ) {\r\n\t\t\tfragment = jQuery.buildFragment( args, this[ 0 ].ownerDocument, false, this );\r\n\t\t\tfirst = fragment.firstChild;\r\n\r\n\t\t\tif ( fragment.childNodes.length === 1 ) {\r\n\t\t\t\tfragment = first;\r\n\t\t\t}\r\n\r\n\t\t\tif ( first ) {\r\n\t\t\t\tscripts = jQuery.map( getAll( fragment, \"script\" ), disableScript );\r\n\t\t\t\thasScripts = scripts.length;\r\n\r\n\t\t\t\t// Use the original fragment for the last item instead of the first because it can end up\r\n\t\t\t\t// being emptied incorrectly in certain situations (#8070).\r\n\t\t\t\tfor ( ; i < l; i++ ) {\r\n\t\t\t\t\tnode = fragment;\r\n\r\n\t\t\t\t\tif ( i !== iNoClone ) {\r\n\t\t\t\t\t\tnode = jQuery.clone( node, true, true );\r\n\r\n\t\t\t\t\t\t// Keep references to cloned scripts for later restoration\r\n\t\t\t\t\t\tif ( hasScripts ) {\r\n\t\t\t\t\t\t\t// Support: QtWebKit\r\n\t\t\t\t\t\t\t// jQuery.merge because push.apply(_, arraylike) throws\r\n\t\t\t\t\t\t\tjQuery.merge( scripts, getAll( node, \"script\" ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcallback.call( this[ i ], node, i );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( hasScripts ) {\r\n\t\t\t\t\tdoc = scripts[ scripts.length - 1 ].ownerDocument;\r\n\r\n\t\t\t\t\t// Reenable scripts\r\n\t\t\t\t\tjQuery.map( scripts, restoreScript );\r\n\r\n\t\t\t\t\t// Evaluate executable scripts on first document insertion\r\n\t\t\t\t\tfor ( i = 0; i < hasScripts; i++ ) {\r\n\t\t\t\t\t\tnode = scripts[ i ];\r\n\t\t\t\t\t\tif ( rscriptType.test( node.type || \"\" ) &&\r\n\t\t\t\t\t\t\t!data_priv.access( node, \"globalEval\" ) && jQuery.contains( doc, node ) ) {\r\n\r\n\t\t\t\t\t\t\tif ( node.src ) {\r\n\t\t\t\t\t\t\t\t// Optional AJAX dependency, but won't run scripts if not present\r\n\t\t\t\t\t\t\t\tif ( jQuery._evalUrl ) {\r\n\t\t\t\t\t\t\t\t\tjQuery._evalUrl( node.src );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tjQuery.globalEval( node.textContent.replace( rcleanScript, \"\" ) );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\njQuery.each({\r\n\tappendTo: \"append\",\r\n\tprependTo: \"prepend\",\r\n\tinsertBefore: \"before\",\r\n\tinsertAfter: \"after\",\r\n\treplaceAll: \"replaceWith\"\r\n}, function( name, original ) {\r\n\tjQuery.fn[ name ] = function( selector ) {\r\n\t\tvar elems,\r\n\t\t\tret = [],\r\n\t\t\tinsert = jQuery( selector ),\r\n\t\t\tlast = insert.length - 1,\r\n\t\t\ti = 0;\r\n\r\n\t\tfor ( ; i <= last; i++ ) {\r\n\t\t\telems = i === last ? this : this.clone( true );\r\n\t\t\tjQuery( insert[ i ] )[ original ]( elems );\r\n\r\n\t\t\t// Support: QtWebKit\r\n\t\t\t// .get() because push.apply(_, arraylike) throws\r\n\t\t\tpush.apply( ret, elems.get() );\r\n\t\t}\r\n\r\n\t\treturn this.pushStack( ret );\r\n\t};\r\n});\r\n\r\n\r\nvar iframe,\r\n\telemdisplay = {};\r\n\r\n/**\r\n * Retrieve the actual display of a element\r\n * @param {String} name nodeName of the element\r\n * @param {Object} doc Document object\r\n */\r\n// Called only from within defaultDisplay\r\nfunction actualDisplay( name, doc ) {\r\n\tvar style,\r\n\t\telem = jQuery( doc.createElement( name ) ).appendTo( doc.body ),\r\n\r\n\t\t// getDefaultComputedStyle might be reliably used only on attached element\r\n\t\tdisplay = window.getDefaultComputedStyle && ( style = window.getDefaultComputedStyle( elem[ 0 ] ) ) ?\r\n\r\n\t\t\t// Use of this method is a temporary fix (more like optimization) until something better comes along,\r\n\t\t\t// since it was removed from specification and supported only in FF\r\n\t\t\tstyle.display : jQuery.css( elem[ 0 ], \"display\" );\r\n\r\n\t// We don't have any data stored on the element,\r\n\t// so use \"detach\" method as fast way to get rid of the element\r\n\telem.detach();\r\n\r\n\treturn display;\r\n}\r\n\r\n/**\r\n * Try to determine the default display value of an element\r\n * @param {String} nodeName\r\n */\r\nfunction defaultDisplay( nodeName ) {\r\n\tvar doc = document,\r\n\t\tdisplay = elemdisplay[ nodeName ];\r\n\r\n\tif ( !display ) {\r\n\t\tdisplay = actualDisplay( nodeName, doc );\r\n\r\n\t\t// If the simple way fails, read from inside an iframe\r\n\t\tif ( display === \"none\" || !display ) {\r\n\r\n\t\t\t// Use the already-created iframe if possible\r\n\t\t\tiframe = (iframe || jQuery( \"<iframe frameborder='0' width='0' height='0'/>\" )).appendTo( doc.documentElement );\r\n\r\n\t\t\t// Always write a new HTML skeleton so Webkit and Firefox don't choke on reuse\r\n\t\t\tdoc = iframe[ 0 ].contentDocument;\r\n\r\n\t\t\t// Support: IE\r\n\t\t\tdoc.write();\r\n\t\t\tdoc.close();\r\n\r\n\t\t\tdisplay = actualDisplay( nodeName, doc );\r\n\t\t\tiframe.detach();\r\n\t\t}\r\n\r\n\t\t// Store the correct default display\r\n\t\telemdisplay[ nodeName ] = display;\r\n\t}\r\n\r\n\treturn display;\r\n}\r\nvar rmargin = (/^margin/);\r\n\r\nvar rnumnonpx = new RegExp( \"^(\" + pnum + \")(?!px)[a-z%]+$\", \"i\" );\r\n\r\nvar getStyles = function( elem ) {\r\n\t\t// Support: IE<=11+, Firefox<=30+ (#15098, #14150)\r\n\t\t// IE throws on elements created in popups\r\n\t\t// FF meanwhile throws on frame elements through \"defaultView.getComputedStyle\"\r\n\t\tif ( elem.ownerDocument.defaultView.opener ) {\r\n\t\t\treturn elem.ownerDocument.defaultView.getComputedStyle( elem, null );\r\n\t\t}\r\n\r\n\t\treturn window.getComputedStyle( elem, null );\r\n\t};\r\n\r\n\r\n\r\nfunction curCSS( elem, name, computed ) {\r\n\tvar width, minWidth, maxWidth, ret,\r\n\t\tstyle = elem.style;\r\n\r\n\tcomputed = computed || getStyles( elem );\r\n\r\n\t// Support: IE9\r\n\t// getPropertyValue is only needed for .css('filter') (#12537)\r\n\tif ( computed ) {\r\n\t\tret = computed.getPropertyValue( name ) || computed[ name ];\r\n\t}\r\n\r\n\tif ( computed ) {\r\n\r\n\t\tif ( ret === \"\" && !jQuery.contains( elem.ownerDocument, elem ) ) {\r\n\t\t\tret = jQuery.style( elem, name );\r\n\t\t}\r\n\r\n\t\t// Support: iOS < 6\r\n\t\t// A tribute to the \"awesome hack by Dean Edwards\"\r\n\t\t// iOS < 6 (at least) returns percentage for a larger set of values, but width seems to be reliably pixels\r\n\t\t// this is against the CSSOM draft spec: http://dev.w3.org/csswg/cssom/#resolved-values\r\n\t\tif ( rnumnonpx.test( ret ) && rmargin.test( name ) ) {\r\n\r\n\t\t\t// Remember the original values\r\n\t\t\twidth = style.width;\r\n\t\t\tminWidth = style.minWidth;\r\n\t\t\tmaxWidth = style.maxWidth;\r\n\r\n\t\t\t// Put in the new values to get a computed value out\r\n\t\t\tstyle.minWidth = style.maxWidth = style.width = ret;\r\n\t\t\tret = computed.width;\r\n\r\n\t\t\t// Revert the changed values\r\n\t\t\tstyle.width = width;\r\n\t\t\tstyle.minWidth = minWidth;\r\n\t\t\tstyle.maxWidth = maxWidth;\r\n\t\t}\r\n\t}\r\n\r\n\treturn ret !== undefined ?\r\n\t\t// Support: IE\r\n\t\t// IE returns zIndex value as an integer.\r\n\t\tret + \"\" :\r\n\t\tret;\r\n}\r\n\r\n\r\nfunction addGetHookIf( conditionFn, hookFn ) {\r\n\t// Define the hook, we'll check on the first run if it's really needed.\r\n\treturn {\r\n\t\tget: function() {\r\n\t\t\tif ( conditionFn() ) {\r\n\t\t\t\t// Hook not needed (or it's not possible to use it due\r\n\t\t\t\t// to missing dependency), remove it.\r\n\t\t\t\tdelete this.get;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Hook needed; redefine it so that the support test is not executed again.\r\n\t\t\treturn (this.get = hookFn).apply( this, arguments );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n\r\n(function() {\r\n\tvar pixelPositionVal, boxSizingReliableVal,\r\n\t\tdocElem = document.documentElement,\r\n\t\tcontainer = document.createElement( \"div\" ),\r\n\t\tdiv = document.createElement( \"div\" );\r\n\r\n\tif ( !div.style ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Support: IE9-11+\r\n\t// Style of cloned element affects source element cloned (#8908)\r\n\tdiv.style.backgroundClip = \"content-box\";\r\n\tdiv.cloneNode( true ).style.backgroundClip = \"\";\r\n\tsupport.clearCloneStyle = div.style.backgroundClip === \"content-box\";\r\n\r\n\tcontainer.style.cssText = \"border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;\" +\r\n\t\t\"position:absolute\";\r\n\tcontainer.appendChild( div );\r\n\r\n\t// Executing both pixelPosition & boxSizingReliable tests require only one layout\r\n\t// so they're executed at the same time to save the second computation.\r\n\tfunction computePixelPositionAndBoxSizingReliable() {\r\n\t\tdiv.style.cssText =\r\n\t\t\t// Support: Firefox<29, Android 2.3\r\n\t\t\t// Vendor-prefix box-sizing\r\n\t\t\t\"-webkit-box-sizing:border-box;-moz-box-sizing:border-box;\" +\r\n\t\t\t\"box-sizing:border-box;display:block;margin-top:1%;top:1%;\" +\r\n\t\t\t\"border:1px;padding:1px;width:4px;position:absolute\";\r\n\t\tdiv.innerHTML = \"\";\r\n\t\tdocElem.appendChild( container );\r\n\r\n\t\tvar divStyle = window.getComputedStyle( div, null );\r\n\t\tpixelPositionVal = divStyle.top !== \"1%\";\r\n\t\tboxSizingReliableVal = divStyle.width === \"4px\";\r\n\r\n\t\tdocElem.removeChild( container );\r\n\t}\r\n\r\n\t// Support: node.js jsdom\r\n\t// Don't assume that getComputedStyle is a property of the global object\r\n\tif ( window.getComputedStyle ) {\r\n\t\tjQuery.extend( support, {\r\n\t\t\tpixelPosition: function() {\r\n\r\n\t\t\t\t// This test is executed only once but we still do memoizing\r\n\t\t\t\t// since we can use the boxSizingReliable pre-computing.\r\n\t\t\t\t// No need to check if the test was already performed, though.\r\n\t\t\t\tcomputePixelPositionAndBoxSizingReliable();\r\n\t\t\t\treturn pixelPositionVal;\r\n\t\t\t},\r\n\t\t\tboxSizingReliable: function() {\r\n\t\t\t\tif ( boxSizingReliableVal == null ) {\r\n\t\t\t\t\tcomputePixelPositionAndBoxSizingReliable();\r\n\t\t\t\t}\r\n\t\t\t\treturn boxSizingReliableVal;\r\n\t\t\t},\r\n\t\t\treliableMarginRight: function() {\r\n\r\n\t\t\t\t// Support: Android 2.3\r\n\t\t\t\t// Check if div with explicit width and no margin-right incorrectly\r\n\t\t\t\t// gets computed margin-right based on width of container. (#3333)\r\n\t\t\t\t// WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right\r\n\t\t\t\t// This support function is only executed once so no memoizing is needed.\r\n\t\t\t\tvar ret,\r\n\t\t\t\t\tmarginDiv = div.appendChild( document.createElement( \"div\" ) );\r\n\r\n\t\t\t\t// Reset CSS: box-sizing; display; margin; border; padding\r\n\t\t\t\tmarginDiv.style.cssText = div.style.cssText =\r\n\t\t\t\t\t// Support: Firefox<29, Android 2.3\r\n\t\t\t\t\t// Vendor-prefix box-sizing\r\n\t\t\t\t\t\"-webkit-box-sizing:content-box;-moz-box-sizing:content-box;\" +\r\n\t\t\t\t\t\"box-sizing:content-box;display:block;margin:0;border:0;padding:0\";\r\n\t\t\t\tmarginDiv.style.marginRight = marginDiv.style.width = \"0\";\r\n\t\t\t\tdiv.style.width = \"1px\";\r\n\t\t\t\tdocElem.appendChild( container );\r\n\r\n\t\t\t\tret = !parseFloat( window.getComputedStyle( marginDiv, null ).marginRight );\r\n\r\n\t\t\t\tdocElem.removeChild( container );\r\n\t\t\t\tdiv.removeChild( marginDiv );\r\n\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n})();\r\n\r\n\r\n// A method for quickly swapping in/out CSS properties to get correct calculations.\r\njQuery.swap = function( elem, options, callback, args ) {\r\n\tvar ret, name,\r\n\t\told = {};\r\n\r\n\t// Remember the old values, and insert the new ones\r\n\tfor ( name in options ) {\r\n\t\told[ name ] = elem.style[ name ];\r\n\t\telem.style[ name ] = options[ name ];\r\n\t}\r\n\r\n\tret = callback.apply( elem, args || [] );\r\n\r\n\t// Revert the old values\r\n\tfor ( name in options ) {\r\n\t\telem.style[ name ] = old[ name ];\r\n\t}\r\n\r\n\treturn ret;\r\n};\r\n\r\n\r\nvar\r\n\t// Swappable if display is none or starts with table except \"table\", \"table-cell\", or \"table-caption\"\r\n\t// See here for display values: https://developer.mozilla.org/en-US/docs/CSS/display\r\n\trdisplayswap = /^(none|table(?!-c[ea]).+)/,\r\n\trnumsplit = new RegExp( \"^(\" + pnum + \")(.*)$\", \"i\" ),\r\n\trrelNum = new RegExp( \"^([+-])=(\" + pnum + \")\", \"i\" ),\r\n\r\n\tcssShow = { position: \"absolute\", visibility: \"hidden\", display: \"block\" },\r\n\tcssNormalTransform = {\r\n\t\tletterSpacing: \"0\",\r\n\t\tfontWeight: \"400\"\r\n\t},\r\n\r\n\tcssPrefixes = [ \"Webkit\", \"O\", \"Moz\", \"ms\" ];\r\n\r\n// Return a css property mapped to a potentially vendor prefixed property\r\nfunction vendorPropName( style, name ) {\r\n\r\n\t// Shortcut for names that are not vendor prefixed\r\n\tif ( name in style ) {\r\n\t\treturn name;\r\n\t}\r\n\r\n\t// Check for vendor prefixed names\r\n\tvar capName = name[0].toUpperCase() + name.slice(1),\r\n\t\torigName = name,\r\n\t\ti = cssPrefixes.length;\r\n\r\n\twhile ( i-- ) {\r\n\t\tname = cssPrefixes[ i ] + capName;\r\n\t\tif ( name in style ) {\r\n\t\t\treturn name;\r\n\t\t}\r\n\t}\r\n\r\n\treturn origName;\r\n}\r\n\r\nfunction setPositiveNumber( elem, value, subtract ) {\r\n\tvar matches = rnumsplit.exec( value );\r\n\treturn matches ?\r\n\t\t// Guard against undefined \"subtract\", e.g., when used as in cssHooks\r\n\t\tMath.max( 0, matches[ 1 ] - ( subtract || 0 ) ) + ( matches[ 2 ] || \"px\" ) :\r\n\t\tvalue;\r\n}\r\n\r\nfunction augmentWidthOrHeight( elem, name, extra, isBorderBox, styles ) {\r\n\tvar i = extra === ( isBorderBox ? \"border\" : \"content\" ) ?\r\n\t\t// If we already have the right measurement, avoid augmentation\r\n\t\t4 :\r\n\t\t// Otherwise initialize for horizontal or vertical properties\r\n\t\tname === \"width\" ? 1 : 0,\r\n\r\n\t\tval = 0;\r\n\r\n\tfor ( ; i < 4; i += 2 ) {\r\n\t\t// Both box models exclude margin, so add it if we want it\r\n\t\tif ( extra === \"margin\" ) {\r\n\t\t\tval += jQuery.css( elem, extra + cssExpand[ i ], true, styles );\r\n\t\t}\r\n\r\n\t\tif ( isBorderBox ) {\r\n\t\t\t// border-box includes padding, so remove it if we want content\r\n\t\t\tif ( extra === \"content\" ) {\r\n\t\t\t\tval -= jQuery.css( elem, \"padding\" + cssExpand[ i ], true, styles );\r\n\t\t\t}\r\n\r\n\t\t\t// At this point, extra isn't border nor margin, so remove border\r\n\t\t\tif ( extra !== \"margin\" ) {\r\n\t\t\t\tval -= jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// At this point, extra isn't content, so add padding\r\n\t\t\tval += jQuery.css( elem, \"padding\" + cssExpand[ i ], true, styles );\r\n\r\n\t\t\t// At this point, extra isn't content nor padding, so add border\r\n\t\t\tif ( extra !== \"padding\" ) {\r\n\t\t\t\tval += jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn val;\r\n}\r\n\r\nfunction getWidthOrHeight( elem, name, extra ) {\r\n\r\n\t// Start with offset property, which is equivalent to the border-box value\r\n\tvar valueIsBorderBox = true,\r\n\t\tval = name === \"width\" ? elem.offsetWidth : elem.offsetHeight,\r\n\t\tstyles = getStyles( elem ),\r\n\t\tisBorderBox = jQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\";\r\n\r\n\t// Some non-html elements return undefined for offsetWidth, so check for null/undefined\r\n\t// svg - https://bugzilla.mozilla.org/show_bug.cgi?id=649285\r\n\t// MathML - https://bugzilla.mozilla.org/show_bug.cgi?id=491668\r\n\tif ( val <= 0 || val == null ) {\r\n\t\t// Fall back to computed then uncomputed css if necessary\r\n\t\tval = curCSS( elem, name, styles );\r\n\t\tif ( val < 0 || val == null ) {\r\n\t\t\tval = elem.style[ name ];\r\n\t\t}\r\n\r\n\t\t// Computed unit is not pixels. Stop here and return.\r\n\t\tif ( rnumnonpx.test(val) ) {\r\n\t\t\treturn val;\r\n\t\t}\r\n\r\n\t\t// Check for style in case a browser which returns unreliable values\r\n\t\t// for getComputedStyle silently falls back to the reliable elem.style\r\n\t\tvalueIsBorderBox = isBorderBox &&\r\n\t\t\t( support.boxSizingReliable() || val === elem.style[ name ] );\r\n\r\n\t\t// Normalize \"\", auto, and prepare for extra\r\n\t\tval = parseFloat( val ) || 0;\r\n\t}\r\n\r\n\t// Use the active box-sizing model to add/subtract irrelevant styles\r\n\treturn ( val +\r\n\t\taugmentWidthOrHeight(\r\n\t\t\telem,\r\n\t\t\tname,\r\n\t\t\textra || ( isBorderBox ? \"border\" : \"content\" ),\r\n\t\t\tvalueIsBorderBox,\r\n\t\t\tstyles\r\n\t\t)\r\n\t) + \"px\";\r\n}\r\n\r\nfunction showHide( elements, show ) {\r\n\tvar display, elem, hidden,\r\n\t\tvalues = [],\r\n\t\tindex = 0,\r\n\t\tlength = elements.length;\r\n\r\n\tfor ( ; index < length; index++ ) {\r\n\t\telem = elements[ index ];\r\n\t\tif ( !elem.style ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvalues[ index ] = data_priv.get( elem, \"olddisplay\" );\r\n\t\tdisplay = elem.style.display;\r\n\t\tif ( show ) {\r\n\t\t\t// Reset the inline display of this element to learn if it is\r\n\t\t\t// being hidden by cascaded rules or not\r\n\t\t\tif ( !values[ index ] && display === \"none\" ) {\r\n\t\t\t\telem.style.display = \"\";\r\n\t\t\t}\r\n\r\n\t\t\t// Set elements which have been overridden with display: none\r\n\t\t\t// in a stylesheet to whatever the default browser style is\r\n\t\t\t// for such an element\r\n\t\t\tif ( elem.style.display === \"\" && isHidden( elem ) ) {\r\n\t\t\t\tvalues[ index ] = data_priv.access( elem, \"olddisplay\", defaultDisplay(elem.nodeName) );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\thidden = isHidden( elem );\r\n\r\n\t\t\tif ( display !== \"none\" || !hidden ) {\r\n\t\t\t\tdata_priv.set( elem, \"olddisplay\", hidden ? display : jQuery.css( elem, \"display\" ) );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Set the display of most of the elements in a second loop\r\n\t// to avoid the constant reflow\r\n\tfor ( index = 0; index < length; index++ ) {\r\n\t\telem = elements[ index ];\r\n\t\tif ( !elem.style ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ( !show || elem.style.display === \"none\" || elem.style.display === \"\" ) {\r\n\t\t\telem.style.display = show ? values[ index ] || \"\" : \"none\";\r\n\t\t}\r\n\t}\r\n\r\n\treturn elements;\r\n}\r\n\r\njQuery.extend({\r\n\r\n\t// Add in style property hooks for overriding the default\r\n\t// behavior of getting and setting a style property\r\n\tcssHooks: {\r\n\t\topacity: {\r\n\t\t\tget: function( elem, computed ) {\r\n\t\t\t\tif ( computed ) {\r\n\r\n\t\t\t\t\t// We should always get a number back from opacity\r\n\t\t\t\t\tvar ret = curCSS( elem, \"opacity\" );\r\n\t\t\t\t\treturn ret === \"\" ? \"1\" : ret;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// Don't automatically add \"px\" to these possibly-unitless properties\r\n\tcssNumber: {\r\n\t\t\"columnCount\": true,\r\n\t\t\"fillOpacity\": true,\r\n\t\t\"flexGrow\": true,\r\n\t\t\"flexShrink\": true,\r\n\t\t\"fontWeight\": true,\r\n\t\t\"lineHeight\": true,\r\n\t\t\"opacity\": true,\r\n\t\t\"order\": true,\r\n\t\t\"orphans\": true,\r\n\t\t\"widows\": true,\r\n\t\t\"zIndex\": true,\r\n\t\t\"zoom\": true\r\n\t},\r\n\r\n\t// Add in properties whose names you wish to fix before\r\n\t// setting or getting the value\r\n\tcssProps: {\r\n\t\t\"float\": \"cssFloat\"\r\n\t},\r\n\r\n\t// Get and set the style property on a DOM Node\r\n\tstyle: function( elem, name, value, extra ) {\r\n\r\n\t\t// Don't set styles on text and comment nodes\r\n\t\tif ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Make sure that we're working with the right name\r\n\t\tvar ret, type, hooks,\r\n\t\t\torigName = jQuery.camelCase( name ),\r\n\t\t\tstyle = elem.style;\r\n\r\n\t\tname = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( style, origName ) );\r\n\r\n\t\t// Gets hook for the prefixed version, then unprefixed version\r\n\t\thooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];\r\n\r\n\t\t// Check if we're setting a value\r\n\t\tif ( value !== undefined ) {\r\n\t\t\ttype = typeof value;\r\n\r\n\t\t\t// Convert \"+=\" or \"-=\" to relative numbers (#7345)\r\n\t\t\tif ( type === \"string\" && (ret = rrelNum.exec( value )) ) {\r\n\t\t\t\tvalue = ( ret[1] + 1 ) * ret[2] + parseFloat( jQuery.css( elem, name ) );\r\n\t\t\t\t// Fixes bug #9237\r\n\t\t\t\ttype = \"number\";\r\n\t\t\t}\r\n\r\n\t\t\t// Make sure that null and NaN values aren't set (#7116)\r\n\t\t\tif ( value == null || value !== value ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If a number, add 'px' to the (except for certain CSS properties)\r\n\t\t\tif ( type === \"number\" && !jQuery.cssNumber[ origName ] ) {\r\n\t\t\t\tvalue += \"px\";\r\n\t\t\t}\r\n\r\n\t\t\t// Support: IE9-11+\r\n\t\t\t// background-* props affect original clone's values\r\n\t\t\tif ( !support.clearCloneStyle && value === \"\" && name.indexOf( \"background\" ) === 0 ) {\r\n\t\t\t\tstyle[ name ] = \"inherit\";\r\n\t\t\t}\r\n\r\n\t\t\t// If a hook was provided, use that value, otherwise just set the specified value\r\n\t\t\tif ( !hooks || !(\"set\" in hooks) || (value = hooks.set( elem, value, extra )) !== undefined ) {\r\n\t\t\t\tstyle[ name ] = value;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t// If a hook was provided get the non-computed value from there\r\n\t\t\tif ( hooks && \"get\" in hooks && (ret = hooks.get( elem, false, extra )) !== undefined ) {\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\r\n\t\t\t// Otherwise just get the value from the style object\r\n\t\t\treturn style[ name ];\r\n\t\t}\r\n\t},\r\n\r\n\tcss: function( elem, name, extra, styles ) {\r\n\t\tvar val, num, hooks,\r\n\t\t\torigName = jQuery.camelCase( name );\r\n\r\n\t\t// Make sure that we're working with the right name\r\n\t\tname = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( elem.style, origName ) );\r\n\r\n\t\t// Try prefixed name followed by the unprefixed name\r\n\t\thooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];\r\n\r\n\t\t// If a hook was provided get the computed value from there\r\n\t\tif ( hooks && \"get\" in hooks ) {\r\n\t\t\tval = hooks.get( elem, true, extra );\r\n\t\t}\r\n\r\n\t\t// Otherwise, if a way to get the computed value exists, use that\r\n\t\tif ( val === undefined ) {\r\n\t\t\tval = curCSS( elem, name, styles );\r\n\t\t}\r\n\r\n\t\t// Convert \"normal\" to computed value\r\n\t\tif ( val === \"normal\" && name in cssNormalTransform ) {\r\n\t\t\tval = cssNormalTransform[ name ];\r\n\t\t}\r\n\r\n\t\t// Make numeric if forced or a qualifier was provided and val looks numeric\r\n\t\tif ( extra === \"\" || extra ) {\r\n\t\t\tnum = parseFloat( val );\r\n\t\t\treturn extra === true || jQuery.isNumeric( num ) ? num || 0 : val;\r\n\t\t}\r\n\t\treturn val;\r\n\t}\r\n});\r\n\r\njQuery.each([ \"height\", \"width\" ], function( i, name ) {\r\n\tjQuery.cssHooks[ name ] = {\r\n\t\tget: function( elem, computed, extra ) {\r\n\t\t\tif ( computed ) {\r\n\r\n\t\t\t\t// Certain elements can have dimension info if we invisibly show them\r\n\t\t\t\t// but it must have a current display style that would benefit\r\n\t\t\t\treturn rdisplayswap.test( jQuery.css( elem, \"display\" ) ) && elem.offsetWidth === 0 ?\r\n\t\t\t\t\tjQuery.swap( elem, cssShow, function() {\r\n\t\t\t\t\t\treturn getWidthOrHeight( elem, name, extra );\r\n\t\t\t\t\t}) :\r\n\t\t\t\t\tgetWidthOrHeight( elem, name, extra );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tset: function( elem, value, extra ) {\r\n\t\t\tvar styles = extra && getStyles( elem );\r\n\t\t\treturn setPositiveNumber( elem, value, extra ?\r\n\t\t\t\taugmentWidthOrHeight(\r\n\t\t\t\t\telem,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\textra,\r\n\t\t\t\t\tjQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\",\r\n\t\t\t\t\tstyles\r\n\t\t\t\t) : 0\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n});\r\n\r\n// Support: Android 2.3\r\njQuery.cssHooks.marginRight = addGetHookIf( support.reliableMarginRight,\r\n\tfunction( elem, computed ) {\r\n\t\tif ( computed ) {\r\n\t\t\treturn jQuery.swap( elem, { \"display\": \"inline-block\" },\r\n\t\t\t\tcurCSS, [ elem, \"marginRight\" ] );\r\n\t\t}\r\n\t}\r\n);\r\n\r\n// These hooks are used by animate to expand properties\r\njQuery.each({\r\n\tmargin: \"\",\r\n\tpadding: \"\",\r\n\tborder: \"Width\"\r\n}, function( prefix, suffix ) {\r\n\tjQuery.cssHooks[ prefix + suffix ] = {\r\n\t\texpand: function( value ) {\r\n\t\t\tvar i = 0,\r\n\t\t\t\texpanded = {},\r\n\r\n\t\t\t\t// Assumes a single number if not a string\r\n\t\t\t\tparts = typeof value === \"string\" ? value.split(\" \") : [ value ];\r\n\r\n\t\t\tfor ( ; i < 4; i++ ) {\r\n\t\t\t\texpanded[ prefix + cssExpand[ i ] + suffix ] =\r\n\t\t\t\t\tparts[ i ] || parts[ i - 2 ] || parts[ 0 ];\r\n\t\t\t}\r\n\r\n\t\t\treturn expanded;\r\n\t\t}\r\n\t};\r\n\r\n\tif ( !rmargin.test( prefix ) ) {\r\n\t\tjQuery.cssHooks[ prefix + suffix ].set = setPositiveNumber;\r\n\t}\r\n});\r\n\r\njQuery.fn.extend({\r\n\tcss: function( name, value ) {\r\n\t\treturn access( this, function( elem, name, value ) {\r\n\t\t\tvar styles, len,\r\n\t\t\t\tmap = {},\r\n\t\t\t\ti = 0;\r\n\r\n\t\t\tif ( jQuery.isArray( name ) ) {\r\n\t\t\t\tstyles = getStyles( elem );\r\n\t\t\t\tlen = name.length;\r\n\r\n\t\t\t\tfor ( ; i < len; i++ ) {\r\n\t\t\t\t\tmap[ name[ i ] ] = jQuery.css( elem, name[ i ], false, styles );\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn map;\r\n\t\t\t}\r\n\r\n\t\t\treturn value !== undefined ?\r\n\t\t\t\tjQuery.style( elem, name, value ) :\r\n\t\t\t\tjQuery.css( elem, name );\r\n\t\t}, name, value, arguments.length > 1 );\r\n\t},\r\n\tshow: function() {\r\n\t\treturn showHide( this, true );\r\n\t},\r\n\thide: function() {\r\n\t\treturn showHide( this );\r\n\t},\r\n\ttoggle: function( state ) {\r\n\t\tif ( typeof state === \"boolean\" ) {\r\n\t\t\treturn state ? this.show() : this.hide();\r\n\t\t}\r\n\r\n\t\treturn this.each(function() {\r\n\t\t\tif ( isHidden( this ) ) {\r\n\t\t\t\tjQuery( this ).show();\r\n\t\t\t} else {\r\n\t\t\t\tjQuery( this ).hide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\n\r\nfunction Tween( elem, options, prop, end, easing ) {\r\n\treturn new Tween.prototype.init( elem, options, prop, end, easing );\r\n}\r\njQuery.Tween = Tween;\r\n\r\nTween.prototype = {\r\n\tconstructor: Tween,\r\n\tinit: function( elem, options, prop, end, easing, unit ) {\r\n\t\tthis.elem = elem;\r\n\t\tthis.prop = prop;\r\n\t\tthis.easing = easing || \"swing\";\r\n\t\tthis.options = options;\r\n\t\tthis.start = this.now = this.cur();\r\n\t\tthis.end = end;\r\n\t\tthis.unit = unit || ( jQuery.cssNumber[ prop ] ? \"\" : \"px\" );\r\n\t},\r\n\tcur: function() {\r\n\t\tvar hooks = Tween.propHooks[ this.prop ];\r\n\r\n\t\treturn hooks && hooks.get ?\r\n\t\t\thooks.get( this ) :\r\n\t\t\tTween.propHooks._default.get( this );\r\n\t},\r\n\trun: function( percent ) {\r\n\t\tvar eased,\r\n\t\t\thooks = Tween.propHooks[ this.prop ];\r\n\r\n\t\tif ( this.options.duration ) {\r\n\t\t\tthis.pos = eased = jQuery.easing[ this.easing ](\r\n\t\t\t\tpercent, this.options.duration * percent, 0, 1, this.options.duration\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis.pos = eased = percent;\r\n\t\t}\r\n\t\tthis.now = ( this.end - this.start ) * eased + this.start;\r\n\r\n\t\tif ( this.options.step ) {\r\n\t\t\tthis.options.step.call( this.elem, this.now, this );\r\n\t\t}\r\n\r\n\t\tif ( hooks && hooks.set ) {\r\n\t\t\thooks.set( this );\r\n\t\t} else {\r\n\t\t\tTween.propHooks._default.set( this );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\nTween.prototype.init.prototype = Tween.prototype;\r\n\r\nTween.propHooks = {\r\n\t_default: {\r\n\t\tget: function( tween ) {\r\n\t\t\tvar result;\r\n\r\n\t\t\tif ( tween.elem[ tween.prop ] != null &&\r\n\t\t\t\t(!tween.elem.style || tween.elem.style[ tween.prop ] == null) ) {\r\n\t\t\t\treturn tween.elem[ tween.prop ];\r\n\t\t\t}\r\n\r\n\t\t\t// Passing an empty string as a 3rd parameter to .css will automatically\r\n\t\t\t// attempt a parseFloat and fallback to a string if the parse fails.\r\n\t\t\t// Simple values such as \"10px\" are parsed to Float;\r\n\t\t\t// complex values such as \"rotate(1rad)\" are returned as-is.\r\n\t\t\tresult = jQuery.css( tween.elem, tween.prop, \"\" );\r\n\t\t\t// Empty strings, null, undefined and \"auto\" are converted to 0.\r\n\t\t\treturn !result || result === \"auto\" ? 0 : result;\r\n\t\t},\r\n\t\tset: function( tween ) {\r\n\t\t\t// Use step hook for back compat.\r\n\t\t\t// Use cssHook if its there.\r\n\t\t\t// Use .style if available and use plain properties where available.\r\n\t\t\tif ( jQuery.fx.step[ tween.prop ] ) {\r\n\t\t\t\tjQuery.fx.step[ tween.prop ]( tween );\r\n\t\t\t} else if ( tween.elem.style && ( tween.elem.style[ jQuery.cssProps[ tween.prop ] ] != null || jQuery.cssHooks[ tween.prop ] ) ) {\r\n\t\t\t\tjQuery.style( tween.elem, tween.prop, tween.now + tween.unit );\r\n\t\t\t} else {\r\n\t\t\t\ttween.elem[ tween.prop ] = tween.now;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// Support: IE9\r\n// Panic based approach to setting things on disconnected nodes\r\nTween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {\r\n\tset: function( tween ) {\r\n\t\tif ( tween.elem.nodeType && tween.elem.parentNode ) {\r\n\t\t\ttween.elem[ tween.prop ] = tween.now;\r\n\t\t}\r\n\t}\r\n};\r\n\r\njQuery.easing = {\r\n\tlinear: function( p ) {\r\n\t\treturn p;\r\n\t},\r\n\tswing: function( p ) {\r\n\t\treturn 0.5 - Math.cos( p * Math.PI ) / 2;\r\n\t}\r\n};\r\n\r\njQuery.fx = Tween.prototype.init;\r\n\r\n// Back Compat <1.8 extension point\r\njQuery.fx.step = {};\r\n\r\n\r\n\r\n\r\nvar\r\n\tfxNow, timerId,\r\n\trfxtypes = /^(?:toggle|show|hide)$/,\r\n\trfxnum = new RegExp( \"^(?:([+-])=|)(\" + pnum + \")([a-z%]*)$\", \"i\" ),\r\n\trrun = /queueHooks$/,\r\n\tanimationPrefilters = [ defaultPrefilter ],\r\n\ttweeners = {\r\n\t\t\"*\": [ function( prop, value ) {\r\n\t\t\tvar tween = this.createTween( prop, value ),\r\n\t\t\t\ttarget = tween.cur(),\r\n\t\t\t\tparts = rfxnum.exec( value ),\r\n\t\t\t\tunit = parts && parts[ 3 ] || ( jQuery.cssNumber[ prop ] ? \"\" : \"px\" ),\r\n\r\n\t\t\t\t// Starting value computation is required for potential unit mismatches\r\n\t\t\t\tstart = ( jQuery.cssNumber[ prop ] || unit !== \"px\" && +target ) &&\r\n\t\t\t\t\trfxnum.exec( jQuery.css( tween.elem, prop ) ),\r\n\t\t\t\tscale = 1,\r\n\t\t\t\tmaxIterations = 20;\r\n\r\n\t\t\tif ( start && start[ 3 ] !== unit ) {\r\n\t\t\t\t// Trust units reported by jQuery.css\r\n\t\t\t\tunit = unit || start[ 3 ];\r\n\r\n\t\t\t\t// Make sure we update the tween properties later on\r\n\t\t\t\tparts = parts || [];\r\n\r\n\t\t\t\t// Iteratively approximate from a nonzero starting point\r\n\t\t\t\tstart = +target || 1;\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\t// If previous iteration zeroed out, double until we get *something*.\r\n\t\t\t\t\t// Use string for doubling so we don't accidentally see scale as unchanged below\r\n\t\t\t\t\tscale = scale || \".5\";\r\n\r\n\t\t\t\t\t// Adjust and apply\r\n\t\t\t\t\tstart = start / scale;\r\n\t\t\t\t\tjQuery.style( tween.elem, prop, start + unit );\r\n\r\n\t\t\t\t// Update scale, tolerating zero or NaN from tween.cur(),\r\n\t\t\t\t// break the loop if scale is unchanged or perfect, or if we've just had enough\r\n\t\t\t\t} while ( scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations );\r\n\t\t\t}\r\n\r\n\t\t\t// Update tween properties\r\n\t\t\tif ( parts ) {\r\n\t\t\t\tstart = tween.start = +start || +target || 0;\r\n\t\t\t\ttween.unit = unit;\r\n\t\t\t\t// If a +=/-= token was provided, we're doing a relative animation\r\n\t\t\t\ttween.end = parts[ 1 ] ?\r\n\t\t\t\t\tstart + ( parts[ 1 ] + 1 ) * parts[ 2 ] :\r\n\t\t\t\t\t+parts[ 2 ];\r\n\t\t\t}\r\n\r\n\t\t\treturn tween;\r\n\t\t} ]\r\n\t};\r\n\r\n// Animations created synchronously will run synchronously\r\nfunction createFxNow() {\r\n\tsetTimeout(function() {\r\n\t\tfxNow = undefined;\r\n\t});\r\n\treturn ( fxNow = jQuery.now() );\r\n}\r\n\r\n// Generate parameters to create a standard animation\r\nfunction genFx( type, includeWidth ) {\r\n\tvar which,\r\n\t\ti = 0,\r\n\t\tattrs = { height: type };\r\n\r\n\t// If we include width, step value is 1 to do all cssExpand values,\r\n\t// otherwise step value is 2 to skip over Left and Right\r\n\tincludeWidth = includeWidth ? 1 : 0;\r\n\tfor ( ; i < 4 ; i += 2 - includeWidth ) {\r\n\t\twhich = cssExpand[ i ];\r\n\t\tattrs[ \"margin\" + which ] = attrs[ \"padding\" + which ] = type;\r\n\t}\r\n\r\n\tif ( includeWidth ) {\r\n\t\tattrs.opacity = attrs.width = type;\r\n\t}\r\n\r\n\treturn attrs;\r\n}\r\n\r\nfunction createTween( value, prop, animation ) {\r\n\tvar tween,\r\n\t\tcollection = ( tweeners[ prop ] || [] ).concat( tweeners[ \"*\" ] ),\r\n\t\tindex = 0,\r\n\t\tlength = collection.length;\r\n\tfor ( ; index < length; index++ ) {\r\n\t\tif ( (tween = collection[ index ].call( animation, prop, value )) ) {\r\n\r\n\t\t\t// We're done with this property\r\n\t\t\treturn tween;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction defaultPrefilter( elem, props, opts ) {\r\n\t/* jshint validthis: true */\r\n\tvar prop, value, toggle, tween, hooks, oldfire, display, checkDisplay,\r\n\t\tanim = this,\r\n\t\torig = {},\r\n\t\tstyle = elem.style,\r\n\t\thidden = elem.nodeType && isHidden( elem ),\r\n\t\tdataShow = data_priv.get( elem, \"fxshow\" );\r\n\r\n\t// Handle queue: false promises\r\n\tif ( !opts.queue ) {\r\n\t\thooks = jQuery._queueHooks( elem, \"fx\" );\r\n\t\tif ( hooks.unqueued == null ) {\r\n\t\t\thooks.unqueued = 0;\r\n\t\t\toldfire = hooks.empty.fire;\r\n\t\t\thooks.empty.fire = function() {\r\n\t\t\t\tif ( !hooks.unqueued ) {\r\n\t\t\t\t\toldfire();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\thooks.unqueued++;\r\n\r\n\t\tanim.always(function() {\r\n\t\t\t// Ensure the complete handler is called before this completes\r\n\t\t\tanim.always(function() {\r\n\t\t\t\thooks.unqueued--;\r\n\t\t\t\tif ( !jQuery.queue( elem, \"fx\" ).length ) {\r\n\t\t\t\t\thooks.empty.fire();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t// Height/width overflow pass\r\n\tif ( elem.nodeType === 1 && ( \"height\" in props || \"width\" in props ) ) {\r\n\t\t// Make sure that nothing sneaks out\r\n\t\t// Record all 3 overflow attributes because IE9-10 do not\r\n\t\t// change the overflow attribute when overflowX and\r\n\t\t// overflowY are set to the same value\r\n\t\topts.overflow = [ style.overflow, style.overflowX, style.overflowY ];\r\n\r\n\t\t// Set display property to inline-block for height/width\r\n\t\t// animations on inline elements that are having width/height animated\r\n\t\tdisplay = jQuery.css( elem, \"display\" );\r\n\r\n\t\t// Test default display if display is currently \"none\"\r\n\t\tcheckDisplay = display === \"none\" ?\r\n\t\t\tdata_priv.get( elem, \"olddisplay\" ) || defaultDisplay( elem.nodeName ) : display;\r\n\r\n\t\tif ( checkDisplay === \"inline\" && jQuery.css( elem, \"float\" ) === \"none\" ) {\r\n\t\t\tstyle.display = \"inline-block\";\r\n\t\t}\r\n\t}\r\n\r\n\tif ( opts.overflow ) {\r\n\t\tstyle.overflow = \"hidden\";\r\n\t\tanim.always(function() {\r\n\t\t\tstyle.overflow = opts.overflow[ 0 ];\r\n\t\t\tstyle.overflowX = opts.overflow[ 1 ];\r\n\t\t\tstyle.overflowY = opts.overflow[ 2 ];\r\n\t\t});\r\n\t}\r\n\r\n\t// show/hide pass\r\n\tfor ( prop in props ) {\r\n\t\tvalue = props[ prop ];\r\n\t\tif ( rfxtypes.exec( value ) ) {\r\n\t\t\tdelete props[ prop ];\r\n\t\t\ttoggle = toggle || value === \"toggle\";\r\n\t\t\tif ( value === ( hidden ? \"hide\" : \"show\" ) ) {\r\n\r\n\t\t\t\t// If there is dataShow left over from a stopped hide or show and we are going to proceed with show, we should pretend to be hidden\r\n\t\t\t\tif ( value === \"show\" && dataShow && dataShow[ prop ] !== undefined ) {\r\n\t\t\t\t\thidden = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\torig[ prop ] = dataShow && dataShow[ prop ] || jQuery.style( elem, prop );\r\n\r\n\t\t// Any non-fx value stops us from restoring the original display value\r\n\t\t} else {\r\n\t\t\tdisplay = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tif ( !jQuery.isEmptyObject( orig ) ) {\r\n\t\tif ( dataShow ) {\r\n\t\t\tif ( \"hidden\" in dataShow ) {\r\n\t\t\t\thidden = dataShow.hidden;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdataShow = data_priv.access( elem, \"fxshow\", {} );\r\n\t\t}\r\n\r\n\t\t// Store state if its toggle - enables .stop().toggle() to \"reverse\"\r\n\t\tif ( toggle ) {\r\n\t\t\tdataShow.hidden = !hidden;\r\n\t\t}\r\n\t\tif ( hidden ) {\r\n\t\t\tjQuery( elem ).show();\r\n\t\t} else {\r\n\t\t\tanim.done(function() {\r\n\t\t\t\tjQuery( elem ).hide();\r\n\t\t\t});\r\n\t\t}\r\n\t\tanim.done(function() {\r\n\t\t\tvar prop;\r\n\r\n\t\t\tdata_priv.remove( elem, \"fxshow\" );\r\n\t\t\tfor ( prop in orig ) {\r\n\t\t\t\tjQuery.style( elem, prop, orig[ prop ] );\r\n\t\t\t}\r\n\t\t});\r\n\t\tfor ( prop in orig ) {\r\n\t\t\ttween = createTween( hidden ? dataShow[ prop ] : 0, prop, anim );\r\n\r\n\t\t\tif ( !( prop in dataShow ) ) {\r\n\t\t\t\tdataShow[ prop ] = tween.start;\r\n\t\t\t\tif ( hidden ) {\r\n\t\t\t\t\ttween.end = tween.start;\r\n\t\t\t\t\ttween.start = prop === \"width\" || prop === \"height\" ? 1 : 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t// If this is a noop like .hide().hide(), restore an overwritten display value\r\n\t} else if ( (display === \"none\" ? defaultDisplay( elem.nodeName ) : display) === \"inline\" ) {\r\n\t\tstyle.display = display;\r\n\t}\r\n}\r\n\r\nfunction propFilter( props, specialEasing ) {\r\n\tvar index, name, easing, value, hooks;\r\n\r\n\t// camelCase, specialEasing and expand cssHook pass\r\n\tfor ( index in props ) {\r\n\t\tname = jQuery.camelCase( index );\r\n\t\teasing = specialEasing[ name ];\r\n\t\tvalue = props[ index ];\r\n\t\tif ( jQuery.isArray( value ) ) {\r\n\t\t\teasing = value[ 1 ];\r\n\t\t\tvalue = props[ index ] = value[ 0 ];\r\n\t\t}\r\n\r\n\t\tif ( index !== name ) {\r\n\t\t\tprops[ name ] = value;\r\n\t\t\tdelete props[ index ];\r\n\t\t}\r\n\r\n\t\thooks = jQuery.cssHooks[ name ];\r\n\t\tif ( hooks && \"expand\" in hooks ) {\r\n\t\t\tvalue = hooks.expand( value );\r\n\t\t\tdelete props[ name ];\r\n\r\n\t\t\t// Not quite $.extend, this won't overwrite existing keys.\r\n\t\t\t// Reusing 'index' because we have the correct \"name\"\r\n\t\t\tfor ( index in value ) {\r\n\t\t\t\tif ( !( index in props ) ) {\r\n\t\t\t\t\tprops[ index ] = value[ index ];\r\n\t\t\t\t\tspecialEasing[ index ] = easing;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tspecialEasing[ name ] = easing;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction Animation( elem, properties, options ) {\r\n\tvar result,\r\n\t\tstopped,\r\n\t\tindex = 0,\r\n\t\tlength = animationPrefilters.length,\r\n\t\tdeferred = jQuery.Deferred().always( function() {\r\n\t\t\t// Don't match elem in the :animated selector\r\n\t\t\tdelete tick.elem;\r\n\t\t}),\r\n\t\ttick = function() {\r\n\t\t\tif ( stopped ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar currentTime = fxNow || createFxNow(),\r\n\t\t\t\tremaining = Math.max( 0, animation.startTime + animation.duration - currentTime ),\r\n\t\t\t\t// Support: Android 2.3\r\n\t\t\t\t// Archaic crash bug won't allow us to use `1 - ( 0.5 || 0 )` (#12497)\r\n\t\t\t\ttemp = remaining / animation.duration || 0,\r\n\t\t\t\tpercent = 1 - temp,\r\n\t\t\t\tindex = 0,\r\n\t\t\t\tlength = animation.tweens.length;\r\n\r\n\t\t\tfor ( ; index < length ; index++ ) {\r\n\t\t\t\tanimation.tweens[ index ].run( percent );\r\n\t\t\t}\r\n\r\n\t\t\tdeferred.notifyWith( elem, [ animation, percent, remaining ]);\r\n\r\n\t\t\tif ( percent < 1 && length ) {\r\n\t\t\t\treturn remaining;\r\n\t\t\t} else {\r\n\t\t\t\tdeferred.resolveWith( elem, [ animation ] );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tanimation = deferred.promise({\r\n\t\t\telem: elem,\r\n\t\t\tprops: jQuery.extend( {}, properties ),\r\n\t\t\topts: jQuery.extend( true, { specialEasing: {} }, options ),\r\n\t\t\toriginalProperties: properties,\r\n\t\t\toriginalOptions: options,\r\n\t\t\tstartTime: fxNow || createFxNow(),\r\n\t\t\tduration: options.duration,\r\n\t\t\ttweens: [],\r\n\t\t\tcreateTween: function( prop, end ) {\r\n\t\t\t\tvar tween = jQuery.Tween( elem, animation.opts, prop, end,\r\n\t\t\t\t\t\tanimation.opts.specialEasing[ prop ] || animation.opts.easing );\r\n\t\t\t\tanimation.tweens.push( tween );\r\n\t\t\t\treturn tween;\r\n\t\t\t},\r\n\t\t\tstop: function( gotoEnd ) {\r\n\t\t\t\tvar index = 0,\r\n\t\t\t\t\t// If we are going to the end, we want to run all the tweens\r\n\t\t\t\t\t// otherwise we skip this part\r\n\t\t\t\t\tlength = gotoEnd ? animation.tweens.length : 0;\r\n\t\t\t\tif ( stopped ) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tstopped = true;\r\n\t\t\t\tfor ( ; index < length ; index++ ) {\r\n\t\t\t\t\tanimation.tweens[ index ].run( 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Resolve when we played the last frame; otherwise, reject\r\n\t\t\t\tif ( gotoEnd ) {\r\n\t\t\t\t\tdeferred.resolveWith( elem, [ animation, gotoEnd ] );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeferred.rejectWith( elem, [ animation, gotoEnd ] );\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t}),\r\n\t\tprops = animation.props;\r\n\r\n\tpropFilter( props, animation.opts.specialEasing );\r\n\r\n\tfor ( ; index < length ; index++ ) {\r\n\t\tresult = animationPrefilters[ index ].call( animation, elem, props, animation.opts );\r\n\t\tif ( result ) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\tjQuery.map( props, createTween, animation );\r\n\r\n\tif ( jQuery.isFunction( animation.opts.start ) ) {\r\n\t\tanimation.opts.start.call( elem, animation );\r\n\t}\r\n\r\n\tjQuery.fx.timer(\r\n\t\tjQuery.extend( tick, {\r\n\t\t\telem: elem,\r\n\t\t\tanim: animation,\r\n\t\t\tqueue: animation.opts.queue\r\n\t\t})\r\n\t);\r\n\r\n\t// attach callbacks from options\r\n\treturn animation.progress( animation.opts.progress )\r\n\t\t.done( animation.opts.done, animation.opts.complete )\r\n\t\t.fail( animation.opts.fail )\r\n\t\t.always( animation.opts.always );\r\n}\r\n\r\njQuery.Animation = jQuery.extend( Animation, {\r\n\r\n\ttweener: function( props, callback ) {\r\n\t\tif ( jQuery.isFunction( props ) ) {\r\n\t\t\tcallback = props;\r\n\t\t\tprops = [ \"*\" ];\r\n\t\t} else {\r\n\t\t\tprops = props.split(\" \");\r\n\t\t}\r\n\r\n\t\tvar prop,\r\n\t\t\tindex = 0,\r\n\t\t\tlength = props.length;\r\n\r\n\t\tfor ( ; index < length ; index++ ) {\r\n\t\t\tprop = props[ index ];\r\n\t\t\ttweeners[ prop ] = tweeners[ prop ] || [];\r\n\t\t\ttweeners[ prop ].unshift( callback );\r\n\t\t}\r\n\t},\r\n\r\n\tprefilter: function( callback, prepend ) {\r\n\t\tif ( prepend ) {\r\n\t\t\tanimationPrefilters.unshift( callback );\r\n\t\t} else {\r\n\t\t\tanimationPrefilters.push( callback );\r\n\t\t}\r\n\t}\r\n});\r\n\r\njQuery.speed = function( speed, easing, fn ) {\r\n\tvar opt = speed && typeof speed === \"object\" ? jQuery.extend( {}, speed ) : {\r\n\t\tcomplete: fn || !fn && easing ||\r\n\t\t\tjQuery.isFunction( speed ) && speed,\r\n\t\tduration: speed,\r\n\t\teasing: fn && easing || easing && !jQuery.isFunction( easing ) && easing\r\n\t};\r\n\r\n\topt.duration = jQuery.fx.off ? 0 : typeof opt.duration === \"number\" ? opt.duration :\r\n\t\topt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;\r\n\r\n\t// Normalize opt.queue - true/undefined/null -> \"fx\"\r\n\tif ( opt.queue == null || opt.queue === true ) {\r\n\t\topt.queue = \"fx\";\r\n\t}\r\n\r\n\t// Queueing\r\n\topt.old = opt.complete;\r\n\r\n\topt.complete = function() {\r\n\t\tif ( jQuery.isFunction( opt.old ) ) {\r\n\t\t\topt.old.call( this );\r\n\t\t}\r\n\r\n\t\tif ( opt.queue ) {\r\n\t\t\tjQuery.dequeue( this, opt.queue );\r\n\t\t}\r\n\t};\r\n\r\n\treturn opt;\r\n};\r\n\r\njQuery.fn.extend({\r\n\tfadeTo: function( speed, to, easing, callback ) {\r\n\r\n\t\t// Show any hidden elements after setting opacity to 0\r\n\t\treturn this.filter( isHidden ).css( \"opacity\", 0 ).show()\r\n\r\n\t\t\t// Animate to the value specified\r\n\t\t\t.end().animate({ opacity: to }, speed, easing, callback );\r\n\t},\r\n\tanimate: function( prop, speed, easing, callback ) {\r\n\t\tvar empty = jQuery.isEmptyObject( prop ),\r\n\t\t\toptall = jQuery.speed( speed, easing, callback ),\r\n\t\t\tdoAnimation = function() {\r\n\t\t\t\t// Operate on a copy of prop so per-property easing won't be lost\r\n\t\t\t\tvar anim = Animation( this, jQuery.extend( {}, prop ), optall );\r\n\r\n\t\t\t\t// Empty animations, or finishing resolves immediately\r\n\t\t\t\tif ( empty || data_priv.get( this, \"finish\" ) ) {\r\n\t\t\t\t\tanim.stop( true );\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tdoAnimation.finish = doAnimation;\r\n\r\n\t\treturn empty || optall.queue === false ?\r\n\t\t\tthis.each( doAnimation ) :\r\n\t\t\tthis.queue( optall.queue, doAnimation );\r\n\t},\r\n\tstop: function( type, clearQueue, gotoEnd ) {\r\n\t\tvar stopQueue = function( hooks ) {\r\n\t\t\tvar stop = hooks.stop;\r\n\t\t\tdelete hooks.stop;\r\n\t\t\tstop( gotoEnd );\r\n\t\t};\r\n\r\n\t\tif ( typeof type !== \"string\" ) {\r\n\t\t\tgotoEnd = clearQueue;\r\n\t\t\tclearQueue = type;\r\n\t\t\ttype = undefined;\r\n\t\t}\r\n\t\tif ( clearQueue && type !== false ) {\r\n\t\t\tthis.queue( type || \"fx\", [] );\r\n\t\t}\r\n\r\n\t\treturn this.each(function() {\r\n\t\t\tvar dequeue = true,\r\n\t\t\t\tindex = type != null && type + \"queueHooks\",\r\n\t\t\t\ttimers = jQuery.timers,\r\n\t\t\t\tdata = data_priv.get( this );\r\n\r\n\t\t\tif ( index ) {\r\n\t\t\t\tif ( data[ index ] && data[ index ].stop ) {\r\n\t\t\t\t\tstopQueue( data[ index ] );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor ( index in data ) {\r\n\t\t\t\t\tif ( data[ index ] && data[ index ].stop && rrun.test( index ) ) {\r\n\t\t\t\t\t\tstopQueue( data[ index ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor ( index = timers.length; index--; ) {\r\n\t\t\t\tif ( timers[ index ].elem === this && (type == null || timers[ index ].queue === type) ) {\r\n\t\t\t\t\ttimers[ index ].anim.stop( gotoEnd );\r\n\t\t\t\t\tdequeue = false;\r\n\t\t\t\t\ttimers.splice( index, 1 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Start the next in the queue if the last step wasn't forced.\r\n\t\t\t// Timers currently will call their complete callbacks, which\r\n\t\t\t// will dequeue but only if they were gotoEnd.\r\n\t\t\tif ( dequeue || !gotoEnd ) {\r\n\t\t\t\tjQuery.dequeue( this, type );\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tfinish: function( type ) {\r\n\t\tif ( type !== false ) {\r\n\t\t\ttype = type || \"fx\";\r\n\t\t}\r\n\t\treturn this.each(function() {\r\n\t\t\tvar index,\r\n\t\t\t\tdata = data_priv.get( this ),\r\n\t\t\t\tqueue = data[ type + \"queue\" ],\r\n\t\t\t\thooks = data[ type + \"queueHooks\" ],\r\n\t\t\t\ttimers = jQuery.timers,\r\n\t\t\t\tlength = queue ? queue.length : 0;\r\n\r\n\t\t\t// Enable finishing flag on private data\r\n\t\t\tdata.finish = true;\r\n\r\n\t\t\t// Empty the queue first\r\n\t\t\tjQuery.queue( this, type, [] );\r\n\r\n\t\t\tif ( hooks && hooks.stop ) {\r\n\t\t\t\thooks.stop.call( this, true );\r\n\t\t\t}\r\n\r\n\t\t\t// Look for any active animations, and finish them\r\n\t\t\tfor ( index = timers.length; index--; ) {\r\n\t\t\t\tif ( timers[ index ].elem === this && timers[ index ].queue === type ) {\r\n\t\t\t\t\ttimers[ index ].anim.stop( true );\r\n\t\t\t\t\ttimers.splice( index, 1 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Look for any animations in the old queue and finish them\r\n\t\t\tfor ( index = 0; index < length; index++ ) {\r\n\t\t\t\tif ( queue[ index ] && queue[ index ].finish ) {\r\n\t\t\t\t\tqueue[ index ].finish.call( this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Turn off finishing flag\r\n\t\t\tdelete data.finish;\r\n\t\t});\r\n\t}\r\n});\r\n\r\njQuery.each([ \"toggle\", \"show\", \"hide\" ], function( i, name ) {\r\n\tvar cssFn = jQuery.fn[ name ];\r\n\tjQuery.fn[ name ] = function( speed, easing, callback ) {\r\n\t\treturn speed == null || typeof speed === \"boolean\" ?\r\n\t\t\tcssFn.apply( this, arguments ) :\r\n\t\t\tthis.animate( genFx( name, true ), speed, easing, callback );\r\n\t};\r\n});\r\n\r\n// Generate shortcuts for custom animations\r\njQuery.each({\r\n\tslideDown: genFx(\"show\"),\r\n\tslideUp: genFx(\"hide\"),\r\n\tslideToggle: genFx(\"toggle\"),\r\n\tfadeIn: { opacity: \"show\" },\r\n\tfadeOut: { opacity: \"hide\" },\r\n\tfadeToggle: { opacity: \"toggle\" }\r\n}, function( name, props ) {\r\n\tjQuery.fn[ name ] = function( speed, easing, callback ) {\r\n\t\treturn this.animate( props, speed, easing, callback );\r\n\t};\r\n});\r\n\r\njQuery.timers = [];\r\njQuery.fx.tick = function() {\r\n\tvar timer,\r\n\t\ti = 0,\r\n\t\ttimers = jQuery.timers;\r\n\r\n\tfxNow = jQuery.now();\r\n\r\n\tfor ( ; i < timers.length; i++ ) {\r\n\t\ttimer = timers[ i ];\r\n\t\t// Checks the timer has not already been removed\r\n\t\tif ( !timer() && timers[ i ] === timer ) {\r\n\t\t\ttimers.splice( i--, 1 );\r\n\t\t}\r\n\t}\r\n\r\n\tif ( !timers.length ) {\r\n\t\tjQuery.fx.stop();\r\n\t}\r\n\tfxNow = undefined;\r\n};\r\n\r\njQuery.fx.timer = function( timer ) {\r\n\tjQuery.timers.push( timer );\r\n\tif ( timer() ) {\r\n\t\tjQuery.fx.start();\r\n\t} else {\r\n\t\tjQuery.timers.pop();\r\n\t}\r\n};\r\n\r\njQuery.fx.interval = 13;\r\n\r\njQuery.fx.start = function() {\r\n\tif ( !timerId ) {\r\n\t\ttimerId = setInterval( jQuery.fx.tick, jQuery.fx.interval );\r\n\t}\r\n};\r\n\r\njQuery.fx.stop = function() {\r\n\tclearInterval( timerId );\r\n\ttimerId = null;\r\n};\r\n\r\njQuery.fx.speeds = {\r\n\tslow: 600,\r\n\tfast: 200,\r\n\t// Default speed\r\n\t_default: 400\r\n};\r\n\r\n\r\n// Based off of the plugin by Clint Helfers, with permission.\r\n// http://blindsignals.com/index.php/2009/07/jquery-delay/\r\njQuery.fn.delay = function( time, type ) {\r\n\ttime = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;\r\n\ttype = type || \"fx\";\r\n\r\n\treturn this.queue( type, function( next, hooks ) {\r\n\t\tvar timeout = setTimeout( next, time );\r\n\t\thooks.stop = function() {\r\n\t\t\tclearTimeout( timeout );\r\n\t\t};\r\n\t});\r\n};\r\n\r\n\r\n(function() {\r\n\tvar input = document.createElement( \"input\" ),\r\n\t\tselect = document.createElement( \"select\" ),\r\n\t\topt = select.appendChild( document.createElement( \"option\" ) );\r\n\r\n\tinput.type = \"checkbox\";\r\n\r\n\t// Support: iOS<=5.1, Android<=4.2+\r\n\t// Default value for a checkbox should be \"on\"\r\n\tsupport.checkOn = input.value !== \"\";\r\n\r\n\t// Support: IE<=11+\r\n\t// Must access selectedIndex to make default options select\r\n\tsupport.optSelected = opt.selected;\r\n\r\n\t// Support: Android<=2.3\r\n\t// Options inside disabled selects are incorrectly marked as disabled\r\n\tselect.disabled = true;\r\n\tsupport.optDisabled = !opt.disabled;\r\n\r\n\t// Support: IE<=11+\r\n\t// An input loses its value after becoming a radio\r\n\tinput = document.createElement( \"input\" );\r\n\tinput.value = \"t\";\r\n\tinput.type = \"radio\";\r\n\tsupport.radioValue = input.value === \"t\";\r\n})();\r\n\r\n\r\nvar nodeHook, boolHook,\r\n\tattrHandle = jQuery.expr.attrHandle;\r\n\r\njQuery.fn.extend({\r\n\tattr: function( name, value ) {\r\n\t\treturn access( this, jQuery.attr, name, value, arguments.length > 1 );\r\n\t},\r\n\r\n\tremoveAttr: function( name ) {\r\n\t\treturn this.each(function() {\r\n\t\t\tjQuery.removeAttr( this, name );\r\n\t\t});\r\n\t}\r\n});\r\n\r\njQuery.extend({\r\n\tattr: function( elem, name, value ) {\r\n\t\tvar hooks, ret,\r\n\t\t\tnType = elem.nodeType;\r\n\r\n\t\t// don't get/set attributes on text, comment and attribute nodes\r\n\t\tif ( !elem || nType === 3 || nType === 8 || nType === 2 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Fallback to prop when attributes are not supported\r\n\t\tif ( typeof elem.getAttribute === strundefined ) {\r\n\t\t\treturn jQuery.prop( elem, name, value );\r\n\t\t}\r\n\r\n\t\t// All attributes are lowercase\r\n\t\t// Grab necessary hook if one is defined\r\n\t\tif ( nType !== 1 || !jQuery.isXMLDoc( elem ) ) {\r\n\t\t\tname = name.toLowerCase();\r\n\t\t\thooks = jQuery.attrHooks[ name ] ||\r\n\t\t\t\t( jQuery.expr.match.bool.test( name ) ? boolHook : nodeHook );\r\n\t\t}\r\n\r\n\t\tif ( value !== undefined ) {\r\n\r\n\t\t\tif ( value === null ) {\r\n\t\t\t\tjQuery.removeAttr( elem, name );\r\n\r\n\t\t\t} else if ( hooks && \"set\" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ) {\r\n\t\t\t\treturn ret;\r\n\r\n\t\t\t} else {\r\n\t\t\t\telem.setAttribute( name, value + \"\" );\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t} else if ( hooks && \"get\" in hooks && (ret = hooks.get( elem, name )) !== null ) {\r\n\t\t\treturn ret;\r\n\r\n\t\t} else {\r\n\t\t\tret = jQuery.find.attr( elem, name );\r\n\r\n\t\t\t// Non-existent attributes return null, we normalize to undefined\r\n\t\t\treturn ret == null ?\r\n\t\t\t\tundefined :\r\n\t\t\t\tret;\r\n\t\t}\r\n\t},\r\n\r\n\tremoveAttr: function( elem, value ) {\r\n\t\tvar name, propName,\r\n\t\t\ti = 0,\r\n\t\t\tattrNames = value && value.match( rnotwhite );\r\n\r\n\t\tif ( attrNames && elem.nodeType === 1 ) {\r\n\t\t\twhile ( (name = attrNames[i++]) ) {\r\n\t\t\t\tpropName = jQuery.propFix[ name ] || name;\r\n\r\n\t\t\t\t// Boolean attributes get special treatment (#10870)\r\n\t\t\t\tif ( jQuery.expr.match.bool.test( name ) ) {\r\n\t\t\t\t\t// Set corresponding property to false\r\n\t\t\t\t\telem[ propName ] = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\telem.removeAttribute( name );\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tattrHooks: {\r\n\t\ttype: {\r\n\t\t\tset: function( elem, value ) {\r\n\t\t\t\tif ( !support.radioValue && value === \"radio\" &&\r\n\t\t\t\t\tjQuery.nodeName( elem, \"input\" ) ) {\r\n\t\t\t\t\tvar val = elem.value;\r\n\t\t\t\t\telem.setAttribute( \"type\", value );\r\n\t\t\t\t\tif ( val ) {\r\n\t\t\t\t\t\telem.value = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Hooks for boolean attributes\r\nboolHook = {\r\n\tset: function( elem, value, name ) {\r\n\t\tif ( value === false ) {\r\n\t\t\t// Remove boolean attributes when set to false\r\n\t\t\tjQuery.removeAttr( elem, name );\r\n\t\t} else {\r\n\t\t\telem.setAttribute( name, name );\r\n\t\t}\r\n\t\treturn name;\r\n\t}\r\n};\r\njQuery.each( jQuery.expr.match.bool.source.match( /\\w+/g ), function( i, name ) {\r\n\tvar getter = attrHandle[ name ] || jQuery.find.attr;\r\n\r\n\tattrHandle[ name ] = function( elem, name, isXML ) {\r\n\t\tvar ret, handle;\r\n\t\tif ( !isXML ) {\r\n\t\t\t// Avoid an infinite loop by temporarily removing this function from the getter\r\n\t\t\thandle = attrHandle[ name ];\r\n\t\t\tattrHandle[ name ] = ret;\r\n\t\t\tret = getter( elem, name, isXML ) != null ?\r\n\t\t\t\tname.toLowerCase() :\r\n\t\t\t\tnull;\r\n\t\t\tattrHandle[ name ] = handle;\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n});\r\n\r\n\r\n\r\n\r\nvar rfocusable = /^(?:input|select|textarea|button)$/i;\r\n\r\njQuery.fn.extend({\r\n\tprop: function( name, value ) {\r\n\t\treturn access( this, jQuery.prop, name, value, arguments.length > 1 );\r\n\t},\r\n\r\n\tremoveProp: function( name ) {\r\n\t\treturn this.each(function() {\r\n\t\t\tdelete this[ jQuery.propFix[ name ] || name ];\r\n\t\t});\r\n\t}\r\n});\r\n\r\njQuery.extend({\r\n\tpropFix: {\r\n\t\t\"for\": \"htmlFor\",\r\n\t\t\"class\": \"className\"\r\n\t},\r\n\r\n\tprop: function( elem, name, value ) {\r\n\t\tvar ret, hooks, notxml,\r\n\t\t\tnType = elem.nodeType;\r\n\r\n\t\t// Don't get/set properties on text, comment and attribute nodes\r\n\t\tif ( !elem || nType === 3 || nType === 8 || nType === 2 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnotxml = nType !== 1 || !jQuery.isXMLDoc( elem );\r\n\r\n\t\tif ( notxml ) {\r\n\t\t\t// Fix name and attach hooks\r\n\t\t\tname = jQuery.propFix[ name ] || name;\r\n\t\t\thooks = jQuery.propHooks[ name ];\r\n\t\t}\r\n\r\n\t\tif ( value !== undefined ) {\r\n\t\t\treturn hooks && \"set\" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ?\r\n\t\t\t\tret :\r\n\t\t\t\t( elem[ name ] = value );\r\n\r\n\t\t} else {\r\n\t\t\treturn hooks && \"get\" in hooks && (ret = hooks.get( elem, name )) !== null ?\r\n\t\t\t\tret :\r\n\t\t\t\telem[ name ];\r\n\t\t}\r\n\t},\r\n\r\n\tpropHooks: {\r\n\t\ttabIndex: {\r\n\t\t\tget: function( elem ) {\r\n\t\t\t\treturn elem.hasAttribute( \"tabindex\" ) || rfocusable.test( elem.nodeName ) || elem.href ?\r\n\t\t\t\t\telem.tabIndex :\r\n\t\t\t\t\t-1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nif ( !support.optSelected ) {\r\n\tjQuery.propHooks.selected = {\r\n\t\tget: function( elem ) {\r\n\t\t\tvar parent = elem.parentNode;\r\n\t\t\tif ( parent && parent.parentNode ) {\r\n\t\t\t\tparent.parentNode.selectedIndex;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n}\r\n\r\njQuery.each([\r\n\t\"tabIndex\",\r\n\t\"readOnly\",\r\n\t\"maxLength\",\r\n\t\"cellSpacing\",\r\n\t\"cellPadding\",\r\n\t\"rowSpan\",\r\n\t\"colSpan\",\r\n\t\"useMap\",\r\n\t\"frameBorder\",\r\n\t\"contentEditable\"\r\n], function() {\r\n\tjQuery.propFix[ this.toLowerCase() ] = this;\r\n});\r\n\r\n\r\n\r\n\r\nvar rclass = /[\\t\\r\\n\\f]/g;\r\n\r\njQuery.fn.extend({\r\n\taddClass: function( value ) {\r\n\t\tvar classes, elem, cur, clazz, j, finalValue,\r\n\t\t\tproceed = typeof value === \"string\" && value,\r\n\t\t\ti = 0,\r\n\t\t\tlen = this.length;\r\n\r\n\t\tif ( jQuery.isFunction( value ) ) {\r\n\t\t\treturn this.each(function( j ) {\r\n\t\t\t\tjQuery( this ).addClass( value.call( this, j, this.className ) );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ( proceed ) {\r\n\t\t\t// The disjunction here is for better compressibility (see removeClass)\r\n\t\t\tclasses = ( value || \"\" ).match( rnotwhite ) || [];\r\n\r\n\t\t\tfor ( ; i < len; i++ ) {\r\n\t\t\t\telem = this[ i ];\r\n\t\t\t\tcur = elem.nodeType === 1 && ( elem.className ?\r\n\t\t\t\t\t( \" \" + elem.className + \" \" ).replace( rclass, \" \" ) :\r\n\t\t\t\t\t\" \"\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif ( cur ) {\r\n\t\t\t\t\tj = 0;\r\n\t\t\t\t\twhile ( (clazz = classes[j++]) ) {\r\n\t\t\t\t\t\tif ( cur.indexOf( \" \" + clazz + \" \" ) < 0 ) {\r\n\t\t\t\t\t\t\tcur += clazz + \" \";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// only assign if different to avoid unneeded rendering.\r\n\t\t\t\t\tfinalValue = jQuery.trim( cur );\r\n\t\t\t\t\tif ( elem.className !== finalValue ) {\r\n\t\t\t\t\t\telem.className = finalValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveClass: function( value ) {\r\n\t\tvar classes, elem, cur, clazz, j, finalValue,\r\n\t\t\tproceed = arguments.length === 0 || typeof value === \"string\" && value,\r\n\t\t\ti = 0,\r\n\t\t\tlen = this.length;\r\n\r\n\t\tif ( jQuery.isFunction( value ) ) {\r\n\t\t\treturn this.each(function( j ) {\r\n\t\t\t\tjQuery( this ).removeClass( value.call( this, j, this.className ) );\r\n\t\t\t});\r\n\t\t}\r\n\t\tif ( proceed ) {\r\n\t\t\tclasses = ( value || \"\" ).match( rnotwhite ) || [];\r\n\r\n\t\t\tfor ( ; i < len; i++ ) {\r\n\t\t\t\telem = this[ i ];\r\n\t\t\t\t// This expression is here for better compressibility (see addClass)\r\n\t\t\t\tcur = elem.nodeType === 1 && ( elem.className ?\r\n\t\t\t\t\t( \" \" + elem.className + \" \" ).replace( rclass, \" \" ) :\r\n\t\t\t\t\t\"\"\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif ( cur ) {\r\n\t\t\t\t\tj = 0;\r\n\t\t\t\t\twhile ( (clazz = classes[j++]) ) {\r\n\t\t\t\t\t\t// Remove *all* instances\r\n\t\t\t\t\t\twhile ( cur.indexOf( \" \" + clazz + \" \" ) >= 0 ) {\r\n\t\t\t\t\t\t\tcur = cur.replace( \" \" + clazz + \" \", \" \" );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Only assign if different to avoid unneeded rendering.\r\n\t\t\t\t\tfinalValue = value ? jQuery.trim( cur ) : \"\";\r\n\t\t\t\t\tif ( elem.className !== finalValue ) {\r\n\t\t\t\t\t\telem.className = finalValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttoggleClass: function( value, stateVal ) {\r\n\t\tvar type = typeof value;\r\n\r\n\t\tif ( typeof stateVal === \"boolean\" && type === \"string\" ) {\r\n\t\t\treturn stateVal ? this.addClass( value ) : this.removeClass( value );\r\n\t\t}\r\n\r\n\t\tif ( jQuery.isFunction( value ) ) {\r\n\t\t\treturn this.each(function( i ) {\r\n\t\t\t\tjQuery( this ).toggleClass( value.call(this, i, this.className, stateVal), stateVal );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.each(function() {\r\n\t\t\tif ( type === \"string\" ) {\r\n\t\t\t\t// Toggle individual class names\r\n\t\t\t\tvar className,\r\n\t\t\t\t\ti = 0,\r\n\t\t\t\t\tself = jQuery( this ),\r\n\t\t\t\t\tclassNames = value.match( rnotwhite ) || [];\r\n\r\n\t\t\t\twhile ( (className = classNames[ i++ ]) ) {\r\n\t\t\t\t\t// Check each className given, space separated list\r\n\t\t\t\t\tif ( self.hasClass( className ) ) {\r\n\t\t\t\t\t\tself.removeClass( className );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.addClass( className );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t// Toggle whole class name\r\n\t\t\t} else if ( type === strundefined || type === \"boolean\" ) {\r\n\t\t\t\tif ( this.className ) {\r\n\t\t\t\t\t// store className if set\r\n\t\t\t\t\tdata_priv.set( this, \"__className__\", this.className );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the element has a class name or if we're passed `false`,\r\n\t\t\t\t// then remove the whole classname (if there was one, the above saved it).\r\n\t\t\t\t// Otherwise bring back whatever was previously saved (if anything),\r\n\t\t\t\t// falling back to the empty string if nothing was stored.\r\n\t\t\t\tthis.className = this.className || value === false ? \"\" : data_priv.get( this, \"__className__\" ) || \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\thasClass: function( selector ) {\r\n\t\tvar className = \" \" + selector + \" \",\r\n\t\t\ti = 0,\r\n\t\t\tl = this.length;\r\n\t\tfor ( ; i < l; i++ ) {\r\n\t\t\tif ( this[i].nodeType === 1 && (\" \" + this[i].className + \" \").replace(rclass, \" \").indexOf( className ) >= 0 ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\nvar rreturn = /\\r/g;\r\n\r\njQuery.fn.extend({\r\n\tval: function( value ) {\r\n\t\tvar hooks, ret, isFunction,\r\n\t\t\telem = this[0];\r\n\r\n\t\tif ( !arguments.length ) {\r\n\t\t\tif ( elem ) {\r\n\t\t\t\thooks = jQuery.valHooks[ elem.type ] || jQuery.valHooks[ elem.nodeName.toLowerCase() ];\r\n\r\n\t\t\t\tif ( hooks && \"get\" in hooks && (ret = hooks.get( elem, \"value\" )) !== undefined ) {\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tret = elem.value;\r\n\r\n\t\t\t\treturn typeof ret === \"string\" ?\r\n\t\t\t\t\t// Handle most common string cases\r\n\t\t\t\t\tret.replace(rreturn, \"\") :\r\n\t\t\t\t\t// Handle cases where value is null/undef or number\r\n\t\t\t\t\tret == null ? \"\" : ret;\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tisFunction = jQuery.isFunction( value );\r\n\r\n\t\treturn this.each(function( i ) {\r\n\t\t\tvar val;\r\n\r\n\t\t\tif ( this.nodeType !== 1 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( isFunction ) {\r\n\t\t\t\tval = value.call( this, i, jQuery( this ).val() );\r\n\t\t\t} else {\r\n\t\t\t\tval = value;\r\n\t\t\t}\r\n\r\n\t\t\t// Treat null/undefined as \"\"; convert numbers to string\r\n\t\t\tif ( val == null ) {\r\n\t\t\t\tval = \"\";\r\n\r\n\t\t\t} else if ( typeof val === \"number\" ) {\r\n\t\t\t\tval += \"\";\r\n\r\n\t\t\t} else if ( jQuery.isArray( val ) ) {\r\n\t\t\t\tval = jQuery.map( val, function( value ) {\r\n\t\t\t\t\treturn value == null ? \"\" : value + \"\";\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\thooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];\r\n\r\n\t\t\t// If set returns undefined, fall back to normal setting\r\n\t\t\tif ( !hooks || !(\"set\" in hooks) || hooks.set( this, val, \"value\" ) === undefined ) {\r\n\t\t\t\tthis.value = val;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\njQuery.extend({\r\n\tvalHooks: {\r\n\t\toption: {\r\n\t\t\tget: function( elem ) {\r\n\t\t\t\tvar val = jQuery.find.attr( elem, \"value\" );\r\n\t\t\t\treturn val != null ?\r\n\t\t\t\t\tval :\r\n\t\t\t\t\t// Support: IE10-11+\r\n\t\t\t\t\t// option.text throws exceptions (#14686, #14858)\r\n\t\t\t\t\tjQuery.trim( jQuery.text( elem ) );\r\n\t\t\t}\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\tget: function( elem ) {\r\n\t\t\t\tvar value, option,\r\n\t\t\t\t\toptions = elem.options,\r\n\t\t\t\t\tindex = elem.selectedIndex,\r\n\t\t\t\t\tone = elem.type === \"select-one\" || index < 0,\r\n\t\t\t\t\tvalues = one ? null : [],\r\n\t\t\t\t\tmax = one ? index + 1 : options.length,\r\n\t\t\t\t\ti = index < 0 ?\r\n\t\t\t\t\t\tmax :\r\n\t\t\t\t\t\tone ? index : 0;\r\n\r\n\t\t\t\t// Loop through all the selected options\r\n\t\t\t\tfor ( ; i < max; i++ ) {\r\n\t\t\t\t\toption = options[ i ];\r\n\r\n\t\t\t\t\t// IE6-9 doesn't update selected after form reset (#2551)\r\n\t\t\t\t\tif ( ( option.selected || i === index ) &&\r\n\t\t\t\t\t\t\t// Don't return options that are disabled or in a disabled optgroup\r\n\t\t\t\t\t\t\t( support.optDisabled ? !option.disabled : option.getAttribute( \"disabled\" ) === null ) &&\r\n\t\t\t\t\t\t\t( !option.parentNode.disabled || !jQuery.nodeName( option.parentNode, \"optgroup\" ) ) ) {\r\n\r\n\t\t\t\t\t\t// Get the specific value for the option\r\n\t\t\t\t\t\tvalue = jQuery( option ).val();\r\n\r\n\t\t\t\t\t\t// We don't need an array for one selects\r\n\t\t\t\t\t\tif ( one ) {\r\n\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Multi-Selects return an array\r\n\t\t\t\t\t\tvalues.push( value );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn values;\r\n\t\t\t},\r\n\r\n\t\t\tset: function( elem, value ) {\r\n\t\t\t\tvar optionSet, option,\r\n\t\t\t\t\toptions = elem.options,\r\n\t\t\t\t\tvalues = jQuery.makeArray( value ),\r\n\t\t\t\t\ti = options.length;\r\n\r\n\t\t\t\twhile ( i-- ) {\r\n\t\t\t\t\toption = options[ i ];\r\n\t\t\t\t\tif ( (option.selected = jQuery.inArray( option.value, values ) >= 0) ) {\r\n\t\t\t\t\t\toptionSet = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Force browsers to behave consistently when non-matching value is set\r\n\t\t\t\tif ( !optionSet ) {\r\n\t\t\t\t\telem.selectedIndex = -1;\r\n\t\t\t\t}\r\n\t\t\t\treturn values;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Radios and checkboxes getter/setter\r\njQuery.each([ \"radio\", \"checkbox\" ], function() {\r\n\tjQuery.valHooks[ this ] = {\r\n\t\tset: function( elem, value ) {\r\n\t\t\tif ( jQuery.isArray( value ) ) {\r\n\t\t\t\treturn ( elem.checked = jQuery.inArray( jQuery(elem).val(), value ) >= 0 );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tif ( !support.checkOn ) {\r\n\t\tjQuery.valHooks[ this ].get = function( elem ) {\r\n\t\t\treturn elem.getAttribute(\"value\") === null ? \"on\" : elem.value;\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n// Return jQuery for attributes-only inclusion\r\n\r\n\r\njQuery.each( (\"blur focus focusin focusout load resize scroll unload click dblclick \" +\r\n\t\"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave \" +\r\n\t\"change select submit keydown keypress keyup error contextmenu\").split(\" \"), function( i, name ) {\r\n\r\n\t// Handle event binding\r\n\tjQuery.fn[ name ] = function( data, fn ) {\r\n\t\treturn arguments.length > 0 ?\r\n\t\t\tthis.on( name, null, data, fn ) :\r\n\t\t\tthis.trigger( name );\r\n\t};\r\n});\r\n\r\njQuery.fn.extend({\r\n\thover: function( fnOver, fnOut ) {\r\n\t\treturn this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );\r\n\t},\r\n\r\n\tbind: function( types, data, fn ) {\r\n\t\treturn this.on( types, null, data, fn );\r\n\t},\r\n\tunbind: function( types, fn ) {\r\n\t\treturn this.off( types, null, fn );\r\n\t},\r\n\r\n\tdelegate: function( selector, types, data, fn ) {\r\n\t\treturn this.on( types, selector, data, fn );\r\n\t},\r\n\tundelegate: function( selector, types, fn ) {\r\n\t\t// ( namespace ) or ( selector, types [, fn] )\r\n\t\treturn arguments.length === 1 ? this.off( selector, \"**\" ) : this.off( types, selector || \"**\", fn );\r\n\t}\r\n});\r\n\r\n\r\nvar nonce = jQuery.now();\r\n\r\nvar rquery = (/\\?/);\r\n\r\n\r\n\r\n// Support: Android 2.3\r\n// Workaround failure to string-cast null input\r\njQuery.parseJSON = function( data ) {\r\n\treturn JSON.parse( data + \"\" );\r\n};\r\n\r\n\r\n// Cross-browser xml parsing\r\njQuery.parseXML = function( data ) {\r\n\tvar xml, tmp;\r\n\tif ( !data || typeof data !== \"string\" ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Support: IE9\r\n\ttry {\r\n\t\ttmp = new DOMParser();\r\n\t\txml = tmp.parseFromString( data, \"text/xml\" );\r\n\t} catch ( e ) {\r\n\t\txml = undefined;\r\n\t}\r\n\r\n\tif ( !xml || xml.getElementsByTagName( \"parsererror\" ).length ) {\r\n\t\tjQuery.error( \"Invalid XML: \" + data );\r\n\t}\r\n\treturn xml;\r\n};\r\n\r\n\r\nvar\r\n\trhash = /#.*$/,\r\n\trts = /([?&])_=[^&]*/,\r\n\trheaders = /^(.*?):[ \\t]*([^\\r\\n]*)$/mg,\r\n\t// #7653, #8125, #8152: local protocol detection\r\n\trlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,\r\n\trnoContent = /^(?:GET|HEAD)$/,\r\n\trprotocol = /^\\/\\//,\r\n\trurl = /^([\\w.+-]+:)(?:\\/\\/(?:[^\\/?#]*@|)([^\\/?#:]*)(?::(\\d+)|)|)/,\r\n\r\n\t/* Prefilters\r\n\t * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)\r\n\t * 2) These are called:\r\n\t *    - BEFORE asking for a transport\r\n\t *    - AFTER param serialization (s.data is a string if s.processData is true)\r\n\t * 3) key is the dataType\r\n\t * 4) the catchall symbol \"*\" can be used\r\n\t * 5) execution will start with transport dataType and THEN continue down to \"*\" if needed\r\n\t */\r\n\tprefilters = {},\r\n\r\n\t/* Transports bindings\r\n\t * 1) key is the dataType\r\n\t * 2) the catchall symbol \"*\" can be used\r\n\t * 3) selection will start with transport dataType and THEN go to \"*\" if needed\r\n\t */\r\n\ttransports = {},\r\n\r\n\t// Avoid comment-prolog char sequence (#10098); must appease lint and evade compression\r\n\tallTypes = \"*/\".concat( \"*\" ),\r\n\r\n\t// Document location\r\n\tajaxLocation = window.location.href,\r\n\r\n\t// Segment location into parts\r\n\tajaxLocParts = rurl.exec( ajaxLocation.toLowerCase() ) || [];\r\n\r\n// Base \"constructor\" for jQuery.ajaxPrefilter and jQuery.ajaxTransport\r\nfunction addToPrefiltersOrTransports( structure ) {\r\n\r\n\t// dataTypeExpression is optional and defaults to \"*\"\r\n\treturn function( dataTypeExpression, func ) {\r\n\r\n\t\tif ( typeof dataTypeExpression !== \"string\" ) {\r\n\t\t\tfunc = dataTypeExpression;\r\n\t\t\tdataTypeExpression = \"*\";\r\n\t\t}\r\n\r\n\t\tvar dataType,\r\n\t\t\ti = 0,\r\n\t\t\tdataTypes = dataTypeExpression.toLowerCase().match( rnotwhite ) || [];\r\n\r\n\t\tif ( jQuery.isFunction( func ) ) {\r\n\t\t\t// For each dataType in the dataTypeExpression\r\n\t\t\twhile ( (dataType = dataTypes[i++]) ) {\r\n\t\t\t\t// Prepend if requested\r\n\t\t\t\tif ( dataType[0] === \"+\" ) {\r\n\t\t\t\t\tdataType = dataType.slice( 1 ) || \"*\";\r\n\t\t\t\t\t(structure[ dataType ] = structure[ dataType ] || []).unshift( func );\r\n\r\n\t\t\t\t// Otherwise append\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(structure[ dataType ] = structure[ dataType ] || []).push( func );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Base inspection function for prefilters and transports\r\nfunction inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR ) {\r\n\r\n\tvar inspected = {},\r\n\t\tseekingTransport = ( structure === transports );\r\n\r\n\tfunction inspect( dataType ) {\r\n\t\tvar selected;\r\n\t\tinspected[ dataType ] = true;\r\n\t\tjQuery.each( structure[ dataType ] || [], function( _, prefilterOrFactory ) {\r\n\t\t\tvar dataTypeOrTransport = prefilterOrFactory( options, originalOptions, jqXHR );\r\n\t\t\tif ( typeof dataTypeOrTransport === \"string\" && !seekingTransport && !inspected[ dataTypeOrTransport ] ) {\r\n\t\t\t\toptions.dataTypes.unshift( dataTypeOrTransport );\r\n\t\t\t\tinspect( dataTypeOrTransport );\r\n\t\t\t\treturn false;\r\n\t\t\t} else if ( seekingTransport ) {\r\n\t\t\t\treturn !( selected = dataTypeOrTransport );\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn selected;\r\n\t}\r\n\r\n\treturn inspect( options.dataTypes[ 0 ] ) || !inspected[ \"*\" ] && inspect( \"*\" );\r\n}\r\n\r\n// A special extend for ajax options\r\n// that takes \"flat\" options (not to be deep extended)\r\n// Fixes #9887\r\nfunction ajaxExtend( target, src ) {\r\n\tvar key, deep,\r\n\t\tflatOptions = jQuery.ajaxSettings.flatOptions || {};\r\n\r\n\tfor ( key in src ) {\r\n\t\tif ( src[ key ] !== undefined ) {\r\n\t\t\t( flatOptions[ key ] ? target : ( deep || (deep = {}) ) )[ key ] = src[ key ];\r\n\t\t}\r\n\t}\r\n\tif ( deep ) {\r\n\t\tjQuery.extend( true, target, deep );\r\n\t}\r\n\r\n\treturn target;\r\n}\r\n\r\n/* Handles responses to an ajax request:\r\n * - finds the right dataType (mediates between content-type and expected dataType)\r\n * - returns the corresponding response\r\n */\r\nfunction ajaxHandleResponses( s, jqXHR, responses ) {\r\n\r\n\tvar ct, type, finalDataType, firstDataType,\r\n\t\tcontents = s.contents,\r\n\t\tdataTypes = s.dataTypes;\r\n\r\n\t// Remove auto dataType and get content-type in the process\r\n\twhile ( dataTypes[ 0 ] === \"*\" ) {\r\n\t\tdataTypes.shift();\r\n\t\tif ( ct === undefined ) {\r\n\t\t\tct = s.mimeType || jqXHR.getResponseHeader(\"Content-Type\");\r\n\t\t}\r\n\t}\r\n\r\n\t// Check if we're dealing with a known content-type\r\n\tif ( ct ) {\r\n\t\tfor ( type in contents ) {\r\n\t\t\tif ( contents[ type ] && contents[ type ].test( ct ) ) {\r\n\t\t\t\tdataTypes.unshift( type );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Check to see if we have a response for the expected dataType\r\n\tif ( dataTypes[ 0 ] in responses ) {\r\n\t\tfinalDataType = dataTypes[ 0 ];\r\n\t} else {\r\n\t\t// Try convertible dataTypes\r\n\t\tfor ( type in responses ) {\r\n\t\t\tif ( !dataTypes[ 0 ] || s.converters[ type + \" \" + dataTypes[0] ] ) {\r\n\t\t\t\tfinalDataType = type;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ( !firstDataType ) {\r\n\t\t\t\tfirstDataType = type;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Or just use first one\r\n\t\tfinalDataType = finalDataType || firstDataType;\r\n\t}\r\n\r\n\t// If we found a dataType\r\n\t// We add the dataType to the list if needed\r\n\t// and return the corresponding response\r\n\tif ( finalDataType ) {\r\n\t\tif ( finalDataType !== dataTypes[ 0 ] ) {\r\n\t\t\tdataTypes.unshift( finalDataType );\r\n\t\t}\r\n\t\treturn responses[ finalDataType ];\r\n\t}\r\n}\r\n\r\n/* Chain conversions given the request and the original response\r\n * Also sets the responseXXX fields on the jqXHR instance\r\n */\r\nfunction ajaxConvert( s, response, jqXHR, isSuccess ) {\r\n\tvar conv2, current, conv, tmp, prev,\r\n\t\tconverters = {},\r\n\t\t// Work with a copy of dataTypes in case we need to modify it for conversion\r\n\t\tdataTypes = s.dataTypes.slice();\r\n\r\n\t// Create converters map with lowercased keys\r\n\tif ( dataTypes[ 1 ] ) {\r\n\t\tfor ( conv in s.converters ) {\r\n\t\t\tconverters[ conv.toLowerCase() ] = s.converters[ conv ];\r\n\t\t}\r\n\t}\r\n\r\n\tcurrent = dataTypes.shift();\r\n\r\n\t// Convert to each sequential dataType\r\n\twhile ( current ) {\r\n\r\n\t\tif ( s.responseFields[ current ] ) {\r\n\t\t\tjqXHR[ s.responseFields[ current ] ] = response;\r\n\t\t}\r\n\r\n\t\t// Apply the dataFilter if provided\r\n\t\tif ( !prev && isSuccess && s.dataFilter ) {\r\n\t\t\tresponse = s.dataFilter( response, s.dataType );\r\n\t\t}\r\n\r\n\t\tprev = current;\r\n\t\tcurrent = dataTypes.shift();\r\n\r\n\t\tif ( current ) {\r\n\r\n\t\t// There's only work to do if current dataType is non-auto\r\n\t\t\tif ( current === \"*\" ) {\r\n\r\n\t\t\t\tcurrent = prev;\r\n\r\n\t\t\t// Convert response if prev dataType is non-auto and differs from current\r\n\t\t\t} else if ( prev !== \"*\" && prev !== current ) {\r\n\r\n\t\t\t\t// Seek a direct converter\r\n\t\t\t\tconv = converters[ prev + \" \" + current ] || converters[ \"* \" + current ];\r\n\r\n\t\t\t\t// If none found, seek a pair\r\n\t\t\t\tif ( !conv ) {\r\n\t\t\t\t\tfor ( conv2 in converters ) {\r\n\r\n\t\t\t\t\t\t// If conv2 outputs current\r\n\t\t\t\t\t\ttmp = conv2.split( \" \" );\r\n\t\t\t\t\t\tif ( tmp[ 1 ] === current ) {\r\n\r\n\t\t\t\t\t\t\t// If prev can be converted to accepted input\r\n\t\t\t\t\t\t\tconv = converters[ prev + \" \" + tmp[ 0 ] ] ||\r\n\t\t\t\t\t\t\t\tconverters[ \"* \" + tmp[ 0 ] ];\r\n\t\t\t\t\t\t\tif ( conv ) {\r\n\t\t\t\t\t\t\t\t// Condense equivalence converters\r\n\t\t\t\t\t\t\t\tif ( conv === true ) {\r\n\t\t\t\t\t\t\t\t\tconv = converters[ conv2 ];\r\n\r\n\t\t\t\t\t\t\t\t// Otherwise, insert the intermediate dataType\r\n\t\t\t\t\t\t\t\t} else if ( converters[ conv2 ] !== true ) {\r\n\t\t\t\t\t\t\t\t\tcurrent = tmp[ 0 ];\r\n\t\t\t\t\t\t\t\t\tdataTypes.unshift( tmp[ 1 ] );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Apply converter (if not an equivalence)\r\n\t\t\t\tif ( conv !== true ) {\r\n\r\n\t\t\t\t\t// Unless errors are allowed to bubble, catch and return them\r\n\t\t\t\t\tif ( conv && s[ \"throws\" ] ) {\r\n\t\t\t\t\t\tresponse = conv( response );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tresponse = conv( response );\r\n\t\t\t\t\t\t} catch ( e ) {\r\n\t\t\t\t\t\t\treturn { state: \"parsererror\", error: conv ? e : \"No conversion from \" + prev + \" to \" + current };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn { state: \"success\", data: response };\r\n}\r\n\r\njQuery.extend({\r\n\r\n\t// Counter for holding the number of active queries\r\n\tactive: 0,\r\n\r\n\t// Last-Modified header cache for next request\r\n\tlastModified: {},\r\n\tetag: {},\r\n\r\n\tajaxSettings: {\r\n\t\turl: ajaxLocation,\r\n\t\ttype: \"GET\",\r\n\t\tisLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),\r\n\t\tglobal: true,\r\n\t\tprocessData: true,\r\n\t\tasync: true,\r\n\t\tcontentType: \"application/x-www-form-urlencoded; charset=UTF-8\",\r\n\t\t/*\r\n\t\ttimeout: 0,\r\n\t\tdata: null,\r\n\t\tdataType: null,\r\n\t\tusername: null,\r\n\t\tpassword: null,\r\n\t\tcache: null,\r\n\t\tthrows: false,\r\n\t\ttraditional: false,\r\n\t\theaders: {},\r\n\t\t*/\r\n\r\n\t\taccepts: {\r\n\t\t\t\"*\": allTypes,\r\n\t\t\ttext: \"text/plain\",\r\n\t\t\thtml: \"text/html\",\r\n\t\t\txml: \"application/xml, text/xml\",\r\n\t\t\tjson: \"application/json, text/javascript\"\r\n\t\t},\r\n\r\n\t\tcontents: {\r\n\t\t\txml: /xml/,\r\n\t\t\thtml: /html/,\r\n\t\t\tjson: /json/\r\n\t\t},\r\n\r\n\t\tresponseFields: {\r\n\t\t\txml: \"responseXML\",\r\n\t\t\ttext: \"responseText\",\r\n\t\t\tjson: \"responseJSON\"\r\n\t\t},\r\n\r\n\t\t// Data converters\r\n\t\t// Keys separate source (or catchall \"*\") and destination types with a single space\r\n\t\tconverters: {\r\n\r\n\t\t\t// Convert anything to text\r\n\t\t\t\"* text\": String,\r\n\r\n\t\t\t// Text to html (true = no transformation)\r\n\t\t\t\"text html\": true,\r\n\r\n\t\t\t// Evaluate text as a json expression\r\n\t\t\t\"text json\": jQuery.parseJSON,\r\n\r\n\t\t\t// Parse text as xml\r\n\t\t\t\"text xml\": jQuery.parseXML\r\n\t\t},\r\n\r\n\t\t// For options that shouldn't be deep extended:\r\n\t\t// you can add your own custom options here if\r\n\t\t// and when you create one that shouldn't be\r\n\t\t// deep extended (see ajaxExtend)\r\n\t\tflatOptions: {\r\n\t\t\turl: true,\r\n\t\t\tcontext: true\r\n\t\t}\r\n\t},\r\n\r\n\t// Creates a full fledged settings object into target\r\n\t// with both ajaxSettings and settings fields.\r\n\t// If target is omitted, writes into ajaxSettings.\r\n\tajaxSetup: function( target, settings ) {\r\n\t\treturn settings ?\r\n\r\n\t\t\t// Building a settings object\r\n\t\t\tajaxExtend( ajaxExtend( target, jQuery.ajaxSettings ), settings ) :\r\n\r\n\t\t\t// Extending ajaxSettings\r\n\t\t\tajaxExtend( jQuery.ajaxSettings, target );\r\n\t},\r\n\r\n\tajaxPrefilter: addToPrefiltersOrTransports( prefilters ),\r\n\tajaxTransport: addToPrefiltersOrTransports( transports ),\r\n\r\n\t// Main method\r\n\tajax: function( url, options ) {\r\n\r\n\t\t// If url is an object, simulate pre-1.5 signature\r\n\t\tif ( typeof url === \"object\" ) {\r\n\t\t\toptions = url;\r\n\t\t\turl = undefined;\r\n\t\t}\r\n\r\n\t\t// Force options to be an object\r\n\t\toptions = options || {};\r\n\r\n\t\tvar transport,\r\n\t\t\t// URL without anti-cache param\r\n\t\t\tcacheURL,\r\n\t\t\t// Response headers\r\n\t\t\tresponseHeadersString,\r\n\t\t\tresponseHeaders,\r\n\t\t\t// timeout handle\r\n\t\t\ttimeoutTimer,\r\n\t\t\t// Cross-domain detection vars\r\n\t\t\tparts,\r\n\t\t\t// To know if global events are to be dispatched\r\n\t\t\tfireGlobals,\r\n\t\t\t// Loop variable\r\n\t\t\ti,\r\n\t\t\t// Create the final options object\r\n\t\t\ts = jQuery.ajaxSetup( {}, options ),\r\n\t\t\t// Callbacks context\r\n\t\t\tcallbackContext = s.context || s,\r\n\t\t\t// Context for global events is callbackContext if it is a DOM node or jQuery collection\r\n\t\t\tglobalEventContext = s.context && ( callbackContext.nodeType || callbackContext.jquery ) ?\r\n\t\t\t\tjQuery( callbackContext ) :\r\n\t\t\t\tjQuery.event,\r\n\t\t\t// Deferreds\r\n\t\t\tdeferred = jQuery.Deferred(),\r\n\t\t\tcompleteDeferred = jQuery.Callbacks(\"once memory\"),\r\n\t\t\t// Status-dependent callbacks\r\n\t\t\tstatusCode = s.statusCode || {},\r\n\t\t\t// Headers (they are sent all at once)\r\n\t\t\trequestHeaders = {},\r\n\t\t\trequestHeadersNames = {},\r\n\t\t\t// The jqXHR state\r\n\t\t\tstate = 0,\r\n\t\t\t// Default abort message\r\n\t\t\tstrAbort = \"canceled\",\r\n\t\t\t// Fake xhr\r\n\t\t\tjqXHR = {\r\n\t\t\t\treadyState: 0,\r\n\r\n\t\t\t\t// Builds headers hashtable if needed\r\n\t\t\t\tgetResponseHeader: function( key ) {\r\n\t\t\t\t\tvar match;\r\n\t\t\t\t\tif ( state === 2 ) {\r\n\t\t\t\t\t\tif ( !responseHeaders ) {\r\n\t\t\t\t\t\t\tresponseHeaders = {};\r\n\t\t\t\t\t\t\twhile ( (match = rheaders.exec( responseHeadersString )) ) {\r\n\t\t\t\t\t\t\t\tresponseHeaders[ match[1].toLowerCase() ] = match[ 2 ];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmatch = responseHeaders[ key.toLowerCase() ];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn match == null ? null : match;\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Raw string\r\n\t\t\t\tgetAllResponseHeaders: function() {\r\n\t\t\t\t\treturn state === 2 ? responseHeadersString : null;\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Caches the header\r\n\t\t\t\tsetRequestHeader: function( name, value ) {\r\n\t\t\t\t\tvar lname = name.toLowerCase();\r\n\t\t\t\t\tif ( !state ) {\r\n\t\t\t\t\t\tname = requestHeadersNames[ lname ] = requestHeadersNames[ lname ] || name;\r\n\t\t\t\t\t\trequestHeaders[ name ] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Overrides response content-type header\r\n\t\t\t\toverrideMimeType: function( type ) {\r\n\t\t\t\t\tif ( !state ) {\r\n\t\t\t\t\t\ts.mimeType = type;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Status-dependent callbacks\r\n\t\t\t\tstatusCode: function( map ) {\r\n\t\t\t\t\tvar code;\r\n\t\t\t\t\tif ( map ) {\r\n\t\t\t\t\t\tif ( state < 2 ) {\r\n\t\t\t\t\t\t\tfor ( code in map ) {\r\n\t\t\t\t\t\t\t\t// Lazy-add the new callback in a way that preserves old ones\r\n\t\t\t\t\t\t\t\tstatusCode[ code ] = [ statusCode[ code ], map[ code ] ];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Execute the appropriate callbacks\r\n\t\t\t\t\t\t\tjqXHR.always( map[ jqXHR.status ] );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// Cancel the request\r\n\t\t\t\tabort: function( statusText ) {\r\n\t\t\t\t\tvar finalText = statusText || strAbort;\r\n\t\t\t\t\tif ( transport ) {\r\n\t\t\t\t\t\ttransport.abort( finalText );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdone( 0, finalText );\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t// Attach deferreds\r\n\t\tdeferred.promise( jqXHR ).complete = completeDeferred.add;\r\n\t\tjqXHR.success = jqXHR.done;\r\n\t\tjqXHR.error = jqXHR.fail;\r\n\r\n\t\t// Remove hash character (#7531: and string promotion)\r\n\t\t// Add protocol if not provided (prefilters might expect it)\r\n\t\t// Handle falsy url in the settings object (#10093: consistency with old signature)\r\n\t\t// We also use the url parameter if available\r\n\t\ts.url = ( ( url || s.url || ajaxLocation ) + \"\" ).replace( rhash, \"\" )\r\n\t\t\t.replace( rprotocol, ajaxLocParts[ 1 ] + \"//\" );\r\n\r\n\t\t// Alias method option to type as per ticket #12004\r\n\t\ts.type = options.method || options.type || s.method || s.type;\r\n\r\n\t\t// Extract dataTypes list\r\n\t\ts.dataTypes = jQuery.trim( s.dataType || \"*\" ).toLowerCase().match( rnotwhite ) || [ \"\" ];\r\n\r\n\t\t// A cross-domain request is in order when we have a protocol:host:port mismatch\r\n\t\tif ( s.crossDomain == null ) {\r\n\t\t\tparts = rurl.exec( s.url.toLowerCase() );\r\n\t\t\ts.crossDomain = !!( parts &&\r\n\t\t\t\t( parts[ 1 ] !== ajaxLocParts[ 1 ] || parts[ 2 ] !== ajaxLocParts[ 2 ] ||\r\n\t\t\t\t\t( parts[ 3 ] || ( parts[ 1 ] === \"http:\" ? \"80\" : \"443\" ) ) !==\r\n\t\t\t\t\t\t( ajaxLocParts[ 3 ] || ( ajaxLocParts[ 1 ] === \"http:\" ? \"80\" : \"443\" ) ) )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Convert data if not already a string\r\n\t\tif ( s.data && s.processData && typeof s.data !== \"string\" ) {\r\n\t\t\ts.data = jQuery.param( s.data, s.traditional );\r\n\t\t}\r\n\r\n\t\t// Apply prefilters\r\n\t\tinspectPrefiltersOrTransports( prefilters, s, options, jqXHR );\r\n\r\n\t\t// If request was aborted inside a prefilter, stop there\r\n\t\tif ( state === 2 ) {\r\n\t\t\treturn jqXHR;\r\n\t\t}\r\n\r\n\t\t// We can fire global events as of now if asked to\r\n\t\t// Don't fire events if jQuery.event is undefined in an AMD-usage scenario (#15118)\r\n\t\tfireGlobals = jQuery.event && s.global;\r\n\r\n\t\t// Watch for a new set of requests\r\n\t\tif ( fireGlobals && jQuery.active++ === 0 ) {\r\n\t\t\tjQuery.event.trigger(\"ajaxStart\");\r\n\t\t}\r\n\r\n\t\t// Uppercase the type\r\n\t\ts.type = s.type.toUpperCase();\r\n\r\n\t\t// Determine if request has content\r\n\t\ts.hasContent = !rnoContent.test( s.type );\r\n\r\n\t\t// Save the URL in case we're toying with the If-Modified-Since\r\n\t\t// and/or If-None-Match header later on\r\n\t\tcacheURL = s.url;\r\n\r\n\t\t// More options handling for requests with no content\r\n\t\tif ( !s.hasContent ) {\r\n\r\n\t\t\t// If data is available, append data to url\r\n\t\t\tif ( s.data ) {\r\n\t\t\t\tcacheURL = ( s.url += ( rquery.test( cacheURL ) ? \"&\" : \"?\" ) + s.data );\r\n\t\t\t\t// #9682: remove data so that it's not used in an eventual retry\r\n\t\t\t\tdelete s.data;\r\n\t\t\t}\r\n\r\n\t\t\t// Add anti-cache in url if needed\r\n\t\t\tif ( s.cache === false ) {\r\n\t\t\t\ts.url = rts.test( cacheURL ) ?\r\n\r\n\t\t\t\t\t// If there is already a '_' parameter, set its value\r\n\t\t\t\t\tcacheURL.replace( rts, \"$1_=\" + nonce++ ) :\r\n\r\n\t\t\t\t\t// Otherwise add one to the end\r\n\t\t\t\t\tcacheURL + ( rquery.test( cacheURL ) ? \"&\" : \"?\" ) + \"_=\" + nonce++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.\r\n\t\tif ( s.ifModified ) {\r\n\t\t\tif ( jQuery.lastModified[ cacheURL ] ) {\r\n\t\t\t\tjqXHR.setRequestHeader( \"If-Modified-Since\", jQuery.lastModified[ cacheURL ] );\r\n\t\t\t}\r\n\t\t\tif ( jQuery.etag[ cacheURL ] ) {\r\n\t\t\t\tjqXHR.setRequestHeader( \"If-None-Match\", jQuery.etag[ cacheURL ] );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set the correct header, if data is being sent\r\n\t\tif ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {\r\n\t\t\tjqXHR.setRequestHeader( \"Content-Type\", s.contentType );\r\n\t\t}\r\n\r\n\t\t// Set the Accepts header for the server, depending on the dataType\r\n\t\tjqXHR.setRequestHeader(\r\n\t\t\t\"Accept\",\r\n\t\t\ts.dataTypes[ 0 ] && s.accepts[ s.dataTypes[0] ] ?\r\n\t\t\t\ts.accepts[ s.dataTypes[0] ] + ( s.dataTypes[ 0 ] !== \"*\" ? \", \" + allTypes + \"; q=0.01\" : \"\" ) :\r\n\t\t\t\ts.accepts[ \"*\" ]\r\n\t\t);\r\n\r\n\t\t// Check for headers option\r\n\t\tfor ( i in s.headers ) {\r\n\t\t\tjqXHR.setRequestHeader( i, s.headers[ i ] );\r\n\t\t}\r\n\r\n\t\t// Allow custom headers/mimetypes and early abort\r\n\t\tif ( s.beforeSend && ( s.beforeSend.call( callbackContext, jqXHR, s ) === false || state === 2 ) ) {\r\n\t\t\t// Abort if not done already and return\r\n\t\t\treturn jqXHR.abort();\r\n\t\t}\r\n\r\n\t\t// Aborting is no longer a cancellation\r\n\t\tstrAbort = \"abort\";\r\n\r\n\t\t// Install callbacks on deferreds\r\n\t\tfor ( i in { success: 1, error: 1, complete: 1 } ) {\r\n\t\t\tjqXHR[ i ]( s[ i ] );\r\n\t\t}\r\n\r\n\t\t// Get transport\r\n\t\ttransport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );\r\n\r\n\t\t// If no transport, we auto-abort\r\n\t\tif ( !transport ) {\r\n\t\t\tdone( -1, \"No Transport\" );\r\n\t\t} else {\r\n\t\t\tjqXHR.readyState = 1;\r\n\r\n\t\t\t// Send global event\r\n\t\t\tif ( fireGlobals ) {\r\n\t\t\t\tglobalEventContext.trigger( \"ajaxSend\", [ jqXHR, s ] );\r\n\t\t\t}\r\n\t\t\t// Timeout\r\n\t\t\tif ( s.async && s.timeout > 0 ) {\r\n\t\t\t\ttimeoutTimer = setTimeout(function() {\r\n\t\t\t\t\tjqXHR.abort(\"timeout\");\r\n\t\t\t\t}, s.timeout );\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tstate = 1;\r\n\t\t\t\ttransport.send( requestHeaders, done );\r\n\t\t\t} catch ( e ) {\r\n\t\t\t\t// Propagate exception as error if not done\r\n\t\t\t\tif ( state < 2 ) {\r\n\t\t\t\t\tdone( -1, e );\r\n\t\t\t\t// Simply rethrow otherwise\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Callback for when everything is done\r\n\t\tfunction done( status, nativeStatusText, responses, headers ) {\r\n\t\t\tvar isSuccess, success, error, response, modified,\r\n\t\t\t\tstatusText = nativeStatusText;\r\n\r\n\t\t\t// Called once\r\n\t\t\tif ( state === 2 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// State is \"done\" now\r\n\t\t\tstate = 2;\r\n\r\n\t\t\t// Clear timeout if it exists\r\n\t\t\tif ( timeoutTimer ) {\r\n\t\t\t\tclearTimeout( timeoutTimer );\r\n\t\t\t}\r\n\r\n\t\t\t// Dereference transport for early garbage collection\r\n\t\t\t// (no matter how long the jqXHR object will be used)\r\n\t\t\ttransport = undefined;\r\n\r\n\t\t\t// Cache response headers\r\n\t\t\tresponseHeadersString = headers || \"\";\r\n\r\n\t\t\t// Set readyState\r\n\t\t\tjqXHR.readyState = status > 0 ? 4 : 0;\r\n\r\n\t\t\t// Determine if successful\r\n\t\t\tisSuccess = status >= 200 && status < 300 || status === 304;\r\n\r\n\t\t\t// Get response data\r\n\t\t\tif ( responses ) {\r\n\t\t\t\tresponse = ajaxHandleResponses( s, jqXHR, responses );\r\n\t\t\t}\r\n\r\n\t\t\t// Convert no matter what (that way responseXXX fields are always set)\r\n\t\t\tresponse = ajaxConvert( s, response, jqXHR, isSuccess );\r\n\r\n\t\t\t// If successful, handle type chaining\r\n\t\t\tif ( isSuccess ) {\r\n\r\n\t\t\t\t// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.\r\n\t\t\t\tif ( s.ifModified ) {\r\n\t\t\t\t\tmodified = jqXHR.getResponseHeader(\"Last-Modified\");\r\n\t\t\t\t\tif ( modified ) {\r\n\t\t\t\t\t\tjQuery.lastModified[ cacheURL ] = modified;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmodified = jqXHR.getResponseHeader(\"etag\");\r\n\t\t\t\t\tif ( modified ) {\r\n\t\t\t\t\t\tjQuery.etag[ cacheURL ] = modified;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if no content\r\n\t\t\t\tif ( status === 204 || s.type === \"HEAD\" ) {\r\n\t\t\t\t\tstatusText = \"nocontent\";\r\n\r\n\t\t\t\t// if not modified\r\n\t\t\t\t} else if ( status === 304 ) {\r\n\t\t\t\t\tstatusText = \"notmodified\";\r\n\r\n\t\t\t\t// If we have data, let's convert it\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstatusText = response.state;\r\n\t\t\t\t\tsuccess = response.data;\r\n\t\t\t\t\terror = response.error;\r\n\t\t\t\t\tisSuccess = !error;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Extract error from statusText and normalize for non-aborts\r\n\t\t\t\terror = statusText;\r\n\t\t\t\tif ( status || !statusText ) {\r\n\t\t\t\t\tstatusText = \"error\";\r\n\t\t\t\t\tif ( status < 0 ) {\r\n\t\t\t\t\t\tstatus = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set data for the fake xhr object\r\n\t\t\tjqXHR.status = status;\r\n\t\t\tjqXHR.statusText = ( nativeStatusText || statusText ) + \"\";\r\n\r\n\t\t\t// Success/Error\r\n\t\t\tif ( isSuccess ) {\r\n\t\t\t\tdeferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );\r\n\t\t\t} else {\r\n\t\t\t\tdeferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );\r\n\t\t\t}\r\n\r\n\t\t\t// Status-dependent callbacks\r\n\t\t\tjqXHR.statusCode( statusCode );\r\n\t\t\tstatusCode = undefined;\r\n\r\n\t\t\tif ( fireGlobals ) {\r\n\t\t\t\tglobalEventContext.trigger( isSuccess ? \"ajaxSuccess\" : \"ajaxError\",\r\n\t\t\t\t\t[ jqXHR, s, isSuccess ? success : error ] );\r\n\t\t\t}\r\n\r\n\t\t\t// Complete\r\n\t\t\tcompleteDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );\r\n\r\n\t\t\tif ( fireGlobals ) {\r\n\t\t\t\tglobalEventContext.trigger( \"ajaxComplete\", [ jqXHR, s ] );\r\n\t\t\t\t// Handle the global AJAX counter\r\n\t\t\t\tif ( !( --jQuery.active ) ) {\r\n\t\t\t\t\tjQuery.event.trigger(\"ajaxStop\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn jqXHR;\r\n\t},\r\n\r\n\tgetJSON: function( url, data, callback ) {\r\n\t\treturn jQuery.get( url, data, callback, \"json\" );\r\n\t},\r\n\r\n\tgetScript: function( url, callback ) {\r\n\t\treturn jQuery.get( url, undefined, callback, \"script\" );\r\n\t}\r\n});\r\n\r\njQuery.each( [ \"get\", \"post\" ], function( i, method ) {\r\n\tjQuery[ method ] = function( url, data, callback, type ) {\r\n\t\t// Shift arguments if data argument was omitted\r\n\t\tif ( jQuery.isFunction( data ) ) {\r\n\t\t\ttype = type || callback;\r\n\t\t\tcallback = data;\r\n\t\t\tdata = undefined;\r\n\t\t}\r\n\r\n\t\treturn jQuery.ajax({\r\n\t\t\turl: url,\r\n\t\t\ttype: method,\r\n\t\t\tdataType: type,\r\n\t\t\tdata: data,\r\n\t\t\tsuccess: callback\r\n\t\t});\r\n\t};\r\n});\r\n\r\n\r\njQuery._evalUrl = function( url ) {\r\n\treturn jQuery.ajax({\r\n\t\turl: url,\r\n\t\ttype: \"GET\",\r\n\t\tdataType: \"script\",\r\n\t\tasync: false,\r\n\t\tglobal: false,\r\n\t\t\"throws\": true\r\n\t});\r\n};\r\n\r\n\r\njQuery.fn.extend({\r\n\twrapAll: function( html ) {\r\n\t\tvar wrap;\r\n\r\n\t\tif ( jQuery.isFunction( html ) ) {\r\n\t\t\treturn this.each(function( i ) {\r\n\t\t\t\tjQuery( this ).wrapAll( html.call(this, i) );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif ( this[ 0 ] ) {\r\n\r\n\t\t\t// The elements to wrap the target around\r\n\t\t\twrap = jQuery( html, this[ 0 ].ownerDocument ).eq( 0 ).clone( true );\r\n\r\n\t\t\tif ( this[ 0 ].parentNode ) {\r\n\t\t\t\twrap.insertBefore( this[ 0 ] );\r\n\t\t\t}\r\n\r\n\t\t\twrap.map(function() {\r\n\t\t\t\tvar elem = this;\r\n\r\n\t\t\t\twhile ( elem.firstElementChild ) {\r\n\t\t\t\t\telem = elem.firstElementChild;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn elem;\r\n\t\t\t}).append( this );\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\twrapInner: function( html ) {\r\n\t\tif ( jQuery.isFunction( html ) ) {\r\n\t\t\treturn this.each(function( i ) {\r\n\t\t\t\tjQuery( this ).wrapInner( html.call(this, i) );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.each(function() {\r\n\t\t\tvar self = jQuery( this ),\r\n\t\t\t\tcontents = self.contents();\r\n\r\n\t\t\tif ( contents.length ) {\r\n\t\t\t\tcontents.wrapAll( html );\r\n\r\n\t\t\t} else {\r\n\t\t\t\tself.append( html );\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\twrap: function( html ) {\r\n\t\tvar isFunction = jQuery.isFunction( html );\r\n\r\n\t\treturn this.each(function( i ) {\r\n\t\t\tjQuery( this ).wrapAll( isFunction ? html.call(this, i) : html );\r\n\t\t});\r\n\t},\r\n\r\n\tunwrap: function() {\r\n\t\treturn this.parent().each(function() {\r\n\t\t\tif ( !jQuery.nodeName( this, \"body\" ) ) {\r\n\t\t\t\tjQuery( this ).replaceWith( this.childNodes );\r\n\t\t\t}\r\n\t\t}).end();\r\n\t}\r\n});\r\n\r\n\r\njQuery.expr.filters.hidden = function( elem ) {\r\n\t// Support: Opera <= 12.12\r\n\t// Opera reports offsetWidths and offsetHeights less than zero on some elements\r\n\treturn elem.offsetWidth <= 0 && elem.offsetHeight <= 0;\r\n};\r\njQuery.expr.filters.visible = function( elem ) {\r\n\treturn !jQuery.expr.filters.hidden( elem );\r\n};\r\n\r\n\r\n\r\n\r\nvar r20 = /%20/g,\r\n\trbracket = /\\[\\]$/,\r\n\trCRLF = /\\r?\\n/g,\r\n\trsubmitterTypes = /^(?:submit|button|image|reset|file)$/i,\r\n\trsubmittable = /^(?:input|select|textarea|keygen)/i;\r\n\r\nfunction buildParams( prefix, obj, traditional, add ) {\r\n\tvar name;\r\n\r\n\tif ( jQuery.isArray( obj ) ) {\r\n\t\t// Serialize array item.\r\n\t\tjQuery.each( obj, function( i, v ) {\r\n\t\t\tif ( traditional || rbracket.test( prefix ) ) {\r\n\t\t\t\t// Treat each array item as a scalar.\r\n\t\t\t\tadd( prefix, v );\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// Item is non-scalar (array or object), encode its numeric index.\r\n\t\t\t\tbuildParams( prefix + \"[\" + ( typeof v === \"object\" ? i : \"\" ) + \"]\", v, traditional, add );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t} else if ( !traditional && jQuery.type( obj ) === \"object\" ) {\r\n\t\t// Serialize object item.\r\n\t\tfor ( name in obj ) {\r\n\t\t\tbuildParams( prefix + \"[\" + name + \"]\", obj[ name ], traditional, add );\r\n\t\t}\r\n\r\n\t} else {\r\n\t\t// Serialize scalar item.\r\n\t\tadd( prefix, obj );\r\n\t}\r\n}\r\n\r\n// Serialize an array of form elements or a set of\r\n// key/values into a query string\r\njQuery.param = function( a, traditional ) {\r\n\tvar prefix,\r\n\t\ts = [],\r\n\t\tadd = function( key, value ) {\r\n\t\t\t// If value is a function, invoke it and return its value\r\n\t\t\tvalue = jQuery.isFunction( value ) ? value() : ( value == null ? \"\" : value );\r\n\t\t\ts[ s.length ] = encodeURIComponent( key ) + \"=\" + encodeURIComponent( value );\r\n\t\t};\r\n\r\n\t// Set traditional to true for jQuery <= 1.3.2 behavior.\r\n\tif ( traditional === undefined ) {\r\n\t\ttraditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;\r\n\t}\r\n\r\n\t// If an array was passed in, assume that it is an array of form elements.\r\n\tif ( jQuery.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {\r\n\t\t// Serialize the form elements\r\n\t\tjQuery.each( a, function() {\r\n\t\t\tadd( this.name, this.value );\r\n\t\t});\r\n\r\n\t} else {\r\n\t\t// If traditional, encode the \"old\" way (the way 1.3.2 or older\r\n\t\t// did it), otherwise encode params recursively.\r\n\t\tfor ( prefix in a ) {\r\n\t\t\tbuildParams( prefix, a[ prefix ], traditional, add );\r\n\t\t}\r\n\t}\r\n\r\n\t// Return the resulting serialization\r\n\treturn s.join( \"&\" ).replace( r20, \"+\" );\r\n};\r\n\r\njQuery.fn.extend({\r\n\tserialize: function() {\r\n\t\treturn jQuery.param( this.serializeArray() );\r\n\t},\r\n\tserializeArray: function() {\r\n\t\treturn this.map(function() {\r\n\t\t\t// Can add propHook for \"elements\" to filter or add form elements\r\n\t\t\tvar elements = jQuery.prop( this, \"elements\" );\r\n\t\t\treturn elements ? jQuery.makeArray( elements ) : this;\r\n\t\t})\r\n\t\t.filter(function() {\r\n\t\t\tvar type = this.type;\r\n\r\n\t\t\t// Use .is( \":disabled\" ) so that fieldset[disabled] works\r\n\t\t\treturn this.name && !jQuery( this ).is( \":disabled\" ) &&\r\n\t\t\t\trsubmittable.test( this.nodeName ) && !rsubmitterTypes.test( type ) &&\r\n\t\t\t\t( this.checked || !rcheckableType.test( type ) );\r\n\t\t})\r\n\t\t.map(function( i, elem ) {\r\n\t\t\tvar val = jQuery( this ).val();\r\n\r\n\t\t\treturn val == null ?\r\n\t\t\t\tnull :\r\n\t\t\t\tjQuery.isArray( val ) ?\r\n\t\t\t\t\tjQuery.map( val, function( val ) {\r\n\t\t\t\t\t\treturn { name: elem.name, value: val.replace( rCRLF, \"\\r\\n\" ) };\r\n\t\t\t\t\t}) :\r\n\t\t\t\t\t{ name: elem.name, value: val.replace( rCRLF, \"\\r\\n\" ) };\r\n\t\t}).get();\r\n\t}\r\n});\r\n\r\n\r\njQuery.ajaxSettings.xhr = function() {\r\n\ttry {\r\n\t\treturn new XMLHttpRequest();\r\n\t} catch( e ) {}\r\n};\r\n\r\nvar xhrId = 0,\r\n\txhrCallbacks = {},\r\n\txhrSuccessStatus = {\r\n\t\t// file protocol always yields status code 0, assume 200\r\n\t\t0: 200,\r\n\t\t// Support: IE9\r\n\t\t// #1450: sometimes IE returns 1223 when it should be 204\r\n\t\t1223: 204\r\n\t},\r\n\txhrSupported = jQuery.ajaxSettings.xhr();\r\n\r\n// Support: IE9\r\n// Open requests must be manually aborted on unload (#5280)\r\n// See https://support.microsoft.com/kb/2856746 for more info\r\nif ( window.attachEvent ) {\r\n\twindow.attachEvent( \"onunload\", function() {\r\n\t\tfor ( var key in xhrCallbacks ) {\r\n\t\t\txhrCallbacks[ key ]();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nsupport.cors = !!xhrSupported && ( \"withCredentials\" in xhrSupported );\r\nsupport.ajax = xhrSupported = !!xhrSupported;\r\n\r\njQuery.ajaxTransport(function( options ) {\r\n\tvar callback;\r\n\r\n\t// Cross domain only allowed if supported through XMLHttpRequest\r\n\tif ( support.cors || xhrSupported && !options.crossDomain ) {\r\n\t\treturn {\r\n\t\t\tsend: function( headers, complete ) {\r\n\t\t\t\tvar i,\r\n\t\t\t\t\txhr = options.xhr(),\r\n\t\t\t\t\tid = ++xhrId;\r\n\r\n\t\t\t\txhr.open( options.type, options.url, options.async, options.username, options.password );\r\n\r\n\t\t\t\t// Apply custom fields if provided\r\n\t\t\t\tif ( options.xhrFields ) {\r\n\t\t\t\t\tfor ( i in options.xhrFields ) {\r\n\t\t\t\t\t\txhr[ i ] = options.xhrFields[ i ];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Override mime type if needed\r\n\t\t\t\tif ( options.mimeType && xhr.overrideMimeType ) {\r\n\t\t\t\t\txhr.overrideMimeType( options.mimeType );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// X-Requested-With header\r\n\t\t\t\t// For cross-domain requests, seeing as conditions for a preflight are\r\n\t\t\t\t// akin to a jigsaw puzzle, we simply never set it to be sure.\r\n\t\t\t\t// (it can always be set on a per-request basis or even using ajaxSetup)\r\n\t\t\t\t// For same-domain requests, won't change header if already provided.\r\n\t\t\t\tif ( !options.crossDomain && !headers[\"X-Requested-With\"] ) {\r\n\t\t\t\t\theaders[\"X-Requested-With\"] = \"XMLHttpRequest\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set headers\r\n\t\t\t\tfor ( i in headers ) {\r\n\t\t\t\t\txhr.setRequestHeader( i, headers[ i ] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Callback\r\n\t\t\t\tcallback = function( type ) {\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\tif ( callback ) {\r\n\t\t\t\t\t\t\tdelete xhrCallbacks[ id ];\r\n\t\t\t\t\t\t\tcallback = xhr.onload = xhr.onerror = null;\r\n\r\n\t\t\t\t\t\t\tif ( type === \"abort\" ) {\r\n\t\t\t\t\t\t\t\txhr.abort();\r\n\t\t\t\t\t\t\t} else if ( type === \"error\" ) {\r\n\t\t\t\t\t\t\t\tcomplete(\r\n\t\t\t\t\t\t\t\t\t// file: protocol always yields status 0; see #8605, #14207\r\n\t\t\t\t\t\t\t\t\txhr.status,\r\n\t\t\t\t\t\t\t\t\txhr.statusText\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcomplete(\r\n\t\t\t\t\t\t\t\t\txhrSuccessStatus[ xhr.status ] || xhr.status,\r\n\t\t\t\t\t\t\t\t\txhr.statusText,\r\n\t\t\t\t\t\t\t\t\t// Support: IE9\r\n\t\t\t\t\t\t\t\t\t// Accessing binary-data responseText throws an exception\r\n\t\t\t\t\t\t\t\t\t// (#11426)\r\n\t\t\t\t\t\t\t\t\ttypeof xhr.responseText === \"string\" ? {\r\n\t\t\t\t\t\t\t\t\t\ttext: xhr.responseText\r\n\t\t\t\t\t\t\t\t\t} : undefined,\r\n\t\t\t\t\t\t\t\t\txhr.getAllResponseHeaders()\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Listen to events\r\n\t\t\t\txhr.onload = callback();\r\n\t\t\t\txhr.onerror = callback(\"error\");\r\n\r\n\t\t\t\t// Create the abort callback\r\n\t\t\t\tcallback = xhrCallbacks[ id ] = callback(\"abort\");\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Do send the request (this may raise an exception)\r\n\t\t\t\t\txhr.send( options.hasContent && options.data || null );\r\n\t\t\t\t} catch ( e ) {\r\n\t\t\t\t\t// #14683: Only rethrow if this hasn't been notified as an error yet\r\n\t\t\t\t\tif ( callback ) {\r\n\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tabort: function() {\r\n\t\t\t\tif ( callback ) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n// Install script dataType\r\njQuery.ajaxSetup({\r\n\taccepts: {\r\n\t\tscript: \"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"\r\n\t},\r\n\tcontents: {\r\n\t\tscript: /(?:java|ecma)script/\r\n\t},\r\n\tconverters: {\r\n\t\t\"text script\": function( text ) {\r\n\t\t\tjQuery.globalEval( text );\r\n\t\t\treturn text;\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Handle cache's special case and crossDomain\r\njQuery.ajaxPrefilter( \"script\", function( s ) {\r\n\tif ( s.cache === undefined ) {\r\n\t\ts.cache = false;\r\n\t}\r\n\tif ( s.crossDomain ) {\r\n\t\ts.type = \"GET\";\r\n\t}\r\n});\r\n\r\n// Bind script tag hack transport\r\njQuery.ajaxTransport( \"script\", function( s ) {\r\n\t// This transport only deals with cross domain requests\r\n\tif ( s.crossDomain ) {\r\n\t\tvar script, callback;\r\n\t\treturn {\r\n\t\t\tsend: function( _, complete ) {\r\n\t\t\t\tscript = jQuery(\"<script>\").prop({\r\n\t\t\t\t\tasync: true,\r\n\t\t\t\t\tcharset: s.scriptCharset,\r\n\t\t\t\t\tsrc: s.url\r\n\t\t\t\t}).on(\r\n\t\t\t\t\t\"load error\",\r\n\t\t\t\t\tcallback = function( evt ) {\r\n\t\t\t\t\t\tscript.remove();\r\n\t\t\t\t\t\tcallback = null;\r\n\t\t\t\t\t\tif ( evt ) {\r\n\t\t\t\t\t\t\tcomplete( evt.type === \"error\" ? 404 : 200, evt.type );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tdocument.head.appendChild( script[ 0 ] );\r\n\t\t\t},\r\n\t\t\tabort: function() {\r\n\t\t\t\tif ( callback ) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\nvar oldCallbacks = [],\r\n\trjsonp = /(=)\\?(?=&|$)|\\?\\?/;\r\n\r\n// Default jsonp settings\r\njQuery.ajaxSetup({\r\n\tjsonp: \"callback\",\r\n\tjsonpCallback: function() {\r\n\t\tvar callback = oldCallbacks.pop() || ( jQuery.expando + \"_\" + ( nonce++ ) );\r\n\t\tthis[ callback ] = true;\r\n\t\treturn callback;\r\n\t}\r\n});\r\n\r\n// Detect, normalize options and install callbacks for jsonp requests\r\njQuery.ajaxPrefilter( \"json jsonp\", function( s, originalSettings, jqXHR ) {\r\n\r\n\tvar callbackName, overwritten, responseContainer,\r\n\t\tjsonProp = s.jsonp !== false && ( rjsonp.test( s.url ) ?\r\n\t\t\t\"url\" :\r\n\t\t\ttypeof s.data === \"string\" && !( s.contentType || \"\" ).indexOf(\"application/x-www-form-urlencoded\") && rjsonp.test( s.data ) && \"data\"\r\n\t\t);\r\n\r\n\t// Handle iff the expected data type is \"jsonp\" or we have a parameter to set\r\n\tif ( jsonProp || s.dataTypes[ 0 ] === \"jsonp\" ) {\r\n\r\n\t\t// Get callback name, remembering preexisting value associated with it\r\n\t\tcallbackName = s.jsonpCallback = jQuery.isFunction( s.jsonpCallback ) ?\r\n\t\t\ts.jsonpCallback() :\r\n\t\t\ts.jsonpCallback;\r\n\r\n\t\t// Insert callback into url or form data\r\n\t\tif ( jsonProp ) {\r\n\t\t\ts[ jsonProp ] = s[ jsonProp ].replace( rjsonp, \"$1\" + callbackName );\r\n\t\t} else if ( s.jsonp !== false ) {\r\n\t\t\ts.url += ( rquery.test( s.url ) ? \"&\" : \"?\" ) + s.jsonp + \"=\" + callbackName;\r\n\t\t}\r\n\r\n\t\t// Use data converter to retrieve json after script execution\r\n\t\ts.converters[\"script json\"] = function() {\r\n\t\t\tif ( !responseContainer ) {\r\n\t\t\t\tjQuery.error( callbackName + \" was not called\" );\r\n\t\t\t}\r\n\t\t\treturn responseContainer[ 0 ];\r\n\t\t};\r\n\r\n\t\t// force json dataType\r\n\t\ts.dataTypes[ 0 ] = \"json\";\r\n\r\n\t\t// Install callback\r\n\t\toverwritten = window[ callbackName ];\r\n\t\twindow[ callbackName ] = function() {\r\n\t\t\tresponseContainer = arguments;\r\n\t\t};\r\n\r\n\t\t// Clean-up function (fires after converters)\r\n\t\tjqXHR.always(function() {\r\n\t\t\t// Restore preexisting value\r\n\t\t\twindow[ callbackName ] = overwritten;\r\n\r\n\t\t\t// Save back as free\r\n\t\t\tif ( s[ callbackName ] ) {\r\n\t\t\t\t// make sure that re-using the options doesn't screw things around\r\n\t\t\t\ts.jsonpCallback = originalSettings.jsonpCallback;\r\n\r\n\t\t\t\t// save the callback name for future use\r\n\t\t\t\toldCallbacks.push( callbackName );\r\n\t\t\t}\r\n\r\n\t\t\t// Call if it was a function and we have a response\r\n\t\t\tif ( responseContainer && jQuery.isFunction( overwritten ) ) {\r\n\t\t\t\toverwritten( responseContainer[ 0 ] );\r\n\t\t\t}\r\n\r\n\t\t\tresponseContainer = overwritten = undefined;\r\n\t\t});\r\n\r\n\t\t// Delegate to script\r\n\t\treturn \"script\";\r\n\t}\r\n});\r\n\r\n\r\n\r\n\r\n// data: string of html\r\n// context (optional): If specified, the fragment will be created in this context, defaults to document\r\n// keepScripts (optional): If true, will include scripts passed in the html string\r\njQuery.parseHTML = function( data, context, keepScripts ) {\r\n\tif ( !data || typeof data !== \"string\" ) {\r\n\t\treturn null;\r\n\t}\r\n\tif ( typeof context === \"boolean\" ) {\r\n\t\tkeepScripts = context;\r\n\t\tcontext = false;\r\n\t}\r\n\tcontext = context || document;\r\n\r\n\tvar parsed = rsingleTag.exec( data ),\r\n\t\tscripts = !keepScripts && [];\r\n\r\n\t// Single tag\r\n\tif ( parsed ) {\r\n\t\treturn [ context.createElement( parsed[1] ) ];\r\n\t}\r\n\r\n\tparsed = jQuery.buildFragment( [ data ], context, scripts );\r\n\r\n\tif ( scripts && scripts.length ) {\r\n\t\tjQuery( scripts ).remove();\r\n\t}\r\n\r\n\treturn jQuery.merge( [], parsed.childNodes );\r\n};\r\n\r\n\r\n// Keep a copy of the old load method\r\nvar _load = jQuery.fn.load;\r\n\r\n/**\r\n * Load a url into a page\r\n */\r\njQuery.fn.load = function( url, params, callback ) {\r\n\tif ( typeof url !== \"string\" && _load ) {\r\n\t\treturn _load.apply( this, arguments );\r\n\t}\r\n\r\n\tvar selector, type, response,\r\n\t\tself = this,\r\n\t\toff = url.indexOf(\" \");\r\n\r\n\tif ( off >= 0 ) {\r\n\t\tselector = jQuery.trim( url.slice( off ) );\r\n\t\turl = url.slice( 0, off );\r\n\t}\r\n\r\n\t// If it's a function\r\n\tif ( jQuery.isFunction( params ) ) {\r\n\r\n\t\t// We assume that it's the callback\r\n\t\tcallback = params;\r\n\t\tparams = undefined;\r\n\r\n\t// Otherwise, build a param string\r\n\t} else if ( params && typeof params === \"object\" ) {\r\n\t\ttype = \"POST\";\r\n\t}\r\n\r\n\t// If we have elements to modify, make the request\r\n\tif ( self.length > 0 ) {\r\n\t\tjQuery.ajax({\r\n\t\t\turl: url,\r\n\r\n\t\t\t// if \"type\" variable is undefined, then \"GET\" method will be used\r\n\t\t\ttype: type,\r\n\t\t\tdataType: \"html\",\r\n\t\t\tdata: params\r\n\t\t}).done(function( responseText ) {\r\n\r\n\t\t\t// Save response for use in complete callback\r\n\t\t\tresponse = arguments;\r\n\r\n\t\t\tself.html( selector ?\r\n\r\n\t\t\t\t// If a selector was specified, locate the right elements in a dummy div\r\n\t\t\t\t// Exclude scripts to avoid IE 'Permission Denied' errors\r\n\t\t\t\tjQuery(\"<div>\").append( jQuery.parseHTML( responseText ) ).find( selector ) :\r\n\r\n\t\t\t\t// Otherwise use the full result\r\n\t\t\t\tresponseText );\r\n\r\n\t\t}).complete( callback && function( jqXHR, status ) {\r\n\t\t\tself.each( callback, response || [ jqXHR.responseText, status, jqXHR ] );\r\n\t\t});\r\n\t}\r\n\r\n\treturn this;\r\n};\r\n\r\n\r\n\r\n\r\n// Attach a bunch of functions for handling common AJAX events\r\njQuery.each( [ \"ajaxStart\", \"ajaxStop\", \"ajaxComplete\", \"ajaxError\", \"ajaxSuccess\", \"ajaxSend\" ], function( i, type ) {\r\n\tjQuery.fn[ type ] = function( fn ) {\r\n\t\treturn this.on( type, fn );\r\n\t};\r\n});\r\n\r\n\r\n\r\n\r\njQuery.expr.filters.animated = function( elem ) {\r\n\treturn jQuery.grep(jQuery.timers, function( fn ) {\r\n\t\treturn elem === fn.elem;\r\n\t}).length;\r\n};\r\n\r\n\r\n\r\n\r\nvar docElem = window.document.documentElement;\r\n\r\n/**\r\n * Gets a window from an element\r\n */\r\nfunction getWindow( elem ) {\r\n\treturn jQuery.isWindow( elem ) ? elem : elem.nodeType === 9 && elem.defaultView;\r\n}\r\n\r\njQuery.offset = {\r\n\tsetOffset: function( elem, options, i ) {\r\n\t\tvar curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition,\r\n\t\t\tposition = jQuery.css( elem, \"position\" ),\r\n\t\t\tcurElem = jQuery( elem ),\r\n\t\t\tprops = {};\r\n\r\n\t\t// Set position first, in-case top/left are set even on static elem\r\n\t\tif ( position === \"static\" ) {\r\n\t\t\telem.style.position = \"relative\";\r\n\t\t}\r\n\r\n\t\tcurOffset = curElem.offset();\r\n\t\tcurCSSTop = jQuery.css( elem, \"top\" );\r\n\t\tcurCSSLeft = jQuery.css( elem, \"left\" );\r\n\t\tcalculatePosition = ( position === \"absolute\" || position === \"fixed\" ) &&\r\n\t\t\t( curCSSTop + curCSSLeft ).indexOf(\"auto\") > -1;\r\n\r\n\t\t// Need to be able to calculate position if either\r\n\t\t// top or left is auto and position is either absolute or fixed\r\n\t\tif ( calculatePosition ) {\r\n\t\t\tcurPosition = curElem.position();\r\n\t\t\tcurTop = curPosition.top;\r\n\t\t\tcurLeft = curPosition.left;\r\n\r\n\t\t} else {\r\n\t\t\tcurTop = parseFloat( curCSSTop ) || 0;\r\n\t\t\tcurLeft = parseFloat( curCSSLeft ) || 0;\r\n\t\t}\r\n\r\n\t\tif ( jQuery.isFunction( options ) ) {\r\n\t\t\toptions = options.call( elem, i, curOffset );\r\n\t\t}\r\n\r\n\t\tif ( options.top != null ) {\r\n\t\t\tprops.top = ( options.top - curOffset.top ) + curTop;\r\n\t\t}\r\n\t\tif ( options.left != null ) {\r\n\t\t\tprops.left = ( options.left - curOffset.left ) + curLeft;\r\n\t\t}\r\n\r\n\t\tif ( \"using\" in options ) {\r\n\t\t\toptions.using.call( elem, props );\r\n\r\n\t\t} else {\r\n\t\t\tcurElem.css( props );\r\n\t\t}\r\n\t}\r\n};\r\n\r\njQuery.fn.extend({\r\n\toffset: function( options ) {\r\n\t\tif ( arguments.length ) {\r\n\t\t\treturn options === undefined ?\r\n\t\t\t\tthis :\r\n\t\t\t\tthis.each(function( i ) {\r\n\t\t\t\t\tjQuery.offset.setOffset( this, options, i );\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar docElem, win,\r\n\t\t\telem = this[ 0 ],\r\n\t\t\tbox = { top: 0, left: 0 },\r\n\t\t\tdoc = elem && elem.ownerDocument;\r\n\r\n\t\tif ( !doc ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdocElem = doc.documentElement;\r\n\r\n\t\t// Make sure it's not a disconnected DOM node\r\n\t\tif ( !jQuery.contains( docElem, elem ) ) {\r\n\t\t\treturn box;\r\n\t\t}\r\n\r\n\t\t// Support: BlackBerry 5, iOS 3 (original iPhone)\r\n\t\t// If we don't have gBCR, just use 0,0 rather than error\r\n\t\tif ( typeof elem.getBoundingClientRect !== strundefined ) {\r\n\t\t\tbox = elem.getBoundingClientRect();\r\n\t\t}\r\n\t\twin = getWindow( doc );\r\n\t\treturn {\r\n\t\t\ttop: box.top + win.pageYOffset - docElem.clientTop,\r\n\t\t\tleft: box.left + win.pageXOffset - docElem.clientLeft\r\n\t\t};\r\n\t},\r\n\r\n\tposition: function() {\r\n\t\tif ( !this[ 0 ] ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar offsetParent, offset,\r\n\t\t\telem = this[ 0 ],\r\n\t\t\tparentOffset = { top: 0, left: 0 };\r\n\r\n\t\t// Fixed elements are offset from window (parentOffset = {top:0, left: 0}, because it is its only offset parent\r\n\t\tif ( jQuery.css( elem, \"position\" ) === \"fixed\" ) {\r\n\t\t\t// Assume getBoundingClientRect is there when computed position is fixed\r\n\t\t\toffset = elem.getBoundingClientRect();\r\n\r\n\t\t} else {\r\n\t\t\t// Get *real* offsetParent\r\n\t\t\toffsetParent = this.offsetParent();\r\n\r\n\t\t\t// Get correct offsets\r\n\t\t\toffset = this.offset();\r\n\t\t\tif ( !jQuery.nodeName( offsetParent[ 0 ], \"html\" ) ) {\r\n\t\t\t\tparentOffset = offsetParent.offset();\r\n\t\t\t}\r\n\r\n\t\t\t// Add offsetParent borders\r\n\t\t\tparentOffset.top += jQuery.css( offsetParent[ 0 ], \"borderTopWidth\", true );\r\n\t\t\tparentOffset.left += jQuery.css( offsetParent[ 0 ], \"borderLeftWidth\", true );\r\n\t\t}\r\n\r\n\t\t// Subtract parent offsets and element margins\r\n\t\treturn {\r\n\t\t\ttop: offset.top - parentOffset.top - jQuery.css( elem, \"marginTop\", true ),\r\n\t\t\tleft: offset.left - parentOffset.left - jQuery.css( elem, \"marginLeft\", true )\r\n\t\t};\r\n\t},\r\n\r\n\toffsetParent: function() {\r\n\t\treturn this.map(function() {\r\n\t\t\tvar offsetParent = this.offsetParent || docElem;\r\n\r\n\t\t\twhile ( offsetParent && ( !jQuery.nodeName( offsetParent, \"html\" ) && jQuery.css( offsetParent, \"position\" ) === \"static\" ) ) {\r\n\t\t\t\toffsetParent = offsetParent.offsetParent;\r\n\t\t\t}\r\n\r\n\t\t\treturn offsetParent || docElem;\r\n\t\t});\r\n\t}\r\n});\r\n\r\n// Create scrollLeft and scrollTop methods\r\njQuery.each( { scrollLeft: \"pageXOffset\", scrollTop: \"pageYOffset\" }, function( method, prop ) {\r\n\tvar top = \"pageYOffset\" === prop;\r\n\r\n\tjQuery.fn[ method ] = function( val ) {\r\n\t\treturn access( this, function( elem, method, val ) {\r\n\t\t\tvar win = getWindow( elem );\r\n\r\n\t\t\tif ( val === undefined ) {\r\n\t\t\t\treturn win ? win[ prop ] : elem[ method ];\r\n\t\t\t}\r\n\r\n\t\t\tif ( win ) {\r\n\t\t\t\twin.scrollTo(\r\n\t\t\t\t\t!top ? val : window.pageXOffset,\r\n\t\t\t\t\ttop ? val : window.pageYOffset\r\n\t\t\t\t);\r\n\r\n\t\t\t} else {\r\n\t\t\t\telem[ method ] = val;\r\n\t\t\t}\r\n\t\t}, method, val, arguments.length, null );\r\n\t};\r\n});\r\n\r\n// Support: Safari<7+, Chrome<37+\r\n// Add the top/left cssHooks using jQuery.fn.position\r\n// Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084\r\n// Blink bug: https://code.google.com/p/chromium/issues/detail?id=229280\r\n// getComputedStyle returns percent when specified for top/left/bottom/right;\r\n// rather than make the css module depend on the offset module, just check for it here\r\njQuery.each( [ \"top\", \"left\" ], function( i, prop ) {\r\n\tjQuery.cssHooks[ prop ] = addGetHookIf( support.pixelPosition,\r\n\t\tfunction( elem, computed ) {\r\n\t\t\tif ( computed ) {\r\n\t\t\t\tcomputed = curCSS( elem, prop );\r\n\t\t\t\t// If curCSS returns percentage, fallback to offset\r\n\t\t\t\treturn rnumnonpx.test( computed ) ?\r\n\t\t\t\t\tjQuery( elem ).position()[ prop ] + \"px\" :\r\n\t\t\t\t\tcomputed;\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n});\r\n\r\n\r\n// Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods\r\njQuery.each( { Height: \"height\", Width: \"width\" }, function( name, type ) {\r\n\tjQuery.each( { padding: \"inner\" + name, content: type, \"\": \"outer\" + name }, function( defaultExtra, funcName ) {\r\n\t\t// Margin is only for outerHeight, outerWidth\r\n\t\tjQuery.fn[ funcName ] = function( margin, value ) {\r\n\t\t\tvar chainable = arguments.length && ( defaultExtra || typeof margin !== \"boolean\" ),\r\n\t\t\t\textra = defaultExtra || ( margin === true || value === true ? \"margin\" : \"border\" );\r\n\r\n\t\t\treturn access( this, function( elem, type, value ) {\r\n\t\t\t\tvar doc;\r\n\r\n\t\t\t\tif ( jQuery.isWindow( elem ) ) {\r\n\t\t\t\t\t// As of 5/8/2012 this will yield incorrect results for Mobile Safari, but there\r\n\t\t\t\t\t// isn't a whole lot we can do. See pull request at this URL for discussion:\r\n\t\t\t\t\t// https://github.com/jquery/jquery/pull/764\r\n\t\t\t\t\treturn elem.document.documentElement[ \"client\" + name ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get document width or height\r\n\t\t\t\tif ( elem.nodeType === 9 ) {\r\n\t\t\t\t\tdoc = elem.documentElement;\r\n\r\n\t\t\t\t\t// Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height],\r\n\t\t\t\t\t// whichever is greatest\r\n\t\t\t\t\treturn Math.max(\r\n\t\t\t\t\t\telem.body[ \"scroll\" + name ], doc[ \"scroll\" + name ],\r\n\t\t\t\t\t\telem.body[ \"offset\" + name ], doc[ \"offset\" + name ],\r\n\t\t\t\t\t\tdoc[ \"client\" + name ]\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value === undefined ?\r\n\t\t\t\t\t// Get width or height on the element, requesting but not forcing parseFloat\r\n\t\t\t\t\tjQuery.css( elem, type, extra ) :\r\n\r\n\t\t\t\t\t// Set width or height on the element\r\n\t\t\t\t\tjQuery.style( elem, type, value, extra );\r\n\t\t\t}, type, chainable ? margin : undefined, chainable, null );\r\n\t\t};\r\n\t});\r\n});\r\n\r\n\r\n// The number of elements contained in the matched element set\r\njQuery.fn.size = function() {\r\n\treturn this.length;\r\n};\r\n\r\njQuery.fn.andSelf = jQuery.fn.addBack;\r\n\r\n\r\n\r\n\r\n// Register as a named AMD module, since jQuery can be concatenated with other\r\n// files that may use define, but not via a proper concatenation script that\r\n// understands anonymous AMD modules. A named AMD is safest and most robust\r\n// way to register. Lowercase jquery is used because AMD module names are\r\n// derived from file names, and jQuery is normally delivered in a lowercase\r\n// file name. Do this after creating the global so that if an AMD module wants\r\n// to call noConflict to hide this version of jQuery, it will work.\r\n\r\n// Note that for maximum portability, libraries that are not jQuery should\r\n// declare themselves as anonymous modules, and avoid setting a global if an\r\n// AMD loader is present. jQuery is a special case. For more information, see\r\n// https://github.com/jrburke/requirejs/wiki/Updating-existing-libraries#wiki-anon\r\n\r\nif ( typeof define === \"function\" && define.amd ) {\r\n\tdefine( \"jquery\", [], function() {\r\n\t\treturn jQuery;\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\nvar\r\n\t// Map over jQuery in case of overwrite\r\n\t_jQuery = window.jQuery,\r\n\r\n\t// Map over the $ in case of overwrite\r\n\t_$ = window.$;\r\n\r\njQuery.noConflict = function( deep ) {\r\n\tif ( window.$ === jQuery ) {\r\n\t\twindow.$ = _$;\r\n\t}\r\n\r\n\tif ( deep && window.jQuery === jQuery ) {\r\n\t\twindow.jQuery = _jQuery;\r\n\t}\r\n\r\n\treturn jQuery;\r\n};\r\n\r\n// Expose jQuery and $ identifiers, even in AMD\r\n// (#7102#comment:10, https://github.com/jquery/jquery/pull/557)\r\n// and CommonJS for browser emulators (#13566)\r\nif ( typeof noGlobal === strundefined ) {\r\n\twindow.jQuery = window.$ = jQuery;\r\n}\r\n\r\n\r\n\r\n\r\nreturn jQuery;\r\n\r\n}));\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/jquery.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 146,
    "kind": "file",
    "name": "src/client/lib/jquery.min.js",
    "content": "/*! jQuery v2.1.4 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */\r\n!function(a,b){\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error(\"jQuery requires a window with a document\");return b(a)}:b(a)}(\"undefined\"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m=\"2.1.4\",n=function(a,b){return new n.fn.init(a,b)},o=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,p=/^-ms-/,q=/-([\\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:\"\",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for(\"boolean\"==typeof g&&(j=g,g=arguments[h]||{},h++),\"object\"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:\"jQuery\"+(m+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return\"function\"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return\"object\"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,\"isPrototypeOf\")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+\"\":\"object\"==typeof a||\"function\"==typeof a?h[i.call(a)]||\"object\":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf(\"use strict\")?(b=l.createElement(\"script\"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,\"ms-\").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?\"\":(a+\"\").replace(o,\"\")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,\"string\"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return\"string\"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each(\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \"),function(a,b){h[\"[object \"+b+\"]\"]=b.toLowerCase()});function s(a){var b=\"length\"in a&&a.length,c=n.type(a);return\"function\"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:\"array\"===c||0===b||\"number\"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=\"sizzle\"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",L=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",M=\"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",N=M.replace(\"w\",\"w#\"),O=\"\\\\[\"+L+\"*(\"+M+\")(?:\"+L+\"*([*^$|!~]?=)\"+L+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+N+\"))|)\"+L+\"*\\\\]\",P=\":(\"+M+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+O+\")*)|.*)\\\\)|)\",Q=new RegExp(L+\"+\",\"g\"),R=new RegExp(\"^\"+L+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+L+\"+$\",\"g\"),S=new RegExp(\"^\"+L+\"*,\"+L+\"*\"),T=new RegExp(\"^\"+L+\"*([>+~]|\"+L+\")\"+L+\"*\"),U=new RegExp(\"=\"+L+\"*([^\\\\]'\\\"]*?)\"+L+\"*\\\\]\",\"g\"),V=new RegExp(P),W=new RegExp(\"^\"+N+\"$\"),X={ID:new RegExp(\"^#(\"+M+\")\"),CLASS:new RegExp(\"^\\\\.(\"+M+\")\"),TAG:new RegExp(\"^(\"+M.replace(\"w\",\"w*\")+\")\"),ATTR:new RegExp(\"^\"+O),PSEUDO:new RegExp(\"^\"+P),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+L+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+L+\"*(?:([+-]|)\"+L+\"*(\\\\d+)|))\"+L+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+K+\")$\",\"i\"),needsContext:new RegExp(\"^\"+L+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+L+\"*((?:-\\\\d)?\\\\d*)\"+L+\"*\\\\)|)(?=[^-]|$)\",\"i\")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\\d$/i,$=/^[^{]+\\{\\s*\\[native \\w/,_=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,aa=/[+~]/,ba=/'|\\\\/g,ca=new RegExp(\"\\\\\\\\([\\\\da-f]{1,6}\"+L+\"?|(\"+L+\")|.)\",\"ig\"),da=function(a,b,c){var d=\"0x\"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ea=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fa){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,\"string\"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&\"object\"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute(\"id\"))?s=r.replace(ba,\"\\\\$&\"):b.setAttribute(\"id\",s),s=\"[id='\"+s+\"'] \",l=o.length;while(l--)o[l]=s+ra(o[l]);w=aa.test(a)&&pa(b.parentNode)||b,x=o.join(\",\")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute(\"id\")}}}return i(a.replace(R,\"$1\"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+\" \")>d.cacheLength&&delete b[a.shift()],b[c+\" \"]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement(\"div\");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split(\"|\"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return\"input\"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return(\"input\"===c||\"button\"===c)&&b.type===a}}function oa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pa(a){return a&&\"undefined\"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?\"HTML\"!==b.nodeName:!1},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener(\"unload\",ea,!1):e.attachEvent&&e.attachEvent(\"onunload\",ea)),p=!f(g),c.attributes=ja(function(a){return a.className=\"i\",!a.getAttribute(\"className\")}),c.getElementsByTagName=ja(function(a){return a.appendChild(g.createComment(\"\")),!a.getElementsByTagName(\"*\").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(\"undefined\"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){return a.getAttribute(\"id\")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){var c=\"undefined\"!=typeof a.getAttributeNode&&a.getAttributeNode(\"id\");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return\"undefined\"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if(\"*\"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML=\"<a id='\"+u+\"'></a><select id='\"+u+\"-\\f]' msallowcapture=''><option selected=''></option></select>\",a.querySelectorAll(\"[msallowcapture^='']\").length&&q.push(\"[*^$]=\"+L+\"*(?:''|\\\"\\\")\"),a.querySelectorAll(\"[selected]\").length||q.push(\"\\\\[\"+L+\"*(?:value|\"+K+\")\"),a.querySelectorAll(\"[id~=\"+u+\"-]\").length||q.push(\"~=\"),a.querySelectorAll(\":checked\").length||q.push(\":checked\"),a.querySelectorAll(\"a#\"+u+\"+*\").length||q.push(\".#.+[+~]\")}),ja(function(a){var b=g.createElement(\"input\");b.setAttribute(\"type\",\"hidden\"),a.appendChild(b).setAttribute(\"name\",\"D\"),a.querySelectorAll(\"[name=d]\").length&&q.push(\"name\"+L+\"*[*^$|!~]?=\"),a.querySelectorAll(\":enabled\").length||q.push(\":enabled\",\":disabled\"),a.querySelectorAll(\"*,:x\"),q.push(\",.*:\")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,\"div\"),s.call(a,\"[s!='']:x\"),r.push(\"!=\",P)}),q=q.length&&new RegExp(q.join(\"|\")),r=r.length&&new RegExp(r.join(\"|\")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?la(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,\"='$1']\"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.error=function(a){throw new Error(\"Syntax error, unrecognized expression: \"+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c=\"\",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if(\"string\"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:X,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ca,da),a[3]=(a[3]||a[4]||a[5]||\"\").replace(ca,da),\"~=\"===a[2]&&(a[3]=\" \"+a[3]+\" \"),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),\"nth\"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*(\"even\"===a[3]||\"odd\"===a[3])),a[5]=+(a[7]+a[8]||\"odd\"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||\"\":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(\")\",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ca,da).toLowerCase();return\"*\"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+\" \"];return b||(b=new RegExp(\"(^|\"+L+\")\"+a+\"(\"+L+\"|$)\"))&&y(a,function(a){return b.test(\"string\"==typeof a.className&&a.className||\"undefined\"!=typeof a.getAttribute&&a.getAttribute(\"class\")||\"\")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?\"!=\"===b:b?(e+=\"\",\"=\"===b?e===c:\"!=\"===b?e!==c:\"^=\"===b?c&&0===e.indexOf(c):\"*=\"===b?c&&e.indexOf(c)>-1:\"$=\"===b?c&&e.slice(-c.length)===c:\"~=\"===b?(\" \"+e.replace(Q,\" \")+\" \").indexOf(c)>-1:\"|=\"===b?e===c||e.slice(0,c.length+1)===c+\"-\":!1):!0}},CHILD:function(a,b,c,d,e){var f=\"nth\"!==a.slice(0,3),g=\"last\"!==a.slice(-4),h=\"of-type\"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?\"nextSibling\":\"previousSibling\",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p=\"only\"===a&&!o&&\"nextSibling\"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error(\"unsupported pseudo: \"+a);return e[u]?e(b):e.length>1?(c=[a,a,\"\",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(R,\"$1\"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(ca,da),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return W.test(a||\"\")||ga.error(\"unsupported lang: \"+a),a=a.replace(ca,da).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute(\"xml:lang\")||b.getAttribute(\"lang\"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+\"-\");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return\"input\"===b&&!!a.checked||\"option\"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return\"input\"===b&&\"button\"===a.type||\"button\"===b},text:function(a){var b;return\"input\"===a.nodeName.toLowerCase()&&\"text\"===a.type&&(null==(b=a.getAttribute(\"type\"))||\"text\"===b.toLowerCase())},first:oa(function(){return[0]}),last:oa(function(a,b){return[b-1]}),eq:oa(function(a,b,c){return[0>c?c+b:c]}),even:oa(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:oa(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:oa(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:oa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function qa(){}qa.prototype=d.filters=d.pseudos,d.setFilters=new qa,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+\" \"];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R,\" \")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function ra(a){for(var b=0,c=a.length,d=\"\";c>b;b++)d+=a[b].value;return d}function sa(a,b,c){var d=b.dir,e=c&&\"parentNode\"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function ta(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c){for(var d=0,e=b.length;e>d;d++)ga(a,b[d],c);return c}function va(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wa(a,b,c,d,e,f){return d&&!d[u]&&(d=wa(d)),e&&!e[u]&&(e=wa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ua(b||\"*\",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:va(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=va(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=va(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[\" \"],i=g?1:0,k=sa(function(a){return a===b},h,!0),l=sa(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sa(ta(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wa(i>1&&ta(m),i>1&&ra(a.slice(0,i-1).concat({value:\" \"===a[i-2].type?\"*\":\"\"})).replace(R,\"$1\"),c,e>i&&xa(a.slice(i,e)),f>e&&xa(a=a.slice(e)),f>e&&ra(a))}m.push(c)}return ta(m)}function ya(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q=\"0\",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG(\"*\",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=va(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&ga.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+\" \"];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,ya(e,d)),f.selector=a}return f},i=ga.select=function(a,b,e,f){var i,j,k,l,m,n=\"function\"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&\"ID\"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ca,da),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ca,da),aa.test(j[0].type)&&pa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&ra(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,aa.test(a)&&pa(b.parentNode)||b),e},c.sortStable=u.split(\"\").sort(B).join(\"\")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement(\"div\"))}),ja(function(a){return a.innerHTML=\"<a href='#'></a>\",\"#\"===a.firstChild.getAttribute(\"href\")})||ka(\"type|href|height|width\",function(a,b,c){return c?void 0:a.getAttribute(b,\"type\"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML=\"<input/>\",a.firstChild.setAttribute(\"value\",\"\"),\"\"===a.firstChild.getAttribute(\"value\")})||ka(\"value\",function(a,b,c){return c||\"input\"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ja(function(a){return null==a.getAttribute(\"disabled\")})||ka(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);n.find=t,n.expr=t.selectors,n.expr[\":\"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/,w=/^.[^:#\\[\\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if(\"string\"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=\":not(\"+a+\")\"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if(\"string\"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+\" \"+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,\"string\"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if(\"string\"==typeof a){if(c=\"<\"===a[0]&&\">\"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?\"undefined\"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||\"string\"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?\"string\"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,\"parentNode\")},parentsUntil:function(a,b,c){return n.dir(a,\"parentNode\",c)},next:function(a){return D(a,\"nextSibling\")},prev:function(a){return D(a,\"previousSibling\")},nextAll:function(a){return n.dir(a,\"nextSibling\")},prevAll:function(a){return n.dir(a,\"previousSibling\")},nextUntil:function(a,b,c){return n.dir(a,\"nextSibling\",c)},prevUntil:function(a,b,c){return n.dir(a,\"previousSibling\",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return\"Until\"!==a.slice(-5)&&(d=c),d&&\"string\"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a=\"string\"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);\"function\"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&\"string\"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[[\"resolve\",\"done\",n.Callbacks(\"once memory\"),\"resolved\"],[\"reject\",\"fail\",n.Callbacks(\"once memory\"),\"rejected\"],[\"notify\",\"progress\",n.Callbacks(\"memory\")]],c=\"pending\",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+\"With\"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+\"With\"](this===e?d:this,arguments),this},e[f[0]+\"With\"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler(\"ready\"),n(l).off(\"ready\"))))}});function I(){l.removeEventListener(\"DOMContentLoaded\",I,!1),a.removeEventListener(\"load\",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),\"complete\"===l.readyState?setTimeout(n.ready):(l.addEventListener(\"DOMContentLoaded\",I,!1),a.addEventListener(\"load\",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if(\"object\"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+K.uid++}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if(\"string\"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&\"string\"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d=\"data-\"+b.replace(O,\"-$1\").toLowerCase(),c=a.getAttribute(d),\"string\"==typeof c){try{c=\"true\"===c?!0:\"false\"===c?!1:\"null\"===c?null:+c+\"\"===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){\r\nreturn M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,\"hasDataAttrs\"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf(\"data-\")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,\"hasDataAttrs\",!0)}return e}return\"object\"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf(\"-\")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||\"fx\")+\"queue\",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||\"fx\";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};\"inprogress\"===e&&(e=c.shift(),d--),e&&(\"fx\"===b&&c.unshift(\"inprogress\"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+\"queueHooks\";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks(\"once memory\").add(function(){L.remove(a,[b+\"queue\",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return\"string\"!=typeof a&&(b=a,a=\"fx\",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),\"fx\"===a&&\"inprogress\"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||\"fx\",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};\"string\"!=typeof a&&(b=a,a=void 0),a=a||\"fx\";while(g--)c=L.get(f[g],a+\"queueHooks\"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,R=[\"Top\",\"Right\",\"Bottom\",\"Left\"],S=function(a,b){return a=b||a,\"none\"===n.css(a,\"display\")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement(\"div\")),c=l.createElement(\"input\");c.setAttribute(\"type\",\"radio\"),c.setAttribute(\"checked\",\"checked\"),c.setAttribute(\"name\",\"t\"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML=\"<textarea>x</textarea>\",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U=\"undefined\";k.focusinBubbles=\"onfocusin\"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||\"\").match(E)||[\"\"],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||\"\").split(\".\").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(\".\")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||\"\").match(E)||[\"\"],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||\"\").split(\".\").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp(\"(^|\\\\.)\"+p.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&(\"**\"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,\"events\"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,\"type\")?b.type:b,r=j.call(b,\"namespace\")?b.namespace.split(\".\"):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(\".\")>=0&&(r=q.split(\".\"),q=r.shift(),r.sort()),k=q.indexOf(\":\")<0&&\"on\"+q,b=b[n.expando]?b:new n.Event(q,\"object\"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join(\".\"),b.namespace_re=b.namespace?new RegExp(\"(^|\\\\.)\"+r.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,\"events\")||{})[b.type]&&L.get(g,\"handle\"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,\"events\")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||\"click\"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||\"click\"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+\" \",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:\"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which\".split(\" \"),fixHooks:{},keyHooks:{props:\"char charCode key keyCode\".split(\" \"),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:\"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement\".split(\" \"),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:\"focusin\"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:\"focusout\"},click:{trigger:function(){return\"checkbox\"===this.type&&this.click&&n.nodeName(this,\"input\")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,\"a\")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:\"focusin\",blur:\"focusout\"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if(\"object\"==typeof a){\"string\"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&(\"string\"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+\".\"+d.namespace:d.origType,d.selector,d.handler),this;if(\"object\"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||\"function\"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/gi,ba=/<([\\w:]+)/,ca=/<|&#?\\w+;/,da=/<(?:script|style|link)/i,ea=/checked\\s*(?:[^=]|=\\s*.checked.)/i,fa=/^$|\\/(?:java|ecma)script/i,ga=/^true\\/(.*)/,ha=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g,ia={option:[1,\"<select multiple='multiple'>\",\"</select>\"],thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};ia.optgroup=ia.option,ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead,ia.th=ia.td;function ja(a,b){return n.nodeName(a,\"table\")&&n.nodeName(11!==b.nodeType?b:b.firstChild,\"tr\")?a.getElementsByTagName(\"tbody\")[0]||a.appendChild(a.ownerDocument.createElement(\"tbody\")):a}function ka(a){return a.type=(null!==a.getAttribute(\"type\"))+\"/\"+a.type,a}function la(a){var b=ga.exec(a.type);return b?a.type=b[1]:a.removeAttribute(\"type\"),a}function ma(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],\"globalEval\",!b||L.get(b[c],\"globalEval\"))}function na(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function oa(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||\"*\"):a.querySelectorAll?a.querySelectorAll(b||\"*\"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pa(a,b){var c=b.nodeName.toLowerCase();\"input\"===c&&T.test(a.type)?b.checked=a.checked:(\"input\"===c||\"textarea\"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=oa(h),f=oa(a),d=0,e=f.length;e>d;d++)pa(f[d],g[d]);if(b)if(c)for(f=f||oa(a),g=g||oa(h),d=0,e=f.length;e>d;d++)na(f[d],g[d]);else na(a,h);return g=oa(h,\"script\"),g.length>0&&ma(g,!i&&oa(a,\"script\")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if(\"object\"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(ca.test(e)){f=f||k.appendChild(b.createElement(\"div\")),g=(ba.exec(e)||[\"\",\"\"])[1].toLowerCase(),h=ia[g]||ia._default,f.innerHTML=h[1]+e.replace(aa,\"<$1></$2>\")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=\"\"}else l.push(b.createTextNode(e));k.textContent=\"\",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=oa(k.appendChild(e),\"script\"),i&&ma(f),c)){j=0;while(e=f[j++])fa.test(e.type||\"\")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=ja(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=ja(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(oa(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&ma(oa(c,\"script\")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(oa(a,!1)),a.textContent=\"\");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if(\"string\"==typeof a&&!da.test(a)&&!ia[(ba.exec(a)||[\"\",\"\"])[1].toLowerCase()]){a=a.replace(aa,\"<$1></$2>\");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(oa(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(oa(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&\"string\"==typeof p&&!k.checkClone&&ea.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(oa(c,\"script\"),ka),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,oa(h,\"script\"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,la),j=0;g>j;j++)h=f[j],fa.test(h.type||\"\")&&!L.access(h,\"globalEval\")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(ha,\"\")))}return this}}),n.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qa,ra={};function sa(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],\"display\");return e.detach(),f}function ta(a){var b=l,c=ra[a];return c||(c=sa(a,b),\"none\"!==c&&c||(qa=(qa||n(\"<iframe frameborder='0' width='0' height='0'/>\")).appendTo(b.documentElement),b=qa[0].contentDocument,b.write(),b.close(),c=sa(a,b),qa.detach()),ra[a]=c),c}var ua=/^margin/,va=new RegExp(\"^(\"+Q+\")(?!px)[a-z%]+$\",\"i\"),wa=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};function xa(a,b,c){var d,e,f,g,h=a.style;return c=c||wa(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(\"\"!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),va.test(g)&&ua.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+\"\":g}function ya(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement(\"div\"),f=l.createElement(\"div\");if(f.style){f.style.backgroundClip=\"content-box\",f.cloneNode(!0).style.backgroundClip=\"\",k.clearCloneStyle=\"content-box\"===f.style.backgroundClip,e.style.cssText=\"border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute\",e.appendChild(f);function g(){f.style.cssText=\"-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute\",f.innerHTML=\"\",d.appendChild(e);var g=a.getComputedStyle(f,null);b=\"1%\"!==g.top,c=\"4px\"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement(\"div\"));return c.style.cssText=f.style.cssText=\"-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0\",c.style.marginRight=c.style.width=\"0\",f.style.width=\"1px\",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),f.removeChild(c),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var za=/^(none|table(?!-c[ea]).+)/,Aa=new RegExp(\"^(\"+Q+\")(.*)$\",\"i\"),Ba=new RegExp(\"^([+-])=(\"+Q+\")\",\"i\"),Ca={position:\"absolute\",visibility:\"hidden\",display:\"block\"},Da={letterSpacing:\"0\",fontWeight:\"400\"},Ea=[\"Webkit\",\"O\",\"Moz\",\"ms\"];function Fa(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Ea.length;while(e--)if(b=Ea[e]+c,b in a)return b;return d}function Ga(a,b,c){var d=Aa.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||\"px\"):b}function Ha(a,b,c,d,e){for(var f=c===(d?\"border\":\"content\")?4:\"width\"===b?1:0,g=0;4>f;f+=2)\"margin\"===c&&(g+=n.css(a,c+R[f],!0,e)),d?(\"content\"===c&&(g-=n.css(a,\"padding\"+R[f],!0,e)),\"margin\"!==c&&(g-=n.css(a,\"border\"+R[f]+\"Width\",!0,e))):(g+=n.css(a,\"padding\"+R[f],!0,e),\"padding\"!==c&&(g+=n.css(a,\"border\"+R[f]+\"Width\",!0,e)));return g}function Ia(a,b,c){var d=!0,e=\"width\"===b?a.offsetWidth:a.offsetHeight,f=wa(a),g=\"border-box\"===n.css(a,\"boxSizing\",!1,f);if(0>=e||null==e){if(e=xa(a,b,f),(0>e||null==e)&&(e=a.style[b]),va.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Ha(a,b,c||(g?\"border\":\"content\"),d,f)+\"px\"}function Ja(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,\"olddisplay\"),c=d.style.display,b?(f[g]||\"none\"!==c||(d.style.display=\"\"),\"\"===d.style.display&&S(d)&&(f[g]=L.access(d,\"olddisplay\",ta(d.nodeName)))):(e=S(d),\"none\"===c&&e||L.set(d,\"olddisplay\",e?c:n.css(d,\"display\"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&\"none\"!==d.style.display&&\"\"!==d.style.display||(d.style.display=b?f[g]||\"\":\"none\"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xa(a,\"opacity\");return\"\"===c?\"1\":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{\"float\":\"cssFloat\"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fa(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&\"get\"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,\"string\"===f&&(e=Ba.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f=\"number\"),null!=c&&c===c&&(\"number\"!==f||n.cssNumber[h]||(c+=\"px\"),k.clearCloneStyle||\"\"!==c||0!==b.indexOf(\"background\")||(i[b]=\"inherit\"),g&&\"set\"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fa(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&\"get\"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xa(a,b,d)),\"normal\"===e&&b in Da&&(e=Da[b]),\"\"===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each([\"height\",\"width\"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?za.test(n.css(a,\"display\"))&&0===a.offsetWidth?n.swap(a,Ca,function(){return Ia(a,b,d)}):Ia(a,b,d):void 0},set:function(a,c,d){var e=d&&wa(a);return Ga(a,c,d?Ha(a,b,d,\"border-box\"===n.css(a,\"boxSizing\",!1,e),e):0)}}}),n.cssHooks.marginRight=ya(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:\"inline-block\"},xa,[a,\"marginRight\"]):void 0}),n.each({margin:\"\",padding:\"\",border:\"Width\"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f=\"string\"==typeof c?c.split(\" \"):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ua.test(a)||(n.cssHooks[a+b].set=Ga)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wa(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Ja(this,!0)},hide:function(){return Ja(this)},toggle:function(a){return\"boolean\"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Ka(a,b,c,d,e){return new Ka.prototype.init(a,b,c,d,e)}n.Tween=Ka,Ka.prototype={constructor:Ka,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||\"swing\",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?\"\":\"px\")},cur:function(){var a=Ka.propHooks[this.prop];return a&&a.get?a.get(this):Ka.propHooks._default.get(this)},run:function(a){var b,c=Ka.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ka.propHooks._default.set(this),this}},Ka.prototype.init.prototype=Ka.prototype,Ka.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,\"\"),b&&\"auto\"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Ka.propHooks.scrollTop=Ka.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Ka.prototype.init,n.fx.step={};var La,Ma,Na=/^(?:toggle|show|hide)$/,Oa=new RegExp(\"^(?:([+-])=|)(\"+Q+\")([a-z%]*)$\",\"i\"),Pa=/queueHooks$/,Qa=[Va],Ra={\"*\":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Oa.exec(b),f=e&&e[3]||(n.cssNumber[a]?\"\":\"px\"),g=(n.cssNumber[a]||\"px\"!==f&&+d)&&Oa.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||\".5\",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sa(){return setTimeout(function(){La=void 0}),La=n.now()}function Ta(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e[\"margin\"+c]=e[\"padding\"+c]=a;return b&&(e.opacity=e.width=a),e}function Ua(a,b,c){for(var d,e=(Ra[b]||[]).concat(Ra[\"*\"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Va(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,\"fxshow\");c.queue||(h=n._queueHooks(a,\"fx\"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,\"fx\").length||h.empty.fire()})})),1===a.nodeType&&(\"height\"in b||\"width\"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,\"display\"),k=\"none\"===j?L.get(a,\"olddisplay\")||ta(a.nodeName):j,\"inline\"===k&&\"none\"===n.css(a,\"float\")&&(o.display=\"inline-block\")),c.overflow&&(o.overflow=\"hidden\",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Na.exec(e)){if(delete b[d],f=f||\"toggle\"===e,e===(p?\"hide\":\"show\")){if(\"show\"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))\"inline\"===(\"none\"===j?ta(a.nodeName):j)&&(o.display=j);else{q?\"hidden\"in q&&(p=q.hidden):q=L.access(a,\"fxshow\",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,\"fxshow\");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ua(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start=\"width\"===d||\"height\"===d?1:0))}}function Wa(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&\"expand\"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xa(a,b,c){var d,e,f=0,g=Qa.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=La||Sa(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:La||Sa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wa(k,j.opts.specialEasing);g>f;f++)if(d=Qa[f].call(j,a,k,j.opts))return d;return n.map(k,Ua,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xa,{tweener:function(a,b){n.isFunction(a)?(b=a,a=[\"*\"]):a=a.split(\" \");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Ra[c]=Ra[c]||[],Ra[c].unshift(b)},prefilter:function(a,b){b?Qa.unshift(a):Qa.push(a)}}),n.speed=function(a,b,c){var d=a&&\"object\"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:\"number\"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue=\"fx\"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css(\"opacity\",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xa(this,n.extend({},a),f);(e||L.get(this,\"finish\"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return\"string\"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||\"fx\",[]),this.each(function(){var b=!0,e=null!=a&&a+\"queueHooks\",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pa.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||\"fx\"),this.each(function(){var b,c=L.get(this),d=c[a+\"queue\"],e=c[a+\"queueHooks\"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each([\"toggle\",\"show\",\"hide\"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||\"boolean\"==typeof a?c.apply(this,arguments):this.animate(Ta(b,!0),a,d,e)}}),n.each({slideDown:Ta(\"show\"),slideUp:Ta(\"hide\"),slideToggle:Ta(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(La=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),La=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ma||(Ma=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Ma),Ma=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||\"fx\",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement(\"input\"),b=l.createElement(\"select\"),c=b.appendChild(l.createElement(\"option\"));a.type=\"checkbox\",k.checkOn=\"\"!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement(\"input\"),a.value=\"t\",a.type=\"radio\",k.radioValue=\"t\"===a.value}();var Ya,Za,$a=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Za:Ya)),\r\nvoid 0===c?d&&\"get\"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&\"set\"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+\"\"),c):void n.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&\"radio\"===b&&n.nodeName(a,\"input\")){var c=a.value;return a.setAttribute(\"type\",b),c&&(a.value=c),b}}}}}),Za={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\\w+/g),function(a,b){var c=$a[b]||n.find.attr;$a[b]=function(a,b,d){var e,f;return d||(f=$a[b],$a[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$a[b]=f),e}});var _a=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{\"for\":\"htmlFor\",\"class\":\"className\"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&\"set\"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&\"get\"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute(\"tabindex\")||_a.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){n.propFix[this.toLowerCase()]=this});var ab=/[\\t\\r\\n\\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=\"string\"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||\"\").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(\" \"+c.className+\" \").replace(ab,\" \"):\" \")){f=0;while(e=b[f++])d.indexOf(\" \"+e+\" \")<0&&(d+=e+\" \");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||\"string\"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||\"\").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(\" \"+c.className+\" \").replace(ab,\" \"):\"\")){f=0;while(e=b[f++])while(d.indexOf(\" \"+e+\" \")>=0)d=d.replace(\" \"+e+\" \",\" \");g=a?n.trim(d):\"\",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return\"boolean\"==typeof b&&\"string\"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if(\"string\"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||\"boolean\"===c)&&(this.className&&L.set(this,\"__className__\",this.className),this.className=this.className||a===!1?\"\":L.get(this,\"__className__\")||\"\")})},hasClass:function(a){for(var b=\" \"+a+\" \",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(\" \"+this[c].className+\" \").replace(ab,\" \").indexOf(b)>=0)return!0;return!1}});var bb=/\\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e=\"\":\"number\"==typeof e?e+=\"\":n.isArray(e)&&(e=n.map(e,function(a){return null==a?\"\":a+\"\"})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&\"set\"in b&&void 0!==b.set(this,e,\"value\")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&\"get\"in b&&void 0!==(c=b.get(e,\"value\"))?c:(c=e.value,\"string\"==typeof c?c.replace(bb,\"\"):null==c?\"\":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,\"value\");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f=\"select-one\"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute(\"disabled\"))||c.parentNode.disabled&&n.nodeName(c.parentNode,\"optgroup\"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each([\"radio\",\"checkbox\"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute(\"value\")?\"on\":a.value})}),n.each(\"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu\".split(\" \"),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,\"**\"):this.off(b,a||\"**\",c)}});var cb=n.now(),db=/\\?/;n.parseJSON=function(a){return JSON.parse(a+\"\")},n.parseXML=function(a){var b,c;if(!a||\"string\"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,\"text/xml\")}catch(d){b=void 0}return(!b||b.getElementsByTagName(\"parsererror\").length)&&n.error(\"Invalid XML: \"+a),b};var eb=/#.*$/,fb=/([?&])_=[^&]*/,gb=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,hb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ib=/^(?:GET|HEAD)$/,jb=/^\\/\\//,kb=/^([\\w.+-]+:)(?:\\/\\/(?:[^\\/?#]*@|)([^\\/?#:]*)(?::(\\d+)|)|)/,lb={},mb={},nb=\"*/\".concat(\"*\"),ob=a.location.href,pb=kb.exec(ob.toLowerCase())||[];function qb(a){return function(b,c){\"string\"!=typeof b&&(c=b,b=\"*\");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])\"+\"===d[0]?(d=d.slice(1)||\"*\",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function rb(a,b,c,d){var e={},f=a===mb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return\"string\"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e[\"*\"]&&g(\"*\")}function sb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function tb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while(\"*\"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader(\"Content-Type\"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+\" \"+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function ub(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if(\"*\"===f)f=i;else if(\"*\"!==i&&i!==f){if(g=j[i+\" \"+f]||j[\"* \"+f],!g)for(e in j)if(h=e.split(\" \"),h[1]===f&&(g=j[i+\" \"+h[0]]||j[\"* \"+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a[\"throws\"])b=g(b);else try{b=g(b)}catch(l){return{state:\"parsererror\",error:g?l:\"No conversion from \"+i+\" to \"+f}}}return{state:\"success\",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ob,type:\"GET\",isLocal:hb.test(pb[1]),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":nb,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":n.parseJSON,\"text xml\":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?sb(sb(a,n.ajaxSettings),b):sb(n.ajaxSettings,a)},ajaxPrefilter:qb(lb),ajaxTransport:qb(mb),ajax:function(a,b){\"object\"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks(\"once memory\"),q=k.statusCode||{},r={},s={},t=0,u=\"canceled\",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=gb.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||ob)+\"\").replace(eb,\"\").replace(jb,pb[1]+\"//\"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||\"*\").toLowerCase().match(E)||[\"\"],null==k.crossDomain&&(h=kb.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===pb[1]&&h[2]===pb[2]&&(h[3]||(\"http:\"===h[1]?\"80\":\"443\"))===(pb[3]||(\"http:\"===pb[1]?\"80\":\"443\")))),k.data&&k.processData&&\"string\"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),rb(lb,k,b,v),2===t)return v;i=n.event&&k.global,i&&0===n.active++&&n.event.trigger(\"ajaxStart\"),k.type=k.type.toUpperCase(),k.hasContent=!ib.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(db.test(d)?\"&\":\"?\")+k.data,delete k.data),k.cache===!1&&(k.url=fb.test(d)?d.replace(fb,\"$1_=\"+cb++):d+(db.test(d)?\"&\":\"?\")+\"_=\"+cb++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader(\"If-Modified-Since\",n.lastModified[d]),n.etag[d]&&v.setRequestHeader(\"If-None-Match\",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader(\"Content-Type\",k.contentType),v.setRequestHeader(\"Accept\",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+(\"*\"!==k.dataTypes[0]?\", \"+nb+\"; q=0.01\":\"\"):k.accepts[\"*\"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u=\"abort\";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=rb(mb,k,b,v)){v.readyState=1,i&&m.trigger(\"ajaxSend\",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort(\"timeout\")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,\"No Transport\");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||\"\",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=tb(k,v,f)),u=ub(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader(\"Last-Modified\"),w&&(n.lastModified[d]=w),w=v.getResponseHeader(\"etag\"),w&&(n.etag[d]=w)),204===a||\"HEAD\"===k.type?x=\"nocontent\":304===a?x=\"notmodified\":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x=\"error\",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+\"\",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?\"ajaxSuccess\":\"ajaxError\",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger(\"ajaxComplete\",[v,k]),--n.active||n.event.trigger(\"ajaxStop\")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,\"json\")},getScript:function(a,b){return n.get(a,void 0,b,\"script\")}}),n.each([\"get\",\"post\"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n._evalUrl=function(a){return n.ajax({url:a,type:\"GET\",dataType:\"script\",async:!1,global:!1,\"throws\":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,\"body\")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var vb=/%20/g,wb=/\\[\\]$/,xb=/\\r?\\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;function Ab(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||wb.test(a)?d(a,e):Ab(a+\"[\"+(\"object\"==typeof e?b:\"\")+\"]\",e,c,d)});else if(c||\"object\"!==n.type(b))d(a,b);else for(e in b)Ab(a+\"[\"+e+\"]\",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?\"\":b,d[d.length]=encodeURIComponent(a)+\"=\"+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Ab(c,a[c],b,e);return d.join(\"&\").replace(vb,\"+\")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,\"elements\");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(\":disabled\")&&zb.test(this.nodeName)&&!yb.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(xb,\"\\r\\n\")}}):{name:b.name,value:c.replace(xb,\"\\r\\n\")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Bb=0,Cb={},Db={0:200,1223:204},Eb=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent(\"onunload\",function(){for(var a in Cb)Cb[a]()}),k.cors=!!Eb&&\"withCredentials\"in Eb,k.ajax=Eb=!!Eb,n.ajaxTransport(function(a){var b;return k.cors||Eb&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Bb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c[\"X-Requested-With\"]||(c[\"X-Requested-With\"]=\"XMLHttpRequest\");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Cb[g],b=f.onload=f.onerror=null,\"abort\"===a?f.abort():\"error\"===a?d(f.status,f.statusText):d(Db[f.status]||f.status,f.statusText,\"string\"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b(\"error\"),b=Cb[g]=b(\"abort\");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/(?:java|ecma)script/},converters:{\"text script\":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter(\"script\",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type=\"GET\")}),n.ajaxTransport(\"script\",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n(\"<script>\").prop({async:!0,charset:a.scriptCharset,src:a.url}).on(\"load error\",c=function(a){b.remove(),c=null,a&&e(\"error\"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Fb=[],Gb=/(=)\\?(?=&|$)|\\?\\?/;n.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var a=Fb.pop()||n.expando+\"_\"+cb++;return this[a]=!0,a}}),n.ajaxPrefilter(\"json jsonp\",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Gb.test(b.url)?\"url\":\"string\"==typeof b.data&&!(b.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Gb.test(b.data)&&\"data\");return h||\"jsonp\"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Gb,\"$1\"+e):b.jsonp!==!1&&(b.url+=(db.test(b.url)?\"&\":\"?\")+b.jsonp+\"=\"+e),b.converters[\"script json\"]=function(){return g||n.error(e+\" was not called\"),g[0]},b.dataTypes[0]=\"json\",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Fb.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),\"script\"):void 0}),n.parseHTML=function(a,b,c){if(!a||\"string\"!=typeof a)return null;\"boolean\"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Hb=n.fn.load;n.fn.load=function(a,b,c){if(\"string\"!=typeof a&&Hb)return Hb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(\" \");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&\"object\"==typeof b&&(e=\"POST\"),g.length>0&&n.ajax({url:a,type:e,dataType:\"html\",data:b}).done(function(a){f=arguments,g.html(d?n(\"<div>\").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Ib=a.document.documentElement;function Jb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,\"position\"),l=n(a),m={};\"static\"===k&&(a.style.position=\"relative\"),h=l.offset(),f=n.css(a,\"top\"),i=n.css(a,\"left\"),j=(\"absolute\"===k||\"fixed\"===k)&&(f+i).indexOf(\"auto\")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),\"using\"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Jb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return\"fixed\"===n.css(c,\"position\")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],\"html\")||(d=a.offset()),d.top+=n.css(a[0],\"borderTopWidth\",!0),d.left+=n.css(a[0],\"borderLeftWidth\",!0)),{top:b.top-d.top-n.css(c,\"marginTop\",!0),left:b.left-d.left-n.css(c,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Ib;while(a&&!n.nodeName(a,\"html\")&&\"static\"===n.css(a,\"position\"))a=a.offsetParent;return a||Ib})}}),n.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(b,c){var d=\"pageYOffset\"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Jb(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each([\"top\",\"left\"],function(a,b){n.cssHooks[b]=ya(k.pixelPosition,function(a,c){return c?(c=xa(a,b),va.test(c)?n(a).position()[b]+\"px\":c):void 0})}),n.each({Height:\"height\",Width:\"width\"},function(a,b){n.each({padding:\"inner\"+a,content:b,\"\":\"outer\"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||\"boolean\"!=typeof d),g=c||(d===!0||e===!0?\"margin\":\"border\");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement[\"client\"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body[\"scroll\"+a],e[\"scroll\"+a],b.body[\"offset\"+a],e[\"offset\"+a],e[\"client\"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return n});var Kb=a.jQuery,Lb=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Lb),b&&a.jQuery===n&&(a.jQuery=Kb),n},typeof b===U&&(a.jQuery=a.$=n),n});\r\n//# sourceMappingURL=jquery.min.map",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/jquery.min.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 147,
    "kind": "file",
    "name": "src/client/lib/require.js",
    "content": "/** vim: et:ts=4:sw=4:sts=4\n * @license RequireJS 2.3.5 Copyright jQuery Foundation and other contributors.\n * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE\n */\nvar requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||\"\"}function isFunction(e){return\"[object Function]\"===ostring.call(e)}function isArray(e){return\"[object Array]\"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,r){return t&&eachProp(t,function(t,n){!i&&hasProp(e,n)||(!r||\"object\"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[n]=t:(e[n]||(e[n]={}),mixin(e[n],t,i,r)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName(\"script\")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split(\".\"),function(e){t=t[e]}),t}function makeError(e,t,i,r){var n=new Error(t+\"\\nhttp://requirejs.org/docs/errors.html#\"+e);return n.requireType=e,n.requireModules=r,i&&(n.originalError=i),n}function newContext(e){function t(e){var t,i;for(t=0;t<e.length;t++)if(\".\"===(i=e[t]))e.splice(t,1),t-=1;else if(\"..\"===i){if(0===t||1===t&&\"..\"===e[2]||\"..\"===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,r){var n,o,a,s,u,c,d,p,f,l,h=i&&i.split(\"/\"),m=y.map,g=m&&m[\"*\"];if(e&&(c=(e=e.split(\"/\")).length-1,y.nodeIdCompat&&jsSuffixRegExp.test(e[c])&&(e[c]=e[c].replace(jsSuffixRegExp,\"\")),\".\"===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),t(e),e=e.join(\"/\")),r&&m&&(h||g)){e:for(a=(o=e.split(\"/\")).length;a>0;a-=1){if(u=o.slice(0,a).join(\"/\"),h)for(s=h.length;s>0;s-=1)if((n=getOwn(m,h.slice(0,s).join(\"/\")))&&(n=getOwn(n,u))){d=n,p=a;break e}!f&&g&&getOwn(g,u)&&(f=getOwn(g,u),l=a)}!d&&f&&(d=f,p=l),d&&(o.splice(0,p,d),e=o.join(\"/\"))}return getOwn(y.pkgs,e)||e}function r(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute(\"data-requiremodule\")===e&&t.getAttribute(\"data-requirecontext\")===q.contextName)return t.parentNode.removeChild(t),!0})}function n(e){var t=getOwn(y.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),q.require.undef(e),q.makeRequire(null,{skipMap:!0})([e]),!0}function o(e){var t,i=e?e.indexOf(\"!\"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function a(e,t,r,n){var a,s,u,c,d=null,p=t?t.name:null,f=e,l=!0,h=\"\";return e||(l=!1,e=\"_@r\"+(T+=1)),c=o(e),d=c[0],e=c[1],d&&(d=i(d,p,n),s=getOwn(j,d)),e&&(d?h=r?e:s&&s.normalize?s.normalize(e,function(e){return i(e,p,n)}):-1===e.indexOf(\"!\")?i(e,p,n):e:(d=(c=o(h=i(e,p,n)))[0],h=c[1],r=!0,a=q.nameToUrl(h))),u=!d||s||r?\"\":\"_unnormalized\"+(A+=1),{prefix:d,name:h,parentMap:t,unnormalized:!!u,url:a,originalName:f,isDefine:l,id:(d?d+\"!\"+h:h)+u}}function s(e){var t=e.id,i=getOwn(S,t);return i||(i=S[t]=new q.Module(e)),i}function u(e,t,i){var r=e.id,n=getOwn(S,r);!hasProp(j,r)||n&&!n.defineEmitComplete?(n=s(e)).error&&\"error\"===t?i(n.error):n.on(t,i):\"defined\"===t&&i(j[r])}function c(e,t){var i=e.requireModules,r=!1;t?t(e):(each(i,function(t){var i=getOwn(S,t);i&&(i.error=e,i.events.error&&(r=!0,i.emit(\"error\",e)))}),r||req.onError(e))}function d(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];\"string\"==typeof t&&(q.defQueueMap[t]=!0),O.push(e)}),globalDefQueue=[])}function p(e){delete S[e],delete k[e]}function f(e,t,i){var r=e.map.id;e.error?e.emit(\"error\",e.error):(t[r]=!0,each(e.depMaps,function(r,n){var o=r.id,a=getOwn(S,o);!a||e.depMatched[n]||i[o]||(getOwn(t,o)?(e.defineDep(n,j[o]),e.check()):f(a,t,i))}),i[r]=!0)}function l(){var e,t,i=1e3*y.waitSeconds,o=i&&q.startTime+i<(new Date).getTime(),a=[],s=[],u=!1,d=!0;if(!x){if(x=!0,eachProp(k,function(e){var i=e.map,c=i.id;if(e.enabled&&(i.isDefine||s.push(e),!e.error))if(!e.inited&&o)n(c)?(t=!0,u=!0):(a.push(c),r(c));else if(!e.inited&&e.fetched&&i.isDefine&&(u=!0,!i.prefix))return d=!1}),o&&a.length)return e=makeError(\"timeout\",\"Load timeout for modules: \"+a,null,a),e.contextName=q.contextName,c(e);d&&each(s,function(e){f(e,{},{})}),o&&!t||!u||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,l()},50)),x=!1}}function h(e){hasProp(j,e[0])||s(a(e[0],null,!0)).init(e[1],e[2])}function m(e,t,i,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(i,t,!1)}function g(e){var t=e.currentTarget||e.srcElement;return m(t,q.onScriptLoad,\"load\",\"onreadystatechange\"),m(t,q.onScriptError,\"error\"),{node:t,id:t&&t.getAttribute(\"data-requiremodule\")}}function v(){var e;for(d();O.length;){if(null===(e=O.shift())[0])return c(makeError(\"mismatch\",\"Mismatched anonymous define() module: \"+e[e.length-1]));h(e)}q.defQueueMap={}}var x,b,q,E,w,y={waitSeconds:7,baseUrl:\"./\",paths:{},bundles:{},pkgs:{},shim:{},config:{}},S={},k={},M={},O=[],j={},P={},R={},T=1,A=1;return E={require:function(e){return e.require?e.require:e.require=q.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?j[e.map.id]=e.exports:e.exports=j[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(y.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn(M,e.id)||{},this.map=e,this.shim=getOwn(y.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,i,r){r=r||{},this.inited||(this.factory=t,i?this.on(\"error\",i):this.events.error&&(i=bind(this,function(e){this.emit(\"error\",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,q.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();q.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;P[e]||(P[e]=!0,q.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,r=this.depExports,n=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit(\"error\",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{n=q.execCb(i,o,r,n)}catch(t){e=t}else n=q.execCb(i,o,r,n);if(this.map.isDefine&&void 0===n&&((t=this.module)?n=t.exports:this.usingExports&&(n=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?\"define\":\"require\",c(this.error=e)}else n=o;if(this.exports=n,this.map.isDefine&&!this.ignore&&(j[i]=n,req.onResourceLoad)){var a=[];each(this.depMaps,function(e){a.push(e.normalizedMap||e)}),req.onResourceLoad(q,this.map,a)}p(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit(\"defined\",this.exports),this.defineEmitComplete=!0)}}else hasProp(q.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,r=a(e.prefix);this.depMaps.push(r),u(r,\"defined\",bind(this,function(r){var n,o,d,f=getOwn(R,this.map.id),l=this.map.name,h=this.map.parentMap?this.map.parentMap.name:null,m=q.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(r.normalize&&(l=r.normalize(l,function(e){return i(e,h,!0)})||\"\"),o=a(e.prefix+\"!\"+l,this.map.parentMap,!0),u(o,\"defined\",bind(this,function(e){this.map.normalizedMap=o,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((d=getOwn(S,o.id))&&(this.depMaps.push(o),this.events.error&&d.on(\"error\",bind(this,function(e){this.emit(\"error\",e)})),d.enable()))):f?(this.map.url=q.nameToUrl(f),void this.load()):((n=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(S,function(e){0===e.map.id.indexOf(t+\"_unnormalized\")&&p(e.map.id)}),c(e)}),n.fromText=bind(this,function(i,r){var o=e.name,u=a(o),d=useInteractive;r&&(i=r),d&&(useInteractive=!1),s(u),hasProp(y.config,t)&&(y.config[o]=y.config[t]);try{req.exec(i)}catch(e){return c(makeError(\"fromtexteval\",\"fromText eval for \"+t+\" failed: \"+e,e,[t]))}d&&(useInteractive=!0),this.depMaps.push(u),q.completeLoad(o),m([o],n)}),void r.load(e.name,m,n,y))})),q.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){k[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,r,n;if(\"string\"==typeof e){if(e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,n=getOwn(E,e.id))return void(this.depExports[t]=n(this));this.depCount+=1,u(e,\"defined\",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?u(e,\"error\",bind(this,this.errback)):this.events.error&&u(e,\"error\",bind(this,function(e){this.emit(\"error\",e)}))}i=e.id,r=S[i],hasProp(E,i)||!r||r.enabled||q.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(S,e.id);t&&!t.enabled&&q.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),\"error\"===e&&delete this.events[e]}},q={config:y,contextName:e,registry:S,defined:j,urlFetched:P,defQueue:O,defQueueMap:{},Module:b,makeModuleMap:a,nextTick:req.nextTick,onError:c,configure:function(e){if(e.baseUrl&&\"/\"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+=\"/\"),\"string\"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,i){return(-1===i.indexOf(\"?\")?\"?\":\"&\")+t}}var i=y.shim,r={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){r[t]?(y[t]||(y[t]={}),mixin(y[t],e,!0,!0)):y[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(R[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=q.makeShimExports(e)),i[t]=e}),y.shim=i),e.packages&&each(e.packages,function(e){var t;t=(e=\"string\"==typeof e?{name:e}:e).name,e.location&&(y.paths[t]=e.location),y.pkgs[t]=e.name+\"/\"+(e.main||\"main\").replace(currDirRegExp,\"\").replace(jsSuffixRegExp,\"\")}),eachProp(S,function(e,t){e.inited||e.map.unnormalized||(e.map=a(t,null,!0))}),(e.deps||e.callback)&&q.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(t,n){function o(i,r,u){var d,p,f;return n.enableBuildCallback&&r&&isFunction(r)&&(r.__requireJsBuild=!0),\"string\"==typeof i?isFunction(r)?c(makeError(\"requireargs\",\"Invalid require call\"),u):t&&hasProp(E,i)?E[i](S[t.id]):req.get?req.get(q,i,t,o):(p=a(i,t,!1,!0),d=p.id,hasProp(j,d)?j[d]:c(makeError(\"notloaded\",'Module name \"'+d+'\" has not been loaded yet for context: '+e+(t?\"\":\". Use require([])\")))):(v(),q.nextTick(function(){v(),(f=s(a(null,t))).skipMap=n.skipMap,f.init(i,r,u,{enabled:!0}),l()}),o)}return n=n||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var r,n=e.lastIndexOf(\".\"),o=e.split(\"/\")[0],a=\".\"===o||\"..\"===o;return-1!==n&&(!a||n>1)&&(r=e.substring(n,e.length),e=e.substring(0,n)),q.nameToUrl(i(e,t&&t.id,!0),r,!0)},defined:function(e){return hasProp(j,a(e,t,!1,!0).id)},specified:function(e){return e=a(e,t,!1,!0).id,hasProp(j,e)||hasProp(S,e)}}),t||(o.undef=function(e){d();var i=a(e,t,!0),n=getOwn(S,e);n.undefed=!0,r(e),delete j[e],delete P[i.url],delete M[e],eachReverse(O,function(t,i){t[0]===e&&O.splice(i,1)}),delete q.defQueueMap[e],n&&(n.events.defined&&(M[e]=n.events),p(e))}),o},enable:function(e){getOwn(S,e.id)&&s(e).enable()},completeLoad:function(e){var t,i,r,o=getOwn(y.shim,e)||{},a=o.exports;for(d();O.length;){if(null===(i=O.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);h(i)}if(q.defQueueMap={},r=getOwn(S,e),!t&&!hasProp(j,e)&&r&&!r.inited){if(!(!y.enforceDefine||a&&getGlobal(a)))return n(e)?void 0:c(makeError(\"nodefine\",\"No define call for \"+e,null,[e]));h([e,o.deps||[],o.exportsFn])}l()},nameToUrl:function(e,t,i){var r,n,o,a,s,u,c,d=getOwn(y.pkgs,e);if(d&&(e=d),c=getOwn(R,e))return q.nameToUrl(c,t,i);if(req.jsExtRegExp.test(e))s=e+(t||\"\");else{for(r=y.paths,o=(n=e.split(\"/\")).length;o>0;o-=1)if(a=n.slice(0,o).join(\"/\"),u=getOwn(r,a)){isArray(u)&&(u=u[0]),n.splice(0,o,u);break}s=n.join(\"/\"),s=(\"/\"===(s+=t||(/^data\\:|^blob\\:|\\?/.test(s)||i?\"\":\".js\")).charAt(0)||s.match(/^[\\w\\+\\.\\-]+:/)?\"\":y.baseUrl)+s}return y.urlArgs&&!/^blob\\:/.test(s)?s+y.urlArgs(e,s):s},load:function(e,t){req.load(q,e,t)},execCb:function(e,t,i,r){return t.apply(r,i)},onScriptLoad:function(e){if(\"load\"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=g(e);q.completeLoad(t.id)}},onScriptError:function(e){var t=g(e);if(!n(t.id)){var i=[];return eachProp(S,function(e,r){0!==r.indexOf(\"_@r\")&&each(e.depMaps,function(e){if(e.id===t.id)return i.push(r),!0})}),c(makeError(\"scripterror\",'Script error for \"'+t.id+(i.length?'\", needed by: '+i.join(\", \"):'\"'),e,[t.id]))}}},q.require=q.makeRequire(),q}function getInteractiveScript(){return interactiveScript&&\"interactive\"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if(\"interactive\"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version=\"2.3.5\",commentRegExp=/\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/gm,cjsRequireRegExp=/[^.]\\s*require\\s*\\(\\s*[\"']([^'\"\\s]+)[\"']\\s*\\)/g,jsSuffixRegExp=/\\.js$/,currDirRegExp=/^\\.\\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!(\"undefined\"==typeof window||\"undefined\"==typeof navigator||!window.document),isWebWorker=!isBrowser&&\"undefined\"!=typeof importScripts,readyRegExp=isBrowser&&\"PLAYSTATION 3\"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName=\"_\",isOpera=\"undefined\"!=typeof opera&&\"[object Opera]\"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,r){var n,o,a=defContextName;return isArray(e)||\"string\"==typeof e||(o=e,isArray(t)?(e=t,t=i,i=r):e=[]),o&&o.context&&(a=o.context),(n=getOwn(contexts,a))||(n=contexts[a]=req.s.newContext(a)),o&&n.configure(o),n.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\\/|:|\\?|\\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each([\"toUrl\",\"undef\",\"defined\",\"specified\"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName(\"head\")[0],(baseElement=document.getElementsByTagName(\"base\")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var r=e.xhtml?document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"html:script\"):document.createElement(\"script\");return r.type=e.scriptType||\"text/javascript\",r.charset=\"utf-8\",r.async=!0,r},req.load=function(e,t,i){var r,n=e&&e.config||{};if(isBrowser)return(r=req.createNode(n,t,i)).setAttribute(\"data-requirecontext\",e.contextName),r.setAttribute(\"data-requiremodule\",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf(\"[native code\")<0||isOpera?(r.addEventListener(\"load\",e.onScriptLoad,!1),r.addEventListener(\"error\",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent(\"onreadystatechange\",e.onScriptLoad)),r.src=i,n.onNodeCreated&&n.onNodeCreated(r,n,t,i),currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(t)}catch(r){e.onError(makeError(\"importscripts\",\"importScripts failed for \"+t+\" at \"+i,r,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute(\"data-main\"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf(\"!\")||(src=mainScript.split(\"/\"),mainScript=src.pop(),subPath=src.length?src.join(\"/\")+\"/\":\"./\",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,\"\"),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var r,n;\"string\"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?[\"require\"]:[\"require\",\"exports\",\"module\"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript())&&(e||(e=r.getAttribute(\"data-requiremodule\")),n=contexts[r.getAttribute(\"data-requirecontext\")]),n?(n.defQueue.push([e,t,i]),n.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,\"undefined\"==typeof setTimeout?void 0:setTimeout);",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/lib/require.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 148,
    "kind": "file",
    "name": "src/client/loaders/loadList.js",
    "content": "/* ================================================== */\n/** Base Configuration Variables */\n/* ================================================== */\n\nvar configFileDir = '../../../config/';\nvar fileExtension = '.json';\nvar requestValue = 'GET';\nvar localDicomServerPath = 'http://localhost:8042/';\n\n/* ================================================== */\n\n\n/* ================================================== */\n/** Environment Configuration Variables */\n/* ================================================== */\n\nvar configEnvFileName = 'env';\nvar envFileFull = configEnvFileName + fileExtension;\nvar configEnvFilePath = configFileDir + envFileFull;\n\n/* ================================================== */\n\n\n/* ================================================== */\n/**\n *\n * Load JSON configuration data from the sercer using\n * GET HTTP request\n *\n */\n/* ================================================== */\n\nvar requestEnv = new XMLHttpRequest();\n\nrequestEnv.open(requestValue, configEnvFilePath, false);\nrequestEnv.send(null);\n\nvar configEnvObject = JSON.parse(requestEnv.responseText);\nvar configFileName = configEnvObject.environment;\n\n/* ================================================== */\n/* ================================================== */\n/* ================================================== */\n\n\n/* ================================================== */\n/** Main Configuration Variables */\n/* ================================================== */\n\nvar fileFull = configFileName + fileExtension;\nvar configFilePath = configFileDir + fileFull;\n\n/* ================================================== */\n\n\n/* ================================================== */\n/**\n *\n * Load JSON configuration data from the sercer using\n * GET HTTP request\n *\n */\n/* ================================================== */\n\nvar request = new XMLHttpRequest();\n\nrequest.open(requestValue, configFilePath, false);\nrequest.send(null);\n\nvar configObject = JSON.parse(request.responseText);\nvar dicomServerValue = configObject.dicomServer;\nvar protocolValue = dicomServerValue[0].transferProtocol;\nvar prefixValue = dicomServerValue[0].prefix;\nvar hostnameValue = dicomServerValue[0].hostname;\nvar portEscapeValue = dicomServerValue[0].portEscape;\nvar portValue = dicomServerValue[0].port;\nvar suffixValue = dicomServerValue[0].suffix;\n\nvar refStartValue = protocolValue + prefixValue;\nvar refEndValue = portEscapeValue + portValue + suffixValue;\n\nvar dicomServerPath = refStartValue + hostnameValue + refEndValue;\n\n// console.log('Local DICOM Server Path:\\n', localDicomServerPath);\n// console.log('Current DICOM Server Path:\\n', dicomServerPath);\n\n/* ================================================== */\n/* ================================================== */\n/* ================================================== */\n\n\n/* ================================================== */\n/** Source Variable Definitions */\n/* ================================================== */\n\nvar studyListData = [];\nvar studyList = {};\nvar studies = [];\nvar studiesDataStructure = {};\nvar patientList = {};\nvar studiesList = [];\nvar studiesObjectData = [];\nvar seriesList = [];\nvar seriesObjectData = [];\nvar instanceList = [];\nvar instanceObjectData = [];\n\n/* ================================================== */\n\n\n// console.log(\"Config File Path: \", configFilePath);\n\n\n/* ================================================== */\n/**\n *\n * Load JSON configuration data from the sercer using\n * GET HTTP request\n *\n */\n/* ================================================== */\n\nvar patientsExpandedQuery = 'patients?expand';\nvar patientsDirPath = 'patients' + '/';\nvar studiesDirPath = 'studies' + '/';\nvar seriesDirPath = 'series' + '/';\nvar instancesDirPath = 'instances' + '/';\n\nvar patientsExpandedPath = dicomServerPath + patientsExpandedQuery;\nvar studiesPath = dicomServerPath + studiesDirPath;\nvar seriesPath = dicomServerPath + seriesDirPath;\nvar instancesPath = dicomServerPath + instancesDirPath;\n\n/* ================================================== */\n/* ================================================== */\n/* ================================================== */\n\n\nconst callAPI = (url, meta) => {\n  return new Promise((resolve, reject) => {\n    $.getJSON(url + '&_=' + new Date().getTime(), function(data) {\n      resolve([data, meta]);\n    },\n    function(err) {\n      reject(err);\n    })\n  })\n}\n\n\n/**\n* Method to generate the Hierarchical data for patient.\n* The Structure will follow as\n* Patient = {\n  .....\n  Studies = [\n    {\n      ......\n      Series = [\n        {\n          ......\n          Instances = {\n            [\n\n            ]\n          }\n        }\n      ]\n    }\n  ]\n}\n*/\n\nasync function getStudyList(callback) {\n  var patients = await callAPI(patientsExpandedPath, patientList);\n  return Promise.all(patients).then(result => {\n    patientList = result[0];\n    for (var patientIndex = 0; patientIndex < patientList.length; patientIndex++) {\n      for (var study = 0; study < patientList[patientIndex].Studies.length; study++)\n        studiesList.push(patientList[patientIndex].Studies[study]);\n    }\n    getStudyListData(studiesList);\n  })\n}\n\nasync function getStudyListData(studiesList) {\n  var studiesDeferred = [];\n  for (var studyIndex = 0; studyIndex < studiesList.length; studyIndex++) {\n    studiesDeferred[studyIndex] = await callAPI(studiesPath + studiesList[studyIndex] + '?', patientList);\n  }\n  return Promise.all(studiesDeferred).then(deferredData => {\n    for (var index = 0; index < deferredData.length; index++) {\n      var studyData = deferredData[index][0];\n      studiesObjectData.push(studyData)\n      for (var series = 0; series < studyData.Series.length; series++) {\n        seriesList.push(studyData.Series[series]);\n      }\n    }\n    getSeriesListData(seriesList);\n  })\n}\n\nasync function getSeriesListData(seriesList) {\n  var studies = [];\n  for (var seriesIndex = 0; seriesIndex < seriesList.length; seriesIndex++) {\n    studies[seriesIndex] = await callAPI(seriesPath + seriesList[seriesIndex] + '?', patientList);\n  }\n  return Promise.all(studies).then(deferredData => {\n    for (var index = 0; index < deferredData.length; index++) {\n      var seriesData = deferredData[index][0];\n      seriesObjectData.push(seriesData)\n      for (var instance = 0; instance < seriesData.Instances.length; instance++) {\n        instanceList.push(seriesData.Instances[instance]);\n      }\n    }\n    getInstanceListData(instanceList);\n  })\n}\n\nasync function getInstanceListData(instanceList) {\n  var instanceDeferred = [];\n  for (var instanceIndex = 0; instanceIndex < instanceList.length; instanceIndex++) {\n    instanceDeferred[instanceIndex] = await callAPI(instancesPath + instanceList[instanceIndex] + '?', patientList);\n  }\n  return Promise.all(instanceDeferred).then(deferredData => {\n    for (var index = 0; index < deferredData.length; index++) {\n      var instanceData = deferredData[index][0];\n      instanceObjectData.push(instanceData)\n    }\n    mapInstanceInSeries();\n    mapSeriesInStudies();\n    mapStudiesInPatient();\n    UpdatePatientData(patientList);\n  })\n}\n\nvar mapInstanceInSeries = function() {\n  for (var x = 0; x < seriesObjectData.length; x++) {\n    seriesObjectData[x].InstanceData = [];\n    var newSeries = seriesObjectData[x].Instances.map(function(instance) {\n      var instanceObject = instanceObjectData.filter(data => data.ID == instance);\n      seriesObjectData[x].InstanceData.push(instanceObject[0]);\n    })\n  }\n}\n\nvar mapSeriesInStudies = function() {\n  for (var x = 0; x < studiesObjectData.length; x++) {\n    studiesObjectData[x].SeriesData = [];\n    var newStudies = studiesObjectData[x].Series.map(function(series) {\n      var seriesObject = seriesObjectData.filter(data => data.ID == series);\n      studiesObjectData[x].SeriesData.push(seriesObject[0]);\n    })\n  }\n}\n\nvar mapStudiesInPatient = function() {\n  for (var x = 0; x < patientList.length; x++) {\n    patientList[x].StudyData = [];\n    var newPatient = patientList[x].Studies.map(function(study) {\n      var studyObject = studiesObjectData.filter(data => data.ID == study);\n      patientList[x].StudyData.push(studyObject[0]);\n    })\n  }\n}\n\n// Study List -> sl\n\ngetStudyList((studyList) => {})\n\nvar UpdatePatientData = function(patients) {\n  if (patients.length > 0) {\n    for (var i = 0; i < patients.length; i++) {\n\n      var totalStudies = [];\n      var studyListDataStructure = {};\n      var studiesDataStructure = {};\n      var fileName;\n\n      for (var j = 0; j < patients[i].StudyData.length; j++) {\n        const slEach = patients[i].StudyData[j];\n        const slPatientAttr = slEach.PatientMainDicomTags;\n        const slMainAttr = slEach.MainDicomTags;\n        const slSeries = slEach.Series;\n\n        const slPatientName = slPatientAttr.PatientName;\n        const slPatientId = slPatientAttr.PatientID;\n        const slStudyDate = slMainAttr.StudyDate;\n        const slModality = slMainAttr.StudyDescription;\n        const slStudyDescription = slMainAttr.StudyDescription;\n        const slNumImages = slSeries.length;\n        const slStudyId = slEach.ID;\n\n        console.log(\"Get Study List From: \", JSON.stringify(slEach));\n        console.log(\"Patient Name: \", JSON.stringify(slPatientName));\n        console.log(\"Patient ID: \", JSON.stringify(slPatientId));\n        console.log(\"Study Date: \", JSON.stringify(slStudyDate));\n        console.log(\"Modality: \", JSON.stringify(slModality));\n        console.log(\"Study Description: \", JSON.stringify(slStudyDescription));\n        console.log(\"Number of Images: \", JSON.stringify(slNumImages));\n        console.log(\"Study ID: \", JSON.stringify(slStudyId));\n\n        //var fileName = slPatientName;\n        var fileName = slPatientId;\n        var seriesForFile = getSeriesForFile(patients[i].StudyData[j].SeriesData);\n\n        studyListDataStructure = {\n          \"patientName\": slPatientName,\n          \"patientId\": slPatientId,\n          \"studyDate\": slStudyDate,\n          \"modality\": slModality,\n          \"studyDescription\": slStudyDescription,\n          \"numImages\": seriesForFile.TotalInstance,\n          \"studyId\": fileName\n        };\n\n\n        studiesDataStructure = {\n          \"patientName\": slPatientName,\n          \"patientId\": slPatientId,\n          \"studyDate\": slStudyDate,\n          \"modality\": slModality,\n          \"studyDescription\": slStudyDescription,\n          \"numImages\": seriesForFile[0].instanceList.length, //slNumImages,\n          \"studyId\": slStudyId,\n          \"seriesList\": seriesForFile\n        };\n\n        totalStudies.push(studiesDataStructure);\n      };\n      studyListData[i] = studyListDataStructure;\n\n      var patientFile = {\n        \"fileName\": fileName,\n        \"fileData\": totalStudies\n      }\n      studies[i] = patientFile;\n    };\n\n    studyList = {\n      \"studyList\": studyListData\n    };\n    console.log(JSON.stringify(studies));\n\n    $.ajax({\n      url: '/UpdatePatients',\n      data: JSON.stringify(studyList),\n      type: 'POST',\n      success: function(data) {\n        console.log('File studyList.json successfully updated on server');\n      },\n      error: function(xhr, status, error) {\n        console.log('Error Occured while saving file');\n      }\n    });\n\n    var files = {\n      \"file\": studies\n    }\n\n    $.ajax({\n      url: '/UpdatePatientFile',\n      data: JSON.stringify(files),\n      type: 'POST',\n      success: function(data) {\n        console.log('patients File saved successfully on server');\n      },\n      error: function(xhr, status, error) {\n        console.log('Error Occured while saving file');\n      }\n    });\n  } else {\n    UpdatePatientDataDefault();\n  }\n};\n\nvar getSeriesForFile = function(seriesData) {\n  var seriesFileData = new Array();\n  var totalInstanceCount = 0;\n  for (var index = 0; index < seriesData.length; index++) {\n    var series = seriesData[index];\n    var instanceForFile = getInstanceListForFile(series.InstanceData);\n    totalInstanceCount += instanceForFile.length;\n    if (series.InstanceData.length <= 1) {\n      seriesFileData.push(getSeriesDataStructure(series, instanceForFile));\n    } else {\n      if (series.MainDicomTags.Modality == 'MR') {\n        seriesFileData.push(getSeriesDataStructure(series, instanceForFile));\n      } else {\n        for (var ins = 0; ins < series.InstanceData.length; ins++) {\n          var currentInstance = new Array();\n          currentInstance.push(instanceForFile[ins]);\n          seriesFileData.push(getSeriesDataStructure(series, currentInstance));\n        }\n      }\n    }\n  }\n  seriesFileData.TotalInstance = totalInstanceCount;\n  return seriesFileData;\n}\n\nvar getSeriesDataStructure = function(series, instance) {\n  var seriesDataStructure = {\n    \"seriesDescription\": series.MainDicomTags.Modality,\n    \"seriesNumber\": series.MainDicomTags.SeriesNumber,\n    \"instanceList\": instance\n  };\n\n  return seriesDataStructure;\n}\n\nvar getInstanceListForFile = function(instanceData) {\n  var instanceFileData = new Array();\n  for (var index1 = 0; index1 < instanceData.length; index1++) {\n    var series = instanceData[index1];\n    var seriesDataStructure = {\n      \"imageId\": instanceData[index1].ID + '/file'\n    };\n    instanceFileData.push(seriesDataStructure);\n  }\n  return instanceFileData;\n}\n\nvar UpdatePatientDataDefault = function() {\n  var studyListDefault = {\n    \"studyList\": \"default\"\n  };\n\n  $.ajax({\n    url: '/UpdatePatients',\n    data: JSON.stringify(studyListDefault),\n    type: 'POST',\n    success: function(data) {\n      console.log('File studyList.json successfully updated on server');\n    },\n    error: function(xhr, status, error) {\n      console.log('Error Occured while saving file');\n    }\n  });\n}\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/loaders/loadList.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 149,
    "kind": "variable",
    "name": "configFileDir",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configFileDir",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "Base Configuration Variables",
    "lineNumber": 5,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 150,
    "kind": "variable",
    "name": "fileExtension",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~fileExtension",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 151,
    "kind": "variable",
    "name": "requestValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~requestValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 152,
    "kind": "variable",
    "name": "localDicomServerPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~localDicomServerPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 153,
    "kind": "variable",
    "name": "configEnvFileName",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configEnvFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "Environment Configuration Variables",
    "lineNumber": 17,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 154,
    "kind": "variable",
    "name": "envFileFull",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~envFileFull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 18,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 155,
    "kind": "variable",
    "name": "configEnvFilePath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configEnvFilePath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 19,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 156,
    "kind": "variable",
    "name": "requestEnv",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~requestEnv",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 33,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 157,
    "kind": "variable",
    "name": "configEnvObject",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configEnvObject",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 38,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 158,
    "kind": "variable",
    "name": "configFileName",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 39,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 159,
    "kind": "variable",
    "name": "fileFull",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~fileFull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "Main Configuration Variables",
    "lineNumber": 50,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 160,
    "kind": "variable",
    "name": "configFilePath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configFilePath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 51,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 161,
    "kind": "variable",
    "name": "request",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~request",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 65,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 162,
    "kind": "variable",
    "name": "configObject",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~configObject",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 70,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 163,
    "kind": "variable",
    "name": "dicomServerValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~dicomServerValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 71,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 164,
    "kind": "variable",
    "name": "protocolValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~protocolValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 72,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 165,
    "kind": "variable",
    "name": "prefixValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~prefixValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 73,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 166,
    "kind": "variable",
    "name": "hostnameValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~hostnameValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 74,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 167,
    "kind": "variable",
    "name": "portEscapeValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~portEscapeValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 75,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 168,
    "kind": "variable",
    "name": "portValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~portValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 76,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 169,
    "kind": "variable",
    "name": "suffixValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~suffixValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 77,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 170,
    "kind": "variable",
    "name": "refStartValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~refStartValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 79,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 171,
    "kind": "variable",
    "name": "refEndValue",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~refEndValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 80,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 172,
    "kind": "variable",
    "name": "dicomServerPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~dicomServerPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 82,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 173,
    "kind": "variable",
    "name": "studyListData",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studyListData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "Source Variable Definitions",
    "lineNumber": 96,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 174,
    "kind": "variable",
    "name": "studyList",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studyList",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 97,
    "undocument": true,
    "type": {
      "types": [
        "{}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 175,
    "kind": "variable",
    "name": "studies",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studies",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 98,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 176,
    "kind": "variable",
    "name": "studiesDataStructure",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studiesDataStructure",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 99,
    "undocument": true,
    "type": {
      "types": [
        "{}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 177,
    "kind": "variable",
    "name": "patientList",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~patientList",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 100,
    "undocument": true,
    "type": {
      "types": [
        "{}"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 178,
    "kind": "variable",
    "name": "studiesList",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studiesList",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 101,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 179,
    "kind": "variable",
    "name": "studiesObjectData",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studiesObjectData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 102,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 180,
    "kind": "variable",
    "name": "seriesList",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~seriesList",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 103,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 181,
    "kind": "variable",
    "name": "seriesObjectData",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~seriesObjectData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 104,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 182,
    "kind": "variable",
    "name": "instanceList",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~instanceList",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 105,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 183,
    "kind": "variable",
    "name": "instanceObjectData",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~instanceObjectData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 106,
    "undocument": true,
    "type": {
      "types": [
        "*[]"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 184,
    "kind": "variable",
    "name": "patientsExpandedQuery",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~patientsExpandedQuery",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 123,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 185,
    "kind": "variable",
    "name": "patientsDirPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~patientsDirPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 124,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 186,
    "kind": "variable",
    "name": "studiesDirPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studiesDirPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 125,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 187,
    "kind": "variable",
    "name": "seriesDirPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~seriesDirPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 126,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 188,
    "kind": "variable",
    "name": "instancesDirPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~instancesDirPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 127,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 189,
    "kind": "variable",
    "name": "patientsExpandedPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~patientsExpandedPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 129,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 190,
    "kind": "variable",
    "name": "studiesPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~studiesPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 130,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 191,
    "kind": "variable",
    "name": "seriesPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~seriesPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 131,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 192,
    "kind": "variable",
    "name": "instancesPath",
    "memberof": "src/client/loaders/loadList.js",
    "static": true,
    "longname": "src/client/loaders/loadList.js~instancesPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 132,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 193,
    "kind": "function",
    "name": "callAPI",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~callAPI",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 139,
    "undocument": true,
    "params": [
      {
        "name": "url",
        "types": [
          "*"
        ]
      },
      {
        "name": "meta",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 194,
    "kind": "function",
    "name": "getStudyList",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": true,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getStudyList",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": "Method to generate the Hierarchical data for patient.\nThe Structure will follow as\nPatient = {\n.....\nStudies = [\n{\n......\nSeries = [\n{\n......\nInstances = {\n[\n\n]\n}\n}\n]\n}\n]\n}",
    "lineNumber": 174,
    "params": [
      {
        "name": "callback",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 195,
    "kind": "function",
    "name": "getStudyListData",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": true,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getStudyListData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 186,
    "undocument": true,
    "params": [
      {
        "name": "studiesList",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 196,
    "kind": "function",
    "name": "getSeriesListData",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": true,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getSeriesListData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 203,
    "undocument": true,
    "params": [
      {
        "name": "seriesList",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 197,
    "kind": "function",
    "name": "getInstanceListData",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": true,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getInstanceListData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 220,
    "undocument": true,
    "params": [
      {
        "name": "instanceList",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 198,
    "kind": "function",
    "name": "mapInstanceInSeries",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~mapInstanceInSeries",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 237,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 199,
    "kind": "function",
    "name": "mapSeriesInStudies",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~mapSeriesInStudies",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 247,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 200,
    "kind": "function",
    "name": "mapStudiesInPatient",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~mapStudiesInPatient",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 257,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 201,
    "kind": "function",
    "name": "UpdatePatientData",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~UpdatePatientData",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 271,
    "undocument": true,
    "params": [
      {
        "name": "patients",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 202,
    "kind": "function",
    "name": "getSeriesForFile",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getSeriesForFile",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 377,
    "undocument": true,
    "params": [
      {
        "name": "seriesData",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 203,
    "kind": "function",
    "name": "getSeriesDataStructure",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getSeriesDataStructure",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 402,
    "undocument": true,
    "params": [
      {
        "name": "series",
        "types": [
          "*"
        ]
      },
      {
        "name": "instance",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 204,
    "kind": "function",
    "name": "getInstanceListForFile",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~getInstanceListForFile",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 412,
    "undocument": true,
    "params": [
      {
        "name": "instanceData",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 205,
    "kind": "function",
    "name": "UpdatePatientDataDefault",
    "memberof": "src/client/loaders/loadList.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadList.js~UpdatePatientDataDefault",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadList.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 424,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 206,
    "kind": "file",
    "name": "src/client/loaders/loadStudy.js",
    "content": "var studiesPath = '/src/common/studies/';\r\n\r\n/* ================================================== */\r\n/** Base Configuration Variables */\r\n/* ================================================== */\r\n\r\nvar configFileDir = '../../../config/';\r\nvar fileExtension = '.json';\r\nvar requestValue = 'GET';\r\nvar localDicomServerPath = 'http://localhost:8042/';\r\nvar responseProtocol = 'wadouri';\r\n\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/** Environment Configuration Variables */\r\n/* ================================================== */\r\n\r\nvar configEnvFileName = 'env';\r\nvar envFileFull = configEnvFileName + fileExtension;\r\nvar configEnvFilePath = configFileDir + envFileFull;\r\n\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/**\r\n *\r\n * Load JSON configuration data from the sercer using\r\n * GET HTTP request\r\n *\r\n */\r\n/* ================================================== */\r\n\r\nvar requestEnv = new XMLHttpRequest();\r\n\r\nrequestEnv.open(requestValue, configEnvFilePath, false);\r\nrequestEnv.send(null);\r\n\r\nvar configEnvObject = JSON.parse(requestEnv.responseText);\r\nvar configFileName = configEnvObject.environment;\r\n\r\n/* ================================================== */\r\n/* ================================================== */\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/** Main Configuration Variables */\r\n/* ================================================== */\r\n\r\nvar fileFull = configFileName + fileExtension;\r\nvar configFilePath = configFileDir + fileFull;\r\n\r\n/* ================================================== */\r\n\r\n\r\nconsole.log(\"Config File Path: \", configFilePath);\r\n\r\n\r\n/* ================================================== */\r\n/**\r\n *\r\n * Load JSON configuration data from the sercer using\r\n * GET HTTP request\r\n *\r\n */\r\n/* ================================================== */\r\n\r\nvar request = new XMLHttpRequest();\r\n\r\nrequest.open(requestValue, configFilePath, false);\r\nrequest.send(null);\r\n\r\nvar configObject = JSON.parse(request.responseText);\r\nvar dicomServerValue = configObject.dicomServer;\r\nvar protocolValue = dicomServerValue[0].serviceProtocol;\r\nvar prefixValue = dicomServerValue[0].prefix;\r\nvar hostnameValue = dicomServerValue[0].hostname;\r\nvar portEscapeValue = dicomServerValue[0].portEscape;\r\nvar portValue = dicomServerValue[0].port;\r\nvar suffixValue = dicomServerValue[0].suffix;\r\n\r\nvar refStartValue = protocolValue + prefixValue;\r\nvar refEndValue = portEscapeValue + portValue + suffixValue;\r\n\r\nvar dicomServerPath = refStartValue + hostnameValue + refEndValue;\r\n\r\nconsole.log('Local DICOM Server Path:\\n', localDicomServerPath);\r\nconsole.log('Current DICOM Server Path:\\n', dicomServerPath);\r\n\r\n/* ================================================== */\r\n/* ================================================== */\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/**\r\n *\r\n * Load JSON configuration data from the sercer using\r\n * GET HTTP request\r\n *\r\n */\r\n/* ================================================== */\r\n\r\nvar instancesDirPath = 'instances' + '/';\r\n\r\nvar instancesPath = dicomServerPath + instancesDirPath;\r\n\r\nconsole.log();\r\n\r\n/* ================================================== */\r\n/* ================================================== */\r\n/* ================================================== */\r\n\r\n\r\n// Load JSON study information for each study\r\nfunction loadStudy(studyViewer, viewportModel, studyId) {\r\n\r\n  // Get the JSON data for the selected studyId\r\n  $.getJSON(studiesPath + studyId, function(data) {\r\n\r\n    var imageViewer = new ImageViewer(studyViewer, viewportModel);\r\n    imageViewer.setLayout('1x1'); // default layout\r\n\r\n    function initViewports() {\r\n      imageViewer.forEachElement(function(el) {\r\n        cornerstone.enable(el);\r\n        $(el).droppable({\r\n          drop: function(evt, ui) {\r\n            var fromStack = $(ui.draggable.context).data('stack'),\r\n              toItem = $(this).data('index');\r\n            useItemStack(toItem, fromStack);\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // setup the tool buttons\r\n    setupButtons(studyViewer);\r\n\r\n    // layout choose\r\n    $(studyViewer).find('.choose-layout a').click(function() {\r\n      var previousUsed = [];\r\n      imageViewer.forEachElement(function(el, vp, i) {\r\n        if (!isNaN($(el).data('useStack'))) {\r\n          previousUsed.push($(el).data('useStack'));\r\n        }\r\n      });\r\n\r\n      var type = $(this).text();\r\n      imageViewer.setLayout(type);\r\n      initViewports();\r\n      resizeStudyViewer();\r\n      if (previousUsed.length > 0) {\r\n        previousUsed = previousUsed.slice(0, imageViewer.viewports.length);\r\n        var item = 0;\r\n        previousUsed.forEach(function(v) {\r\n          useItemStack(item++, v);\r\n        });\r\n      }\r\n\r\n      //return false;\r\n    });\r\n\r\n    // Load the first series into the viewport (?)\r\n    var stacks = [];\r\n    var currentStackIndex = 0;\r\n    var seriesIndex = 0;\r\n    var studiesIndex = 0;\r\n    for (var dataIndex = 0; dataIndex < data.length; dataIndex++) {\r\n      // Create a stack object for each series\r\n      data[dataIndex].seriesList.forEach(function(series) {\r\n        var stack = {\r\n          seriesDescription: series.seriesDescription,\r\n          stackId: series.seriesNumber,\r\n          imageIds: [],\r\n          seriesIndex: seriesIndex,\r\n          currentImageIdIndex: 0,\r\n          frameRate: series.frameRate\r\n        };\r\n\r\n\r\n        // Populate imageIds array with the imageIds from each series\r\n        // For series with frame information, get the image url's\r\n        // by requesting each frame\r\n        if (series.numberOfFrames !== undefined) {\r\n          var numberOfFrames = series.numberOfFrames;\r\n          for (var i = 0; i < numberOfFrames; i++) {\r\n            var imageId = series.instanceList[0].imageId + \"?frame=\" + i;\r\n            if (imageId.substr(0, 4) !== 'http') {\r\n              imageId = instancesPath + imageId;\r\n              console.log(\"DICOM ID: \", imageId);\r\n              studyViewer.roiData.dicom_id = imageId;\r\n            }\r\n            stack.imageIds.push(imageId);\r\n          }\r\n          // Otherwise, get each instance url\r\n        } else {\r\n          series.instanceList.forEach(function(image) {\r\n            var imageId = image.imageId;\r\n\r\n            if (image.imageId.substr(0, 4) !== 'http') {\r\n              imageId = instancesPath + image.imageId;\r\n              console.log(\"DICOM Image ID: \", image.imageId);\r\n            }\r\n            stack.imageIds.push(imageId);\r\n          });\r\n        }\r\n        // Move to next series\r\n        seriesIndex++;\r\n\r\n        // Add the series stack to the stacks array\r\n        imageViewer.stacks.push(stack);\r\n        studyViewer.roiData.stacks.push(stack);\r\n      });\r\n    }\r\n\r\n\r\n\r\n    // Resize the parent div of the viewport to fit the screen\r\n    var imageViewerElement = $(studyViewer).find('.imageViewer')[0];\r\n    var viewportWrapper = $(imageViewerElement).find('.viewportWrapper')[0];\r\n    var parentDiv = $(studyViewer).find('.viewer')[0];\r\n\r\n    //viewportWrapper.style.width = (parentDiv.style.width - 10) + \"px\";\r\n    //viewportWrapper.style.height = (window.innerHeight - 150) + \"px\";\r\n\r\n    var studyRow = $(studyViewer).find('.studyRow')[0];\r\n    var width = $(studyRow).width();\r\n\r\n    //$(parentDiv).width(width - 170);\r\n    //viewportWrapper.style.width = (parentDiv.style.width - 10) + \"px\";\r\n    //viewportWrapper.style.height = (window.innerHeight - 150) + \"px\";\r\n\r\n    // Get the viewport elements\r\n    var element = $(studyViewer).find('.viewport')[0];\r\n\r\n    // Image enable the dicomImage element\r\n    initViewports();\r\n    //cornerstone.enable(element);\r\n\r\n    // Get series list from the series thumbnails (?)\r\n    var seriesList = $(studyViewer).find('.thumbnails')[0];\r\n    imageViewer.stacks.forEach(function(stack, stackIndex) {\r\n\r\n      // Create series thumbnail item\r\n      var seriesEntry = '<a class=\"list-group-item\" + ' +\r\n        'oncontextmenu=\"return false\"' +\r\n        'unselectable=\"on\"' +\r\n        'onselectstart=\"return false;\"' +\r\n        'onmousedown=\"return false;\">' +\r\n        '<div class=\"csthumbnail\"' +\r\n        'oncontextmenu=\"return false\"' +\r\n        'unselectable=\"on\"' +\r\n        'onselectstart=\"return false;\"' +\r\n        'onmousedown=\"return false;\"></div>' +\r\n        \"<div class='text-center small'>\" + stack.seriesDescription + '</div></a>';\r\n\r\n      // Add to series list\r\n      var seriesElement = $(seriesEntry).appendTo(seriesList);\r\n\r\n      // Find thumbnail\r\n      var thumbnail = $(seriesElement).find('div')[0];\r\n\r\n      // Enable cornerstone on the thumbnail\r\n      cornerstone.enable(thumbnail);\r\n\r\n      // Have cornerstone load the thumbnail image\r\n      cornerstone.loadAndCacheImage(imageViewer.stacks[stack.seriesIndex].imageIds[0]).then(function(image) {\r\n        // Make the first thumbnail active\r\n        if (stack.seriesIndex === 0) {\r\n          $(seriesElement).addClass('active');\r\n        }\r\n        // Display the image\r\n        cornerstone.displayImage(thumbnail, image);\r\n        $(seriesElement).draggable({\r\n          helper: \"clone\"\r\n        });\r\n      });\r\n\r\n      // Handle thumbnail click\r\n      $(seriesElement).on('click touchstart', function() {\r\n        useItemStack(0, stackIndex);\r\n      }).data('stack', stackIndex);\r\n    });\r\n\r\n    function useItemStack(item, stack) {\r\n      studyViewer.roiData.currentStack = stack;\r\n      var imageId = imageViewer.stacks[stack].imageIds[0],\r\n        element = imageViewer.getElement(item);\r\n      if ($(element).data('waiting')) {\r\n        imageViewer.viewports[item].find('.overlay-text').remove();\r\n        $(element).data('waiting', false);\r\n      }\r\n      $(element).data('useStack', stack);\r\n\r\n      displayThumbnail(seriesList, $(seriesList).find('.list-group-item')[stack], element, imageViewer.stacks[stack], function(el, stack) {\r\n        if (!$(el).data('setup')) {\r\n          setupViewport(el, stack, this);\r\n          setupViewportOverlays(el, data);\r\n          $(el).data('setup', true);\r\n        }\r\n      });\r\n      /*cornerstone.loadAndCacheImage(imageId).then(function(image){\r\n          setupViewport(element, imageViewer.stacks[stack], image);\r\n          setupViewportOverlays(element, data);\r\n      });*/\r\n    }\r\n    // Resize study viewer\r\n    function resizeStudyViewer() {\r\n      var studyRow = $(studyViewer).find('.studyContainer')[0];\r\n      var height = $(studyRow).height();\r\n      var width = $(studyRow).width();\r\n      console.log($(studyRow).innerWidth(), $(studyRow).outerWidth(), $(studyRow).width());\r\n      $(seriesList).height(\"100%\");\r\n      $(parentDiv).width(width - $(studyViewer).find('.thumbnailSelector:eq(0)').width());\r\n      $(parentDiv).css({\r\n        height: '100%'\r\n      });\r\n      $(imageViewerElement).css({\r\n        height: $(parentDiv).height() - $(parentDiv).find('.text-center:eq(0)').height()\r\n      });\r\n\r\n      imageViewer.forEachElement(function(el, vp) {\r\n        cornerstone.resize(el, true);\r\n\r\n        if ($(el).data('waiting')) {\r\n          var ol = vp.find('.overlay-text');\r\n          if (ol.length < 1) {\r\n            ol = $('<div class=\"overlay overlay-text\">Please drag a stack onto here to view images.</div>').appendTo(vp);\r\n          }\r\n          var ow = vp.width() / 2,\r\n            oh = vp.height() / 2;\r\n          ol.css({\r\n            top: oh,\r\n            left: ow - (ol.width() / 2)\r\n          });\r\n        }\r\n      });\r\n    }\r\n    // Call resize viewer on window resize\r\n    $(window).resize(function() {\r\n      resizeStudyViewer();\r\n    });\r\n    resizeStudyViewer();\r\n    if (imageViewer.isSingle())\r\n      useItemStack(0, 0);\r\n\r\n  });\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/loaders/loadStudy.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 207,
    "kind": "variable",
    "name": "studiesPath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~studiesPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 208,
    "kind": "variable",
    "name": "configFileDir",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configFileDir",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": "Base Configuration Variables",
    "lineNumber": 7,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 209,
    "kind": "variable",
    "name": "fileExtension",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~fileExtension",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 210,
    "kind": "variable",
    "name": "requestValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~requestValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 9,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 211,
    "kind": "variable",
    "name": "localDicomServerPath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~localDicomServerPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 212,
    "kind": "variable",
    "name": "responseProtocol",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~responseProtocol",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 11,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 213,
    "kind": "variable",
    "name": "configEnvFileName",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configEnvFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": "Environment Configuration Variables",
    "lineNumber": 20,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 214,
    "kind": "variable",
    "name": "envFileFull",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~envFileFull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 21,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 215,
    "kind": "variable",
    "name": "configEnvFilePath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configEnvFilePath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 22,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 216,
    "kind": "variable",
    "name": "requestEnv",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~requestEnv",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 36,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 217,
    "kind": "variable",
    "name": "configEnvObject",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configEnvObject",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 41,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 218,
    "kind": "variable",
    "name": "configFileName",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 42,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 219,
    "kind": "variable",
    "name": "fileFull",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~fileFull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": "Main Configuration Variables",
    "lineNumber": 53,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 220,
    "kind": "variable",
    "name": "configFilePath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configFilePath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 54,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 221,
    "kind": "variable",
    "name": "request",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~request",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 71,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 222,
    "kind": "variable",
    "name": "configObject",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~configObject",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 76,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 223,
    "kind": "variable",
    "name": "dicomServerValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~dicomServerValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 77,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 224,
    "kind": "variable",
    "name": "protocolValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~protocolValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 78,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 225,
    "kind": "variable",
    "name": "prefixValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~prefixValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 79,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 226,
    "kind": "variable",
    "name": "hostnameValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~hostnameValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 80,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 227,
    "kind": "variable",
    "name": "portEscapeValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~portEscapeValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 228,
    "kind": "variable",
    "name": "portValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~portValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 82,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 229,
    "kind": "variable",
    "name": "suffixValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~suffixValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 83,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 230,
    "kind": "variable",
    "name": "refStartValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~refStartValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 85,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 231,
    "kind": "variable",
    "name": "refEndValue",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~refEndValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 86,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 232,
    "kind": "variable",
    "name": "dicomServerPath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~dicomServerPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 88,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 233,
    "kind": "variable",
    "name": "instancesDirPath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~instancesDirPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 107,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 234,
    "kind": "variable",
    "name": "instancesPath",
    "memberof": "src/client/loaders/loadStudy.js",
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~instancesPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 109,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 235,
    "kind": "function",
    "name": "loadStudy",
    "memberof": "src/client/loaders/loadStudy.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadStudy.js~loadStudy",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadStudy.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 119,
    "undocument": true,
    "params": [
      {
        "name": "studyViewer",
        "types": [
          "*"
        ]
      },
      {
        "name": "viewportModel",
        "types": [
          "*"
        ]
      },
      {
        "name": "studyId",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 236,
    "kind": "file",
    "name": "src/client/loaders/loadTemplate.js",
    "content": "function loadTemplate(url, callback) {\r\n  $.get(url, function(data) {\r\n    var parsed = $.parseHTML(data);\r\n    $.each(parsed, function(index, ele) {\r\n      if (ele.nodeName === 'DIV') {\r\n        var element = $(ele);\r\n        callback(element);\r\n      }\r\n    });\r\n  });\r\n\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/loaders/loadTemplate.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 237,
    "kind": "function",
    "name": "loadTemplate",
    "memberof": "src/client/loaders/loadTemplate.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/loaders/loadTemplate.js~loadTemplate",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/loaders/loadTemplate.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [
      {
        "name": "url",
        "types": [
          "*"
        ]
      },
      {
        "name": "callback",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 238,
    "kind": "file",
    "name": "src/client/main.js",
    "content": "const actualEnv = (env) => {\n  return env;\n}\n\nconsole.log('Configurations: OK');\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/main.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 239,
    "kind": "function",
    "name": "actualEnv",
    "memberof": "src/client/main.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/main.js~actualEnv",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/main.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [
      {
        "name": "env",
        "types": [
          "*"
        ]
      }
    ],
    "return": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 240,
    "kind": "file",
    "name": "src/client/modals/about.js",
    "content": "loadTemplate(\"templates/about.html\", function(element) {\r\n  $('body').append(element);\r\n  $(\"#about\").click(function() {\r\n    $(\"#aboutModal\").modal();\r\n  });\r\n});\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/modals/about.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 241,
    "kind": "file",
    "name": "src/client/modals/help.js",
    "content": "loadTemplate(\"templates/help.html\", function(element) {\r\n  $('body').append(element);\r\n  $(\"#help\").click(function() {\r\n    $(\"#helpModal\").modal();\r\n  });\r\n});\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/modals/help.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 242,
    "kind": "file",
    "name": "src/client/tools/disableAllTools.js",
    "content": "// Disable all tools\r\nfunction disableAllTools() {\r\n  forEachViewport(function(element) {\r\n    cornerstoneTools.wwwc.disable(element);\r\n    cornerstoneTools.pan.activate(element, 2); // 2 is middle mouse button\r\n    cornerstoneTools.zoom.activate(element, 4); // 4 is right mouse button\r\n    cornerstoneTools.probe.deactivate(element, 1);\r\n    cornerstoneTools.length.deactivate(element, 1);\r\n    cornerstoneTools.angle.deactivate(element, 1);\r\n    cornerstoneTools.ellipticalRoi.deactivate(element, 1);\r\n    cornerstoneTools.rectangleRoi.deactivate(element, 1);\r\n    cornerstoneTools.freehand.deactivate(element, 1);\r\n    cornerstoneTools.stackScroll.deactivate(element, 1);\r\n    cornerstoneTools.wwwcTouchDrag.deactivate(element);\r\n    cornerstoneTools.zoomTouchDrag.deactivate(element);\r\n    cornerstoneTools.panTouchDrag.deactivate(element);\r\n    cornerstoneTools.stackScrollTouchDrag.deactivate(element);\r\n  });\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/tools/disableAllTools.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 243,
    "kind": "function",
    "name": "disableAllTools",
    "memberof": "src/client/tools/disableAllTools.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/tools/disableAllTools.js~disableAllTools",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/disableAllTools.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 244,
    "kind": "file",
    "name": "src/client/tools/displayThumbnail.js",
    "content": "function displayThumbnail(seriesList, seriesElement, element, stack, loaded) {\r\n  // Deactivate other thumbnails\r\n  $(seriesList).find('a').each(function() {\r\n    $(this).removeClass('active');\r\n  });\r\n\r\n  // Make this series visible\r\n\r\n  // Make the selected thumbnail active\r\n  $(seriesElement).addClass('active');\r\n\r\n  var enabledImage = cornerstone.getEnabledElement(element);\r\n  if (enabledImage.image) {\r\n    // Stop clip from if playing on element\r\n    cornerstoneTools.stopClip(element);\r\n    // Disable stack scrolling\r\n    cornerstoneTools.stackScroll.disable(element);\r\n    // Enable stackScroll on selected series\r\n    cornerstoneTools.stackScroll.enable(element);\r\n  }\r\n\r\n  // Load the first image of the selected series stack\r\n  cornerstone.loadAndCacheImage(stack.imageIds[0]).then(function(image) {\r\n    if (loaded) {\r\n      loaded.call(image, element, stack);\r\n    }\r\n\r\n    // Get the state of the stack tool\r\n    var stackState = cornerstoneTools.getToolState(element, 'stack');\r\n    stackState.data[0] = stack;\r\n    stackState.data[0].currentImageIdIndex = 0;\r\n\r\n    // Get the default viewport\r\n    var defViewport = cornerstone.getDefaultViewport(element, image);\r\n    // Get the current series stack index\r\n    // Display the image\r\n    cornerstone.displayImage(element, image, defViewport);\r\n    // Fit the image to the viewport window\r\n    cornerstone.fitToWindow(element);\r\n\r\n    // Prefetch the remaining images in the stack (?)\r\n    cornerstoneTools.stackPrefetch.enable(element);\r\n\r\n    // Play clip if stack is a movie (has framerate)\r\n    if (stack.frameRate !== undefined) {\r\n      cornerstoneTools.playClip(element, stack.frameRate);\r\n    }\r\n  });\r\n};\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/tools/displayThumbnail.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 245,
    "kind": "function",
    "name": "displayThumbnail",
    "memberof": "src/client/tools/displayThumbnail.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/tools/displayThumbnail.js~displayThumbnail",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/displayThumbnail.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [
      {
        "name": "seriesList",
        "types": [
          "*"
        ]
      },
      {
        "name": "seriesElement",
        "types": [
          "*"
        ]
      },
      {
        "name": "element",
        "types": [
          "*"
        ]
      },
      {
        "name": "stack",
        "types": [
          "*"
        ]
      },
      {
        "name": "loaded",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 246,
    "kind": "file",
    "name": "src/client/tools/setupButtons.js",
    "content": "// File Management\r\nvar fileFormat = '.json';\r\nvar pathToSave = '../../dataset/';\r\n\r\n// Time Stamp\r\nvar currentDate = new Date();\r\nvar year = currentDate.getFullYear();\r\nvar yearString = year.toString();\r\nvar month = currentDate.getMonth() + 1; //Be careful! January is 0 not 1\r\nvar monthString = (month < 9 ? '0' : '') + (month);\r\nvar date = currentDate.getDate();\r\nvar dateString = (date < 9 ? '0' : '') + (date);\r\nvar hours = currentDate.getHours();\r\nvar hoursString = (hours < 9 ? '0' : '') + (hours);\r\nvar minutes = currentDate.getMinutes();\r\nvar minutesString = (minutes < 9 ? '0' : '') + (minutes);\r\nvar seconds = currentDate.getSeconds();\r\nvar secondsString = (seconds < 9 ? '0' : '') + (seconds);\r\nvar totalDate = yearString + monthString + dateString;\r\nvar totalTime = hoursString + minutesString + secondsString;\r\nvar timeStamp = totalDate + totalTime;\r\n\r\n// var http = require('http');\r\n\r\n// var server = http.createServer(function(req, res) {\r\n//   res.writeHead(200);\r\n//   res.end('Hello Http');\r\n// });\r\n// server.listen(8080);\r\n\r\nconst setupButtons = (studyViewer) => {\r\n  // Get the button elements\r\n  var buttons = $(studyViewer).find('button');\r\n\r\n  // Tool button event handlers that set the new active tool\r\n\r\n  // WW/WL\r\n  $(buttons[0]).on('click touchstart', function() {\r\n    disableAllTools();\r\n    forEachViewport(function(element) {\r\n      cornerstoneTools.wwwc.activate(element, 1);\r\n      cornerstoneTools.wwwcTouchDrag.activate(element);\r\n    });\r\n  });\r\n\r\n  // Invert\r\n  $(buttons[1]).on('click touchstart', function() {\r\n    disableAllTools();\r\n    forEachViewport(function(element) {\r\n      var viewport = cornerstone.getViewport(element);\r\n      // Toggle invert\r\n      if (viewport.invert === true) {\r\n        viewport.invert = false;\r\n      } else {\r\n        viewport.invert = true;\r\n      }\r\n      cornerstone.setViewport(element, viewport);\r\n    });\r\n  });\r\n\r\n  // Zoom\r\n  $(buttons[2]).on('click touchstart', function() {\r\n    disableAllTools();\r\n    forEachViewport(function(element) {\r\n      // 5 is right mouse button and left mouse button\r\n      cornerstoneTools.zoom.activate(element, 5);\r\n      cornerstoneTools.zoomTouchDrag.activate(element);\r\n    });\r\n  });\r\n\r\n  // Pan\r\n  $(buttons[3]).on('click touchstart', function() {\r\n    disableAllTools();\r\n    forEachViewport(function(element) {\r\n      // 3 is middle mouse button and left mouse button\r\n      cornerstoneTools.pan.activate(element, 3);\r\n      cornerstoneTools.panTouchDrag.activate(element);\r\n    });\r\n  });\r\n\r\n  // Stack scroll\r\n  $(buttons[4]).on('click touchstart', function() {\r\n    disableAllTools();\r\n    forEachViewport(function(element) {\r\n      cornerstoneTools.stackScroll.activate(element, 1);\r\n      cornerstoneTools.stackScrollTouchDrag.activate(element);\r\n    });\r\n  });\r\n\r\n  // Freehand ROI draw\r\n  $(buttons[5]).on('click touchstart', function() {\r\n    forEachViewport(function(element) {\r\n      cornerstoneTools.freehand.activate(element, 1);\r\n    });\r\n  });\r\n\r\n  // JSON Save Button\r\n  $(buttons[6]).on('click touchstart', function() {\r\n    disableAllTools();\r\n    forEachViewport(function(element) {\r\n\r\n      /**\r\n       * time_stamp => YYYYMMDDHHmmSS\r\n       *\r\n       * Y: Year\r\n       * M: Month\r\n       * D: Day\r\n       * H: Hour\r\n       * m: minute\r\n       * S: Second\r\n       *\r\n       */\r\n\r\n      var toolData = cornerstoneTools.getToolState(element, 'freehand');\r\n      var studyRoiData = studyViewer.roiData;\r\n      var studyCurrentStack = studyRoiData.currentStack;\r\n      var stack = studyRoiData.stacks[studyCurrentStack];\r\n      var dataStudyId = studyRoiData.studyId;\r\n      var dataPatientId = studyRoiData.patientId;\r\n      var sourceNameToSave = dataStudyId;\r\n      var fileNameToSave = sourceNameToSave + fileFormat;\r\n\r\n      console.log(\"Study ROI Data: \", studyRoiData);\r\n\r\n      if (toolData === undefined) {\r\n        return;\r\n      }\r\n\r\n      console.log(\"TimeStamp: \", timeStamp);\r\n\r\n      // The name of the file is the system studyId of the patient:\r\n      // timeStamp + studyId\r\n      // Example:\r\n      // 20180223203337 + 123456789\r\n      // Output File:\r\n      // 20180223203337123456789.json\r\n\r\n      console.log(\"Saved File Name: \", fileNameToSave);\r\n      stack.freehand = toolData.data;\r\n\r\n      console.log(studyRoiData);\r\n\r\n      // save json\r\n      // download(\r\n      //   studyRoiData,\r\n      //   fileNameToSave,\r\n      //   'application/octet-stream'\r\n      // );\r\n\r\n      var pathFileNameToSave = fileNameToSave;\r\n      var data = {\r\n        rawData: studyRoiData,\r\n        path: pathFileNameToSave\r\n      };\r\n\r\n      $.ajax({\r\n        url: '/SaveFile',\r\n        data: JSON.stringify(data),\r\n        dataType: \"text\",\r\n        type: 'POST',\r\n        success: function(data) {\r\n          console.log('File saved successfully on server');\r\n        },\r\n        error: function(xhr, status, error) {\r\n          console.log('Error Occured while saving file');\r\n        },\r\n      });\r\n    });\r\n  });\r\n\r\n  // Tooltips\r\n  $(buttons[0]).tooltip();\r\n  $(buttons[1]).tooltip();\r\n  $(buttons[2]).tooltip();\r\n  $(buttons[3]).tooltip();\r\n  $(buttons[4]).tooltip();\r\n  $(buttons[5]).tooltip();\r\n  $(buttons[6]).tooltip();\r\n\r\n  const download = (data, name, type) => {\r\n    var link = document.createElement(\"a\");\r\n    var data = JSON.stringify(data, null, 4);\r\n    var blob = new Blob([data], {\r\n      type: 'application/octet-stream'\r\n    });\r\n    var url = URL.createObjectURL(blob, {\r\n      type: type\r\n    });\r\n\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', name);\r\n\r\n    var event = document.createEvent('MouseEvents');\r\n    event.initMouseEvent(\r\n      'click',\r\n      true,\r\n      true,\r\n      window,\r\n      1,\r\n      0,\r\n      0,\r\n      0,\r\n      0,\r\n      false,\r\n      false,\r\n      false,\r\n      false,\r\n      0,\r\n      null\r\n    );\r\n    link.dispatchEvent(event);\r\n  }\r\n};\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/tools/setupButtons.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 247,
    "kind": "variable",
    "name": "fileFormat",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~fileFormat",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 248,
    "kind": "variable",
    "name": "pathToSave",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~pathToSave",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 249,
    "kind": "variable",
    "name": "currentDate",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~currentDate",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 6,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 250,
    "kind": "variable",
    "name": "year",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~year",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 7,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 251,
    "kind": "variable",
    "name": "yearString",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~yearString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 8,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 252,
    "kind": "variable",
    "name": "month",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~month",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 9,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 253,
    "kind": "variable",
    "name": "monthString",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~monthString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 10,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 254,
    "kind": "variable",
    "name": "date",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~date",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 11,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 255,
    "kind": "variable",
    "name": "dateString",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~dateString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 256,
    "kind": "variable",
    "name": "hours",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~hours",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 257,
    "kind": "variable",
    "name": "hoursString",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~hoursString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 14,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 258,
    "kind": "variable",
    "name": "minutes",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~minutes",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 259,
    "kind": "variable",
    "name": "minutesString",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~minutesString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 16,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 260,
    "kind": "variable",
    "name": "seconds",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~seconds",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 17,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 261,
    "kind": "variable",
    "name": "secondsString",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~secondsString",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 18,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 262,
    "kind": "variable",
    "name": "totalDate",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~totalDate",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 19,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 263,
    "kind": "variable",
    "name": "totalTime",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~totalTime",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 20,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 264,
    "kind": "variable",
    "name": "timeStamp",
    "memberof": "src/client/tools/setupButtons.js",
    "static": true,
    "longname": "src/client/tools/setupButtons.js~timeStamp",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 21,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 265,
    "kind": "function",
    "name": "setupButtons",
    "memberof": "src/client/tools/setupButtons.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/tools/setupButtons.js~setupButtons",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/tools/setupButtons.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 31,
    "undocument": true,
    "params": [
      {
        "name": "studyViewer",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 266,
    "kind": "file",
    "name": "src/client/viewport/forEachViewport.js",
    "content": "function forEachViewport(callback) {\r\n  var elements = $('.viewport');\r\n  $.each(elements, function(index, value) {\r\n    var element = value;\r\n    try {\r\n      callback(element);\r\n    } catch (e) {\r\n\r\n    }\r\n  });\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/viewport/forEachViewport.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 267,
    "kind": "function",
    "name": "forEachViewport",
    "memberof": "src/client/viewport/forEachViewport.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/viewport/forEachViewport.js~forEachViewport",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/viewport/forEachViewport.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [
      {
        "name": "callback",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 268,
    "kind": "file",
    "name": "src/client/viewport/imageViewer.js",
    "content": "// ImageViewer = function(root, viewport) {\r\n//   var self = this;\r\n\r\n//   self.root = root;\r\n//   self.stacks = [];\r\n//   self.viewports = [];\r\n//   self.layout = '1x1';\r\n//   self.viewportModel = viewport;\r\n\r\n//   self.setLayout = function(layout) {\r\n//     self.layout = layout;\r\n//     // TODO: create viewports\r\n//     var ab = self.getRowsCols(),\r\n//       a = ab[0],\r\n//       b = ab[1],\r\n//       numOfViewports = a * b,\r\n//       perWidth = 100 / b,\r\n//       perHeight = 100 / a;\r\n//     self.root.find('.imageViewer').html('');\r\n//     var i = 0;\r\n//     self.viewports = [];\r\n//     while (i < numOfViewports) {\r\n//       var elem = self.viewportModel.clone().css({\r\n//         width: perWidth + '%',\r\n//         height: perHeight + '%'\r\n//       }).appendTo(self.root.find('.imageViewer'));\r\n//       elem.find('.viewport').data('index', i).data('waiting', true);\r\n\r\n//       self.viewports.push(elem);\r\n//       i++;\r\n//     }\r\n//   }\r\n\r\n//   self.getRowsCols = function() {\r\n//     var s = self.layout.split(/x/);\r\n//     return [parseInt(s[0]), parseInt(s[1])];\r\n//   }\r\n\r\n//   self.isSingle = function() {\r\n//     return self.layout == '1x1';\r\n//   }\r\n\r\n//   self.getElement = function(item) {\r\n//     return self.viewports[item].find('.viewport')[0];\r\n//   }\r\n\r\n//   self.forEachElement = function(cb) {\r\n//     self.viewports.forEach(function(vp, i) {\r\n//       cb.call(self, vp.find('.viewport')[0], vp, i);\r\n//     });\r\n//   }\r\n// }\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/viewport/imageViewer.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 269,
    "kind": "file",
    "name": "src/client/viewport/setupViewport.js",
    "content": "function setupViewport(element, stack, image) {\r\n  // Display the image on the viewer element\r\n  cornerstone.displayImage(element, image);\r\n\r\n  // If it's a movie (has frames), then play the clip\r\n  if (stack.frameRate !== undefined) {\r\n    cornerstone.playClip(element, stack.frameRate);\r\n  }\r\n\r\n  // Activate mouse clicks, mouse wheel and touch\r\n  cornerstoneTools.mouseInput.enable(element);\r\n  cornerstoneTools.mouseWheelInput.enable(element);\r\n  cornerstoneTools.touchInput.enable(element);\r\n\r\n  // Enable all tools we want to use with this element\r\n  cornerstoneTools.wwwc.activate(element, 1); // ww/wc is the default tool for left mouse button\r\n  cornerstoneTools.pan.activate(element, 2); // pan is the default tool for middle mouse button\r\n  cornerstoneTools.zoom.activate(element, 4); // zoom is the default tool for right mouse button\r\n  cornerstoneTools.probe.enable(element);\r\n  cornerstoneTools.length.enable(element);\r\n  cornerstoneTools.ellipticalRoi.enable(element);\r\n  cornerstoneTools.rectangleRoi.enable(element);\r\n  cornerstoneTools.wwwcTouchDrag.activate(element);\r\n  cornerstoneTools.zoomTouchPinch.activate(element);\r\n  cornerstoneTools.freehand.activate(element);\r\n\r\n  // Stack tools\r\n  cornerstoneTools.addStackStateManager(element, ['playClip']);\r\n  cornerstoneTools.addToolState(element, 'stack', stack);\r\n  cornerstoneTools.stackScrollWheel.activate(element);\r\n  cornerstoneTools.stackPrefetch.enable(element);\r\n\r\n\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/viewport/setupViewport.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 270,
    "kind": "function",
    "name": "setupViewport",
    "memberof": "src/client/viewport/setupViewport.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/viewport/setupViewport.js~setupViewport",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/viewport/setupViewport.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [
      {
        "name": "element",
        "types": [
          "*"
        ]
      },
      {
        "name": "stack",
        "types": [
          "*"
        ]
      },
      {
        "name": "image",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 271,
    "kind": "file",
    "name": "src/client/viewport/setupViewportOverlays.js",
    "content": "function setupViewportOverlays(element, data) {\r\n  var parent = $(element).parent();\r\n\r\n  // Get the overlays\r\n  var childDivs = $(parent).find('.overlay');\r\n  var topLeft = $(childDivs[0]).find('div');\r\n  var topRight = $(childDivs[1]).find('div');\r\n  var bottomLeft = $(childDivs[2]).find('div');\r\n  var bottomRight = $(childDivs[3]).find('div');\r\n\r\n  // Set the overlay text\r\n  $(topLeft[0]).text(data.patientName);\r\n  $(topLeft[1]).text(data.patientId);\r\n  $(topRight[0]).text(data.studyDescription);\r\n  $(topRight[1]).text(data.studyDate);\r\n\r\n\r\n  // On new image (displayed?)\r\n  function onNewImage(e, eventData) {\r\n    // If we are currently playing a clip then update the FPS\r\n    // Get the state of the 'playClip tool'\r\n    var playClipToolData = cornerstoneTools.getToolState(element, 'playClip');\r\n\r\n    // If playing a clip ...\r\n    if (playClipToolData !== undefined && playClipToolData.data.length > 0 && playClipToolData.data[0].intervalId !== undefined && eventData.frameRate !== undefined) {\r\n\r\n      // Update FPS\r\n      $(bottomLeft[0]).text(\"FPS: \" + Math.round(eventData.frameRate));\r\n      console.log('frameRate: ' + e.frameRate);\r\n\r\n    } else {\r\n      // Set FPS empty if not playing a clip\r\n      if ($(bottomLeft[0]).text().length > 0) {\r\n        $(bottomLeft[0]).text(\"\");\r\n      }\r\n    }\r\n\r\n    var toolData = cornerstoneTools.getToolState(element, 'stack');\r\n    if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\r\n      return;\r\n    }\r\n    var stack = toolData.data[0];\r\n\r\n    // Update Image number overlay\r\n    $(bottomLeft[2]).text(\"Image # \" + (stack.currentImageIdIndex + 1) + \"/\" + stack.imageIds.length);\r\n  }\r\n  // Add a CornerstoneNewImage event listener on the 'element' (viewer) (?)\r\n  $(element).on(\"CornerstoneNewImage\", onNewImage);\r\n\r\n\r\n  // On image rendered\r\n  function onImageRendered(e, eventData) {\r\n    // Set zoom overlay text\r\n    $(bottomRight[0]).text(\"Zoom:\" + eventData.viewport.scale.toFixed(2));\r\n    // Set WW/WL overlay text\r\n    $(bottomRight[1]).text(\"WW/WL:\" + Math.round(eventData.viewport.voi.windowWidth) + \"/\" + Math.round(eventData.viewport.voi.windowCenter));\r\n    // Set render time overlay text\r\n    $(bottomLeft[1]).text(\"Render Time:\" + eventData.renderTimeInMs + \" ms\");\r\n  }\r\n  // Add a CornerstoneImageRendered event listener on the 'element' (viewer) (?)\r\n  $(element).on(\"CornerstoneImageRendered\", onImageRendered);\r\n\r\n\r\n}\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/client/viewport/setupViewportOverlays.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 272,
    "kind": "function",
    "name": "setupViewportOverlays",
    "memberof": "src/client/viewport/setupViewportOverlays.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/client/viewport/setupViewportOverlays.js~setupViewportOverlays",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/client/viewport/setupViewportOverlays.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [
      {
        "name": "element",
        "types": [
          "*"
        ]
      },
      {
        "name": "data",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 273,
    "kind": "file",
    "name": "src/server/index.js",
    "content": "var http = require('http');\r\nvar url = require(\"url\");\r\nvar path = require(\"path\");\r\nvar fs = require(\"fs\");\r\n\r\n/* ================================================== */\r\n/** Base Configuration Variables */\r\n/* ================================================== */\r\n\r\n// var configFilePrefix = '../../';\r\nvar configFilePrefix = '';\r\nvar configFileName = 'config';\r\nvar configFileSuffix = '/';\r\nvar configFileSet = configFileName + configFileSuffix;\r\nvar configFileDir = configFilePrefix + configFileSet;\r\nvar fileExtension = '.json';\r\nvar requestValue = 'GET';\r\nvar studyListPath = 'src/common/studyList.json';\r\nvar seriesPath = 'src/common/studies/';\r\n\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/** Environment Configuration Variables */\r\n/* ================================================== */\r\n\r\nvar configEnvFileName = 'env';\r\nvar envFileFull = configEnvFileName + fileExtension;\r\nvar configEnvFilePath = configFileDir + envFileFull;\r\n\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/**\r\n *\r\n * Load JSON configuration data from the sercer using\r\n * GET HTTP request\r\n *\r\n */\r\n/* ================================================== */\r\n\r\nvar readEnvConfigPath = fs.readFileSync(configEnvFilePath, 'utf8');\r\nvar configEnvObject = JSON.parse(readEnvConfigPath);\r\nvar configFileName = configEnvObject.environment;\r\n\r\nconsole.log(\"Index Read Env Config Path:\\n\", readEnvConfigPath);\r\nconsole.log(\"Index Config Env Object:\\n\", configEnvObject);\r\nconsole.log(\"Index Config File Name:\\n\", configFileName);\r\n\r\n/* ================================================== */\r\n/* ================================================== */\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/** Main Configuration Variables */\r\n/* ================================================== */\r\n\r\nvar fileFull = configFileName + fileExtension;\r\nvar configFilePath = configFileSet + fileFull;\r\n\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/**\r\n *\r\n * Load JSON configuration data from the sercer using\r\n * GET HTTP request\r\n *\r\n */\r\n/* ================================================== */\r\n\r\nvar readConfigPath = fs.readFileSync(configFilePath, 'utf8');\r\nvar configObject = JSON.parse(readConfigPath);\r\nvar dicomServerValue = configObject.dicomServer;\r\nvar portDicomValue = dicomServerValue[0].port;\r\nvar mainServerValue = configObject.mainServer;\r\nvar portValue = mainServerValue[0].port;\r\n\r\nconsole.log(\"Index Read Config Path:\\n\", readConfigPath);\r\nconsole.log(\"Index Config Object:\\n\", configObject);\r\nconsole.log(\"Index Main Server Value:\\n\", mainServerValue);\r\nconsole.log(\"Index DICOM Server Port Value:\\n\", portDicomValue);\r\nconsole.log(\"Index Port Value:\\n\", portValue);\r\n\r\n/* ================================================== */\r\n/* ================================================== */\r\n/* ================================================== */\r\n\r\n\r\n/* ================================================== */\r\n/**\r\n *\r\n * CORS Configuration\r\n *\r\n */\r\n/* ================================================== */\r\n\r\n\r\n\r\n/* ================================================== */\r\n/* ================================================== */\r\n/* ================================================== */\r\n\r\n\r\nvar saveFileHandler = function(path, data) {\r\n  fs.writeFile('dataset/' + path, data, function(err) {\r\n    if (err) {\r\n      console.log('Error in saving file ');\r\n    }\r\n    console.log('file saved!');\r\n  });\r\n};\r\n\r\nvar updateStudiesHandler = function(patientData) {\r\n  var studyList = JSON.parse(patientData)\r\n  fs.writeFile(studyListPath, JSON.stringify(studyList, null, 4), function(err) {\r\n    if (err) {\r\n      console.log('Error in saving file ');\r\n    }\r\n    console.log('file studyList.json updated successfully saved!');\r\n  });\r\n};\r\n\r\nvar updateStudiesFileHandler = function(fileData) {\r\n  var objectData = JSON.parse(fileData);\r\n  console.log(objectData.file.length);\r\n  for (var i = 0; i < objectData.file.length; i++) {\r\n\r\n    fs.writeFile(seriesPath + objectData.file[i].fileName + '.json', JSON.stringify(objectData.file[i].fileData, null, 4), function(err) {\r\n      if (err) {\r\n        console.log('Error in saving file:\\n' + err);\r\n      }\r\n      console.log('patients file created successfully:');\r\n    });\r\n  }\r\n};\r\n\r\nhttp.createServer(function(request, response) {\r\n  if (request.url == 'SaveFile' || request.url == '/SaveFile' || request.url == './SaveFile') {\r\n    var store = '';\r\n    request.on('data', function(chunk) {\r\n      store += chunk;\r\n    });\r\n\r\n    request.on('end', function() {\r\n      var objectData = JSON.parse(store);\r\n      saveFileHandler(objectData.path, store);\r\n      console.log(objectData.path);\r\n    });\r\n  };\r\n\r\n  if (request.url == 'UpdatePatients' || request.url == '/UpdatePatients' || request.url == './UpdatePatients') {\r\n    console.log('update patients');\r\n    var patientData = '';\r\n    request.on('data', function(chunk) {\r\n      patientData += chunk;\r\n    });\r\n\r\n    request.on('end', function() {\r\n      //console.log(patientData);\r\n      response.writeHead(200, {\r\n        'Content-Type': 'text/plain'\r\n      });\r\n      response.end('success');\r\n      updateStudiesHandler(patientData);\r\n    });\r\n  };\r\n\r\n  if (request.url == 'UpdatePatientFile' || request.url == '/UpdatePatientFile' || request.url == './UpdatePatientFile') {\r\n    console.log('update patients files in studies/<file>');\r\n    var fileData = '';\r\n    request.on('data', function(chunk) {\r\n      fileData += chunk;\r\n    });\r\n\r\n    request.on('end', function() {\r\n      //console.log(fileData);\r\n      response.writeHead(200, {\r\n        'Content-Type': 'text/plain'\r\n      });\r\n      response.end('success');\r\n      updateStudiesFileHandler(fileData);\r\n    });\r\n  };\r\n\r\n  var filePath = '.' + request.url;\r\n  if (filePath == './') {\r\n    filePath = '../public/index.html';\r\n  }\r\n\r\n  var extname = path.extname(filePath);\r\n  var contentType = 'text/html';\r\n  switch (extname) {\r\n    case '.js':\r\n      contentType = 'text/javascript';\r\n      break;\r\n    case '.css':\r\n      contentType = 'text/css';\r\n      break;\r\n    case '.json':\r\n      contentType = 'application/json';\r\n      break;\r\n    case '.png':\r\n      contentType = 'image/png';\r\n      break;\r\n    case '.jpg':\r\n      contentType = 'image/jpg';\r\n      break;\r\n    case '.wav':\r\n      contentType = 'audio/wav';\r\n      break;\r\n  }\r\n\r\n  fs.readFile(filePath, function(error, content) {\r\n    if (error) {\r\n      if (error.code == 'ENOENT') {\r\n        fs.readFile('../public/404.html', function(error, content) {\r\n          response.writeHead(200, {\r\n            'Content-Type': contentType\r\n          });\r\n          response.end(content, 'utf-8');\r\n        });\r\n      } else {\r\n        response.writeHead(500);\r\n        response.end('Sorry, check with the site admin for error: ' + error.code + ' ..\\n');\r\n        response.end();\r\n      }\r\n    } else {\r\n      response.writeHead(200, {\r\n        'Content-Type': contentType\r\n      });\r\n      response.end(content, 'utf-8');\r\n    }\r\n  });\r\n}).listen(portValue);\r\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/server/index.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 274,
    "kind": "variable",
    "name": "http",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~http",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 275,
    "kind": "variable",
    "name": "url",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~url",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 2,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 276,
    "kind": "variable",
    "name": "path",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~path",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 3,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 277,
    "kind": "variable",
    "name": "fs",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~fs",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 4,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 278,
    "kind": "variable",
    "name": "configFilePrefix",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFilePrefix",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": "Base Configuration Variables",
    "lineNumber": 11,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 279,
    "kind": "variable",
    "name": "configFileName",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 12,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 280,
    "kind": "variable",
    "name": "configFileSuffix",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFileSuffix",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 13,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 281,
    "kind": "variable",
    "name": "configFileSet",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFileSet",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 14,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 282,
    "kind": "variable",
    "name": "configFileDir",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFileDir",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 15,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 283,
    "kind": "variable",
    "name": "fileExtension",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~fileExtension",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 16,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 284,
    "kind": "variable",
    "name": "requestValue",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~requestValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 17,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 285,
    "kind": "variable",
    "name": "studyListPath",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~studyListPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 18,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 286,
    "kind": "variable",
    "name": "seriesPath",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~seriesPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 19,
    "undocument": true,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 287,
    "kind": "variable",
    "name": "configEnvFileName",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configEnvFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": "Environment Configuration Variables",
    "lineNumber": 28,
    "type": {
      "types": [
        "string"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 288,
    "kind": "variable",
    "name": "envFileFull",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~envFileFull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 29,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 289,
    "kind": "variable",
    "name": "configEnvFilePath",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configEnvFilePath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 30,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 290,
    "kind": "variable",
    "name": "readEnvConfigPath",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~readEnvConfigPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 44,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 291,
    "kind": "variable",
    "name": "configEnvObject",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configEnvObject",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 45,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 292,
    "kind": "variable",
    "name": "configFileName",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFileName",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 46,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 293,
    "kind": "variable",
    "name": "fileFull",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~fileFull",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": "Main Configuration Variables",
    "lineNumber": 61,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 294,
    "kind": "variable",
    "name": "configFilePath",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configFilePath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 62,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 295,
    "kind": "variable",
    "name": "readConfigPath",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~readConfigPath",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": "\nLoad JSON configuration data from the sercer using\nGET HTTP request",
    "lineNumber": 76,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 296,
    "kind": "variable",
    "name": "configObject",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~configObject",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 77,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 297,
    "kind": "variable",
    "name": "dicomServerValue",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~dicomServerValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 78,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 298,
    "kind": "variable",
    "name": "portDicomValue",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~portDicomValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 79,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 299,
    "kind": "variable",
    "name": "mainServerValue",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~mainServerValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 80,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 300,
    "kind": "variable",
    "name": "portValue",
    "memberof": "src/server/index.js",
    "static": true,
    "longname": "src/server/index.js~portValue",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 81,
    "undocument": true,
    "type": {
      "types": [
        "*"
      ]
    },
    "ignore": true
  },
  {
    "__docId__": 301,
    "kind": "function",
    "name": "saveFileHandler",
    "memberof": "src/server/index.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/server/index.js~saveFileHandler",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": "\nCORS Configuration",
    "lineNumber": 109,
    "params": [
      {
        "name": "path",
        "types": [
          "*"
        ]
      },
      {
        "name": "data",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 302,
    "kind": "function",
    "name": "updateStudiesHandler",
    "memberof": "src/server/index.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/server/index.js~updateStudiesHandler",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 118,
    "undocument": true,
    "params": [
      {
        "name": "patientData",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 303,
    "kind": "function",
    "name": "updateStudiesFileHandler",
    "memberof": "src/server/index.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/server/index.js~updateStudiesFileHandler",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/index.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 128,
    "undocument": true,
    "params": [
      {
        "name": "fileData",
        "types": [
          "*"
        ]
      }
    ],
    "return": null,
    "ignore": true
  },
  {
    "__docId__": 304,
    "kind": "file",
    "name": "src/server/utils/cors.js",
    "content": "/**\n * Make a X-Domain request to url and callback.\n *\n * @param url {String}\n * @param method {String} HTTP verb ('GET', 'POST', 'DELETE', etc.)\n * @param data {String} request body\n * @param callback {Function} to callback on completion\n * @param errback {Function} to callback on error\n */\n\n\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/server/utils/cors.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 305,
    "kind": "file",
    "name": "src/server/utils/fetchImage.js",
    "content": "function fetchImagePatients() {\n  fetch('http://localhost:8042/patients')\n  .then(data => data.json())\n}\n\nconsole.log('Fetch Image Patients: OK');\n",
    "static": true,
    "longname": "/Users/Francisco/Git/prototype-breast-screening/src/server/utils/fetchImage.js",
    "access": "public",
    "description": null,
    "lineNumber": 1
  },
  {
    "__docId__": 306,
    "kind": "function",
    "name": "fetchImagePatients",
    "memberof": "src/server/utils/fetchImage.js",
    "generator": false,
    "async": false,
    "static": true,
    "longname": "src/server/utils/fetchImage.js~fetchImagePatients",
    "access": "public",
    "export": false,
    "importPath": "prototype-breast-screening/src/server/utils/fetchImage.js",
    "importStyle": null,
    "description": null,
    "lineNumber": 1,
    "undocument": true,
    "params": [],
    "return": null,
    "ignore": true
  },
  {
    "kind": "index",
    "content": "# MIMBCD-UI Breast Screening Prototype\n\n<img src=\"assets/banner.png\"/>\n\n[MIMBCD-UI](https://mimbcd-ui.github.io/) is a Research Project that deals with the use of a recently proposed technique in literature: [Deep Convolutional Neural Networks (CNNs)](https://en.wikipedia.org/wiki/Convolutional_neural_network). These deep networks will incorporate information from several different modes by a User Interface (UI) implemented based on our [Prototype Cornerstone](https://github.com/MIMBCD-UI/prototype-cornerstone) repository. The [Prototype Cornerstone](https://github.com/MIMBCD-UI/prototype-cornerstone) repository is an Open Source Project with a goal to deliver an example of web based medical imaging platform for the breast cancer diagnosis. We also have several demos to see in our [YouTube Channel](https://www.youtube.com/channel/UCPz4aTIVHekHXTxHTUOLmXw), please follow us.\n\n## Instructions\n\nFirst of all, you will need [NodeJS](https://nodejs.org/) installed locally on your machine. This project needs both [`npm`](https://www.npmjs.com/) and [`http-server`](https://github.com/indexzero/http-server) dependencies to install and run the core project. If you do not have those installed please follow the [`INSTALL`](src/INSTALL.md) instructions.\n\n### Clone\n\nThe following assumes you will be using a [git](https://git-scm.com/) version control for this repository, storing thanks to [GitHub](https://github.com/). First, [Download](https://git-scm.com/downloads) and [Install](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git) [git](https://git-scm.com/).\n\n1.1. Clone the project repository:\n\n```\ngit clone git@github.com:MIMBCD-UI/prototype-breast-screening.git\n```\n\n1.2. Go to the project folder:\n\n```\ncd prototype-breast-screening/\n```\n\n### Install\n\n2.1. Install the local dependencies:\n\n```\nnpm install\n```\n\n2.2. You can now **Run** the project, just follow the [next section](https://github.com/MIMBCD-UI/prototype-breast-screening#run).\n\n### Run\n\n3.1. Inside the project folder:\n\n`cd prototype-breast-screening/`\n\n3.2. Start the DICOM Server (Orthanc) for [MacOS](https://www.orthanc-server.com/static.php?page=download-mac):\n\n`npm run dicom-server`\n\nOR\n\n```\ncd ..\ncd dicom-server/orthancAndPluginsOSX.stable/\n./startOrthanc.command\n```\n\n**NOTE**: If you are not using [MacOS](https://www.orthanc-server.com/static.php?page=download-mac), for instance, if you are using [Windows](https://www.orthanc-server.com/download-windows.php) or [Debian](https://packages.debian.org/search?keywords=orthanc&searchon=names&exact=1&suite=all&section=all) you have a [documentation](https://www.orthanc-server.com/static.php?page=documentation) for that. Just follow the [Windows](https://www.orthanc-server.com/resources/2015-02-09-emsy-tutorial/index.html) or [Debian](https://packages.debian.org/sid/orthanc) documentations. You also have several [other options](https://www.orthanc-server.com/download.php).\n\n\n3.3. Open the link:\n\n```\nlocalhost:8042\n```\n\nNOTE: If you need some help see the [Demo](https://youtu.be/tkzpT3KpY2A).\n\n3.4. Inside the project folder:\n\n```\ncd prototype-breast-screening/\n```\n\n3.5. Run the code:\n\n```\nnpm run build:prod\n```\n\n3.6. Start the project:\n\n```\nnpm start\n```\n\n3.7. Open the link:\n\n```\nlocalhost:8080/src/public/index.html\n```\n\n#### Allow-Control-Allow-Origin\n\nAccess-Control-Allow-Origin is a [CORS (Cross-Origin Resource Sharing) header](https://www.html5rocks.com/en/tutorials/cors/). If you want to know [How does Access-Control-Allow-Origin header work?](https://stackoverflow.com/questions/10636611/how-does-access-control-allow-origin-header-work) follow the link.\n\n##### Google Chrome\n\n* To deal with the CORS issue it is necessary to open [Google Chrome](https://www.google.com/intl/en/chrome/browser/desktop/) with `--disable-web-security` flag on:\n\n```\nopen /Applications/Google\\ Chrome.app --args --disable-web-security --user-data-dir\n```\n\n* Or install the  [CORS](https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?hl=en) plugin for [Google Chrome](https://www.google.com/intl/en/chrome/browser/desktop/).\n\n\n## About\n\nFor more information about the [MIMBCD-UI](https://mimbcd-ui.github.io/) Project just follow the [link](https://github.com/MIMBCD-UI/meta). Pieces of information about details of this repository are also in a [wiki](https://github.com/MIMBCD-UI/prototype-breast-screening/wiki). This prototype was developed using several libraries and dependencies. Despite that all libraries had their importance and supported the development, one of it was of chief importance. The [CornerstoneJS](https://cornerstonejs.org/) library and [secondary libraries](https://github.com/cornerstonejs), respectively, are supporting this prototype. We [Acknowledge](https://github.com/MIMBCD-UI/prototype-breast-screening/blob/master/README.md#acknowledgments) all people involved in the path.\n\n### License\n\nCopyright  2017 [Instituto Superior Tcnico (IST)](https://tecnico.ulisboa.pt/en/)\n\nThe [`prototype-breast-screening`](https://github.com/MIMBCD-UI/prototype-breast-screening) repository is distributed under the terms of both [Academic License](https://github.com/MIMBCD-UI/prototype-breast-screening/blob/master/ACADEMIC.md) and [Commercial License](https://github.com/MIMBCD-UI/prototype-breast-screening/blob/master/COMMERCIAL.md), for academic and commercial purpose, respectively. For more information regarding the [License](https://github.com/MIMBCD-UI/prototype-breast-screening/blob/master/LICENSE.md) of the hereby repository, just follow both [ACADEMIC](https://github.com/MIMBCD-UI/prototype-breast-screening/blob/master/ACADEMIC.md) and [COMMERCIAL](https://github.com/MIMBCD-UI/prototype-breast-screening/blob/master/COMMERCIAL.md) files.\n\n### Acknowledgments\n\nA special thanks to [Chris Hafey](https://www.linkedin.com/in/chafey/), the propelling person of [CornerstoneJS](https://cornerstonejs.org/), who also developed the [cornerstoneDemo](https://github.com/chafey/cornerstoneDemo). Not forgetting the three supporters of the CornerstoneJS library, [Alos Dreyfus](https://www.linkedin.com/in/alois-dreyfus), [Danny Brown](http://dannyrb.com/) and [Erik Ziegler](https://www.npmjs.com/~swederik). We also would like to give a special thanks to [Erik Ziegler](https://www.npmjs.com/~swederik) who support several [issues](https://groups.google.com/forum/#!forum/cornerstone-platform) during this path.\n\n- [Alos Dreyfus](https://www.linkedin.com/in/alois-dreyfus) ([adreyfus](https://github.com/adreyfus))\n\n- [Chris Hafey](https://www.linkedin.com/in/chafey/) ([chafey](https://github.com/chafey))\n\n- [Danny Brown](http://dannyrb.com/) ([dannyrb](https://github.com/dannyrb))\n\n- [Erik Ziegler](https://www.npmjs.com/~swederik) ([swederik](https://github.com/swederik))\n\n- [Jason Hostetter](http://www.jasonhostetter.com/)\n\n- [Marcelo Ribeiro](http://www.sysline.inf.br/) ([sysline](https://github.com/sysline))\n\n- [Sbastien Jodogne](https://www.linkedin.com/in/jodogne/) ([jodogne](https://github.com/jodogne))\n\n- [Steve Pieper](https://lmi.med.harvard.edu/people/steve-pieper)\n",
    "longname": "/Users/Francisco/Git/prototype-breast-screening/README.md",
    "name": "./README.md",
    "static": true,
    "access": "public"
  },
  {
    "kind": "packageJSON",
    "content": "{\n  \"name\": \"prototype-breast-screening\",\n  \"version\": \"0.1.0\",\n  \"main\": \"src/js/index.js\",\n  \"description\": \"MIMBCD-UI Prototype Breast Screening\",\n  \"keywords\": [\n    \"DICOM\",\n    \"WADO\",\n    \"medical\",\n    \"imaging\"\n  ],\n  \"author\": \"Francisco Maria Calisto\",\n  \"homepage\": \"https://github.com/MIMBCD-UI/prototype-breast-screening\",\n  \"license\": \"MIT\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/MIMBCD-UI/prototype-breast-screening\"\n  },\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"install\": \"cd src npm install\",\n    \"build\": \"webpack-dev-server\",\n    \"build:prod\": \"webpack -p\",\n    \"start\": \"node src/server/index.js &\",\n    \"clean:dataset\": \"rimraf dataset/*\",\n    \"clean:studies\": \"rimraf src/common/studies/*\",\n    \"clean:study\": \"rimraf src/common/studyList.json\",\n    \"clean:dirs\": \"npm run clean:dataset & npm run clean:studies\",\n    \"clean:paths\": \"npm run clean:dirs & npm run clean:study\",\n    \"clean\": \"npm run clean:paths && touch src/common/studyList.json\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^6.26.0\",\n    \"babel-loader\": \"^7.1.2\",\n    \"babel-preset-es2015\": \"^6.24.1\",\n    \"babel-preset-react\": \"^6.24.1\",\n    \"browserify\": \"^14.5.0\",\n    \"fs\": \"^0.0.1-security\",\n    \"grunt-contrib-clean\": \"^0.5.0\",\n    \"grunt-contrib-concat\": \"^0.3.0\",\n    \"grunt-contrib-copy\": \"0.4.x\",\n    \"grunt-contrib-jshint\": \"^0.8.0\",\n    \"grunt-contrib-qunit\": \"^0.4.0\",\n    \"grunt-contrib-uglify\": \"^0.4.0\",\n    \"grunt-contrib-watch\": \"^0.6.1\",\n    \"gulp-gh-pages\": \"^0.5.4\",\n    \"html-webpack-plugin\": \"^3.0.4\",\n    \"jshint\": \"^2.9.5\",\n    \"jshint-loader\": \"^0.8.4\",\n    \"load-grunt-tasks\": \"^0.2.1\",\n    \"node-libs-browser\": \"^2.1.0\",\n    \"rimraf\": \"^2.6.2\",\n    \"webpack\": \"^3.10.0\",\n    \"webpack-dev-server\": \"^2.11.1\"\n  },\n  \"dependencies\": {\n    \"catta\": \"^2.1.1\",\n    \"common-js\": \"^0.3.8\",\n    \"cors\": \"^2.8.4\",\n    \"cors-middleware\": \"^3.0.0\",\n    \"corsproxy\": \"^1.5.0\",\n    \"ecstatic\": \"^3.1.1\",\n    \"esdoc\": \"^1.0.4\",\n    \"esdoc-standard-plugin\": \"^1.0.0\",\n    \"express\": \"^4.16.2\",\n    \"fs\": \"^0.0.1-security\",\n    \"grunt\": \"^0.4.5\",\n    \"gulp-util\": \"^3.0.8\",\n    \"http-server\": \"^0.9.0\",\n    \"merry\": \"^5.5.2\",\n    \"requirejs\": \"^2.3.5\",\n    \"semver\": \"^5.5.0\"\n  }\n}\n",
    "longname": "/Users/Francisco/Git/prototype-breast-screening/package.json",
    "name": "package.json",
    "static": true,
    "access": "public"
  }
]